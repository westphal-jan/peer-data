{"id": "1606.04216", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "14-Jun-2016", "title": "Spreadsheet Probabilistic Programming", "abstract": "Spreadsheet workbook contents are simple programs. Because of this, probabilistic programming techniques can be used to perform Bayesian inversion of spreadsheet computations. What is more, existing execution engines in spreadsheet applications such as Microsoft Excel can be made to do this using only built-in functionality. We demonstrate this by developing a native Excel implementation of both a particle Markov Chain Monte Carlo variant and black-box variational inference for spreadsheet probabilistic programming. The resulting engine performs probabilistically coherent inference over spreadsheet computations, notably including spreadsheets that include user-defined black-box functions. Spreadsheet engines that choose to integrate the functionality we describe in this paper will give their users the ability to both easily develop probabilistic models and maintain them over time by including actuals via a simple user-interface mechanism. For spreadsheet end-users this would mean having access to efficient and probabilistically coherent probabilistic modeling and inference for use in all kinds of decision making under uncertainty.", "histories": [["v1", "Tue, 14 Jun 2016 07:01:00 GMT  (56kb,D)", "http://arxiv.org/abs/1606.04216v1", null]], "reviews": [], "SUBJECTS": "cs.AI cs.PL", "authors": ["mike wu", "yura perov", "frank wood", "hongseok yang"], "accepted": false, "id": "1606.04216"}, "pdf": {"name": "1606.04216.pdf", "metadata": {"source": "CRF", "title": "Spreadsheet Probabilistic Programming", "authors": ["Mike Wu", "Yura Perov", "Frank Wood", "Hongseok Yang"], "emails": ["mike@invrea.com", "yura@invrea.com", "frank@invrea.com", "hongseok@invrea.com"], "sections": [{"heading": "1 Introduction", "text": "Spreadsheets are the de facto lingua franca of data analysis [Panko, 2008]. They are the principle of what-if simulation and decision-making tool for millions of users [Scaffidi et al., 2005, Chan and Storey, 1996]. Spreadsheet users often translate internal beliefs and expertise into simulations in the form of spreadsheet programs, without necessarily realizing that they are programmed themselves. A common spreadsheet simulation is one in which assumptions are set apart, often on a separate worksheet, and a dependent prediction simulation is specified, for example, a sequence of dividend payments given, and the decision policy of a business unit. These simulations are used to make predictions for decision-making amid uncertainty; for example, an investment decision based on the distribution of an internal rate of return calculation. The usual way that compatibility is injected into such simulations is through manual values reflecting the uncertainty of their values."}, {"heading": "2 Abstract Spreadsheet Language", "text": "We begin by formalizing the syntax and semantics of our spreadsheet, proving important properties of the language. These properties allow us to safely apply certain sequencing algorithms, as discussed later in this paper. Intuitively, grammar uses c for constant numbers (such as 1.0 and \u2212 2.4), r for cell references, primOp for primitive operators (such as + and log), and blackOp for custom black box operators. Typically, these black box operators are external custom functions such as Excel VBA functions, and they can be stochastic and model unknown probability distributions. According to grammar, an expression can be a constant c, the value of a cell r, or the result of applying deterministic or chastic methods."}, {"heading": "3 Spreadsheet Inference", "text": "After we have proven that a spreadsheet is finished and know that there is a total order for the cells in a spreadsheet, we can safely use algorithms based on Monte Carlo sequential (SMC) algorithm 2 Spreadsheet black-box inference (follows algorithm 1 of Ranganath and al. [2013]) Input: Program f: Ref \u2192 Expr, Common Distribution P, Distribution Q, Number of particles S, Graph G = (V, E), Convergence constant linked to iterations tmax, Number of samples per iteration S, Learning rate, Number of stochastic operators in the program Lerp. Variables: State, Free parameters of distribution Q for a particular random choice l, Common Log probability of a particular sample Tp, Common Log probability Tq for variable distributions Q, Vector of graditions for Ql, Number of applications for a random choice Tt (l), Learning rate."}, {"heading": "4 Experiments", "text": "To demonstrate the practicality of implementing SMC and BBVI inferences natively in a spreadsheet engine from 1983 to 1983, we show correctness using a regression example and show that both inferences can perform on spreadsheets that include custom functions. Excel's abstract spreadsheet syntax allows users to use random primitives (= GAUSSIAN (\u00b7), = CHOICE (\u00b7) and = BETWEEN (\u00b7) and \"observe\" cells via a syntax = ACTUAL (data, model, parameters) shown in each of the following examples. SMC and BBVI are both implemented in VB and are used as Excel add-ins, which means that inference functionality can be added to existing spreadsheets. For the following examples, all SMC runs are used 5000 particles on islands of 500 and all BBVI runs are used with Iterations."}, {"heading": "5 Related Work", "text": "Existing work on the use of variable Bayes Wingate and Weber [2013], Mansinghka et al. [2014] and specifically black box variations of Bayes in probabilistic programming Kucukelbir et al. [2014] inspired this work. The formalism we present in this paper provides some theoretical justification for some of this state of the art, but also raises questions, especially in relation to stochastic optimization in infinite dimensions. Here, both BBVI and SMC rely on repeated reexecution of the program guided by bid distributions. Having proven the termination of all programs written in our abstract spreadsheet, we can be sure that the compilation carried out in the inner loop of our inference algorithm is completed each time, and as a result we can rely on our inference algorithm also being terminated. Prior probabilistic programming inference work reposed on SMC, namely [Wood et al, Wood, Wood, Paghet al."}, {"heading": "6 Discussion", "text": "We have shown that Bayesian model inversion can be natively implemented in a spreadsheet engine by both the Monte Carlo sequential method and black box variations, and is safe in the sense that it is theoretically on a sound footing. Implementation into additional spreadsheet engines is still under way, which could lead to a transition from deterministic to probabilistic conditional spreadsheets, which in turn could fundamentally change the way spreadsheets are developed and used to analyze and model data in the future."}], "references": [{"title": "Particle Markov chain Monte Carlo methods", "author": ["Christophe Andrieu", "Arnaud Doucet", "Roman Holenstein"], "venue": "Journal of the Royal Statistical Society: Series B (Statistical Methodology),", "citeRegEx": "Andrieu et al\\.,? \\Q2010\\E", "shortCiteRegEx": "Andrieu et al\\.", "year": 2010}, {"title": "The use of spreadsheets in organizations: Determinants and consequences", "author": ["Yolande E Chan", "Veda C Storey"], "venue": "Information & Management,", "citeRegEx": "Chan and Storey.,? \\Q1996\\E", "shortCiteRegEx": "Chan and Storey.", "year": 1996}, {"title": "Church: a language for generative models", "author": ["Noah D. Goodman", "Vikash K. Mansinghka", "Daniel M. Roy", "Keith Bonawitz", "Joshua B. Tenenbaum"], "venue": "In Proc. of Uncertainty in Artificial Intelligence,", "citeRegEx": "Goodman et al\\.,? \\Q2008\\E", "shortCiteRegEx": "Goodman et al\\.", "year": 2008}, {"title": "Tabular: a schema-driven probabilistic programming language", "author": ["Andrew D Gordon", "Thore Graepel", "Nicolas Rolland", "Claudio Russo", "Johannes Borgstrom", "John Guiver"], "venue": "In ACM SIGPLAN Notices,", "citeRegEx": "Gordon et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Gordon et al\\.", "year": 2014}, {"title": "Learning to pass expectation propagation messages", "author": ["Nicolas Heess", "Daniel Tarlow", "John Winn"], "venue": "In Advances in Neural Information Processing Systems,", "citeRegEx": "Heess et al\\.,? \\Q2013\\E", "shortCiteRegEx": "Heess et al\\.", "year": 2013}, {"title": "Fully automatic variational inference of differentiable probability models", "author": ["Alp Kucukelbir", "Rajesh Ranganath", "Andrew Gelman", "David Blei"], "venue": "In NIPS Workshop on Probabilistic Programming,", "citeRegEx": "Kucukelbir et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Kucukelbir et al\\.", "year": 2014}, {"title": "Venture: a higher-order probabilistic programming platform with programmable inference. arXiv, page", "author": ["Vikash Mansinghka", "Daniel Selsam", "Yura Perov"], "venue": null, "citeRegEx": "Mansinghka et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Mansinghka et al\\.", "year": 2014}, {"title": "A family of algorithms for approximate Bayesian inference", "author": ["Thomas P Minka"], "venue": "PhD thesis, Massachusetts Institute of Technology,", "citeRegEx": "Minka.,? \\Q2001\\E", "shortCiteRegEx": "Minka.", "year": 2001}, {"title": "A compilation target for probabilistic programming languages", "author": ["Brooks Paige", "Frank Wood"], "venue": "In JMLR; ICML", "citeRegEx": "Paige and Wood.,? \\Q2014\\E", "shortCiteRegEx": "Paige and Wood.", "year": 2014}, {"title": "Spreadsheet errors: What we know. what we think we can do", "author": ["Raymond R Panko"], "venue": "arXiv preprint arXiv:0802.3457,", "citeRegEx": "Panko.,? \\Q2008\\E", "shortCiteRegEx": "Panko.", "year": 2008}, {"title": "IBAL: A probabilistic rational programming language", "author": ["Avi Pfeffer"], "venue": "In IJCAI,", "citeRegEx": "Pfeffer.,? \\Q2001\\E", "shortCiteRegEx": "Pfeffer.", "year": 2001}, {"title": "Figaro: An object-oriented probabilistic programming language. Charles River Analytics", "author": ["Avi Pfeffer"], "venue": "Technical Report,", "citeRegEx": "Pfeffer.,? \\Q2009\\E", "shortCiteRegEx": "Pfeffer.", "year": 2009}, {"title": "Black box variational inference", "author": ["Rajesh Ranganath", "Sean Gerrish", "David M Blei"], "venue": "arXiv preprint arXiv:1401.0118,", "citeRegEx": "Ranganath et al\\.,? \\Q2013\\E", "shortCiteRegEx": "Ranganath et al\\.", "year": 2013}, {"title": "Estimating the numbers of end users and end user programmers", "author": ["Christopher Scaffidi", "Mary Shaw", "Brad Myers"], "venue": "In Visual Languages and Human-Centric Computing,", "citeRegEx": "Scaffidi et al\\.,? \\Q2005\\E", "shortCiteRegEx": "Scaffidi et al\\.", "year": 2005}, {"title": "Particle Gibbs with Ancestor Sampling for Probabilistic Programs", "author": ["Jan-Willem van de Meent", "Hongseok Yang", "Vikash Mansinghka", "Frank Wood"], "venue": "In Artificial Intelligence and Statistics,", "citeRegEx": "Meent et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Meent et al\\.", "year": 2015}, {"title": "Automated variational inference in probabilistic programming", "author": ["David Wingate", "Theophane Weber"], "venue": "arXiv preprint arXiv:1301.1299,", "citeRegEx": "Wingate and Weber.,? \\Q2013\\E", "shortCiteRegEx": "Wingate and Weber.", "year": 2013}, {"title": "Lightweight implementations of probabilistic programming languages via transformational compilation", "author": ["David Wingate", "Andreas Stuhlmueller", "Noah D Goodman"], "venue": "In International Conference on Artificial Intelligence and Statistics,", "citeRegEx": "Wingate et al\\.,? \\Q2011\\E", "shortCiteRegEx": "Wingate et al\\.", "year": 2011}, {"title": "A new approach to probabilistic programming inference", "author": ["Frank Wood", "Jan-Willem van de Meent", "Vikash Mansinghka"], "venue": "In Artificial Intelligence and Statistics,", "citeRegEx": "Wood et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Wood et al\\.", "year": 2014}], "referenceMentions": [{"referenceID": 9, "context": "Spreadsheets are the de facto lingua franca of data analysis [Panko, 2008].", "startOffset": 61, "endOffset": 74}, {"referenceID": 12, "context": ", 2014], and particularly black-box variational inference [Ranganath et al., 2013], for probabilistic programming.", "startOffset": 58, "endOffset": 82}, {"referenceID": 6, "context": "Also note that actual is novel to spreadsheet languages but closely corresponds to the notion of observation in the probabilistic programming literature Mansinghka et al. [2014], Wood et al.", "startOffset": 153, "endOffset": 178}, {"referenceID": 6, "context": "Also note that actual is novel to spreadsheet languages but closely corresponds to the notion of observation in the probabilistic programming literature Mansinghka et al. [2014], Wood et al. [2014].", "startOffset": 153, "endOffset": 198}, {"referenceID": 12, "context": "Algorithm 2 Spreadsheet Black-Box Inference (follows Algorithm 1 from Ranganath et al. [2013]) Input: program f : Ref \u2192 Expr , joint distribution P , distribution Q, number of particles S, graph G = (V,E), convergence constant \u03b5, bound on iterations tmax , number of samples per iteration S, learning rate parameter \u03b3, number of stochastic operators in the program L \u2217 .", "startOffset": 70, "endOffset": 94}, {"referenceID": 0, "context": "Algorithm 1 gives a detailed implementation of a version of SMC, the inner loop of the particle independent Metropolis Hastings (PIMH)-like algorithm Andrieu et al. [2010] we implemented in", "startOffset": 150, "endOffset": 172}, {"referenceID": 0, "context": "That we can do this follows directly from the PIMH results in [Andrieu et al., 2010] where instead of doing MH on ratios of evidence estimates we simply do importance sampling with weights proportional to the evidence estimates.", "startOffset": 62, "endOffset": 84}, {"referenceID": 13, "context": "Existing work on using variational Bayes Wingate and Weber [2013], Mansinghka et al.", "startOffset": 41, "endOffset": 66}, {"referenceID": 5, "context": "Existing work on using variational Bayes Wingate and Weber [2013], Mansinghka et al. [2014] and specifically black box variational Bayes in probabilistic programming Kucukelbir et al.", "startOffset": 67, "endOffset": 92}, {"referenceID": 5, "context": "[2014] and specifically black box variational Bayes in probabilistic programming Kucukelbir et al. [2014] inspired this work.", "startOffset": 81, "endOffset": 106}, {"referenceID": 3, "context": "There are discernible differences between our approach and Tabular, a probabilistic programming language for Excel created by Microsoft Research [Gordon et al., 2014].", "startOffset": 145, "endOffset": 166}, {"referenceID": 7, "context": "Furthermore, Tabular does not allow black-box user-programmed primitives owing to their incompatibility with, for instance, EP [Minka, 2001] inference (aka Infer.", "startOffset": 127, "endOffset": 140}], "year": 2016, "abstractText": "Spreadsheet workbook contents are simple programs. Because of this, probabilistic programming techniques can be used to perform Bayesian inversion of spreadsheet computations. What is more, existing execution engines in spreadsheet applications such as Microsoft Excel can be made to do this using only built-in functionality. We demonstrate this by developing a native Excel implementation of both a particle Markov Chain Monte Carlo variant and black-box variational inference for spreadsheet probabilistic programming. The resulting engine performs probabilistically coherent inference over spreadsheet computations, notably including spreadsheets that include user-defined black-box functions. Spreadsheet engines that choose to integrate the functionality we describe in this paper will give their users the ability to both easily develop probabilistic models and maintain them over time by including actuals via a simple user-interface mechanism. For spreadsheet end-users this would mean having access to efficient and probabilistically coherent probabilistic modeling and inference for use in all kinds of decision making under uncertainty.", "creator": "LaTeX with hyperref package"}}}