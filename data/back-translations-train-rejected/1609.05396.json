{"id": "1609.05396", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "17-Sep-2016", "title": "A Deep Metric for Multimodal Registration", "abstract": "Multimodal registration is a challenging problem in medical imaging due the high variability of tissue appearance under different imaging modalities. The crucial component here is the choice of the right similarity measure. We make a step towards a general learning-based solution that can be adapted to specific situations and present a metric based on a convolutional neural network. Our network can be trained from scratch even from a few aligned image pairs. The metric is validated on intersubject deformable registration on a dataset different from the one used for training, demonstrating good generalization. In this task, we outperform mutual information by a significant margin.", "histories": [["v1", "Sat, 17 Sep 2016 21:46:21 GMT  (752kb,D)", "http://arxiv.org/abs/1609.05396v1", "Accepted to MICCAI 2016; extended version"]], "COMMENTS": "Accepted to MICCAI 2016; extended version", "reviews": [], "SUBJECTS": "cs.CV cs.LG cs.NE", "authors": ["martin simonovsky", "benjam\\'in guti\\'errez-becker", "diana mateus", "nassir navab", "nikos komodakis"], "accepted": false, "id": "1609.05396"}, "pdf": {"name": "1609.05396.pdf", "metadata": {"source": "CRF", "title": "A Deep Metric for Multimodal Registration", "authors": ["Martin Simonovsky", "Benjam\u0131\u0301n Guti\u00e9rrez-Becker", "Diana Mateus", "Nassir Navab", "Nikos Komodakis"], "emails": ["martin.simonovsky@enpc.fr", "nikos.komodakis@enpc.fr"], "sections": [{"heading": "1 Introduction", "text": "The main difficulty of the multimodal registration task lies in the high variability of tissues or organs when they are mapped by different physical principles, resulting in the lack of a general rule for comparing such images. Therefore, efforts to solve this problem focus mainly on the design of multimodal similarity metrics. Recent work has examined the use of monitored methods to learn similarity metrics from a series of concerted examples [2,8,11] that show the potential to surpass handmade metrics in certain applications. A general method for learning similarities between two modalities requires higher capacity models.Inspired by their success in computer vision, we propose to learn such a general similarity metric based on Convolutional Neural Networks (CNNs)."}, {"heading": "1.1 Related Work", "text": "On the one hand, there are probabilistic approaches based on modeling the common image distribution. For example, Guetter et al. propose a generative method based on the Kullback-Leibler divergence [6]. Our work is closer to the discriminatory concept proposed by Lee et al. [8] and Michel et al. [11], which poses the problem of learning a similarity metric as a binary classification, where the goal is to distinguish between aligned and misaligned image pairs. Lee et al. propose the use of a structured support vector machine, while Michel et al. use a method based on Adaboost. In contrast to these approaches, we rely on CNN as our learning method of choice as a suitable set of characteristics for each type of modality combination."}, {"heading": "2 Method", "text": "Image registration is the task of estimating the best spatial transformation. In our environment, d = 3 and the images each come from a different modality. The problem is often solved by minimizing the energyE (\u03b8) = M (If, Im (T (\u03b8)) + R (T)) (1), with the first term M being a metric for quantifying the cost of alignment through transformation T parameterized by \u03b8, and the second term R being a regulation that limits mapping. We refer to the moving image that is re-sampled by T as the distorted image I \u2032 m = Im (Tennessee): minimization is usually solved within a continuous or discrete optimization frame."}, {"heading": "2.1 Continuous Optimization", "text": "Continuous optimization methods iteratively update the parameters \u03b8 based on the gradient of the objective function E (\u03b8).We limit ourselves to first-order methods and use gradient lineage in particular. Our metric is defined for aggregated local patch comparisons asM (If, I \u2032 m) = \u2211 P N (If (P), I \u2032 m (P)))) (2), where P is sampled for the set of patch domains P \u00b2 f on a dense uniform network with significant overlaps. The method is shown in Figure 1. Its gradient is required for all patch operations by applying chain rules as follows: If (P), I \u00b2 m (P), x (P), x (P), x (P), x, x, P, x, P, x, P, x, P, P, x, P, P, x, P, P, x, P, P, x, P, P, x, P, P, x, P, P, P, P, x, P, P, P, x, P, P (P), P (P), P (P), P (P), P, P, P, P, P (P), P, P, P, P, P, P, P, P, P, P (P, P, P, P, P, P, P, P, P (P), P, P, P, P, P, P, P, P, P (P, P, P, P, P, P, P, P, P, P, P, P, P, P, P (P, P, P), P, P, P (P, P, P, P, P (P), P, P (P), P, P (P), P, P, P, P), P (P, P, P, P, P), P, P (P), P, P (P), P (P), P (x, P), P (x, P), P), P, P, P, P, P (P, P, P (P), P (P), P (x, P), P), P (x, P), P,"}, {"heading": "2.2 Network Architecture and Training", "text": "The architecture is based on recent work on learning to compare patches, in particular the 2-channel network of Zagoruyko and Komodakis [14], which is considered a 2-channel 3D image (each channel represents a different modality) that is fed into the first layer of the network.The network consists of a series of volumetric revolutionary layers with ReLU non-linearity, characterized by a revolutionary layer without any non-linearity, which is a scalar score.In order to gradually substitute the spatial domain within the network and increase the spatial context (perceptive field), we prefer constellations with non-unit output as it has led to better performance."}, {"heading": "3 Experiments and Results", "text": "We evaluate the effectiveness of the learned measurement in registration experiments on a number of clinical brain images in Section 3.1 and conduct further experiments to demonstrate their interesting properties in Section 3.2 and 3.3."}, {"heading": "3.1 Deformable Registration of Neonatal Brain MRI Images", "text": "This database consists of T1 and T2-weighted MRI scans of 20 newborns. Each T1-T2 pair is aligned and commented on with a segmentation map of 50 anatomical regions that allows us to evaluate the quality of registration in terms of overlap measures. Each T1-T2 pair is aligned with a segmentation map of 50 anatomical regions that allows us to measure the quality of registration in terms of overlap; we calculate average dice and jaccard coefficients. To make the experiment challenging and demonstrate a good generalization of our learned metrics (reported by CNN), we train on IXI [1], a completely independent dataset of adult brain images. Let us note that there are structural differences between the brains of neonates and adults. The datasets contain about 600 approximately matched pairs of T1-T2 image pairs, and we will use 557 pairs to validate the rest, although much less is needed for training."}, {"heading": "3.2 Influence of Training Set Size", "text": "The large number of coordinated volumes in the IXI data set is rather unusual in the medical field. Therefore, we are interested in how much we can reduce the size of the training set k without noticeable effects on the quality. To this end, we train networks with only k = 11, 6 and 3 random image pairs under the same setting as above. Table 1 shows that the results are very good even with few training data and do not significantly exceed our measurement MI + M only for k = 3. On the one hand, this indicates that our online sampling and data augmentation method works well. On the other hand, either the inherent variability in the data set is very low (especially compared to natural image recognition problems, where more data typically improves performance) or our network is not able to exploit. We expect that the amount of necessary data will be higher with more demanding modalities such as ultrasound."}, {"heading": "3.3 Plausibility of Metric and Its Derivatives", "text": "To study the behavior of metric values and their actual derivatives for continuous optimization, we visualize these sets by manually aligning a single parameter of a transformation initialized to identity to an aligned validation image pair in IXI. Figure 3 suggests that the metric behaves reasonably, since its curves are smooth with the correct local minima. Analytical derivatives, as in Equation (5), show the correct sign over a large area, although their size is somewhat noisy. Nevertheless, it has been shown that this does not prevent the metric from achieving good registration results."}, {"heading": "4 Conclusion", "text": "We have presented a similarity metric for multi-modal 3D image registration based on a Convolutionary Neural Network. The network can even be trained from the ground up using some aligned image pairs, largely based on our data sampling scheme. We have described the incorporation of this metric into first-class, continuous optimization frameworks. Experimental evaluation was performed on the task of the interdisciplinary T1-T2 deformable registration on a data set different from that used for training, demonstrating good generalization. In this task, we clearly exceed mutual information. We envision incorporating our network into a discrete optimization framework as a simple extension. In an MRF-based formulation, local alignment costs are expressed through uniform potentials across nodes in a diagram [4]. Specifically, a mixed potential gn (un) related to the cost of assigning a label / un to a node."}, {"heading": "A Comparison with MIND", "text": "The Modality Independent Neighborhood Descriptor (MIND) is a state-of-the-art multimodal descriptor by Heinrich et al. [7] based on the concept of self-similarity. We carried out the same set of 68 registrations as in paragraph 3.1 using the code from the authors \"website. After validating its three main hyperparameters (six-quarter search region, Gaussian weighting \u03c3 = 0.5, regularization \u03b1 = 0.2), we obtained a cube value of 0.610 \u00b1 0.073 (see also Figure 4) or a Jaccard score of 0.458 \u00b1 0.070. The results are significantly inferior to both MI + M and our CNN-based approach, although the duration was much shorter. However, we emphasize that their deformable registration code does not follow our pipeline described in paragraph 3.1 (different regulation and optimization, no similarity transformation step), and therefore serves the purpose of comparing sybsyb.syb.dia / / www.juel.http: / www.juel.ed.ed."}], "references": [{"title": "Robust multimodal dictionary learning", "author": ["T. Cao", "V. Jojic", "S. Modla", "D. Powell", "K. Czymmek", "M. Niethammer"], "venue": "Mori, K., Sakuma, I., Sato, Y., Barillot, C., Navab, N. (eds.) MICCAI. LNCS, vol. 8149, pp. 259\u2013266. Springer", "citeRegEx": "2", "shortCiteRegEx": null, "year": 2013}, {"title": "Deep similarity learning for multimodal medical images", "author": ["X. Cheng", "L. Zhang", "Y. Zheng"], "venue": "Computer Methods in Biomechanics and Biomedical Engineering: Imaging & Visualization. pp. 1\u20135", "citeRegEx": "3", "shortCiteRegEx": null, "year": 2015}, {"title": "Deformable medical image registration: Setting the state of the art with discrete methods", "author": ["B. Glocker", "A. Sotiras", "N. Komodakis", "N. Paragios"], "venue": "Annual Review of Biomedical Engineering 13, 219\u2013244", "citeRegEx": "4", "shortCiteRegEx": null, "year": 2011}, {"title": "Magnetic resonance imaging of the newborn brain: Manual segmentation of labelled atlases in term-born and preterm infants", "author": ["I. Gousias", "A. Edwards", "M. Rutherford", "S. Counsell", "J. Hajnal", "D. Rueckert", "A. Hammers"], "venue": "Neuroimage 62,", "citeRegEx": "5", "shortCiteRegEx": "5", "year": 2012}, {"title": "Learning based non-rigid multi-modal image registration using Kullback-Leibler divergence", "author": ["C. Guetter", "C. Xu", "F. Sauer", "J. Hornegger"], "venue": "Duncan, J.S., Gerig, G. (eds.) MICCAI. LNCS, vol. 3750, pp. 255\u2013262. Springer", "citeRegEx": "6", "shortCiteRegEx": null, "year": 2005}, {"title": "MIND: Modality independent neighbourhood descriptor for multi-modal deformable registration", "author": ["M.P. Heinrich", "M. Jenkinson", "M. Bhushan", "T. Matin", "F.V. Gleeson", "S.M. Brady", "J.A. Schnabel"], "venue": "Medical image analysis 16, 1423\u201335", "citeRegEx": "7", "shortCiteRegEx": null, "year": 2012}, {"title": "Learning similarity measure for multi-modal 3D image registration", "author": ["D. Lee", "M. Hofmann", "F. Steinke", "Y. Altun", "N. Cahill", "B. Scholkopf"], "venue": "CVPR. pp. 186\u2013193", "citeRegEx": "8", "shortCiteRegEx": null, "year": 2009}, {"title": "Fully convolutional networks for semantic segmentation", "author": ["J. Long", "E. Shelhamer", "T. Darrell"], "venue": "CVPR. pp. 3431\u20133440", "citeRegEx": "9", "shortCiteRegEx": null, "year": 2015}, {"title": "Nonrigid multimodality image registration", "author": ["D. Mattes", "D.R. Haynor", "H. Vesselle", "T.K. Lewellyn", "W. Eubank"], "venue": "SPIE. vol. 4322, pp. 1609\u20131620", "citeRegEx": "10", "shortCiteRegEx": null, "year": 2001}, {"title": "Boosted metric learning for 3d multi-modal deformable registration", "author": ["F. Michel", "M. Bronstein", "A. Bronstein", "N. Paragios"], "venue": "ISBI. pp. 1209\u20131214", "citeRegEx": "11", "shortCiteRegEx": null, "year": 2011}, {"title": "Cross-domain synthesis of medical images using efficient location-sensitive deep network", "author": ["H.V. Nguyen", "S.K. Zhou", "R. Vemulapalli"], "venue": "Navab, N., Hornegger, J., Wells III, W.M., Frangi, A.F. (eds.) MICCAI. LNCS, vol. 9349, pp. 677\u2013684. Springer", "citeRegEx": "12", "shortCiteRegEx": null, "year": 2015}, {"title": "Deformable medical image registration: A survey", "author": ["A. Sotiras", "C. Davatzikos", "N. Paragios"], "venue": "TMI 32(7), 1153\u20131190", "citeRegEx": "13", "shortCiteRegEx": null, "year": 2013}, {"title": "Learning to compare image patches via convolutional neural networks", "author": ["S. Zagoruyko", "N. Komodakis"], "venue": "CVPR. pp. 4353\u20134361", "citeRegEx": "14", "shortCiteRegEx": null, "year": 2015}], "referenceMentions": [{"referenceID": 11, "context": "Multimodal registration is a very challenging problem in medical imaging commonly faced during image-guided interventions and data fusion [13].", "startOffset": 138, "endOffset": 142}, {"referenceID": 0, "context": "Recent works have explored the use of supervised methods to learn similarity metrics from a set of aligned examples [2,8,11], showing potential to outperform hand-crafted metrics in particular applications.", "startOffset": 116, "endOffset": 124}, {"referenceID": 6, "context": "Recent works have explored the use of supervised methods to learn similarity metrics from a set of aligned examples [2,8,11], showing potential to outperform hand-crafted metrics in particular applications.", "startOffset": 116, "endOffset": 124}, {"referenceID": 9, "context": "Recent works have explored the use of supervised methods to learn similarity metrics from a set of aligned examples [2,8,11], showing potential to outperform hand-crafted metrics in particular applications.", "startOffset": 116, "endOffset": 124}, {"referenceID": 3, "context": "The ability of our metric to obtain reliable registrations is demonstrated on the ALBERTs database of neonatal images [5], where we outperform Mutual Information [10].", "startOffset": 118, "endOffset": 121}, {"referenceID": 8, "context": "The ability of our metric to obtain reliable registrations is demonstrated on the ALBERTs database of neonatal images [5], where we outperform Mutual Information [10].", "startOffset": 162, "endOffset": 166}, {"referenceID": 4, "context": "propose a generative method based on Kullback-Leibler Divergence [6].", "startOffset": 65, "endOffset": 68}, {"referenceID": 6, "context": "[8] and Michel et al.", "startOffset": 0, "endOffset": 3}, {"referenceID": 9, "context": "[11], where the problem of learning a similarity metric is posed as binary classification.", "startOffset": 0, "endOffset": 4}, {"referenceID": 10, "context": "The power of CNNs to capture complex relationships between multimodal medical images has been shown in the problem of modality synthesis [12], where CNNs are used to map MRI-T2 images to MRI-T1 images using jointly the appearance of a small patch together with its localization.", "startOffset": 137, "endOffset": 141}, {"referenceID": 1, "context": "[3] who train a multilayer fullyconnected network pretrained with autoencoder for estimating similarity of 2D CT-MR patch pairs.", "startOffset": 0, "endOffset": 3}, {"referenceID": 11, "context": "The minimization is commonly solved in a continuous or discrete optimization framework [13], depending on the nature of \u03b8.", "startOffset": 87, "endOffset": 91}, {"referenceID": 7, "context": "This makes the computation very efficient, as results in intermediate network layers can be shared among neighboring patches [9].", "startOffset": 125, "endOffset": 128}, {"referenceID": 12, "context": "The architecture is based on recent works on learning to compare patches, notably the 2-channel network of Zagoruyko and Komodakis [14].", "startOffset": 131, "endOffset": 135}, {"referenceID": 12, "context": "To gradually subsample the spatial domain within the network and increase spatial context (perceptive field), we prefer convolutions with non-unit output stride to pooling used in [14], as it has led to better performance.", "startOffset": 180, "endOffset": 184}, {"referenceID": 12, "context": "We have therefore experimented on architectures with two independent input branches, such as the pseudo-siamese network in [14].", "startOffset": 123, "endOffset": 127}, {"referenceID": 6, "context": "Imposing restrictions on negatives (such as minimum or maximum overlap of source patch domains) or on patch content (such as minimum contrast [8]) were experimentally shown detrimental to the registration quality.", "startOffset": 142, "endOffset": 145}, {"referenceID": 1, "context": "Instead of preparing a fixed dataset of patches like in [3], we sample Xi online.", "startOffset": 56, "endOffset": 59}, {"referenceID": 3, "context": "We conducted intersubject deformable registration experiments on a set of neonatal brain image volumes taken from the publicly available brain atlases ALBERTs [5].", "startOffset": 159, "endOffset": 162}, {"referenceID": 8, "context": "Our baseline is mutual information (MI) [10], the standard metric for multimodal registration.", "startOffset": 40, "endOffset": 44}, {"referenceID": 6, "context": "Unfortunately, we could not compare to other learning-based metrics [8,11] as their implementation was not available.", "startOffset": 68, "endOffset": 74}, {"referenceID": 9, "context": "Unfortunately, we could not compare to other learning-based metrics [8,11] as their implementation was not available.", "startOffset": 68, "endOffset": 74}, {"referenceID": 2, "context": "In a MRF-based formulation, the local alignment cost is expressed by unary potentials over nodes in a graph [4].", "startOffset": 108, "endOffset": 111}], "year": 2016, "abstractText": "Multimodal registration is a challenging problem in medical imaging due the high variability of tissue appearance under different imaging modalities. The crucial component here is the choice of the right similarity measure. We make a step towards a general learning-based solution that can be adapted to specific situations and present a metric based on a convolutional neural network. Our network can be trained from scratch even from a few aligned image pairs. The metric is validated on intersubject deformable registration on a dataset different from the one used for training, demonstrating good generalization. In this task, we outperform mutual information by a significant margin.", "creator": "LaTeX with hyperref package"}}}