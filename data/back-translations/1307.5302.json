{"id": "1307.5302", "review": {"conference": "ICML", "VERSION": "v1", "DATE_OF_SUBMISSION": "19-Jul-2013", "title": "Kernel Adaptive Metropolis-Hastings", "abstract": "The algorithm embeds the trajectory of the Markov chain in a reproducing Hilbert space (RKHS), so that the covariance of the characteristic space of the samples influences the selection of the proposal. It is computationally efficient and easy to implement, since the steps of the RKHS can be integrated analytically: Our supply distribution in the original space is a normal distribution, the mean and covariance of which depend on where the current sample is to support the target distribution, and adapts to the local covariance structure of the target. Kernel Adaptive Metropolis-Hastings outperforms competing fixed and adaptive samples on multivariate, highly non-linear target distributions. The code can be downloaded from the following address:", "histories": [["v1", "Fri, 19 Jul 2013 18:26:34 GMT  (379kb,D)", "https://arxiv.org/abs/1307.5302v1", null], ["v2", "Thu, 13 Feb 2014 18:06:06 GMT  (3572kb)", "http://arxiv.org/abs/1307.5302v2", null], ["v3", "Thu, 12 Jun 2014 22:30:05 GMT  (2314kb)", "http://arxiv.org/abs/1307.5302v3", "Proceedings of the 31st International Conference on Machine Learning, Beijing, China, 2014; JMLR: W&amp;CP volume 32(2)"]], "reviews": [], "SUBJECTS": "stat.ML cs.LG", "authors": ["dino sejdinovic", "heiko strathmann", "maria lomeli garcia", "christophe andrieu", "arthur gretton"], "accepted": true, "id": "1307.5302"}, "pdf": {"name": "1307.5302.pdf", "metadata": {"source": "META", "title": "Kernel Adaptive Metropolis-Hastings", "authors": ["Dino Sejdinovic", "Heiko Strathmann", "Maria Lomeli Garcia", "Christophe Andrieu", "Arthur Gretton"], "emails": ["DINO@GATSBY.UCL.AC.UK", "UCABHST@GATSBY.UCL.AC.UK", "MLOMELI@GATSBY.UCL.AC.UK", "C.ANDRIEU@BRISTOL.AC.UK", "ARTHUR.GRETTON@GMAIL.COM"], "sections": [{"heading": null, "text": "ar X\niv :1\n30 7.\n53 02\nv3 [\nst at\n.M L\n] 1\n2 Ju\nn 20"}, {"heading": "1. Introduction", "text": "The choice of the proposal distribution is known to be crucial for the design of Metropolis-Hastings algorithms, and methods for adapting the proposal distribution to increase the sampler\u2019s efficiency based on the history of the Markov chain have been widely studied. These methods often aim to learn the covariance structure of the target distribution, and adapt the proposal accordingly. Adaptive MCMC samplers were first studied by Haario et al. (1999;\nProceedings of the 31 st International Conference on Machine Learning, Beijing, China, 2014. JMLR: W&CP volume 32. Copyright 2014 by the author(s).\n2001), where the authors propose to update the proposal distribution along the sampling process. Based on the chain history, they estimate the covariance of the target distribution and construct a Gaussian proposal centered at the current chain state, with a particular choice of the scaling factor from Gelman et al. (1996). More sophisticated schemes are presented by Andrieu & Thoms (2008), e.g., adaptive scaling, component-wise scaling, and principal component updates.\nWhile these strategies are beneficial for distributions that show high anisotropy (e.g., by ensuring the proposal uses the right scaling in all principal directions), they may still suffer from low acceptance probability and slow mixing when the target distributions are strongly nonlinear, and the directions of large variance depend on the current location of the sampler in the support. In the present work, we develop an adaptive Metropolis-Hastings algorithm in which samples are mapped to a reproducing kernel Hilbert space, and the proposal distribution is chosen according to the covariance in this feature space (Scho\u0308lkopf et al., 1998; Smola et al., 2001). Unlike earlier adaptive approaches, the resulting proposal distributions are locally adaptive in input space, and oriented towards nearby regions of high density, rather than simply matching the global covariance structure of the distribution. Our approach combines a move in the feature space with a stochastic step towards the nearest input space point, where the feature space move can be analytically integrated out. Thus, the implementation of the procedure is straightforward: the proposal is simply a multivariate Gaussian in the input space, with location-dependent covariance which is informed by the feature space representation of the target. Furthermore, the resulting Metropolis-Hastings sampler only requires the ability to evaluate the unnormalized density of the target (or its unbiased estimate, as in Pseudo-Marginal MCMC of Andrieu & Roberts, 2009), and no gradient evaluation is needed, making it applicable to situations where more sophisticated schemes based on Hamiltonian Monte Carlo (HMC) or Metropolis Adjusted\nLangevin Algorithms (MALA) (Roberts & Stramer, 2003; Girolami & Calderhead, 2011) cannot be applied.\nWe begin our presentation in Section 2, with a brief overview of existing adaptive Metropolis approaches; we also review covariance operators in the RKHS. Based on these operators, we describe a sampling strategy for Gaussian measures in the RKHS in Section 3, and introduce a cost function for constructing proposal distributions. In Section 4, we outline our main algorithm, termed Kernel Adaptive Metropolis-Hastings (MCMC Kameleon). We provide experimental comparisons with other fixed and adaptive samplers in Section 5, where we show superior performance in the context of Pseudo-Marginal MCMC for Bayesian classification, and on synthetic target distributions with highly nonlinear shape."}, {"heading": "2. Background", "text": "Adaptive Metropolis Algorithms. Let X = Rd be the domain of interest, and denote the unnormalized target density on X by \u03c0. Additionally, let \u03a3t = \u03a3t(x0, x1, . . . , xt\u22121) denote an estimate of the covariance matrix of the target density based on the chain history {xi}t\u22121i=0 . The original adaptive Metropolis at the current state of the chain state xt = y uses the proposal\nqt(\u00b7|y) = N (y, \u03bd2\u03a3t), (1)\nwhere \u03bd = 2.38/ \u221a d is a fixed scaling factor from Gelman et al. (1996). This choice of scaling factor was shown to be optimal (in terms of efficiency measures) for the usual Metropolis algorithm. While this optimality result does not hold for Adaptive Metropolis, it can nevertheless be used as a heuristic. Alternatively, the scale \u03bd can also be adapted at each step as in Andrieu & Thoms (2008, Algorithm 4) to obtain the acceptance rate from Gelman et al. (1996), a\u2217 = 0.234.\nRKHS Embeddings and Covariance Operators. According to the Moore-Aronszajn theorem (Berlinet & Thomas-Agnan, 2004, p. 19), for every symmetric, positive definite function (kernel) k : X \u00d7X \u2192 R, there is an associated reproducing kernel Hilbert space Hk of real-valued functions on X with reproducing kernel k. The map \u03d5 : X \u2192 Hk, \u03d5 : x 7\u2192 k(\u00b7, x) is called the canonical feature map of k. This feature map or embedding of a single point can be extended to that of a probability measure P on X : its kernel embedding is an element \u00b5P \u2208 Hk, given by \u00b5P = \u00b4\nk(\u00b7, x) dP (x) (Berlinet & Thomas-Agnan, 2004; Fukumizu et al., 2004; Smola et al., 2007). If a measurable kernel k is bounded, it is straightforward to show using the Riesz representation theorem that the mean embedding \u00b5k(P ) exists for all probability measures on X . For many interesting\nbounded kernels k, including the Gaussian, Laplacian and inverse multi-quadratics, the kernel embedding P 7\u2192 \u00b5P is injective. Such kernels are said to be characteristic (Sriperumbudur et al., 2010; 2011), since each distribution is uniquely characterized by its embedding (in the same way that every probability distribution has a unique characteristic function). The kernel embedding \u00b5P is the representer of expectations of smooth functions w.r.t. P , i.e., \u2200f \u2208 Hk, \u3008f, \u00b5P \u3009Hk = \u00b4\nf(x)dP (x). Given samples z = {zi}ni=1 \u223c P , the embedding of the empirical measure is \u00b5z = 1n \u2211n i=1 k(\u00b7, zi). Next, the covariance operator CP : Hk \u2192 Hk for a probability measure P is given by CP = \u00b4\nk(\u00b7, x) \u2297 k(\u00b7, x) dP (x) \u2212 \u00b5P \u2297 \u00b5P (Baker, 1973; Fukumizu et al., 2004), where for a, b, c \u2208 Hk the tensor product is defined as (a \u2297 b)c = \u3008b, c\u3009Hk a. The covariance operator has the property that \u2200f, g \u2208 Hk, \u3008f, CP g\u3009Hk = EP (fg)\u2212 EP fEP g. Our approach is based on the idea that the nonlinear support of a target density may be learned using Kernel Principal Component Analysis (Kernel PCA) (Scho\u0308lkopf et al., 1998; Smola et al., 2001), this being linear PCA on the empirical covariance operator in the RKHS, Cz = 1 n \u2211n i=1 k(\u00b7, zi) \u2297 k(\u00b7, zi) \u2212 \u00b5z \u2297 \u00b5z, computed on the sample z defined above. The empirical covariance operator behaves as expected: applying the tensor product definition gives \u3008f, Czg\u3009Hk = 1 n \u2211n i=1 f(zi)g(zi) \u2212 (\n1 n \u2211n i=1 f(zi)\n) (\n1 n \u2211n i=1 g(zi)\n)\n. By analogy with algorithms which use linear PCA directions to inform M-H proposals (Andrieu & Thoms, 2008, Algorithm 8), nonlinear PCA directions can be encoded in the proposal construction, as described in Appendix C. Alternatively, one can focus on a Gaussian measure on the RKHS determined by the empirical covariance operator Cz rather than extracting its eigendirections, which is the approach we pursue in this contribution. This generalizes the proposal (1), which considers the Gaussian measure induced by the empirical covariance matrix on the original space."}, {"heading": "3. Sampling in RKHS", "text": "We next describe the proposal distribution at iteration t of the MCMC chain. We will assume that a subset of the chain history, denoted z = {zi}ni=1, n \u2264 t\u2212 1, is available. Our proposal is constructed by first considering the samples in the RKHS associated to the empirical covariance operator, and then performing a gradient descent step on a cost function associated with those samples.\nGaussian Measure of the Covariance Operator. We will work with the Gaussian measure on the RKHS Hk with mean k(\u00b7, y) and covariance \u03bd2Cz, where z = {zi}ni=1 is the subset of the chain history. While there is no analogue\nof a Lebesgue measure in an infinite dimensional RKHS, it is instructive (albeit with some abuse of notation) to denote this measure in the \u201cdensity form\u201d N (f ; k(\u00b7, y), \u03bd2Cz) \u221d exp (\n\u2212 12\u03bd2 \u2329 f \u2212 k(\u00b7, y), C\u22121 z (f \u2212 k(\u00b7, y)) \u232a\nHk\n)\n. As Cz is\na finite-rank operator, this measure is supported only on a finite-dimensional affine space k(\u00b7, y) +Hz, where Hz = span {k(\u00b7, zi)}ni=1 is the subspace spanned by the canonical features of z. It can be shown that a sample from this measure has the form f = k(\u00b7, y) + \u2211ni=1 \u03b2i [k(\u00b7, zi)\u2212 \u00b5z] , where \u03b2 \u223c N (0, \u03bd2n I) is isotropic. Indeed, to see that f has the correct covariance structure, note that:\nE [(f \u2212 k(\u00b7, y))\u2297 (f \u2212 k(\u00b7, y))]\n= E\n\n\nn \u2211\ni=1\nn \u2211\nj=1\n\u03b2i\u03b2j (k(\u00b7, zi)\u2212 \u00b5z)\u2297 (k(\u00b7, zj)\u2212 \u00b5z)\n\n\n= \u03bd2\nn\nn \u2211\ni=1\n(k(\u00b7, zi)\u2212 \u00b5z)\u2297 (k(\u00b7, zi)\u2212 \u00b5z) = \u03bd2Cz.\nDue to the equivalence in the RKHS between a Gaussian measure and a Gaussian Process (GP) (Berlinet & Thomas-Agnan, 2004, Ch. 4), we can think of the RKHS samples f as trajectories of the GP with mean m(x) = k(x, y) and covariance function\n\u03ba(x, x\u2032) = cov [f(x), f(x\u2032)]\n= \u03bd2\nn\nn \u2211\ni=1\n(k(x, zi)\u2212 \u00b5z(x)) (k(x\u2032, zi)\u2212 \u00b5z(x\u2032)) .\nThe covariance function \u03ba of this GP is therefore the kernel k convolved with itself with respect to the empirical measure associated to the samples z, and draws from this GP therefore lie in a smaller RKHS; see Saitoh (1997, p. 21) for details.\nObtaining Target Samples through Gradient Descent. We have seen how to obtain the RKHS sample f = k(\u00b7, y) + \u2211ni=1 \u03b2i [k(\u00b7, zi)\u2212 \u00b5z] from the Gaussian measure in the RKHS. This sample does not in general have a corresponding pre-image in the original domain X = Rd; i.e., there is no point x\u2217 \u2208 X such that f = k(\u00b7, x\u2217). If there were such a point, then we could use it as a proposal in the original domain. Therefore, we are ideally looking for a point x\u2217 \u2208 X whose canonical feature map k(\u00b7, x\u2217) is close to f in the RKHS norm. We consider the optimization problem\nargmin x\u2208X \u2016k (\u00b7, x)\u2212 f\u20162Hk =\nargmin x\u2208X\n{\nk(x, x)\u2212 2k(x, y)\u2212 2 n \u2211\ni=1\n\u03b2i [k(x, zi)\u2212 \u00b5z(x)]\n}\n.\nIn general, this is a non-convex minimization problem, and may be difficult to solve (Bakir et al., 2003). Rather than solving it for every new vector of coefficients \u03b2, which would lead to an excessive computational burden for every proposal made, we simply make a single descent step along the gradient of the cost function,\ng(x) = k(x, x)\u2212 2k(x, y)\u2212 2 n \u2211\ni=1\n\u03b2i [k(x, zi)\u2212 \u00b5z(x)] ,\n(2) i.e., the proposed new point is\nx\u2217 = y \u2212 \u03b7\u2207xg(x)|x=y + \u03be, where \u03b7 is a gradient step size parameter and \u03be \u223c N (0, \u03b32I) is an additional isotropic \u2019exploration\u2019 term after the gradient step. It will be useful to split the scaled gradient at y into two terms as \u03b7\u2207xg(x)|x=y = \u03b7 (ay \u2212Mz,yH\u03b2), where ay = \u2207xk(x, x)|x=y \u2212 2\u2207xk(x, y)|x=y ,\nMz,y = 2 [\u2207xk(x, z1)|x=y, . . . ,\u2207xk(x, zn)|x=y] (3) is a d\u00d7n matrix, and H = I\u2212 1n1n\u00d7n is the n\u00d7n centering matrix.\nFigure 1 plots g(x) and its gradients for several samples of \u03b2-coefficients, in the case where the underlying z-samples are from the two-dimensional nonlinear Banana target distribution of Haario et al. (1999). It can be seen that g may have multiple local minima, and that it varies most along the high-density regions of the Banana distribution."}, {"heading": "4. MCMC Kameleon Algorithm", "text": ""}, {"heading": "4.1. Proposal Distribution", "text": "We now have a recipe to construct a proposal that is able to adapt to the local covariance structure for the current chain\nMCMC Kameleon Input: unnormalized target \u03c0, subsample size n, scaling parameters \u03bd, \u03b3, adaptation probabilities {pt}\u221et=0, kernel k,\n\u2022 At iteration t+ 1, 1. With probability pt, update a random subsample\nz = {zi}min(n,t)i=1 of the chain history {xi} t\u22121 i=0 ,\n2. Sample proposed point x\u2217 from qz(\u00b7|xt) = N (xt, \u03b32I + \u03bd2Mz,xtHM\u22a4z,xt), where Mz,xt is given in Eq. (3) and H = I \u2212 1n1n\u00d7n is the centering matrix,\n3. Accept/Reject with the Metropolis-Hastings acceptance probability A(xt, x\u2217) in Eq. (4),\nxt+1 =\n{\nx\u2217, w.p. A(xt, x\u2217), xt, w.p. 1\u2212A(xt, x\u2217).\nstate y. This proposal depends on a subset of the chain history z, and is denoted by qz(\u00b7|y). While we will later simplify this proposal by integrating out the moves in the RKHS, it is instructive to think of the proposal generating process as:\n1. Sample \u03b2 \u223c N (0, \u03bd2I) (n\u00d7 1 normal of RKHS coefficients).\n\u2022 This represents an RKHS sample f = k(\u00b7, y) + \u2211n\ni=1 \u03b2i [k(\u00b7, zi)\u2212 \u00b5z] which is the goal of the cost function g(x).\n2. Move along the gradient of g: x\u2217 = y \u2212 \u03b7\u2207xg(x)|x=y + \u03be. \u2022 This gives a proposal x\u2217|y, \u03b2 \u223c N (y \u2212 \u03b7ay + \u03b7Mz,yH\u03b2, \u03b3\n2I) (d \u00d7 1 normal in the original space).\nOur first step in the derivation of the explicit proposal density is to show that as long as k is a differentiable positive definite kernel, the term ay vanishes.\nProposition 1. Let k be a differentiable positive definite kernel. Then ay = \u2207xk(x, x)|x=y \u2212 2\u2207xk(x, y)|x=y = 0.\nSince ay = 0, the gradient step size \u03b7 always appears together with \u03b2, so we merge \u03b7 and the scale \u03bd of the \u03b2coefficients into a single scale parameter, and set \u03b7 = 1 henceforth. Furthermore, since both p(\u03b2) and pz(x\u2217|y, \u03b2) are multivariate Gaussian densities, the proposal density qz(x \u2217|y) = \u00b4 p(\u03b2)pz(x \u2217|y, \u03b2)d\u03b2 can be computed analytically. We therefore get the following closed form expression for the proposal distribution.\nProposition 2. qz(\u00b7|y) = N (y, \u03b32I + \u03bd2Mz,yHM\u22a4z,y).\nProofs of the above Propositions are given in Appendix A.\nWith the derived proposal distribution, we proceed with the standard Metropolis-Hastings accept/reject scheme, where the proposed sample x\u2217 is accepted with probability\nA(xt, x \u2217) = min\n{ 1, \u03c0(x\u2217)qz(xt|x\u2217) \u03c0(xt)qz(x\u2217|xt) } , (4)\ngiving rise to the MCMC Kameleon Algorithm. Note that each \u03c0(x\u2217) and \u03c0(xt) could be replaced by their unbiased estimates without impacting the invariant distribution (Andrieu & Roberts, 2009). The constructed family of proposals encodes local structure of the target distribution, which is learned based on the subsample z. Figure 2 depicts the regions that contain 95% of the mass of the proposal distribution qz(\u00b7|y) at various states y for a fixed subsample z, where the Banana target is used (details in Section 5). More examples of proposal contours can be found in Appendix B."}, {"heading": "4.2. Properties of the Algorithm", "text": "The update schedule and convergence. MCMC Kameleon requires a subsample z = {zi}ni=1 at each iteration of the algorithm, and the proposal distribution qz(\u00b7|y) is updated each time a new subsample z is obtained. It is well known that a chain which keeps adapting the proposal distribution need not converge to the correct target (Andrieu & Thoms, 2008). To guarantee convergence, we introduce adaptation probabilities {pt}\u221et=0, such that pt \u2192 0 and \u2211\u221e\nt=1 pt = \u221e, and at iteration t we update the subsample z with probability pt. As adaptations occur with decreasing probability, Theorem 1 of Roberts & Rosenthal (2007) implies that the resulting algorithm is ergodic and converges to the correct target. Another straightforward way to guarantee convergence is to fix the set z = {zi}ni=1 after a \u201cburn-in\u201d phase; i.e., to stop adapting Roberts & Rosenthal (2007, Proposition 2). In this case, a \u201cburn-in\u201d phase is used to get a rough sketch of the shape of the distribution: the initial samples need not\ncome from a converged or even valid MCMC chain, and it suffices to have a scheme with good exploratory properties, e.g., Welling & Teh (2011). In MCMC Kameleon, the term \u03b3 allows exploration in the initial iterations of the chain (while the subsample z is still not informative about the structure of the target) and provides regularization of the proposal covariance in cases where it might become ill-conditioned. Intuitively, a good approach to setting \u03b3 is to slowly decrease it with each adaptation, such that the learned covariance progressively dominates the proposal.\nSymmetry of the proposal. In Haario et al. (2001), the proposal distribution is asymptotically symmetric due to the vanishing adaptation property. Therefore, the authors compute the standard Metropolis acceptance probability. In our case, the proposal distribution is a Gaussian with mean at the current state of the chain xt = y and covariance \u03b32I + \u03bd2Mz,yHM \u22a4 z,y , where Mz,y depends both on the current state y and a random subsample z = {zi}ni=1 of the chain history {xi}t\u22121i=0 . This proposal distribution is never symmetric (as covariance of the proposal always depends on the current state of the chain), and therefore we use the Metropolis-Hastings acceptance probability to reflect this.\nRelationship to MALA and Manifold MALA. The Metropolis Adjusted Langevin Algorithm (MALA) algorithm uses information about the gradient of the log-target density at the current chain state to construct a proposed point for the Metropolis step. Our approach does not require that the log-target density gradient be available or computable. Kernel gradients in the matrix Mz,y are easily obtained for commonly used kernels, including the Gaussian kernel (see section 4.3), for which the computational complexity is equal to evaluating the kernel itself. Moreover, while standard MALA simply shifts the mean of the proposal distribution along the gradient and then adds an isotropic exploration term, our proposal is centered at the current state, and it is the covariance structure of the proposal distribution that coerces the proposed points to belong to the high-density regions of the target. It would be straightforward to modify our approach to include a drift term along the gradient of the log-density, should such information be available, but it is unclear whether this would provide additional performance gains. Further work is required to elucidate possible connections between our approach and the use of a preconditioning matrix (Roberts & Stramer, 2003) in the MALA proposal; i.e., where the exploration term is scaled with appropriate metric tensor information, as in Riemannian manifold MALA (Girolami & Calderhead, 2011)."}, {"heading": "4.3. Examples of Covariance Structure for Standard Kernels", "text": "The proposal distributions in MCMC Kameleon are dependant on the choice of the kernel k. To gain intuition re-\ngarding their covariance structure, we give two examples below.\nLinear kernel. In the case of a linear kernel k(x, x\u2032) = x\u22a4x\u2032, we obtain Mz,y = 2 [ \u2207xx\u22a4z1|x=y, . . . ,\u2207xx\u22a4zn|x=y ]\n= 2Z\u22a4, so the proposal is given by qz(\u00b7|y) = N (y, \u03b32I + 4\u03bd2Z\u22a4HZ); thus, the proposal simply uses the scaled empirical covariance Z\u22a4HZ just like standard Adaptive Metropolis (Haario et al., 1999), with an additional isotropic exploration component, and depends on y only through the mean.\nGaussian kernel. In the case of a Gaussian kernel\nk(x, x\u2032) = exp\n(\n\u2212\u2016x\u2212x \u2032\u20162 2\n2\u03c32\n)\n, since \u2207xk(x, x\u2032) = 1 \u03c32 k(x, x \u2032)(x\u2032 \u2212 x), we obtain\nMz,y = 2\n\u03c32 [k(y, z1)(z1 \u2212 y), . . . , k(y, zn)(zn \u2212 y)] .\nConsider how this encodes the covariance structure of the target distribution:\nRij = \u03b3 2 \u03b4ij\n+ 4\u03bd2(n\u2212 1)\n\u03c34n\nn \u2211\na=1\n[k(y, za)] 2 (za,i \u2212 yi)(za,j \u2212 yj)\n\u2212 4\u03bd2\n\u03c34n\n\u2211\na 6=b\nk(y, za)k(y, zb)(za,i \u2212 yi)(zb,j \u2212 yj). (5)\nAs the first two terms dominate, the previous points za which are close to the current state y (for which k(y, za) is large) have larger weights, and thus they have more influence in determining the covariance of the proposal at y.\nMate\u0301rn kernel. In the Mate\u0301rn family of kernels\nk\u03d1,\u03c1(x, x \u2032) = 2\n1\u2212\u03d1\n\u0393(\u03d1)\n(\n\u2016x\u2212x\u2032\u2016 2\n\u03c1\n)\u03d1\nK\u03d1\n(\n\u2016x\u2212x\u2032\u2016 2\n\u03c1\n)\n, where\nK\u03d1 is the modified Bessel function of the second kind, we obtain a form of the covariance structure very similar to that of the Gaussain kernel. In this case, \u2207xk\u03d1,\u03c1(x, x\u2032) =\n1 2\u03c12(\u03d1\u22121)k\u03d1\u22121,\u03c1(x, x \u2032)(x\u2032\u2212x), so the only difference (apart from the scalings) to (5) is that the weights are now determined by a \u201crougher\u201d kernel k\u03d1\u22121,\u03c1 of the same family."}, {"heading": "5. Experiments", "text": "In the experiments, we compare the following samplers: (SM) Standard Metropolis with the isotropic proposal q(\u00b7|y) = N (y, \u03bd2I) and scaling \u03bd = 2.38/ \u221a d, (AMFS) Adaptive Metropolis with a learned covariance matrix and fixed scaling \u03bd = 2.38/ \u221a d, (AM-LS) Adaptive Metropolis with a learned covariance matrix and scaling learned to bring the acceptance rate close to \u03b1\u2217 = 0.234 as described in Andrieu & Thoms (2008, Algorithm 4), and (KAMH-LS) MCMC Kameleon with the scaling \u03bd learned\nin the same fashion (\u03b3 was fixed to 0.2), and which also stops adapting the proposal after the burn-in of the chain (in all experiments, we use a random subsample z of size n = 1000, and a Gaussian kernel with bandwidth selected according to the median heuristic). We consider the following nonlinear targets: (1) the posterior distribution of Gaussian Process (GP) classification hyperparameters (Filippone & Girolami, 2014) on the UCI glass dataset, and (2) the synthetic banana-shaped distribution of Haario et al. (1999) and a flower-shaped disribution concentrated on a circle with a periodic perturbation."}, {"heading": "5.1. Pseudo-Marginal MCMC for GP Classification", "text": "In the first experiment, we illustrate usefulness of the MCMC Kameleon sampler in the context of Bayesian classification with GPs (Williams & Barber, 1998). Consider the joint distribution of latent variables f , labels y (with covariate matrix X), and hyperparameters \u03b8, given by\np(f ,y, \u03b8) = p(\u03b8)p(f |\u03b8)p(y|f),\nwhere f |\u03b8 \u223c N (0,K\u03b8), with K\u03b8 modeling the covariance between latent variables evaluated at the input covariates: (K\u03b8)ij = \u03ba(xi,x\u2032j |\u03b8) = exp ( \u2212 12 \u2211D d=1 (xi,d\u2212x \u2032 j,d) 2\n\u21132 d\n)\nand \u03b8d = log \u21132d. We restrict our attention to the binary logistic classifier; i.e., the likelihood is given by p(yi|fi) = 11\u2212exp(\u2212yifi) where yi \u2208 {\u22121, 1}. We pursue a fully Bayesian treatment, and estimate the posterior of the hyperparameters \u03b8. As observed by Murray & Adams (2012), a Gibbs sampler on p(\u03b8, f |y), which samples from p(f |\u03b8, y) and p(\u03b8|f , y) in turn, is problematic, as p(\u03b8|f , y) is extremely sharp, drastically limiting the amount that any Markov chain can update \u03b8|f , y. On the other hand, if we directly consider the marginal posterior p(\u03b8|y) \u221d p(y|\u03b8)p(\u03b8) of the hyperparameters, a much less peaked distribution can be obtained. However, the marginal likelihood p(y|\u03b8) is intractable for non-Gaussian likelihoods p(y|f), so it is not possible to analytically integrate out the latent variables. Recently developed pseudo-marginal MCMC methods (Andrieu & Roberts, 2009) enable exact\ninference on this problem (Filippone & Girolami, 2014), by replacing p(y|\u03b8) with an unbiased estimate\np\u0302(y|\u03b8) := 1 nimp\nnimp \u2211\ni=1\np(y|f (i))p(f (i)|\u03b8)\nq(f (i)|\u03b8) , (6)\nwhere { f (i) }nimp\ni=1 \u223c q(f |\u03b8) are nimp importance sam-\nples. In Filippone & Girolami (2014), the importance distribution q(f |\u03b8) is chosen as the Laplacian or as the Expectation Propagation (EP) approximation of p(f |y, \u03b8) \u221d p(y|f)p(f |\u03b8), leading to state-of-the-art results. We consider the UCI Glass dataset (Bache & Lichman, 2013), where classification of window against non-window glass is sought. Due to the heterogeneous structure of each of the classes (i.e., non-window glass consists of containers, tableware and headlamps), there is no single consistent set of lengthscales determining the decision boundary, so one expects the posterior of the covariance bandwidths \u03b8d to have a complicated (nonlinear) shape. This is illustrated by the plot of the posterior projections to the dimensions 2 and 7 (out of 9) in Figure 3. Since the ground truth for the hyperparameter posterior is not available, we initially ran 30 Standard Metropolis chains for 500,000 iterations (with a 100,000 burn-in), kept every 1000-th sample in each of the chains, and combined them. The resulting samples were used as a benchmark, to evaluate the performance of shorter single-chain runs of SM, AM-FS, AMLS and KAMH-LS. Each of these algorithms was run for 100,000 iterations (with a 20,000 burnin) and every 20-th sample was kept. Two metrics were used in evaluating the performance of the four samplers, relative to the large-scale benchmark. First, the distance \u2225\n\u2225\u00b5\u0302\u03b8 \u2212 \u00b5b\u03b8 \u2225 \u2225 2 was computed\nbetween the mean \u00b5\u0302\u03b8 estimated from each of the four sampler outputs, and the mean \u00b5b\u03b8 on the benchmark sample (Fig. 4, left), as a function of sample size. Second, the MMD (Borgwardt et al., 2006; Gretton et al., 2007) was computed between each sampler output and the benchmark sample, using the polynomial kernel (1 + \u3008\u03b8, \u03b8\u2032\u3009)3; i.e., the comparison was made in terms of all mixed moments of order up to 3 (Fig. 4, right). The figures indicate that KAMH-LS approximates the benchmark sample better than the competing approaches, where the effect is especially pronounced in the high order moments, indicating that KAMH-LS thoroughly explores the distribution support in a relatively small number of samples. We emphasise that, as for any pseudo-marginal MCMC scheme, neither the likelihood itself, nor any higherorder information about the marginal posterior target p(\u03b8|y), are available. This makes HMC or MALA based approaches such as (Roberts & Stramer, 2003; Girolami & Calderhead, 2011) unsuitable for this problem, so it is very difficult to deal with strongly nonlinear posterior targets. In contrast, as indicated in this example, the MCMC Kameleon scheme is able to effectively sample\nModerately twisted 8-dimensional B(0.03,100) target; iterations: 40000, burn-in: 20000\nfrom such nonlinear targets, and outperforms the vanilla Metropolis methods, which are the only competing choices in the pseudo-marginal context.\nIn addition, since the bulk of the cost for pseudo-marginal MCMC is in importance sampling in order to obtain the acceptance ratio, the additional cost imposed by KAMHLS is negligible. Indeed, we observed that there is an increase of only 2-3% in terms of effective computation time in comparison to all other samplers, for the chosen size of the chain history subsample (n = 1000)."}, {"heading": "5.2. Synthetic examples", "text": "Banana target. In Haario et al. (1999), the following family of nonlinear target distributions is considered. Let X \u223c N (0,\u03a3) be a multivariate normal in d \u2265 2 dimensions, with \u03a3 = diag(v, 1, . . . , 1), which undergoes the transformation X \u2192 Y , where Y2 = X2 + b(X21 \u2212 v), and Yi = Xi for i 6= 2. We will write Y \u223c B(b, v). It is clear that EY = 0, and that B(y; b, v) = N (y1; 0, v)N (y2; b(y21\u2212v), 1) d \u220f\nj=3\nN (yj ; 0, 1).\nFlower target. The second target distribution we consider is the d-dimensional flower target F(r0, A, \u03c9, \u03c3), with\nF(x; r0, A,\u03c9, \u03c3) =\nexp\n(\n\u2212\n\u221a\nx2 1 + x2 2 \u2212 r0 \u2212A cos (\u03c9atan2 (x2, x1))\n2\u03c32\n)\n\u00d7 d \u220f\nj=3\nN (xj ; 0, 1).\nThis distribution concentrates around the r0-circle with a periodic perturbation (with amplitude A and frequency \u03c9) in the first two dimensions.\nIn these examples, exact quantile regions of the targets can be computed analytically, so we can directly assess performance without the need to estimate distribution distances on the basis of samples (i.e., by estimating MMD to the benchmark sample). We compute the following measures of performance (similarly as in Haario et al. (1999); Andrieu & Thoms (2008)) based on the chain after burn-in: average acceptance rate, norm of the empirical mean (the true mean is by construction zero for all targets), and the deviation of the empirical quantiles from the true quantiles. We consider 8-dimensional target distributions: the moderately twisted B(0.03, 100) banana target (Figure 5, top) and the strongly twisted B(0.1, 100) banana target (Figure 5, middle) and F(10, 6, 6, 1) flower target (Figure 5, bottom).\nThe results show that MCMC Kameleon is superior to the competing samplers. Since the covariance of the proposal\nadapts to the local structure of the target at the current chain state, as illustrated in Figure 2, MCMC Kameleon does not suffer from wrongly scaled proposal distributions. The result is a significantly improved quantile performance in comparison to all competing samplers, as well as a comparable or superior norm of the empirical mean. SM has a significantly larger norm of the empirical mean, due to its purely random walk behavior (e.g., the chain tends to get stuck in one part of the space, and is not able to traverse both tails of the banana target equally well). AM with fixed scale has a low acceptance rate (indicating that the scaling of the proposal is too large), and even though the norm of the empirical mean is much closer to the true value, quantile performance of the chain is poor. Even if the estimated covariance matrix closely resembles the true global covariance matrix of the target, using it to construct proposal distributions at every state of the chain may not be the best choice. For example, AM correctly captures scalings along individual dimensions for the flower target (the norm of its empirical mean is close to its true value of zero) but fails to capture local dependence structure. The flower target, due to its symmetry, has an isotropic covariance in the first two dimensions \u2013 even though they are highly dependent. This leads to a mismatch in the scale of the covariance and the scale of the target, which concentrates on a thin band in the joint space. AM-LS has the \u201ccorrect\u201d acceptance rate, but the quantile performance is even worse, as the scaling now becomes too small to traverse high-density regions of the target."}, {"heading": "6. Conclusions", "text": "We have constructed a simple, versatile, adaptive, gradientfree MCMC sampler that constructs a family of proposal distributions based on the sample history of the chain. These proposal distributions automatically conform to the local covariance structure of the target distribution at the current chain state. In experiments, the sampler outperforms existing approaches on nonlinear target distributions, both by exploring the entire support of these distributions, and by returning accurate empirical quantiles, indicating faster mixing. Possible extensions include incorporating additional parametric information about the target densities, and exploring the tradeoff between the degree of subsampling of the chain history and convergence of the sampler.\nSoftware. Python implementation of MCMC Kameleon is available at https://github.com/karlnapf/kameleon-mcmc.\nAcknowledgments. D.S., H.S., M.L.G. and A.G. acknowledge support of the Gatsby Charitable Foundation. We thank Mark Girolami for insightful discussions and the anonymous reviewers for useful comments."}, {"heading": "A. Proofs", "text": "Proposition 1. Let k be a differentiable positive definite kernel. Then \u2207xk(x, x)|x=y \u2212 2\u2207xk(x, y)|x=y = 0.\nProof. Since k is a positive definite kernel there exists a Hilbert space H and a feature map \u03d5 : Rd \u2192 H, such that k(x, x\u2032) = \u3008\u03d5(x), \u03d5(x\u2032)\u3009H. Consider first the map \u03c4 : Rd \u2192 R, defined by \u03c4(x) = k(x, x). We write \u03c4 = \u03c8 \u25e6 \u03d5, where \u03c8 : H \u2192 R, \u03c8(f) = \u2016f\u20162H . We can obtain \u2207xk(x, x)|x=y from the Fre\u0301chet derivativeD\u03c4(y) \u2208 B(Rd,R) of \u03c4 at y, which to each y \u2208 Rd associates a bounded linear operator from Rd to R (Steinwart & Christmann, 2008, Definition A.5.14). By the chain rule for\nFre\u0301chet derivatives (Steinwart & Christmann, 2008, Lemma A.5.15(b)), the value of D\u03c4(y) at some x\u2032 \u2208 Rd is\n[D\u03c4(y)] (x\u2032) = [D\u03c8 (\u03d5(y)) \u25e6D\u03d5(y)] (x\u2032),\nwhere D\u03d5(y) \u2208 B(Rd,H), and D\u03c8 (\u03d5(y)) \u2208 B(H,R). The derivative D\u03d5 of the feature map exists whenever k is a differentiable function (Steinwart & Christmann, 2008, Section 4.3). It is readily shown that D\u03c8 [\u03d5(y)] = 2 \u3008\u03d5(y), \u00b7\u3009H, so that\n[D\u03c4(y)] (x\u2032) = 2 \u3008\u03d5(y), [D\u03d5(y)] (x\u2032)\u3009H .\nNext, we consider the map \u03bay(x) = k(x, y) = \u3008\u03d5(x), \u03d5(y)\u3009H, i.e., \u03bay = \u03c8y \u25e6 \u03d5 where \u03c8y(f) = \u3008f, \u03d5(y)\u3009H. Since \u03c8y is a linear scalar function on H, D\u03c8y (f) = \u3008\u03d5(y), \u00b7\u3009H. Again, by the chain rule:\n[D\u03bay(y)] (x \u2032) = [D\u03c8y (\u03d5(y)) \u25e6D\u03d5(y)] (x\u2032)\n= \u3008\u03d5(y), [D\u03d5(y)] (x\u2032)\u3009H ,\nand thus (D\u03c4(y)\u2212 2D\u03bay(y)) (x\u2032) = 0, for all x\u2032 \u2208 Rd, and we obtain equality of operators. Since Fre\u0301chet derivatives can also be written as inner products with the gradients, (\u2207xk(x, x)|x=y \u2212 2\u2207xk(x, y)|x=y)\u22a4 x\u2032 = (D\u03c4(y) \u2212 2D\u03bay(y)) (x\u2032) = 0, \u2200x\u2032 \u2208 Rd, which proves the claim. Proposition 2. qz(\u00b7|y) = N (y, \u03b32I + \u03bd2Mz,yHM\u22a4z,y).\nProof. We start with\np(\u03b2)p(x\u2217|y, \u03b2) = 1 (2\u03c0) n+d 2 \u03b3d\u03bdn exp\n(\n\u2212 1 2\u03bd2 \u03b2\u22a4\u03b2\n)\n\u00b7 exp ( \u2212 1 2\u03b32 (x\u2217 \u2212 y \u2212Mz,yH\u03b2)\u22a4 (x\u2217 \u2212 y \u2212Mz,yH\u03b2) )\n= 1\n(2\u03c0) n+d 2 \u03b3d\u03bdn\nexp\n(\n\u2212 1 2\u03b32 (x\u2217 \u2212 y)\u22a4 (x\u2217 \u2212 y) )\n\u00b7 exp ( \u22121 2 ( \u03b2\u22a4 ( 1 \u03bd2 I + 1 \u03b32 HM\u22a4 z,yMz,yH ) \u03b2 \u2212 2 \u03b32 \u03b2\u22a4HM\u22a4 z,y(x \u2217 \u2212 y) )) .\nNow, we set\n\u03a3\u22121 = 1\n\u03bd2 I +\n1\n\u03b32 HM\u22a4 z,yMz,yH\n\u00b5 = 1\n\u03b32 \u03a3HM\u22a4 z,y(x \u2217 \u2212 y),\nand application of the standard Gaussian integral \u02c6\nexp\n(\n\u22121 2 ( \u03b2\u22a4\u03a3\u22121\u03b2 \u2212 2\u03b2\u22a4\u03a3\u22121\u00b5 )\n)\nd\u03b2 =\n(2\u03c0)n/2 \u221a det \u03a3 exp ( 1\n2 \u00b5\u22a4\u03a3\u22121\u00b5\n)\n,\nleads to\nqz(x \u2217|y) =\n\u221a det\u03a3\n(2\u03c0) d 2 \u03b3d\u03bdn\nexp\n(\n\u2212 1 2\u03b32 (x\u2217 \u2212 y)\u22a4 (x\u2217 \u2212 y) )\n\u00b7 exp ( 1\n2 \u00b5\u22a4\u03a3\u22121\u00b5\n)\n.\nThis is just a d-dimensional Gaussian density where both the mean and covariance will, in general, depend on y. Let us consider the exponent\n\u2212 1 2\u03b32 (x\u2217 \u2212 y)\u22a4 (x\u2217 \u2212 y) + 1 2 \u00b5\u22a4\u03a3\u22121\u00b5 =\n\u22121 2\n{\n1\n\u03b32 (x\u2217 \u2212 y)\u22a4 (x\u2217 \u2212 y)\n\u2212 1 \u03b34\n(x\u2217 \u2212 y)\u22a4Mz,yH\u03a3HM\u22a4z,y (x\u2217 \u2212 y) } =\n\u22121 2 { (x\u2217 \u2212 y)\u22a4R\u22121 (x\u2217 \u2212 y) } ,\nwhere R\u22121 = 1\u03b32 (I \u2212 1\u03b32Mz,yH\u03a3HM\u22a4z,y). We can simplify the covariance R using the Woodbury identity to obtain:\nR = \u03b32(I \u2212 1 \u03b32 Mz,yH\u03a3HM \u22a4 z,y) \u22121\n= \u03b32 ( I +Mz,yH ( \u03b32\u03a3\u22121 \u2212HM\u22a4 z,yMz,yH )\u22121 HM\u22a4 z,y )\n= \u03b32\n(\nI +Mz,yH\n(\n\u03b32 \u03bd2 I\n)\u22121\nHM\u22a4 z,y\n)\n= \u03b32I + \u03bd2Mz,yHM \u22a4 z,y.\nTherefore, the proposal density is qz(\u00b7|y) = N (y, \u03b32I + \u03bd2Mz,yHM\u22a4z,y)."}, {"heading": "B. Further details on synthetic experiments", "text": "Proposal contours for the Flower target. The d-dimensional flower target F(r0, A, \u03c9, \u03c3) is given by\nF(x; r0, A, \u03c9, \u03c3) = exp ( \u2212 \u221a x21 + x 2 2 \u2212 r0 \u2212A cos (\u03c9atan2 (x2, x1))\n2\u03c32\n)\nN (x3:d; 0, I).\nThis distribution concentrates around the r0-circle with a periodic perturbation (with amplitude A and frequency \u03c9) in the first two dimensions. For A = 0, we obtain a band around the r0-circle, which we term the ring target. Figure 6 gives the contour plots of the MCMC Kameleon proposal distributions on two instances of the flower target.\nConvergence statistics for the Banana target. Figure 7 illustrates how the norm of the mean and quantile deviation (shown for 0.5-quantile) for the strongly twisted Banana target decrease as a function of the number of iterations. This shows that the trends observed in the main text persist along the evolution of the whole chain."}, {"heading": "C. Principal Components Proposals", "text": "An alternative approach to the standard adaptive Metropolis, discussed in Andrieu & Thoms (2008, Algorithm 8), is to extract m \u2264 d principal eigenvalue-eigenvector pairs {(\u03bbj , vj)}mj=1 from the estimated covariance matrix \u03a3z and use the proposal that takes form of a mixture of one-dimensional random walks along the principal eigendirections\nqz (\u00b7|y) = m \u2211\nj=1\n\u03c9jN (y, \u03bd2j \u03bbjvjv\u22a4j ). (7)\nIn other words, given the current chain state y, the j-th principal eigendirection is chosen with probability \u03c9j (choice \u03c9j = \u03bbj/ \u2211m l=1 \u03bbl is suggested), and the proposed point is\nx\u2217 = y + \u03c1\u03bdj \u221a \u03bbjvj , (8)\nwith \u03c1 \u223c N (0, 1). Note that each eigendirection may have a different scaling factor \u03bdj in addition to the scaling with the eigenvalue.\nWe can consider an analogous version of the update (8) performed in the RKHS\nf = k(\u00b7, y) + \u03c1\u03bdj \u221a \u03bbjvj , (9)\nwith m \u2264 n principal eigenvalue-eigenfunction pairs {(\u03bbj ,vj)}mj=1. It is readily shown that the eigenfunctions vj = \u2211n\ni=1 \u03b1\u0303 (j) i [k(\u00b7, zi)\u2212 \u00b5z] lie in the subspace Hz induced by z, and that the coefficients vectors \u03b1\u0303(j) =\n(\n\u03b1\u0303 (j) 1 \u00b7 \u00b7 \u00b7 \u03b1\u0303 (j) n\n)\u22a4\nare proportional to the eigenvector of the centered kernel matrix HKH , with normalization chosen so that \u2016vj\u20162Hk = (\n\u03b1\u0303(j) )\u22a4 HKH\u03b1\u0303(j) = \u03bbj \u2225 \u2225\u03b1\u0303(j) \u2225 \u2225 2\n2 = 1 (so that the eigenfunctions have the unit RKHS norm). Therefore, the update (9)\nhas form\nf = k(\u00b7, y) + n \u2211\ni=1\n\u03b2 (j) i [k(\u00b7, zi)\u2212 \u00b5z] ,\nwhere \u03b2(j) = \u03c1\u03bdj \u221a \u03bbj \u03b1\u0303 (j). But \u03b1(j) = \u221a \u03bbj\u03b1\u0303 (j) are themselves the (unit norm) eigenvectors of HKH, as\n\u2225 \u2225\u03b1(j) \u2225 \u2225\n2 2 =\n\u03bbj \u2225 \u2225\u03b1\u0303(j) \u2225 \u2225\n2 2 = 1. Therefore, the appropriate scaling with eigenvalues is already included in the \u03b2-coefficients, just like in\nthe MCMC Kameleon, where the \u03b2-coefficients are isotropic.\nNow, we can construct the MCMC PCA-Kameleon by simply substituting \u03b2-coefficients with \u03c1\u03bdj\u03b1(j), where j is the selected eigendirection, and \u03bdj is the scaling factor associated to the j-th eigendirection. We have the following steps:\n1. Perform eigendecomposition of HKH to obtain the m \u2264 n eigenvectors {\u03b1j}mj=1 .\n2. Draw j \u223c Discrete [\u03c91, . . . , \u03c9m]\n3. \u03c1 \u223c N (0, 1)\n4. x\u2217|y, \u03c1, j \u223c N (y + \u03c1\u03bdjMz,yH\u03b1(j), \u03b32I) (d\u00d7 1 normal in the original space)\nSimilarly as before, we can simplify the proposal by integrating out the scale \u03c1 of the moves in the RKHS.\nProposition 3. qz(\u00b7|y) = \u2211m j=1 \u03c9jN (y, \u03b32I + \u03bd2jMz,yH\u03b1(j) ( \u03b1(j) )\u22a4 HM\u22a4 z,y).\nProof. We start with\np(\u03c1)p(x\u2217 | y, \u03c1, j) \u221d exp [ \u2212 1 2\u03b32 (x\u2217 \u2212 y)\u22a4(x\u2217 \u2212 y) ]\n\u00b7 exp [\n\u22121 2\n{(\n1 + \u03bd2j \u03b32 ( \u03b1(j) )\u22a4 HM\u22a4 z,yMz,yH\u03b1 (j)\n)\n\u03c12 \u2212 2\u03c1 \u03bdj \u03b32 ( \u03b1(j) )\u22a4 HM\u22a4 z,y (x\n\u2217 \u2212 y) }] .\nBy substituting\n\u03c3\u22122 = 1+ \u03bd2j \u03b32 ( \u03b1(j) )\u22a4 HM\u22a4 z,yMz,yH\u03b1 (j),\n\u00b5 = \u03c32 ( \u03bdj \u03b32 ( \u03b1(j) )\u22a4 HM\u22a4 z,y (x \u2217 \u2212 y) ) ,\nwe integrate out \u03c1 to obtain:\np (x\u2217 | y, j) \u221d exp [\n\u22121 2\n{\n1\n\u03b32 (x\u2217 \u2212 y)\u22a4(x\u2217 \u2212 y)\u2212\n\u03bd2j \u03c3 2\n\u03b34 (x\u2217 \u2212 y)\u22a4 Mz,yH\u03b1(j)\n( \u03b1(j) )\u22a4\nHM\u22a4 z,y (x\n\u2217 \u2212 y) }]\n= exp\n[\n\u22121 2 (x\u2217 \u2212 y)\u22a4 R\u22121 (x\u2217 \u2212 y)\n]\nwhere R\u22121 = 1\u03b32 ( I \u2212 \u03bd 2 j \u03c3 2 \u03b32 Mz,yH\u03b1 (j) ( \u03b1(j) )\u22a4 HM\u22a4 z,y ) . We can simplify the covariance R using the Woodbury identity to obtain:\nR = \u03b32(I \u2212 \u03bd2j \u03c3 2\n\u03b32 Mz,yH\u03b1\n(j) ( \u03b1(j) )\u22a4\nHM\u22a4 z,y) \u22121\n= \u03b32\n I + \u03bd2j \u03c3 2\n\u03b32 Mz,yH\u03b1\n(j)\n(\n1\u2212 \u03bd2j \u03c3 2\n\u03b32\n( \u03b1(j) )\u22a4\nHM\u22a4 z,yMz,yH\u03b1 (j)\n)\u22121 (\n\u03b1(j) )\u22a4\nHM\u22a4 z,y\n\n\n= \u03b32\n(\nI + \u03bd2j \u03b32 Mz,yH\u03b1 (j) ( \u03b1(j) )\u22a4 HM\u22a4 z,y\n)\n= \u03b32I + \u03bd2jMz,yH\u03b1 (j)\n( \u03b1(j) )\u22a4\nHM\u22a4 z,y.\nThe claim follows after summing over the choice j of the eigendirection (w.p. \u03c9j)."}], "references": [{"title": "The pseudo-marginal approach for efficient Monte Carlo computations", "author": ["C. Andrieu", "G.O. Roberts"], "venue": "Ann. Statist.,", "citeRegEx": "Andrieu and Roberts,? \\Q2009\\E", "shortCiteRegEx": "Andrieu and Roberts", "year": 2009}, {"title": "A tutorial on adaptive MCMC", "author": ["C. Andrieu", "J. Thoms"], "venue": "Statistics and Computing,", "citeRegEx": "Andrieu and Thoms,? \\Q2008\\E", "shortCiteRegEx": "Andrieu and Thoms", "year": 2008}, {"title": "Joint measures and cross-covariance operators", "author": ["C. Baker"], "venue": "Transactions of the American Mathematical Society,", "citeRegEx": "Baker,? \\Q1973\\E", "shortCiteRegEx": "Baker", "year": 1973}, {"title": "Learning to find preimages", "author": ["G. Bakir", "J. Weston", "B. Sch\u00f6lkopf"], "venue": "In Advances in Neural Information Processing Systems", "citeRegEx": "Bakir et al\\.,? \\Q2003\\E", "shortCiteRegEx": "Bakir et al\\.", "year": 2003}, {"title": "Reproducing Kernel Hilbert Spaces in Probability and Statistics", "author": ["A. Berlinet", "C. Thomas-Agnan"], "venue": null, "citeRegEx": "Berlinet and Thomas.Agnan,? \\Q2004\\E", "shortCiteRegEx": "Berlinet and Thomas.Agnan", "year": 2004}, {"title": "Integrating structured biological data by kernel maximum mean discrepancy", "author": ["K.M. Borgwardt", "A. Gretton", "M.J. Rasch", "Kriegel", "H.-P", "B. Sch\u00f6lkopf", "A.J. Smola"], "venue": "Bioinformatics (ISMB),", "citeRegEx": "Borgwardt et al\\.,? \\Q2006\\E", "shortCiteRegEx": "Borgwardt et al\\.", "year": 2006}, {"title": "Pseudo-marginal Bayesian inference for Gaussian Processes", "author": ["M. Filippone", "M. Girolami"], "venue": "IEEE Transactions on Pattern Analysis and Machine Intelligence,", "citeRegEx": "Filippone and Girolami,? \\Q2014\\E", "shortCiteRegEx": "Filippone and Girolami", "year": 2014}, {"title": "Dimensionality reduction for supervised learning with reproducing kernel Hilbert spaces", "author": ["K. Fukumizu", "F.R. Bach", "M.I. Jordan"], "venue": "J. Mach. Learn. Res.,", "citeRegEx": "Fukumizu et al\\.,? \\Q2004\\E", "shortCiteRegEx": "Fukumizu et al\\.", "year": 2004}, {"title": "Efficient Metropolis jumping rules", "author": ["A. Gelman", "G.O. Roberts", "W.R. Gilks"], "venue": "In Bayesian statistics,", "citeRegEx": "Gelman et al\\.,? \\Q1994\\E", "shortCiteRegEx": "Gelman et al\\.", "year": 1994}, {"title": "Riemann manifold Langevin and Hamiltonian Monte Carlo methods", "author": ["M. Girolami", "B. Calderhead"], "venue": "Journal of the Royal Statistical Society: Series B,", "citeRegEx": "Girolami and Calderhead,? \\Q2011\\E", "shortCiteRegEx": "Girolami and Calderhead", "year": 2011}, {"title": "A kernel method for the two-sample problem", "author": ["A. Gretton", "K. Borgwardt", "M. Rasch", "B. Sch\u00f6lkopf", "A. Smola"], "venue": "In Advances in Neural Information Processing Systems", "citeRegEx": "Gretton et al\\.,? \\Q2007\\E", "shortCiteRegEx": "Gretton et al\\.", "year": 2007}, {"title": "Adaptive Proposal Distribution for Random Walk Metropolis Algorithm", "author": ["H. Haario", "E. Saksman", "J. Tamminen"], "venue": "Comput. Stat.,", "citeRegEx": "Haario et al\\.,? \\Q1999\\E", "shortCiteRegEx": "Haario et al\\.", "year": 1999}, {"title": "Slice sampling covariance hyperparameters of latent Gaussian models", "author": ["I. Murray", "R.P. Adams"], "venue": "In Advances in Neural Information Processing Systems", "citeRegEx": "Murray and Adams,? \\Q2012\\E", "shortCiteRegEx": "Murray and Adams", "year": 2012}, {"title": "Coupling and ergodicity of adaptive Markov chain Monte Carlo algorithms", "author": ["G.O. Roberts", "J.S. Rosenthal"], "venue": "J. Appl. Probab., 44(2):458\u2013475,", "citeRegEx": "Roberts and Rosenthal,? \\Q2007\\E", "shortCiteRegEx": "Roberts and Rosenthal", "year": 2007}, {"title": "Langevin diffusions and Metropolis-Hastings algorithms", "author": ["G.O. Roberts", "O. Stramer"], "venue": "Methodol. Comput. Appl. Probab.,", "citeRegEx": "Roberts and Stramer,? \\Q2003\\E", "shortCiteRegEx": "Roberts and Stramer", "year": 2003}, {"title": "Integral transforms, reproducing kernels, and their applications", "author": ["S. Saitoh"], "venue": "Pitman Research Notes in Mathematics", "citeRegEx": "Saitoh,? \\Q1997\\E", "shortCiteRegEx": "Saitoh", "year": 1997}, {"title": "Nonlinear component analysis as a kernel eigenvalue problem", "author": ["B. Sch\u00f6lkopf", "A.J. Smola", "M\u00fcller", "K.-R"], "venue": "Neural Comput.,", "citeRegEx": "Sch\u00f6lkopf et al\\.,? \\Q1998\\E", "shortCiteRegEx": "Sch\u00f6lkopf et al\\.", "year": 1998}, {"title": "A Hilbert space embedding for distributions", "author": ["A. Smola", "A. Gretton", "L. Song", "B. Sch\u00f6lkopf"], "venue": "In Proceedings of the Conference on Algorithmic Learning Theory (ALT),", "citeRegEx": "Smola et al\\.,? \\Q2007\\E", "shortCiteRegEx": "Smola et al\\.", "year": 2007}, {"title": "Regularized principal manifolds", "author": ["A.J. Smola", "S. Mika", "B. Sch\u00f6lkopf", "R.C. Williamson"], "venue": "J. Mach. Learn. Res.,", "citeRegEx": "Smola et al\\.,? \\Q2001\\E", "shortCiteRegEx": "Smola et al\\.", "year": 2001}, {"title": "Hilbert space embeddings and metrics on probability measures", "author": ["B. Sriperumbudur", "A. Gretton", "K. Fukumizu", "G. Lanckriet", "B. Sch\u00f6lkopf"], "venue": "J. Mach. Learn. Res.,", "citeRegEx": "Sriperumbudur et al\\.,? \\Q2010\\E", "shortCiteRegEx": "Sriperumbudur et al\\.", "year": 2010}, {"title": "Universality, characteristic kernels and RKHS embedding of measures", "author": ["B. Sriperumbudur", "K. Fukumizu", "G. Lanckriet"], "venue": "J. Mach. Learn. Res.,", "citeRegEx": "Sriperumbudur et al\\.,? \\Q2011\\E", "shortCiteRegEx": "Sriperumbudur et al\\.", "year": 2011}, {"title": "Bayesian learning via stochastic gradient Langevin dynamics", "author": ["M. Welling", "Y.W. Teh"], "venue": "In Proc. of the 28th International Conference on Machine Learning (ICML),", "citeRegEx": "Welling and Teh,? \\Q2011\\E", "shortCiteRegEx": "Welling and Teh", "year": 2011}, {"title": "Bayesian classification with Gaussian processes", "author": ["C.K.I. Williams", "D. Barber"], "venue": "IEEE Transactions on Pattern Analysis and Machine Intelligence,", "citeRegEx": "Williams and Barber,? \\Q1998\\E", "shortCiteRegEx": "Williams and Barber", "year": 1998}], "referenceMentions": [{"referenceID": 16, "context": "In the present work, we develop an adaptive Metropolis-Hastings algorithm in which samples are mapped to a reproducing kernel Hilbert space, and the proposal distribution is chosen according to the covariance in this feature space (Sch\u00f6lkopf et al., 1998; Smola et al., 2001).", "startOffset": 231, "endOffset": 275}, {"referenceID": 18, "context": "In the present work, we develop an adaptive Metropolis-Hastings algorithm in which samples are mapped to a reproducing kernel Hilbert space, and the proposal distribution is chosen according to the covariance in this feature space (Sch\u00f6lkopf et al., 1998; Smola et al., 2001).", "startOffset": 231, "endOffset": 275}, {"referenceID": 8, "context": "Based on the chain history, they estimate the covariance of the target distribution and construct a Gaussian proposal centered at the current chain state, with a particular choice of the scaling factor from Gelman et al. (1996). More sophisticated schemes are presented by Andrieu & Thoms (2008), e.", "startOffset": 207, "endOffset": 228}, {"referenceID": 8, "context": "Based on the chain history, they estimate the covariance of the target distribution and construct a Gaussian proposal centered at the current chain state, with a particular choice of the scaling factor from Gelman et al. (1996). More sophisticated schemes are presented by Andrieu & Thoms (2008), e.", "startOffset": 207, "endOffset": 296}, {"referenceID": 8, "context": "38/ \u221a d is a fixed scaling factor from Gelman et al. (1996). This choice of scaling factor was shown to be optimal (in terms of efficiency measures) for the usual Metropolis algorithm.", "startOffset": 39, "endOffset": 60}, {"referenceID": 8, "context": "38/ \u221a d is a fixed scaling factor from Gelman et al. (1996). This choice of scaling factor was shown to be optimal (in terms of efficiency measures) for the usual Metropolis algorithm. While this optimality result does not hold for Adaptive Metropolis, it can nevertheless be used as a heuristic. Alternatively, the scale \u03bd can also be adapted at each step as in Andrieu & Thoms (2008, Algorithm 4) to obtain the acceptance rate from Gelman et al. (1996), a = 0.", "startOffset": 39, "endOffset": 455}, {"referenceID": 7, "context": "This feature map or embedding of a single point can be extended to that of a probability measure P on X : its kernel embedding is an element \u03bcP \u2208 Hk, given by \u03bcP = \u0301 k(\u00b7, x) dP (x) (Berlinet & Thomas-Agnan, 2004; Fukumizu et al., 2004; Smola et al., 2007).", "startOffset": 181, "endOffset": 255}, {"referenceID": 17, "context": "This feature map or embedding of a single point can be extended to that of a probability measure P on X : its kernel embedding is an element \u03bcP \u2208 Hk, given by \u03bcP = \u0301 k(\u00b7, x) dP (x) (Berlinet & Thomas-Agnan, 2004; Fukumizu et al., 2004; Smola et al., 2007).", "startOffset": 181, "endOffset": 255}, {"referenceID": 19, "context": "Such kernels are said to be characteristic (Sriperumbudur et al., 2010; 2011), since each distribution is uniquely characterized by its embedding (in the same way that every probability distribution has a unique characteristic function).", "startOffset": 43, "endOffset": 77}, {"referenceID": 2, "context": "Next, the covariance operator CP : Hk \u2192 Hk for a probability measure P is given by CP = \u0301 k(\u00b7, x) \u2297 k(\u00b7, x) dP (x) \u2212 \u03bcP \u2297 \u03bcP (Baker, 1973; Fukumizu et al., 2004), where for a, b, c \u2208 Hk the tensor product is defined as (a \u2297 b)c = \u3008b, c\u3009Hk a.", "startOffset": 125, "endOffset": 161}, {"referenceID": 7, "context": "Next, the covariance operator CP : Hk \u2192 Hk for a probability measure P is given by CP = \u0301 k(\u00b7, x) \u2297 k(\u00b7, x) dP (x) \u2212 \u03bcP \u2297 \u03bcP (Baker, 1973; Fukumizu et al., 2004), where for a, b, c \u2208 Hk the tensor product is defined as (a \u2297 b)c = \u3008b, c\u3009Hk a.", "startOffset": 125, "endOffset": 161}, {"referenceID": 16, "context": "Our approach is based on the idea that the nonlinear support of a target density may be learned using Kernel Principal Component Analysis (Kernel PCA) (Sch\u00f6lkopf et al., 1998; Smola et al., 2001), this being linear PCA on the empirical covariance operator in the RKHS, Cz = 1 n \u2211n i=1 k(\u00b7, zi) \u2297 k(\u00b7, zi) \u2212 \u03bcz \u2297 \u03bcz, computed on the sample z defined above.", "startOffset": 151, "endOffset": 195}, {"referenceID": 18, "context": "Our approach is based on the idea that the nonlinear support of a target density may be learned using Kernel Principal Component Analysis (Kernel PCA) (Sch\u00f6lkopf et al., 1998; Smola et al., 2001), this being linear PCA on the empirical covariance operator in the RKHS, Cz = 1 n \u2211n i=1 k(\u00b7, zi) \u2297 k(\u00b7, zi) \u2212 \u03bcz \u2297 \u03bcz, computed on the sample z defined above.", "startOffset": 151, "endOffset": 195}, {"referenceID": 3, "context": "In general, this is a non-convex minimization problem, and may be difficult to solve (Bakir et al., 2003).", "startOffset": 85, "endOffset": 105}, {"referenceID": 11, "context": "Figure 1 plots g(x) and its gradients for several samples of \u03b2-coefficients, in the case where the underlying z-samples are from the two-dimensional nonlinear Banana target distribution of Haario et al. (1999). It can be seen that g may have multiple local minima, and that it varies most along the high-density regions of the Banana distribution.", "startOffset": 189, "endOffset": 210}, {"referenceID": 11, "context": "95% contours (red) of proposal distributions evaluated at a number of points, for the first two dimensions of the banana target of Haario et al. (1999). Underneath is the density heatmap, and the samples (blue) used to construct the proposals.", "startOffset": 131, "endOffset": 152}, {"referenceID": 11, "context": "In Haario et al. (2001), the proposal distribution is asymptotically symmetric due to the vanishing adaptation property.", "startOffset": 3, "endOffset": 24}, {"referenceID": 11, "context": ",\u2207xxzn|x=y ] = 2Z, so the proposal is given by qz(\u00b7|y) = N (y, \u03b3I + 4\u03bdZHZ); thus, the proposal simply uses the scaled empirical covariance ZHZ just like standard Adaptive Metropolis (Haario et al., 1999), with an additional isotropic exploration component, and depends on y only through the mean.", "startOffset": 182, "endOffset": 203}, {"referenceID": 11, "context": "We consider the following nonlinear targets: (1) the posterior distribution of Gaussian Process (GP) classification hyperparameters (Filippone & Girolami, 2014) on the UCI glass dataset, and (2) the synthetic banana-shaped distribution of Haario et al. (1999) and a flower-shaped disribution concentrated on a circle with a periodic perturbation.", "startOffset": 239, "endOffset": 260}, {"referenceID": 5, "context": "Second, the MMD (Borgwardt et al., 2006; Gretton et al., 2007) was computed between each sampler output and the benchmark sample, using the polynomial kernel (1 + \u3008\u03b8, \u03b8\u2032\u3009); i.", "startOffset": 16, "endOffset": 62}, {"referenceID": 10, "context": "Second, the MMD (Borgwardt et al., 2006; Gretton et al., 2007) was computed between each sampler output and the benchmark sample, using the polynomial kernel (1 + \u3008\u03b8, \u03b8\u2032\u3009); i.", "startOffset": 16, "endOffset": 62}, {"referenceID": 11, "context": "In Haario et al. (1999), the following family of nonlinear target distributions is considered.", "startOffset": 3, "endOffset": 24}, {"referenceID": 11, "context": "We compute the following measures of performance (similarly as in Haario et al. (1999); Andrieu & Thoms (2008)) based on the chain after burn-in: average acceptance rate, norm of the empirical mean (the true mean is by construction zero for all targets), and the deviation of the empirical quantiles from the true quantiles.", "startOffset": 66, "endOffset": 87}, {"referenceID": 11, "context": "We compute the following measures of performance (similarly as in Haario et al. (1999); Andrieu & Thoms (2008)) based on the chain after burn-in: average acceptance rate, norm of the empirical mean (the true mean is by construction zero for all targets), and the deviation of the empirical quantiles from the true quantiles.", "startOffset": 66, "endOffset": 111}], "year": 2014, "abstractText": null, "creator": "LaTeX with hyperref package"}}}