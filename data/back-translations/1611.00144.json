{"id": "1611.00144", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "1-Nov-2016", "title": "Product-based Neural Networks for User Response Prediction", "abstract": "Predicting user responses, such as clicks and conversions, is of great importance and is used in many web applications, including recommendation systems, web search, and online advertising. Data in these applications is largely categorical in nature and encompasses multiple fields; a typical representation is to transform it into a high-dimensional sparse representation of binary features using one-hot encoding. In view of the extreme scarcity, traditional models can limit their ability to filter out flat patterns from the data, i.e. low-order combinations of features. Deep models such as deep neural networks, on the other hand, cannot be applied directly to high-dimensional input due to the huge feature space. In this paper, we propose a product-based neural network (PNN) with an embedding layer to learn a distributed representation of the categorical data, a product layer to capture interactive patterns between field categories, and other fully connected layers to explore high-order large-scale display actions on our large-scale displays.", "histories": [["v1", "Tue, 1 Nov 2016 07:10:22 GMT  (1578kb,D)", "http://arxiv.org/abs/1611.00144v1", "6 pages, 5 figures, ICDM2016"]], "COMMENTS": "6 pages, 5 figures, ICDM2016", "reviews": [], "SUBJECTS": "cs.LG cs.IR", "authors": ["yanru qu", "han cai", "kan ren", "weinan zhang", "yong yu", "ying wen", "jun wang"], "accepted": false, "id": "1611.00144"}, "pdf": {"name": "1611.00144.pdf", "metadata": {"source": "CRF", "title": "Product-based Neural Networks for User Response Prediction", "authors": ["Yanru Qu", "Han Cai", "Kan Ren", "Weinan Zhang", "Yong Yu", "Ying Wen", "Jun Wang"], "emails": ["yyu}@apex.sjtu.edu.cn", "j.wang}@cs.ucl.ac.uk"], "sections": [{"heading": null, "text": "I. INTRODUCTION\nLearning and predicting user response now plays a crucial role in many personalization tasks in information retrieval (IR), such as recommender systems, web search and online advertising. The goal of user response prediction is to estimate the probability that the user will provide a predefined positive response, e.g. clicks, purchases etc., in a given context [1]. This predicted probability indicates the user\u2019s interest on the specific item such as a news article, a commercial item or an advertising post, which influences the subsequent decision making such as document ranking [2] and ad bidding [3].\nThe data collection in these IR tasks is mostly in a multifield categorical form, for example, [Weekday=Tuesday, Gender=Male, City=London], which is normally transformed into high-dimensional sparse binary features via onehot encoding [4]. For example, the three field vectors with one-hot encoding are concatenated as\n[0, 1, 0, 0, 0, 0, 0]\ufe38 \ufe37\ufe37 \ufe38 Weekday=Tuesday [0, 1]\ufe38\ufe37\ufe37\ufe38 Gender=Male [0, 0, 1, 0, . . . , 0, 0]\ufe38 \ufe37\ufe37 \ufe38 City=London .\nMany machine learning models, including linear logistic regression [5], non-linear gradient boosting decision trees [4] and factorization machines [6], have been proposed to work on such high-dimensional sparse binary features and produce high quality user response predictions. However, these models\nhighly depend on feature engineering in order to capture highorder latent patterns [7].\nRecently, deep neural networks (DNNs) [8] have shown great capability in classification and regression tasks, including computer vision [9], speech recognition [10] and natural language processing [11]. It is promising to adopt DNNs in user response prediction since DNNs could automatically learn more expressive feature representations and deliver better prediction performance. In order to improve the multi-field categorical data interaction, [12] presented an embedding methodology based on pre-training of a factorization machine. Based on the concatenated embedding vectors, multi-layer perceptrons (MLPs) were built to explore feature interactions. However, the quality of embedding initialization is largely limited by the factorization machine. More importantly, the \u201cadd\u201d operations of the perceptron layer might not be useful to explore the interactions of categorical data in multiple fields. Previous work [1], [6] has shown that local dependencies between features from different fields can be effectively explored by feature vector \u201cproduct\u201d operations instead of \u201cadd\u201d operations.\nTo utilize the learning ability of neural networks and mine the latent patterns of data in a more effective way than MLPs, in this paper we propose Product-based Neural Network (PNN) which (i) starts from an embedding layer without pretraining as used in [12], and (ii) builds a product layer based on the embedded feature vectors to model the inter-field feature interactions, and (iii) further distills the high-order feature patterns with fully connected MLPs. We present two types of PNNs, with inner and outer product operations in the product layer, to efficiently model the interactive patterns.\nWe take CTR estimation in online advertising as the working example to explore the learning ability of our PNN model. The extensive experimental results on two large-scale realworld datasets demonstrate the consistent superiority of our model over state-of-the-art user response prediction models [6], [13], [12] on various metrics."}, {"heading": "II. RELATED WORK", "text": "The response prediction problem is normally formulated as a binary classification problem with prediction likelihood or cross entropy as the training objective [14]. Area under ROC Curve (AUC) and Relative Information Gain (RIG) are common evaluation metrics for response prediction accuracy\nar X\niv :1\n61 1.\n00 14\n4v 1\n[ cs\n.L G\n] 1\nN ov\n2 01\n6\n[15]. From the modeling perspective, linear logistic regression (LR) [5], [16] and non-linear gradient boosting decision trees (GBDT) [4] and factorization machines (FM) [6] are widely used in industrial applications. However, these models are limited in mining high-order latent patterns or learning quality feature representations.\nDeep learning is able to explore high-order latent patterns as well as generalizing expressive data representations [11]. The input data of DNNs are usually dense real vectors, while the solution of multi-field categorical data has not been well studied. Factorization-machine supported neural networks (FNN) was proposed in [12] to learn embedding vectors of categorical data via pre-trained FM. Convolutional Click Prediction Model (CCPM) was proposed in [13] to predict ad click by convolutional neural networks (CNN). However, in CCPM the convolutions are only performed on the neighbor fields in a certain alignment, which fails to model the full interactions among non-neighbor features. Recurrent neural networks (RNN) was leveraged to model the user queries as a series of user context to predict the ad click behavior [17]. Product unit neural network (PUNN) [18] was proposed to build high-order combinations of the inputs. However, neither can PUNN learn local dependencies, nor produce bounded outputs to fit the response rate.\nIn this paper, we demonstrate the way our PNN models learn local dependencies and high-order feature interactions."}, {"heading": "III. DEEP LEARNING FOR CTR ESTIMATION", "text": "We take CTR estimation in online advertising [14] as a working example to formulate our model and explore the performance on various metrics. The task is to build a prediction model to estimate the probability of a user clicking a specific ad in a given context.\nEach data sample consists of multiple fields of categorical data such as user information (City, Hour, etc.), publisher information (Domain, Ad slot, etc.) and ad information (Ad creative ID, Campaign ID, etc.) [19]. All the information is represented as a multi-field categorical feature vector, where each field (e.g. City) is one-hot encoded as discussed in Section I. Such a field-wise one-hot encoding representation results in curse of dimensionality and enormous sparsity [12]. Besides, there exist local dependencies and hierarchical structures among fields [1].\nThus we are seeking a DNN model to capture high-order latent patterns in multi-field categorical data. And we come up with the idea of product layers to explore feature interactions automatically. In FM, feature interaction is defined as the inner product of two feature vectors [20].\nThe proposed deep learning model is named as Productbased Neural Network (PNN). In this section, we present PNN model in detail and discuss two variants of this model, namely Inner Product-based Neural Network (IPNN), which has an inner product layer, and Outer Product-based Neural Network (OPNN) which uses an outer product expression.\nField 1 Field 2 Field N\nFeature 1 Feature 2 Feature N\nInput\nEmbedding Layer Field-wisely Connected\nProduct Layer Pair-wisely Connected\nHidden Layer 1 Fully Connected\nCTR\n\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n1\n\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7 \u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\n\u00b7\u00b7\u00b7\u00b7\u00b7\u00b7\nHidden Layer 2 Fully Connected L2\nL1\nz p\nf\nFig. 1: Product-based Neural Network Architecture."}, {"heading": "A. Product-based Neural Network", "text": "The architecture of the PNN model is illustrated in Figure 1. From a top-down perspective, the output of PNN is a real number y\u0302 \u2208 (0, 1) as the predicted CTR:\ny\u0302 = \u03c3(W3l2 + b3), (1)\nwhere W3 \u2208 R1\u00d7D2 and b3 \u2208 R are the parameters of the output layer, l2 \u2208 RD2 is the output of the second hidden layer, and \u03c3(x) is the sigmoid activation function: \u03c3(x) = 1/(1 + e\u2212x). And we use Di to represent the dimension of the i-th hidden layer.\nThe output l2 of the second hidden layer is constructed as\nl2 = relu(W2l1 + b2), (2)\nwhere l1 \u2208 RD1 is the output of the first hidden layer. The rectified linear unit (relu), defined as relu(x) = max(0, x), is chosen as the activation function for hidden layer output since it has outstanding performance and efficient computation.\nThe first hidden layer is fully connected with the product layer. The inputs to it consist of linear signals lz and quadratic signals lp. With respect to lz and lp inputs, separately, the formulation of l1 is:\nl1 = relu(lz + lp + b1), (3)\nwhere all lz , lp and the bias vector b1 \u2208 RD1 . Then, let us define the operation of tensor inner product:\nA B , \u2211 i,j Ai,jBi,j , (4)\nwhere firstly element-wise multiplication is applied to A,B, then the multiplication result is summed up to a scalar. After that, lz and lp are calculated through z and p, respectively:\nlz = ( l1z , l 2 z , . . . , l n z , . . . , l D1 z ) , lnz =W n z z (5)\nlp = ( l1p, l 2 p, . . . , l n p , . . . , l D1 p ) , lnp =W n p p\nwhere W nz and W n p are the weights in the product layer, and their shapes are determined by z and p respectively.\nBy introducing a \u201c1\u201d constant signal, the product layer can not only generate the quadratic signals p, but also maintaining the linear signals z, as illustrated in Figure 1. More specifically,\nz = ( z1, z2, . . . ,zN ) , ( f1,f2, . . . ,fN ) , (6)\np = {pi,j}, i = 1...N, j = 1...N, (7)\nwhere fi \u2208 RM is the embedding vector for field i. pi,j = g(fi,fj) defines the pairwise feature interaction. Our PNN model can have different implementations by designing different operation for g. In this paper, we propose two variants of PNN, namely IPNN and OPNN, as will be discussed later.\nThe embedding vector fi of field i, is the output of the embedding layer:\nfi =W i 0 x[starti : endi], (8)\nwhere x is the input feature vector containing multiple fields, and x[starti : endi] represents the one-hot encoded vector for field i. W0 represents the parameters of the embedding layer, and W i0 \u2208 RM\u00d7(endi\u2212starti+1) is fully connected with field i.\nFinally, supervised training is applied to minimize the log loss, which is a widely used objective function capturing divergence between two probability distributions:\nL(y, y\u0302) = \u2212y log y\u0302 \u2212 (1\u2212 y) log(1\u2212 y\u0302), (9)\nwhere y is the ground truth (1 for click, 0 for non-click), and y\u0302 is the predicted CTR of our model as in Eq. (1).\nB. Inner Product-based Neural Network In this section, we demonstrate the Inner Product-based Neural Network (IPNN). In IPNN, we firstly define the pairwise feature interaction as vector inner product : g(fi,fj) = \u3008fi,fj\u3009.\nWith the constant signal \u201c1\u201d, the linear information z is preserved as:\nlnz =W n z z = N\u2211 i=1 M\u2211 j=1 (W nz )i,jzi,j . (10)\nAs for the quadratic information p, the pairwise inner product terms of g(fi,fj) form a square matrix p \u2208 RN\u00d7N . Recalling the definition of lp in Eq. (5), lnp =\u2211N\ni=1 \u2211N j=1(W n p )i,jpi,j and the commutative law in vector inner product, p and W np should be symmetric. Such pairwise connection expands the capacity of the neural network, but also enormously increases the complexity. In this case, the formulation of l1, described in Eq. (3), has the space complexity of O(D1N(M +N)), and the time complexity of O(N2(D1 +M)), where D1 and M are the hyper-parameters about network architecture, N is the number of input fields. Inspired by FM [20], we come up with the idea of matrix factorization to reduce complexity.\nBy introducing the assumption that W np = \u03b8 n\u03b8nT , where\n\u03b8n \u2208 RN , we can simplify l1\u2019s formulation as:\nW np p = N\u2211 i=1 N\u2211 j=1 \u03b8ni \u03b8 n j \u3008fi,fj\u3009 = \u3008 N\u2211 i=1 \u03b4ni , N\u2211 i=1 \u03b4ni \u3009 (11)\nwhere, for convenience, we use \u03b4ni \u2208 RM to denote a feature vector fi weighted by \u03b8ni , i.e. \u03b4 n i = \u03b8 n i fi. And we also have\n\u03b4n = ( \u03b4n1 , \u03b4 n 2 , . . . , \u03b4 n i , . . . , \u03b4 n N ) \u2208 RN\u00d7M .\nWith the first order decomposition on n-th single node, we give the lp complete form:\nlp = ( \u2016 \u2211 i \u03b41i \u2016, . . . , \u2016 \u2211 i \u03b4ni \u2016, . . . , \u2016 \u2211 i \u03b4D1i \u2016 ) . (12)\nBy reduction of lp in Eq. (12), the space complexity of l1 becomes O(D1MN), and the time complexity is also O(D1MN). In general, l1 complexity is reduced from quadratic to linear with respect to N . This well-formed equation makes reusable for some intermediate results. Moreover, matrix operations are easily accelerated in practice with GPUs.\nMore generally, we discuss K-order decomposition of W np at the end of this section. We should point out that W np = \u03b8n\u03b8 T n is only the first order decomposition with a strong assumption. The general matrix decomposition method can be derived that:\nW np p = N\u2211 i=1 N\u2211 j=1 \u3008\u03b8in,\u03b8jn\u3009\u3008fi,fj\u3009. (13)\nIn this case, \u03b8in \u2208 RK . This general decomposition is more expressive with weaker assumptions, but also leading to K times model complexity."}, {"heading": "C. Outer Product-based Neural Network", "text": "Vector inner product takes a pair of vectors as input and outputs a scalar. Different from that, vector outer product takes a pair of vectors and produces a matrix. IPNN defines feature interaction by vector inner product, while in this section, we discuss the Outer Product-based Neural Network (OPNN).\nThe only difference between IPNN and OPNN is the quadratic term p. In OPNN, we define feature interaction as g(fi,fj) = fif T j . Thus for every element in p, pi,j \u2208 RM\u00d7M is a square matrix. For calculating l1, the space complexity is O(D1M2N2) , and the time complexity is also O(D1M2N2). Recall that D1 and M are the hyper-parameters of the network architecture, and N is the number of the input fields, this implementation is expensive in practice. To reduce the complexity, we propose the idea of superposition.\nBy element-wise superposition, we can reduce the complexity by a large step. Specifically, we re-define p formulation as\np = N\u2211 i=1 N\u2211 j=1 fif T j = f\u03a3(f\u03a3) T , f\u03a3 = N\u2211 i=1 fi, (14)\nwhere p \u2208 RM\u00d7M becomes symmetric, thus W np should also be symmetric. Recall Eq. (5) that Wp \u2208 RD1\u00d7M\u00d7M . In this case, the space complexity of l1 becomes O(D1M(M +N)), and the time complexity is also O(D1M(M +N))."}, {"heading": "D. Discussions", "text": "Compared with FNN [12], PNN has a product layer. If removing lp part of the product layer, PNN is identical to FNN. With the inner product operator, PNN is quite similar with FM [20]: if there is no hidden layer and the output layer is simply summing up with uniform weight, PNN is identical to FM. Inspired by Net2Net [21], we can firstly train a part of PNN (e.g., the FNN or FM part) as the initialization, and then start to let the back propagation go over the whole net. The resulted PNN should at least be as good as FNN or FM.\nIn general, PNN uses product layers to explore feature interactions. Vector products can be viewed as a series of addition/multiplication operations. Inner product and outer product are just two implementations. In fact, we can define more general or complicated product layers, gaining PNN better capability in exploration of feature interactions.\nAnalogous to electronic circuit, addition acts like \u201cOR\u201d gate while multiplication acting like \u201cAND\u201d gate, and the product layer seems to learn rules other than features. Reviewing the scenario of computer vision, while pixels in images are real-world raw features, categorical data in web applications are artificial features with high levels and rich meanings. Logic is a powerful tool in dealing with concepts, domains and relationships. Thus we believe that introducing product operations in neural networks will improve networks\u2019 ability for modeling multi-field categorical data."}, {"heading": "IV. EXPERIMENTS", "text": "In this section, we present our experiments in detail, including datasets, data processing, experimental setup, model comparison, and the corresponding analysis1. In our experiments, PNN models outperform major state-of-the-art models in the CTR estimation task on two real-world datasets."}, {"heading": "A. Datasets", "text": "1) Criteo: Criteo 1TB click log2 is a famous ad tech industry benchmarking dataset. We select 7 consecutive days of samples for training, and the next 1 day for evaluation. Because of the enormous data volume and high bias, we apply negative down-sampling on this dataset. Define the down-sampling ratio as w, the predicted CTR as p, the recalibrated CTR q should be q = p/(p + 1\u2212pw ) [4]. After down-sampling and feature mapping, we get a dataset, which comprises 79.38M instances with 1.64M feature dimensions.\n2) iPinYou: The iPinYou dataset3 is another real-world dataset for ad click logs over 10 days. After one-hot encoding, we get a dataset containing 19.50M instances with 937.67K input dimensions. We keep the original train/test splitting scheme, where for each advertiser the last 3-day data are used as the test dataset while the rest as the training dataset.\n1We release the repeatable experiment code on GitHub: https://github.com/ Atomu2014/product-nets\n2Criteo terabyte dataset download link: http://labs.criteo.com/downloads/ download-terabyte-click-logs/.\n3iPinYou dataset download link: http://data.computational-advertising.org. We only use the data from season 2 and 3 because of the same data schema."}, {"heading": "B. Model Comparison", "text": "We compare 7 models in our experiments, which are implemented with TensorFlow4, and trained with Stochastic Gradient Descent (SGD).\nLR: LR is the most widely used linear model in industrial applications [22]. It is easy to implement and fast to train, however, unable to capture non-linear information.\nFM: FM has many successful applications in recommender systems and user response prediction tasks [20]. FM explores feature interactions, which is effective on sparse data.\nFNN: FNN is proposed in [12], being able to capture highorder latent patterns of multi-field categorical data.\nCCPM: CCPM is a convolutional model for click prediction [13]. This model learns local-global features efficiently. However, CCPM highly relies on feature alignment, and is lack of interpretation.\nIPNN: PNN with inner product layer III-B. OPNN: PNN with outer product layer III-C. PNN*: This model has a product layer, which is a concatenation of inner product and outer product. Additionally, in order to prevent over-fitting, the popular L2 regularization term is added to the loss function L(y, y\u0302) when training LR and FM. And we also employ dropout as a regularization method to prevent over-fitting when training neural networks."}, {"heading": "C. Evaluation Metrics", "text": "Four evaluation metrics are tested in our experiments. The two major metrics are:\nAUC: Area under ROC curve is a widely used metric in evaluating classification problems. Besides, some work validates AUC as a good measurement in CTR estimation [15].\nRIG: Relative Information Gain, RIG = 1 \u2212 NE, where NE is the Normalized Cross Entropy [4].\nBesides, we also employ Log Loss (Eq. (9)) and root mean square error (RMSE) as our additional evaluation metrics."}, {"heading": "D. Performance Comparison", "text": "Table I and II show the overall performance on Criteo and iPinYou datasets, respectively. In FM, we employ 10- order factorization and correspondingly, we employ 10-order embedding in network models. CCPM has 1 embedding layer, 2 convolution layers (with max pooling) and 1 hidden layer (5 layers in total). FNN has 1 embedding layer and 3 hidden layers (4 layers in total). Every PNN has 1 embedding layer, 1 product layer and 3 hidden layers (5 layers in total). The impact of network depth will be discussed later.\nThe LR and FM models are trained with L2 norm regularization, while FNN, CCPM and PNNs are trained with dropout. By default, we set dropout rate at 0.5 on network hidden layers, which is proved effective in Figure 2. Further discussions about the network architecture will be provided in Section IV-E.\n4TensorFlow: https://www.tensorflow.org/\nTABLE II: Overall Performance on the iPinYou Dataset.\nModel AUC Log Loss RMSE RIG LR 73.43% 5.581e-3 5.350e-07 7.353e-2 FM 75.52% 5.504e-3 5.343e-07 8.635e-2 FNN 76.19% 5.443e-3 5.285e-07 9.635e-2 CCPM 76.38% 5.522e-3 5.343e-07 8.335e-2 IPNN 79.14% 5.195e-3 4.851e-07 1.376e-1 OPNN 81.74% 5.211e-3 5.293e-07 1.349e-1 PNN* 76.61% 4.975e-3 4.819e-07 1.740e-1\nTABLE III: P-values under the Log Loss Metric.\nFirstly, we focus on the AUC performance. The overall results in Table I and II illustrate that (i) FM outperforms LR, demonstrating the effectiveness of feature interactions; (ii) Neural networks outperform LR and FM, which validates the importance of high-order latent patterns; (iii) PNNs perform the best on both Criteo and iPinYou datasets. As for log loss, RMSE and RIG, the results are similar.\nWe also conduct t-test between our proposed PNNs and the other compared models. Table III shows the calculated p-values under log loss metric on both datasets. The results verify that our models significantly improve the performance of user response prediction against the baseline models.\nWe also find that PNN*, which is the combination of IPNN and OPNN, has no obvious advantages over IPNN and OPNN on AUC performance. We consider that IPNN and OPNN are sufficient to capture the feature interactions in multi-field categorical data.\nFigure 3 shows the AUC performance with respect to the training iterations on iPinYou dataset. We find that network\nmodels converge more quickly than LR and FM. We also observe that our two proposed PNNs have better convergence than other network models."}, {"heading": "E. Ablation Study on Network Architecture", "text": "In this section, we discuss the impact of neural network architecture. For IPNN and OPNN, we take three hyperparameters (or settings) into consideration: (i) embedding layer size, (ii) network depth and (iii) activation function. Since CCPM shares few similarities with other neural networks and PNN* is just a combination of IPNN and OPNN, we only compare FNN, IPNN and OPNN in this section.\n1) Embedding Layer: The embedding layer is to convert sparse binary inputs to dense real-value vectors. Take word embedding as an example [11], an embedding vector contains the information of the word and its context, and indicates the relationships between words.\nWe take the idea of embedding layer from [12]. In this paper, the latent vectors learned by FM are explained as node representations, and the authors use a pre-trained FM to initialize the embedding layers in FNN. Thus the factorization order of FM keeps consistent with the embedding order.\nThe input units are fully connected with the embedding layer within each field. We compare different orders, like 2, 10, 50 and 100. However, when the order grows larger, it is harder to fit the parameters in memory, and the models are much easier to over-fit. In our experiments, we take 10-order embedding in neural networks.\n2) Network Depth: We also explore the impact of network depth by adjusting the number of hidden layers in FNN and PNNs. We compare different number of hidden layers: 1, 3, 5 and 7. Figure 4 shows the performance as network depth grows. Generally speaking, the networks with 3 hidden layers have better generalization on the test set.\nFor convenience, we call convolution layers and product layers as representation layers. These layers can capture complex feature patterns using fewer parameters, thus are efficient in training, and generalize better on the test set.\n3) Activation Function: We compare three mainstream activation functions: sigmoid(x) = 11+e\u2212x , tanh(x) = 1\u2212e\u22122x 1+e\u22122x , and relu(x) = max(0, x). Compared with the sigmoidal family, relu function has the advantages of sparsity and efficient gradient, which is possible to gain more benefits on multi-field categorical data.\nFigure 5 compares these activation functions on FNN, IPNN and OPNN. From this figure, we find that tanh has better performance than sigmoid. This is supported by [12]. Besides tanh, we find relu function also has good performance. Possible reasons include: (i) Sparse activation, nodes with negative outputs will not be activated; (ii) Efficient gradient propagation, no vanishing gradient problem or exploding effect; (iii) Efficient computation, only comparison, addition and multiplication."}, {"heading": "V. CONCLUSION AND FUTURE WORK", "text": "In this paper, we proposed a deep neural network model with novel architecture, namely Product-based Neural Network, to improve the prediction performance of DNN working on categorical data. And we chose CTR estimation as our working example. By exploration of feature interactions, PNN is promising to learn high-order latent patterns on multi-field categorical data. We designed two types of PNN: IPNN based on inner product and OPNN based on outer product. We also discussed solutions to reduce complexity, making PNN efficient and scalable. Our experimental results demonstrated that PNN outperformed the other state-of-the-art models in 4 metrics on 2 datasets. To sum up, we obtain the following\nconclusions: (i) By investigating feature interactions, PNN gains better capacity on multi-field categorical data. (ii) Being both efficient and effective, PNN outperforms major stateof-the-art models. (iii) Analogous to \u201cAND\u201d/\u201cOR\u201d gates, the product/add operations in PNN provide a potential strategy for data representation, more specifically, rule representation.\nIn the future work, we will explore PNN with more general and complicated product layers. Besides, we are interested in explaining and visualizing the feature vectors learned by our models. We will investigate their properties, and further apply these node representations to other tasks."}], "references": [{"title": "Response prediction using collaborative filtering with hierarchies and side-information", "author": ["A.K. Menon", "K.-P. Chitrapura", "S. Garg"], "venue": "SIGKDD. ACM, 2011, pp. 141\u2013149.", "citeRegEx": "1", "shortCiteRegEx": null, "year": 2011}, {"title": "Optimizing web search using web click-through data", "author": ["G.-R. Xue", "H.-J. Zeng", "Z. Chen", "Y. Yu", "W.-Y. Ma", "W. Xi", "W. Fan"], "venue": "CIKM, 2004.", "citeRegEx": "2", "shortCiteRegEx": null, "year": 2004}, {"title": "Optimal real-time bidding for display advertising", "author": ["W. Zhang", "S. Yuan", "J. Wang"], "venue": "SIGKDD. ACM, 2014, pp. 1077\u20131086.", "citeRegEx": "3", "shortCiteRegEx": null, "year": 2014}, {"title": "Practical lessons from predicting clicks on ads at facebook", "author": ["X. He", "J. Pan", "O. Jin"], "venue": "Proceedings of the Eighth International Workshop on Data Mining for Online Advertising. ACM, 2014, pp. 1\u20139.", "citeRegEx": "4", "shortCiteRegEx": null, "year": 2014}, {"title": "Estimating conversion rate in display advertising from past erformance data", "author": ["K.-c. Lee", "B. Orten", "A. Dasdan"], "venue": "SIGKDD. ACM, 2012, pp. 768\u2013776.", "citeRegEx": "5", "shortCiteRegEx": null, "year": 2012}, {"title": "Factorization machines with follow-the-regularized-leader for ctr prediction in display advertising", "author": ["A.-P. Ta"], "venue": "IEEE BigData. IEEE, 2015, pp. 2889\u20132891.", "citeRegEx": "6", "shortCiteRegEx": null, "year": 2015}, {"title": "Bid landscape forecasting in online ad exchange marketplace", "author": ["Y. Cui", "R. Zhang", "W. Li"], "venue": "SIGKDD. ACM, 2011, pp. 265\u2013273.", "citeRegEx": "7", "shortCiteRegEx": null, "year": 2011}, {"title": "Deep learning", "author": ["Y. LeCun", "Y. Bengio", "G. Hinton"], "venue": "Nature, 2015.", "citeRegEx": "8", "shortCiteRegEx": null, "year": 2015}, {"title": "Imagenet classification with deep convolutional neural networks", "author": ["A. Krizhevsky", "I. Sutskever", "G.E. Hinton"], "venue": "NIPS, 2012, pp. 1097\u2013 1105.", "citeRegEx": "9", "shortCiteRegEx": null, "year": 2012}, {"title": "Speech recognition with deep recurrent neural networks", "author": ["A. Graves", "A.-r. Mohamed", "G. Hinton"], "venue": "ICASSP. IEEE, 2013, pp. 6645\u2013 6649.", "citeRegEx": "10", "shortCiteRegEx": null, "year": 2013}, {"title": "Distributed representations of words and phrases and their compositionality", "author": ["T. Mikolov", "I. Sutskever", "K. Chen"], "venue": "NIPS, 2013, pp. 3111\u20133119.", "citeRegEx": "11", "shortCiteRegEx": null, "year": 2013}, {"title": "Deep learning over multi-field categorical data: A case study on user response prediction", "author": ["W. Zhang", "T. Du", "J. Wang"], "venue": "ECIR, 2016.", "citeRegEx": "12", "shortCiteRegEx": null, "year": 2016}, {"title": "A convolutional click prediction model", "author": ["Q. Liu", "F. Yu", "S. Wu"], "venue": "CIKM. ACM, 2015, pp. 1743\u20131746.", "citeRegEx": "13", "shortCiteRegEx": null, "year": 2015}, {"title": "Predicting clicks: estimating the click-through rate for new ads", "author": ["M. Richardson", "E. Dominowska", "R. Ragno"], "venue": "WWW. ACM, 2007, pp. 521\u2013530.", "citeRegEx": "14", "shortCiteRegEx": null, "year": 2007}, {"title": "Web-scale bayesian clickthrough rate prediction for sponsored search advertising in microsoft\u2019s bing search engine", "author": ["T. Graepel", "J.Q. Candela", "T. Borchert"], "venue": "ICML, 2010, pp. 13\u201320.", "citeRegEx": "15", "shortCiteRegEx": null, "year": 2010}, {"title": "User response learning for directly optimizing campaign performance in display advertising", "author": ["K. Ren", "W. Zhang", "Y. Rong", "H. Zhang", "Y. Yu", "J. Wang"], "venue": "CIKM, 2016.", "citeRegEx": "16", "shortCiteRegEx": null, "year": 2016}, {"title": "Sequential click prediction for sponsored search with recurrent neural networks", "author": ["Y. Zhang", "H. Dai", "C. Xu"], "venue": "arXiv preprint arXiv:1404.5772, 2014.", "citeRegEx": "17", "shortCiteRegEx": null, "year": 2014}, {"title": "Training product unit neural networks", "author": ["A.P. Engelbrecht", "A. Engelbrecht", "A. Ismail"], "venue": "1999.", "citeRegEx": "18", "shortCiteRegEx": null, "year": 1999}, {"title": "Real-time bidding benchmarking with ipinyou dataset", "author": ["W. Zhang", "S. Yuan", "J. Wang"], "venue": "arXiv:1407.7073, 2014.", "citeRegEx": "19", "shortCiteRegEx": null, "year": 2014}, {"title": "Factorization machines", "author": ["S. Rendle"], "venue": "ICDM. IEEE, 2010, pp. 995\u2013 1000.", "citeRegEx": "20", "shortCiteRegEx": null, "year": 2010}, {"title": "Net2net: Accelerating learning via knowledge transfer", "author": ["T. Chen", "I. Goodfellow", "J. Shlens"], "venue": "ICLR, 2016.", "citeRegEx": "21", "shortCiteRegEx": null, "year": 2016}, {"title": "Ad click prediction: a view from the trenches", "author": ["H.B. McMahan", "G. Holt", "D. Sculley"], "venue": "SIGKDD. ACM, 2013, pp. 1222\u20131230.", "citeRegEx": "22", "shortCiteRegEx": null, "year": 2013}], "referenceMentions": [{"referenceID": 0, "context": ", in a given context [1].", "startOffset": 21, "endOffset": 24}, {"referenceID": 1, "context": "This predicted probability indicates the user\u2019s interest on the specific item such as a news article, a commercial item or an advertising post, which influences the subsequent decision making such as document ranking [2] and ad bidding [3].", "startOffset": 217, "endOffset": 220}, {"referenceID": 2, "context": "This predicted probability indicates the user\u2019s interest on the specific item such as a news article, a commercial item or an advertising post, which influences the subsequent decision making such as document ranking [2] and ad bidding [3].", "startOffset": 236, "endOffset": 239}, {"referenceID": 3, "context": "The data collection in these IR tasks is mostly in a multifield categorical form, for example, [Weekday=Tuesday, Gender=Male, City=London], which is normally transformed into high-dimensional sparse binary features via onehot encoding [4].", "startOffset": 235, "endOffset": 238}, {"referenceID": 0, "context": "[0, 1, 0, 0, 0, 0, 0] } {{ }", "startOffset": 0, "endOffset": 21}, {"referenceID": 0, "context": "Weekday=Tuesday [0, 1] }{{}", "startOffset": 16, "endOffset": 22}, {"referenceID": 4, "context": "Many machine learning models, including linear logistic regression [5], non-linear gradient boosting decision trees [4] and factorization machines [6], have been proposed to work on such high-dimensional sparse binary features and produce high quality user response predictions.", "startOffset": 67, "endOffset": 70}, {"referenceID": 3, "context": "Many machine learning models, including linear logistic regression [5], non-linear gradient boosting decision trees [4] and factorization machines [6], have been proposed to work on such high-dimensional sparse binary features and produce high quality user response predictions.", "startOffset": 116, "endOffset": 119}, {"referenceID": 5, "context": "Many machine learning models, including linear logistic regression [5], non-linear gradient boosting decision trees [4] and factorization machines [6], have been proposed to work on such high-dimensional sparse binary features and produce high quality user response predictions.", "startOffset": 147, "endOffset": 150}, {"referenceID": 6, "context": "However, these models highly depend on feature engineering in order to capture highorder latent patterns [7].", "startOffset": 105, "endOffset": 108}, {"referenceID": 7, "context": "Recently, deep neural networks (DNNs) [8] have shown great capability in classification and regression tasks, including computer vision [9], speech recognition [10] and natural language processing [11].", "startOffset": 38, "endOffset": 41}, {"referenceID": 8, "context": "Recently, deep neural networks (DNNs) [8] have shown great capability in classification and regression tasks, including computer vision [9], speech recognition [10] and natural language processing [11].", "startOffset": 136, "endOffset": 139}, {"referenceID": 9, "context": "Recently, deep neural networks (DNNs) [8] have shown great capability in classification and regression tasks, including computer vision [9], speech recognition [10] and natural language processing [11].", "startOffset": 160, "endOffset": 164}, {"referenceID": 10, "context": "Recently, deep neural networks (DNNs) [8] have shown great capability in classification and regression tasks, including computer vision [9], speech recognition [10] and natural language processing [11].", "startOffset": 197, "endOffset": 201}, {"referenceID": 11, "context": "In order to improve the multi-field categorical data interaction, [12] presented an embedding methodology based on pre-training of a factorization machine.", "startOffset": 66, "endOffset": 70}, {"referenceID": 0, "context": "Previous work [1], [6] has shown that local dependencies between features from different fields can be effectively explored by feature vector \u201cproduct\u201d operations instead of \u201cadd\u201d operations.", "startOffset": 14, "endOffset": 17}, {"referenceID": 5, "context": "Previous work [1], [6] has shown that local dependencies between features from different fields can be effectively explored by feature vector \u201cproduct\u201d operations instead of \u201cadd\u201d operations.", "startOffset": 19, "endOffset": 22}, {"referenceID": 11, "context": "To utilize the learning ability of neural networks and mine the latent patterns of data in a more effective way than MLPs, in this paper we propose Product-based Neural Network (PNN) which (i) starts from an embedding layer without pretraining as used in [12], and (ii) builds a product layer based on the embedded feature vectors to model the inter-field feature interactions, and (iii) further distills the high-order feature patterns with fully connected MLPs.", "startOffset": 255, "endOffset": 259}, {"referenceID": 5, "context": "The extensive experimental results on two large-scale realworld datasets demonstrate the consistent superiority of our model over state-of-the-art user response prediction models [6], [13], [12] on various metrics.", "startOffset": 179, "endOffset": 182}, {"referenceID": 12, "context": "The extensive experimental results on two large-scale realworld datasets demonstrate the consistent superiority of our model over state-of-the-art user response prediction models [6], [13], [12] on various metrics.", "startOffset": 184, "endOffset": 188}, {"referenceID": 11, "context": "The extensive experimental results on two large-scale realworld datasets demonstrate the consistent superiority of our model over state-of-the-art user response prediction models [6], [13], [12] on various metrics.", "startOffset": 190, "endOffset": 194}, {"referenceID": 13, "context": "The response prediction problem is normally formulated as a binary classification problem with prediction likelihood or cross entropy as the training objective [14].", "startOffset": 160, "endOffset": 164}, {"referenceID": 14, "context": "[15].", "startOffset": 0, "endOffset": 4}, {"referenceID": 4, "context": "From the modeling perspective, linear logistic regression (LR) [5], [16] and non-linear gradient boosting decision trees (GBDT) [4] and factorization machines (FM) [6] are widely used in industrial applications.", "startOffset": 63, "endOffset": 66}, {"referenceID": 15, "context": "From the modeling perspective, linear logistic regression (LR) [5], [16] and non-linear gradient boosting decision trees (GBDT) [4] and factorization machines (FM) [6] are widely used in industrial applications.", "startOffset": 68, "endOffset": 72}, {"referenceID": 3, "context": "From the modeling perspective, linear logistic regression (LR) [5], [16] and non-linear gradient boosting decision trees (GBDT) [4] and factorization machines (FM) [6] are widely used in industrial applications.", "startOffset": 128, "endOffset": 131}, {"referenceID": 5, "context": "From the modeling perspective, linear logistic regression (LR) [5], [16] and non-linear gradient boosting decision trees (GBDT) [4] and factorization machines (FM) [6] are widely used in industrial applications.", "startOffset": 164, "endOffset": 167}, {"referenceID": 10, "context": "Deep learning is able to explore high-order latent patterns as well as generalizing expressive data representations [11].", "startOffset": 116, "endOffset": 120}, {"referenceID": 11, "context": "Factorization-machine supported neural networks (FNN) was proposed in [12] to learn embedding vectors of categorical data via pre-trained FM.", "startOffset": 70, "endOffset": 74}, {"referenceID": 12, "context": "Convolutional Click Prediction Model (CCPM) was proposed in [13] to predict ad click by convolutional neural networks (CNN).", "startOffset": 60, "endOffset": 64}, {"referenceID": 16, "context": "Recurrent neural networks (RNN) was leveraged to model the user queries as a series of user context to predict the ad click behavior [17].", "startOffset": 133, "endOffset": 137}, {"referenceID": 17, "context": "Product unit neural network (PUNN) [18] was proposed to build high-order combinations of the inputs.", "startOffset": 35, "endOffset": 39}, {"referenceID": 13, "context": "We take CTR estimation in online advertising [14] as a working example to formulate our model and explore the performance on various metrics.", "startOffset": 45, "endOffset": 49}, {"referenceID": 18, "context": ") [19].", "startOffset": 2, "endOffset": 6}, {"referenceID": 11, "context": "Such a field-wise one-hot encoding representation results in curse of dimensionality and enormous sparsity [12].", "startOffset": 107, "endOffset": 111}, {"referenceID": 0, "context": "Besides, there exist local dependencies and hierarchical structures among fields [1].", "startOffset": 81, "endOffset": 84}, {"referenceID": 19, "context": "In FM, feature interaction is defined as the inner product of two feature vectors [20].", "startOffset": 82, "endOffset": 86}, {"referenceID": 19, "context": "Inspired by FM [20], we come up with the idea of matrix factorization to reduce complexity.", "startOffset": 15, "endOffset": 19}, {"referenceID": 11, "context": "Compared with FNN [12], PNN has a product layer.", "startOffset": 18, "endOffset": 22}, {"referenceID": 19, "context": "With the inner product operator, PNN is quite similar with FM [20]: if there is no hidden layer and the output layer is simply summing up with uniform weight, PNN is identical to FM.", "startOffset": 62, "endOffset": 66}, {"referenceID": 20, "context": "Inspired by Net2Net [21], we can firstly train a part of PNN (e.", "startOffset": 20, "endOffset": 24}, {"referenceID": 3, "context": "Define the down-sampling ratio as w, the predicted CTR as p, the recalibrated CTR q should be q = p/(p + 1\u2212p w ) [4].", "startOffset": 113, "endOffset": 116}, {"referenceID": 21, "context": "LR: LR is the most widely used linear model in industrial applications [22].", "startOffset": 71, "endOffset": 75}, {"referenceID": 19, "context": "FM: FM has many successful applications in recommender systems and user response prediction tasks [20].", "startOffset": 98, "endOffset": 102}, {"referenceID": 11, "context": "FNN: FNN is proposed in [12], being able to capture highorder latent patterns of multi-field categorical data.", "startOffset": 24, "endOffset": 28}, {"referenceID": 12, "context": "CCPM: CCPM is a convolutional model for click prediction [13].", "startOffset": 57, "endOffset": 61}, {"referenceID": 14, "context": "Besides, some work validates AUC as a good measurement in CTR estimation [15].", "startOffset": 73, "endOffset": 77}, {"referenceID": 3, "context": "RIG: Relative Information Gain, RIG = 1 \u2212 NE, where NE is the Normalized Cross Entropy [4].", "startOffset": 87, "endOffset": 90}, {"referenceID": 10, "context": "Take word embedding as an example [11], an embedding vector contains the information of the word and its context, and indicates the relationships between words.", "startOffset": 34, "endOffset": 38}, {"referenceID": 11, "context": "We take the idea of embedding layer from [12].", "startOffset": 41, "endOffset": 45}, {"referenceID": 11, "context": "This is supported by [12].", "startOffset": 21, "endOffset": 25}], "year": 2016, "abstractText": "Predicting user responses, such as clicks and conversions, is of great importance and has found its usage in many Web applications including recommender systems, web search and online advertising. The data in those applications is mostly categorical and contains multiple fields; a typical representation is to transform it into a high-dimensional sparse binary feature representation via one-hot encoding. Facing with the extreme sparsity, traditional models may limit their capacity of mining shallow patterns from the data, i.e. low-order feature combinations. Deep models like deep neural networks, on the other hand, cannot be directly applied for the high-dimensional input because of the huge feature space. In this paper, we propose a Product-based Neural Networks (PNN) with an embedding layer to learn a distributed representation of the categorical data, a product layer to capture interactive patterns between interfield categories, and further fully connected layers to explore high-order feature interactions. Our experimental results on two large-scale real-world ad click datasets demonstrate that PNNs consistently outperform the state-of-the-art models on various metrics.", "creator": "LaTeX with hyperref package"}}}