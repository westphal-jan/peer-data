{"id": "1703.01161", "review": {"conference": "ICML", "VERSION": "v1", "DATE_OF_SUBMISSION": "3-Mar-2017", "title": "FeUdal Networks for Hierarchical Reinforcement Learning", "abstract": "We introduce FeUdal Networks (FuNs): a novel architecture for hierarchical reinforcement learning. Inspired by the feudal reinforcement learning proposal of Dayan and Hinton, our approach gains power and efficiency by decoupling end-to-end learning across multiple levels - allowing it to take advantage of different time resolutions. Our framework uses a manager module and a worker module. The manager works with a lower time resolution and sets abstract goals that are conveyed to the worker and implemented by the worker. The worker generates primitive actions at any point in the environment. The decoupled structure of FuN offers several benefits - in addition to facilitating very long-term lending, it also promotes the emergence of sub-policies linked to different goals set by the manager, which allow FuN to dramatically outperform a strong base agent in tasks involving long-term lending or storage.", "histories": [["v1", "Fri, 3 Mar 2017 14:05:11 GMT  (1754kb,D)", "https://arxiv.org/abs/1703.01161v1", null], ["v2", "Mon, 6 Mar 2017 18:17:18 GMT  (1748kb,D)", "http://arxiv.org/abs/1703.01161v2", null]], "reviews": [], "SUBJECTS": "cs.AI", "authors": ["alexander sasha vezhnevets", "simon osindero", "tom schaul", "nicolas heess", "max jaderberg", "david silver", "koray kavukcuoglu"], "accepted": true, "id": "1703.01161"}, "pdf": {"name": "1703.01161.pdf", "metadata": {"source": "META", "title": "FeUdal Networks for Hierarchical Reinforcement Learning", "authors": ["Alexander Sasha Vezhnevets", "Simon Osindero", "Tom Schaul", "Nicolas Heess", "Koray Kavukcuoglu"], "emails": ["VEZHNICK@GOOGLE.COM", "OSINDERO@GOOGLE.COM", "SCHAUL@GOOGLE.COM", "HEESS@GOOGLE.COM", "JADERBERG@GOOGLE.COM", "DAVIDSILVER@GOOGLE.COM", "KORAYK@GOOGLE.COM"], "sections": [{"heading": "1. Introduction", "text": "Deep reinforcement learning has recently enjoyed successes in many domains (Mnih et al., 2015; Schulman et al., 2015; Levine et al., 2015; Mnih et al., 2016; Lillicrap et al., 2015). Nevertheless, long-term credit assignment re-\nmains a major challenge for these methods, especially in environments with sparse reward signals, such as the infamous Montezuma\u2019s Revenge ATARI game. It is symptomatic that the standard approach on the ATARI benchmark suite (Bellemare et al., 2012) is to use an actionrepeat heuristic, where each action translates into several (usually 4) consecutive actions in the environment. Yet another dimension of complexity is seen in non-Markovian environments that require memory \u2013 these are particularly challenging, since the agent has to learn which parts of experience to store for later, using only a sparse reward signal.\nThe framework we propose takes inspiration from feudal reinforcement learning (FRL) introduced by Dayan & Hinton (1993), where levels of hierarchy within an agent communicate via explicit goals. Some key insights from FRL are that goals can be generated in a top-down fashion, and that goal setting can be decoupled from goal achievement; a level in the hierarchy communicates to the level below it what must be achieved, but does not specify how to do so. Making higher levels reason at a lower temporal resolution naturally structures the agents behaviour into temporally extended sub-policies.\nThe architecture explored in this work is a fullydifferentiable neural network with two levels of hierarchy (though there are obvious generalisations to deeper hierarchies). The top level, the Manager, sets goals at a lower temporal resolution in a latent state-space that is itself learnt by the Manager. The lower level, the Worker, operates at a higher temporal resolution and produces primitive actions, conditioned on the goals it receives from the Manager. The Worker is motivated to follow the goals by an intrinsic reward. However, significantly, no gradients are propagated between Worker and Manager; the Manager receives its learning signal from the environment alone. In other words, the Manager learns to select latent goals that maximise extrinsic reward.\nar X\niv :1\n70 3.\n01 16\n1v 2\n[ cs\n.A I]\n6 M\nar 2\nFeUdal Networks for Hierarchical Reinforcement Learning\nThe key contributions of our proposal are: (1) A consistent, end-to-end differentiable model that embodies and generalizes the principles of FRL. (2) A novel, approximate transition policy gradient update for training the Manager, which exploits the semantic meaning of the goals it produces. (3) The use of goals that are directional rather than absolute in nature. (4) A novel RNN design for the Manager \u2013 a dilated LSTM \u2013 which extends the longevity of the recurrent state memories and allows gradients to flow through large hops in time, enabling effective back-propagation through hundreds of steps.\nOur ablative analysis (Section 5.4) confirms that transitional policy gradient and directional goals are crucial for best performance. Our experiments on a selection of ATARI games (including the infamous Montezuma\u2019s revenge) and on several memory tasks in the 3D DeepMind Lab environment (Beattie et al., 2016) show that FuN significantly improves long-term credit assignment and memorisation."}, {"heading": "2. Related Work", "text": "Building hierarchical agents is a long standing topic in reinforcement learning (Sutton et al., 1999; Precup, 2000; Dayan & Hinton, 1993; Dietterich, 2000; Boutilier et al., 1997; Dayan, 1993; Kaelbling, 2014; Parr & Russell, 1998; Precup et al., 1997; 1998; Schmidhuber, 1991; Sutton, 1995; Wiering & Schmidhuber, 1997; Vezhnevets et al., 2016; Bacon et al., 2017). The options framework (Sutton et al., 1999; Precup, 2000) is a popular formulation for considering the problem with a two level hierarchy. The bottom level \u2013 an option \u2013 is a sub-policy with a termination condition, which takes in environment observations and outputs actions until the termination condition is met. An agent picks an option using its policy-over-options (the top level) and subsequently follows it until termination, at which point the policy-over-options is queried again and the process continues. Options are typically learned using sub-goals and \u2018pseudo-rewards\u2019 that are provided explicitly (Sutton et al., 1999; Dietterich, 2000; Dayan & Hinton, 1993). For a simple, tabular case (Wiering & Schmidhuber, 1997; Schaul et al., 2015), each state can be used as a sub-goal. Given the options, a policy-over-options can be learned using standard techniques by treating options as actions. Recently (Tessler et al., 2016; Kulkarni et al., 2016) have demonstrated that combining deep learning with predefined sub-goals delivers promising results in challenging environments like Minecraft and Atari, however sub-goal discovery was not addressed.\nA recent work of (Bacon et al., 2017) shows the possibility of learning options jointly with a policy-over-options in an end-to-end fashion by extending the policy gradient theorem to options. When options are learnt end-to-\n\u2112(rt+ cos(St+c-St,gt))\nPolicy gradient\n(Rt-V M t) cos(st+c-st,gt)\nTransition policy gradient\nend, they tend to degenerate to one of two trivial solutions: (i) only one active option that solves the whole task; (ii) a policy-over-options that changes options at every step, micro-managing the behaviour. Consequently, regularisers (Bacon et al., 2017; Vezhnevets et al., 2016) are usually introduced to steer the solution towards multiple options of extended length. This is believed to provide an inductive bias towards re-usable temporal abstractions and to help generalisation.\nA key difference between our approach and the options framework is that in our proposal the top level produces a meaningful and explicit goal for the bottom level to achieve. Sub-goals emerge as directions in the latent statespace and are naturally diverse. We also achieve significantly better scores on ATARI than Option-Critic (section 5).\nThere has also been a significant progress in nonhierarchical deep RL methods by using auxiliary losses and rewards. (Bellemare et al., 2016a) have significantly advanced the state-of-the-art on Montezuma\u2019s Revenge by using pseudo-count based auxiliary rewards for exploration, which stimulate agents to explore new parts of the state space. The recently proposed UNREAL agent (Jaderberg et al., 2016) also demonstrates a strong improvement by using unsupervised auxiliary tasks to help refine its internal representations. We note that these benefits are orthogonal to those provided by FuN, and that both approaches could be combined with FuN for even greater effect."}, {"heading": "3. The model", "text": "What is FuN? FuN is a modular neural-network consisting of two modules \u2013 the Worker and the Manager. The Manager internally computes a latent state representation st and outputs a goal vector gt. The Worker produces actions conditioned on external observation, its own state, and the Managers goal. The Manager and the Worker share a perceptual module which takes an observation from the environment xt and computes a shared intermediate representation zt. The Manager\u2019s goals gt are trained using an\napproximate transition policy gradient. This is a particularly efficient form of policy gradient training that exploits the knowledge that the Worker\u2019s behaviour will ultimately align with the goal directions it has been set. The Worker is then trained via intrinsic reward to produce actions that cause these goal directions to be achieved. Figure 1a illustrates the overall design and the following equations describe the forward dynamics of our network:\nzt = f percept(xt) (1)\nst = f Mspace(zt) (2)\nhMt , g\u0302t = f Mrnn(st, hMt\u22121); gt = g\u0302t/||g\u0302t||; (3)\nwt = \u03c6( t\u2211 i=t\u2212c gi) (4)\nhW , Ut = f Wrnn(zt, hWt\u22121) (5)\n\u03c0t = SoftMax(Utwt) (6)\nwhere both the Manager and the Worker are recurrent. Here hM and hW correspond to the internal states of the Manager and the Worker respectively. A linear transform \u03c6 maps a goal gt into an embedding vectorwt \u2208 Rk, which is then combined via product with matrixUt (Workers output) to produce policy \u03c0 \u2013 vector of probabilities over primitive actions. The next section provides the details on goal embedding and the following sections 3.2,3.3 describes how FuN is trained."}, {"heading": "3.1. Goal embedding", "text": "The goal g modulates the policy via a multiplicative interaction in a low dimensional goal-embedding space Rk, k << d. The Worker first produces an embedding vector for every action, represented by rows of matrix U \u2208 R|a|\u00d7k (eq. 5). To incorporate goals from the Manager, the last c goals are first pooled by summation and then embedded into a vector w \u2208 Rk using a linear projection \u03c6 (eq. 4). The projection \u03c6 is linear, with no biases, and is learnt with gradients coming from the Worker\u2019s actions. The embedding matrix U is then combined with the goal embedding w via a matrix-vector product (eq. 6). Since \u03c6 has no biases it can never produce a constant non-zero vector \u2013 which is the only way the setup could ignore the Manager\u2019s input. This makes sure that the goal output by the Manager always influences the final policy. Notice how, due to pooling of goals over several time-steps, the conditioning from the Manager varies smoothly."}, {"heading": "3.2. Learning", "text": "We consider a standard reinforcement learning setup. At each step t, the agent receives an observation xt from the environment and selects an action at from a finite set of possible actions. The environment responds with a new observation xt+1 and a scalar reward rt. The process continues until the terminal state is reached, after which it restarts. The goal of the agent is to maximise the discounted return Rt = \u2211\u221e k=0 \u03b3\nkrt+k+1 with \u03b3 \u2208 [0, 1]. The agent\u2019s behaviour is defined by its action-selection policy \u03c0. FuN produces a distribution over possible actions (a stochastic policy) as defined in eq. 6.\nThe conventional wisdom would be to train the whole architecture monolithically through gradient descent on either the policy directly or via TD-learning. Notice, that since FuN is fully differentiable we could train it end-toend using a policy gradient algorithm operating on the actions taken by the Worker. The outputs g of the Manager would be trained by gradients coming from the Worker. This, however would deprive Manager\u2019s goals g of any semantic meaning, making them just internal latent variables of the model. We propose instead to independently train Manager to predict advantageous directions (transitions) in state space and to intrinsically reward the Worker to follow these directions. If the Worker can fulfil the goal of moving in these directions (as it is rewarded for doing), then we ought to end up taking advantageous trajectories through state-space. We formalise this in the following update rule for the Manager:\n\u2207gt = AMt \u2207\u03b8dcos(st+c \u2212 st, gt(\u03b8)), (7)\nwhere AMt = Rt \u2212 VMt (xt, \u03b8) is the Manager\u2019s advantage function, computed using a value function estimate VMt (xt, \u03b8) from the internal critic; dcos(\u03b1, \u03b2) = \u03b1T\u03b2/(|\u03b1||\u03b2|) is the cosine similarity between two vectors. Note: the dependence of s on \u03b8 is ignored when computing \u2207\u03b8dcos \u2013 this avoids trivial solutions. Notice that now gt acquires a semantic meaning as an advantageous direction in the latent state space at a horizon c, which defines the temporal resolution of the Manager.\nThe intrinsic reward that encourages the Worker to follow the goals is defined as:\nrIt = 1/c c\u2211 i=1 dcos(st \u2212 st\u2212i, gt\u2212i) (8)\nWe use directions because it is more feasible for the Worker to be able to reliably cause directional shifts in the latent state than it is to assume that the Worker can take us to (potentially) arbitrary new absolute locations. It also gives a degree of invariance to the goals and allows for structural\ngeneralisation \u2013 the same directional sub-goal g can invoke a sub-policy that is valid and useful in a large part of the latent state space; e.g. evade an enemy, swim up for air, etc. We compare absolute against directional goals empirically in section 5.4.\nThe original feudal reinforcement learning formulation of Dayan & Hinton (1993) advocated completely concealing the reward from the environment from lower levels of hierarchy. In practice we take a softer approach by adding an intrinsic reward for following the goals, but retaining the environment reward as well. The Worker is then trained to maximise a weighted sum Rt + \u03b1RIt , where \u03b1 is a hyperparameter that regulates the influence of the intrinsic reward. The Workers policy \u03c0 can be trained to maximise intrinsic reward by using any off-the shelf deep reinforcement learning algorithm. Here we use an advantage actor critic (Mnih et al., 2016):\n\u2207\u03c0t = ADt \u2207\u03b8 log \u03c0(at|xt; \u03b8) (9)\nThe Advantage function ADt = (Rt + \u03b1R I t \u2212 V Dt (xt; \u03b8)) is calculated using an internal critic, which estimates the value functions for both rewards.\nNote that the Worker and Manager can potentially have different discount factors \u03b3 for computing the return. This allows, for instance, the Worker to be more greedy and focus on immediate rewards while the Manager can consider a long-term perspective."}, {"heading": "3.3. Transition Policy Gradients", "text": "We now motivate our proposed update rule for the Manager as a novel form of policy gradient with respect to a model of the Worker\u2019s behaviour. Consider a high-level policy ot = \u00b5(st, \u03b8) that selects among sub-policies (possibly from a continuous set), where we assume for now that these sub-policies are fixed duration behaviours (lasting for c steps). Corresponding to each sub-policy is a transition distribution, p(st+c|st, ot), that describes the distribution of states that we end up at the end of the sub-policy, given the start state and the sub-policy enacted. The high-level policy can be composed with the transition distribution to give a \u2018transition policy\u2019 \u03c0TP (st+c|st) = p(st+c|st, \u00b5(st, \u03b8)) describing the distribution over end states given start states. It is valid to refer to this as a policy because the original MDP is isomorphic to a new MDP with policy \u03c0TP and transition function st+c = \u03c0TP (st) (i.e. the state always transitions to the end state picked by the transition policy). As a result, we can apply the policy gradient theorem to the transition policy \u03c0TP , so as to find the performance gradient with respect to the policy parameters,\n\u2207\u03b8\u03c0TPt = E [(Rt \u2212 V (st))\u2207\u03b8 log p(st+c|st, \u00b5(st, \u03b8))] (10)\nIn general, the Worker may follow a complex trajectory. A naive application of policy gradients requires the agent to learn from samples of these trajectories. But if we know where these trajectories are likely to end up, by modelling the transitions, then we can skip directly over the Worker\u2019s behaviour and instead follow the policy gradient of the predicted transition. FuN assumes a particular form for the transition model: that the direction in state-space, st+c\u2212st, follows a von Mises-Fisher distribution. Specifically, if the mean direction of the von Mises-Fisher distribution is given by g(ot) (which for compactness we write as gt) we would have p(st+c|st, ot) \u221d edcos(st+c\u2212st,gt). If this functional form were indeed correct, then we see that our proposed update heuristic for the Manager, eqn.7, is in fact the proper form for the transition policy gradient arrived at in eqn.10.\nNote that the Worker\u2019s intrinsic reward (eqn. 8) is based on the log-likelihood of state trajectory. Through that the FuN architecture actively encourages the functional form of the transition model to hold true. Because the Worker is learning to achieve the Manager\u2019s direction, its transitions should, over time, closely follow a distribution around this direction, and hence our approximation for transition policy gradients should hold reasonably well."}, {"heading": "4. Architecture details", "text": "This section provides the particular details of the model as described in section 3. The perceptual module fpercept is a convolutional network (CNN) followed by a fully connected layer. The CNN has a first layer with 16 8x8 filters of stride 4, followed by a layer with with 32 4x4 filters of stride 2. The fully connected layer has 256 hidden units. Each convolutional and fully-connected layer is followed by a rectifier non-linearity1. The state space which the Manager implicitly models in formulating its goals is computed via fMspace, which is another fully connected layer followed by a rectifier non-linearity. The dimensionality of the embedding vectors, w, is set as k = 16. To encourage exploration in transition policy, at every step with a small probability we emit a random goal sampled from a uni-variate Gaussian.\nThe Worker\u2019s recurrent network fWrnn is a standard LSTM (Hochreiter & Schmidhuber, 1997). For the Manager\u2019s recurrent network, fMrnn, we propose a novel design \u2013 the dilated LSTM, which is introduced in the next section. Both fMrnn and fWrnn have 256 hidden units.\n1This is substantially the same CNN as in (Mnih et al., 2016; 2015), the only difference is that in the pre-processing stage we retain all colour channels."}, {"heading": "4.1. Dilated LSTM", "text": "We propose a novel RNN architecture for the Manager, which operates at lower temporal resolution than the data stream. We define a dilated LSTM analogously to dilated convolutional networks (Yu & Koltun, 2016). For a dilation radius r let the full state of the network be h = {h\u0302i}ri=1, i.e. it is composed of r separate groups of sub-states or \u2018cores\u2019. At time t the network is governed by the following equations: h\u0302t%rt , gt = LSTM(st, h\u0302 t%r t\u22121; \u03b8\nLSTM), where % denotes the modulo operation and allows us to indicate which group of cores is currently being updated. We make the parameters of the LSTM network \u03b8LSTM explicit to stress that the same set of parameters governs the update for each of the r groups within the dLSTM.\nAt each time step only the corresponding part of the state is updated and the output is pooled across the previous c outputs. This allows the r groups of cores inside the dLSTM to preserve the memories for long periods, yet the dLSTM as a whole is still able to process and learn from every input experience, and is also able to update its output at every step. This idea is similar to clockwork RNNs (Koutn\u0131\u0301k et al., 2014), however there the top level \u201cticks\u201d at a fixed, slow pace, whereas the dLSTM observes all the available training data instead. In the experiments we set r = 10, and this was also used as the predictions horizon, c."}, {"heading": "5. Experiments", "text": "The goal of our experiments is to demonstrate that FuN learns non-trivial, helpful, and interpretable sub-policies and sub-goals, and also to validate components of the architecture. We start by describing technical details of the experimental setup and then present results on Montezuma\u2019s\nrevenge \u2013 an infamously hard ATARI game \u2013 in section 5.1. Section 5.2 presents results on more ATARI games and extensively compares FuN to LSTM baseline with different discount factors and BPTT lengths. In section 5.3 we present results on a set of visual memorisation tasks in 3D environment. Section 5.4 presents an ablation study of FuN, validating our design choices.\nBaseline. Our main baseline is a recurrent LSTM network on top of a representation learned by a CNN. The LSTM (Hochreiter & Schmidhuber, 1997) architecture is a widely used recurrent network and it was demonstrated to perform very well on a suite of reinforcement learning problems (Mnih et al., 2016). LSTM uses 316 hidden units2 and its inputs are the feature representation of an observation and the previous action of the agent. Action probabilities and the value function estimate are regressed from its hidden state. All the methods the same CNN architecture, input pre-processing, and an action repeat of 4.\nOptimisation. We use the A3C method (Mnih et al., 2016) for all reinforcement learning experiments. It was shown to achieve state-of-the-art results on several challenging benchmarks (Mnih et al., 2016). We cut the trajectory and run backpropagation through time (BPTT) (Mozer, 1989) after K forward passes of a network or if a terminal signal is received. For FuN K = 400, for LSTM, unless otherwise stated, K = 40. We discuss different choice of K for LSTM in section 5.2. The optimization process runs 32 asynchronous threads using shared RMSProp. There are 3 hyper-parameters in FuN and 2 in the LSTM baselines. For each method,\n2This choice means that FuN and the LSTM baseline to have roughly the same number of total parameters.\n0 50 100 150 200 0\n1000\n2000\n3000\n4000\n5000\nS co\nre\nm s_pacman\n0 50 100 150 200 0\n500\n1000\n1500\n2000\n2500\n3000\n3500\n4000\n4500 amidar\n0 50 100 150 200 0\n500\n1000\n1500\n2000\n2500\n3000\n3500 gravitar\nFuN, 0.95 FuN, 0.99 LSTM, 0.95 LSTM, 0.99 LSTM, 0.99, BPTT=100\n0 50 100 150 200 0\n200\n400\n600\n800\n1000\n1200\n1400\n1600\n1800 enduro\n0 50 100 150 200 0\n1000\n2000\n3000\n4000\n5000\n6000\n7000\n8000 fros tbite\n16000\ns pace_invaders\n40000 hero\n70000 seaques t\n3500 a lien\n700 breakout\nwe ran 100 experiments, each using randomly sampled hyper-parameters. Learning rate and entropy penalty were sampled from a LogUniform(10\u22124, 10\u22123) interval for LSTM. For FuN the learning rate was sampled from LogUniform(10\u22124.5, 10\u22123.5), to account for higher gradients due to longer BPTT unrolls. The learning rate was linearly annealed from a sampled value to half the initial rate for all agents. To explore intrinsic motivation in FuN, we sample its weight \u03b1 \u223c Uniform(0, 1). We define a training epoch as one million observations. When reporting learning curves, we plot the average episode score of the top 5 agents (according to the final score) against the training epochs. For all ATARI experiments we clip the reward to [\u22121,+1] interval"}, {"heading": "5.1. Montezuma\u2019s revenge", "text": "Montezuma\u2019s revenge is one of the hardest games available through the ALE (Bellemare et al., 2012). The game is infamous for challenging agents with lethal traps and sparse rewards. We had to broaden and intensify our\nhyper-parameter search for the LSTM baseline to see any progress at all for that model. We have experimented with many different hyper-parameter configurations for LSTM baseline, for instance expanding learning rate search to LogUniform(10\u22123, 10\u22122), and we report on the configuration that worked best. We use a small discount 0.99 for LSTM; for FuN we use 0.99 in Worker and 0.999 in Manager. Figure 2b analyses the sub-goals learnt by FuN in the first room. They turn out to be meaningful milestones, which bridge the agents progress to its first extrinsic reward \u2013 picking up the key. Interestingly, two of the learnt sub-goals correspond to roughly the same locations as the ones hand-crafted in (Kulkarni et al., 2016) (ladder and key), but here they are learnt by the agent itself. Figure 2a plots the learning curves. Notice how FuN starts learning much earlier and achieves much higher scores. It takes > 300 epochs for LSTM to reach the score 400, which corresponds to solving the first room (take the key, open a door); it stagnates at that score until about 900 epochs, when it starts exploring further. FuN solves the first room\nin less than 200 epochs and immediately moves on to explore further, eventually visiting several other rooms and scoring up to 2600 points."}, {"heading": "5.2. ATARI", "text": "Experiments in this section validate that the capabilities of FuN go beyond what standard tools for long-term credit assignment \u2013 discount factors and BPTT unroll length \u2013 can provide for a baseline LSTM agent. We use two discounts 0.99 and 0.95 for both FuN and LSTM agents. (For the experiments on FuN only the discount for the Manager changes, while the Worker\u2019s discount is fixed at 0.95.) For the LSTM we explore BPTT of 40 and 100, while for FuN we use a BPTT unroll of 400. For LSTM with BPTT 100 we search for learning rate in the interval LogUniform(10\u22124.5, 10\u22123.5), as for FuN. We use a diverse set of ATARI games, some of which involve longterm credit assignment and some which are more reactive.\nFigure 4 plots the learning curves. A few categories emerge. On Ms. Pacman, Amidar, and Gravitar FuN with a low Manager discount of 0.99 strongly outperforms all other methods. All of these games are known to require long-term reasoning to play well. Enduro stands out as all the LSTM agents completely fail at it. In this game the agent controls a racing car and scores points for overtaking other racers; this requires accelerating and steering for significant amount of time before the first reward is experienced. Frostbite is a hard game (Vezhnevets et al., 2016; Lake et al., 2016) that requires both long-term credit assignment and good exploration. The best-performing frostbite agent is FuN with 0.95 Manager discount, which outperforms the rest by a factor of 7. On Hero and Space Invaders all agents perform equally well. On Seaquest and Breakout, the baseline LSTM with a more aggressive discount of 0.95 is the best. This suggests that in these games long-term credit assignment is not important and the agent is better off optimising more immediate rewards in a greedy fashion. Alien is the only game where using different discounts doesn\u2019t meaningfully influence the agents performance; here we see the baseline LSTM outperforms our FuN model, although both still achieve a satisfactory scores. We provide qualitative analysis of subpolicies learnt on Seaquest in supplementary material.\nNote how using an unroll for BPTT=100 in the baseline LSTM significantly hurts its performance (hence we do not explore longer unrolls), while FuN performs very well with BPTT of 400 thanks to its ability to leverage the dLSTM. Being able to train a recurrent network over very long sequences could be an enabling tool for many memory related task, as we demonstrate in section 5.3.\nQualitative analysis on Seaquest To qualitatively inspect sub-policies learnt by the Worker we use the following procedure: first, we record goals emitted by Manager during the play; we then sample one of them and provide it as a constant input to the Worker for the duration of an episode and record its behaviour. This allows us to qualitatively inspect what kind of sub-policies emerge. Figure 3 plots sub-policies learnt on the seaquest game. Notice how different options correspond to rough spatial positions or manoeuvres for the agent\u2019s submarine \u2013 for instance subpolicy 3 corresponds to swimming up for air.\nOption-critic architecture (Bacon et al., 2017) is, to the best of our knowledge, the only other end-to-end trainable system with sub-policies. The experimental results for Option-Critic on 4 ATARI (Bacon et al., 2017) games show scores similar those from a flat DQN (Mnih et al., 2015) baseline agent. Notice that our baseline (Mnih et al., 2016) is much stronger than DQN. We also ran FuN on the same games as Option-Critic (Asterix, Ms. Pacman, Seaquest and Zaxxon) and after 200 epochs it achieves a similar score on Seaquest, doubles it on Ms. Pacman, more than triples it on Zaxxon and gets more than 20x improvement on Asterix. Figure 7 presents our results on Asterix and Zaxxon. We took the approximate performance of OptionCritic from the original paper \u2013 8000 for Asterix and 6000 for Zaxxon. Plots in the original paper also suggest that score stagnates around these levels, notice that our score keeps going up."}, {"heading": "5.3. Memory in Labyrinth", "text": "DeepMind Lab (Beattie et al., 2016) is a first-person 3D game platform extended from OpenArena. It\u2019s a visually complex 3D environment with agent actions corresponding to movement and orientation. We use 4 different levels that test long-term credit assignment and visual memory:\nWater maze is a reproduction of the Morris water maze experiment (Morris, 1981) from the behavioural science literature. An agent is dropped into a circular pool of water with a concealed platform at unknown random location. The agent can move around and upon stepping on the platform it receives a reward and the trial restarts. The platform remains in the same location for the rest of the episode, while agent starts each trial at a random location. The walls of the pool are decorated with visual cues to assist localisation.\nT-maze is another classic animal cognition test. The agent spawns in a small T-shaped maze. Two objects with randomly chosen shape and colour are spawned at the left and right \u201dbaiting\u201d locations. One of them is assigned a reward of +1 and the other a reward of -1. When the agent\ncollects one of the objects, it receives the reward and is respawned at the beginning of the T-maze. The objects are also re-instantiated in the same locations and with the same rewards on the re-spawn event. The agent should remember which object gives the positive reward across re-spawns and collect it as many times as possible within the fixed time given for the episode. T-maze+ is a modification of T-maze, where at each trial the length of corridors can vary, adding additional dimension of complexity.\nNon-match is a visual memorisation task. Each trial begins in small room with an out of reach object being dis-\nplayed in one of two display pods. There is a pad in the middle, which upon touching, the agent is rewarded with 1 point, and is teleported to a second room which has two objects in it, one of which matches the object in the previous room. Collecting the matching object gives a reward of -10 points, collecting the non matching object gives a reward of 10 points. Once either is collected, the agent is teleported back to the first room, with the same object being shown.\nFor all agents we include reward as a part of the observation. Figure 5a illustrates T-maze and non-match environments and figure 6 plots the learning curves. FuN consitently outperforms the LSTM baseline \u2013 it learns faster and also reaches a higher final reward. We analyse the FuN agent\u2019s behaviour in more detail in Figure 5b. It demonstrates that FuN learns meaningful sub-policies, which are then efficiently integrated with memory to produce rewarding behaviour. Interestingly, the LSTM agent doesn\u2019t appear to use its memory for water maze task at all, always circling the maze at the roughly the same radius."}, {"heading": "5.4. Ablative analysis", "text": "This section empirically validates the main innovations of this paper: transition policy gradient for training the Manager; relative rather than absolute goals; lower temporal resolution for Manager; intrinsic motivation for the Worker.\n0 50 100 150 200\nTraining epochs\n0\n1000\n2000\n3000\n4000\n5000\nS co\nre\nm s_pacman\n0 50 100 150 200\nTraining epochs\n0\n500\n1000\n1500\n2000\n2500\n3000\n3500\n4000\n4500 amidar\n0 50 100 150 200\nTraining epochs\n0\n500\n1000\n1500\n2000\n2500\n3000\n3500 gravitar\n0 50 100 150 200\nTraining epochs\n0\n200\n400\n600\n800\n1000\n1200\n1400\n1600 enduro\nFuN Non feudal FuN Pure feudal FuN Manager via PG Absolute goals\nFigure 8. Ablative analysis\n0 50 100 150 0\n500\n1000\n1500\n2000\n2500\n3000\n3500\nS co\nre\nfros tbite\nFuN FuN trans fe r LSTM trans fe r LSTM\n0 50 100 150 0\n500\n1000\n1500\n2000\n2500\n3000\n3500\n4000 ms_pacman\n0 50 100 150 0\n500\n1000\n1500\n2000 amidar\n0 50 100 150 0\n500\n1000\n1500\n2000\n2500\n3000\n3500\n4000\n4500 space_invaders\nFigure 9. Action repeat transfer\nTransition policy gradient First we consider a \u2018nonFeudal\u2019 FuN \u2013 it has exactly the same network architecture as FuN, but the Managers output g is trained with gradients coming directly from the Worker and no intrinsic reward is used, much like in Option-Critic architecture (Bacon et al., 2017). Second, g is learnt using a standard policy gradient approach with the Manager emitting the mean of a Gaussian distribution from which goals are sampled (as if the Manager were solving a continuous control problem (Schulman et al., 2016; Mnih et al., 2016; Lillicrap et al., 2015)). Third, we explore a variant of FuN in which g specifies absolute, rather than relative/directional, goals (and the Worker\u2019s intrinsic reward is adjusted accordingly) but otherwise everything is the same. The experiments (Figure 8) reveal that, although alternatives do work to some degree their performance is significantly inferior. We also evaluate a purely feudal version of FuN \u2013 in which the Worker is trained from the intrinsic reward alone. This ablation performs better than other, but still inferior to the full FuN approach. It shows that allowing the Worker to experience the external reward is beneficial.\nTemporal resolution ablations. An important feature of FuN is the ability of the Manager to operate at a low temporal resolution. This is achieved through dilation in the LSTM and through the prediction horizon c. To investigate their influence we use two baselines: i) the Manager uses a vanilla LSTM with no dilation; ii) FuN with Manager\u2019s prediction horizon c = 1. Figure 10 presents the results. The non-dilated LSTM fails catastrophically, most likely\noverwhelmed by the recurrent gradient. Reducing the horizon c to 1 did hurt the performance, although interestingly less so than other ablations. It seems that even at high temporal resolution Manager captures certain properties of the underlying MDP and communicate them down to Worker in a helpful way. This confirms that by learning in two separate formulations FuN is able to capture richer structural properties of the environment and thus train faster.\nIntrinsic motivation weight. This section look at the impact of the weight \u03b1, which regulates the relative weight of intrinsic reward (if \u03b1 = 0 then intrinsic reward is not used). We train agents with learning rate and entropy penalty fixed to 10\u22123.5 and only vary \u03b1 between [0, 1]. Figure 11 shows scatter plots of agents final score vs \u03b1 hyper-parameter. Notice a clear correlation between the score and high value of \u03b1 on gravitar and amidar; however on other games the optimal value of \u03b1 can be less than to 1.\nDilate LSTM agent baseline One of innovations this paper presents is dLSTM design for a Recurrent network. In principle, it could alone be used in an agent on top of a CNN, without the rest of FuN structures. We evaluate such an agent as an additional baseline. We use the same hyper-parameters as for FuN \u2013 BPTT=400, discount = 0.99, learning rate sampled in the interval LogUniform(10\u22124.5, 10\u22123.5), entropy penalty LogUniform(10\u22124, 10\u22123). Figure 12 plots the learning curves for FuN, LSTM and dLSTM agents. dLSTM generally underperforms both LSTM and FuN. The power of\ndLSTM is in the ability to operate at lower temporal resolution, which is useful in the Manager, but not so much on it\u2019s own."}, {"heading": "5.5. ATARI action repeat transfer", "text": "One of the advantages of FuN is the clear separation of duties between Manager and Worker. The Manager learns a transition policy, while the Worker learns to operate primitive actions to enact these transitions. This transition policy is invariant to the underlying embodiment of the agent \u2013 the way its primitive actions translate into state space transitions. Potentially, the transition policy can be transferred between agents with different embodiment \u2013 e.g. robot models with physical design or different operational frequency. We provide evidence towards that possibility by transferring policies across agents with different action repeat on ATARI.3\nTo perform transfer, we initialise the FuN system with parameters extracted from an agent trained with action repeat of 4 and then make the following adjustments: (i) we accordingly adjust the discounts for all rewards; (ii) we increase the dilation of the dLSTM by a factor of 4; (iii) we increase the Manager\u2019s goal horizon c by a factor of 4. (These modifications adapt all the \u201chard-wired\u201d\n3Action repeat is a heuristic used in all successful agents (Mnih et al., 2015; 2016; Bellemare et al., 2016b; Vezhnevets et al., 2016). It enables better exploration, eases credit assignment, and saves computation by repeating any action chosen by the agent several (= 4) times.\nbut explicitly temporally sensitive aspects of the agent.) We then train this agent without action repeat. As a baseline we use an LSTM agent transferred in a similar way (with adjusted discounts) as well as FuN and LSTM agents trained without action repeat from scratch. Figure 9 shows the corresponding learning curves. The transferred FuN agent (green curve) significantly outperforms every other method. Furthermore it shows positive transfer on each environment, whereas LSTM only shows positive transfer on Ms. Pacman."}, {"heading": "6. Discussion and future work", "text": "How to create agents that can learn to decompose their behaviour into meaningful primitives and then reuse them to more efficiently acquire new behaviours is a long standing research question. The solution to this question may be an important stepping stone towards agents with general intelligence and competence. This paper introduced FeUdal Networks, a novel architecture that formulates sub-goals as directions in latent state space, which, if followed, translate into a meaningful behavioural primitives. FuN clearly separates the module that discovers and sets sub-goals from the module that generates the behaviour through primitive actions. This creates a natural hierarchy that is stable and allows both modules to learn in complementary ways. Our experiments clearly demonstrate that this makes long-term credit assignment and memorisation more tractable. This also opens many avenues for further research, for instance: deeper hierarchies can be constructed by setting goals at\nmultiple time scales, scaling agents to truly large environments with sparse rewards and partial observability. The modular structure of FuN is also lends itself to transfer and multitask learning \u2013 learnt behavioural primitives can be re-used to acquire new complex skills, or alternatively the transitional policies of the Manager can be transferred to agents with different embodiment."}, {"heading": "7. Acknowledgements", "text": "We thank Alex Graves, Daan Wierstra, Olivier Pietquin, Oriol Vinyals, Joseph Modayil and Vlad Mnih for many helpful discussions, suggestions and comments on the paper."}], "references": [{"title": "The option-critic architecture", "author": ["Bacon", "Pierre-Luc", "Precup", "Doina", "Harb", "Jean"], "venue": "In AAAI,", "citeRegEx": "Bacon et al\\.,? \\Q2017\\E", "shortCiteRegEx": "Bacon et al\\.", "year": 2017}, {"title": "Unifying count-based exploration and intrinsic motivation", "author": ["Bellemare", "Marc", "Srinivasan", "Sriram", "Ostrovski", "Georg", "Schaul", "Tom", "Saxton", "David", "Munos", "Remi"], "venue": "In NIPS,", "citeRegEx": "Bellemare et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Bellemare et al\\.", "year": 2016}, {"title": "Increasing the action gap: New operators for reinforcement learning", "author": ["Bellemare", "Marc G", "Ostrovski", "Georg", "Guez", "Arthur", "Thomas", "Philip S", "Munos", "R\u00e9mi"], "venue": "In Proceedings of the AAAI Conference on Artificial Intelligence,", "citeRegEx": "Bellemare et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Bellemare et al\\.", "year": 2016}, {"title": "Prioritized goal decomposition of markov decision processes: Toward a synthesis of classical and decision theoretic planning", "author": ["Boutilier", "Craig", "Brafman", "Ronen I", "Geib", "Christopher"], "venue": "In IJCAI,", "citeRegEx": "Boutilier et al\\.,? \\Q1997\\E", "shortCiteRegEx": "Boutilier et al\\.", "year": 1997}, {"title": "Improving generalization for temporal difference learning: The successor representation", "author": ["Dayan", "Peter"], "venue": "Neural Computation,", "citeRegEx": "Dayan and Peter.,? \\Q1993\\E", "shortCiteRegEx": "Dayan and Peter.", "year": 1993}, {"title": "Feudal reinforcement learning", "author": ["Dayan", "Peter", "Hinton", "Geoffrey E"], "venue": "In NIPS. Morgan Kaufmann Publishers,", "citeRegEx": "Dayan et al\\.,? \\Q1993\\E", "shortCiteRegEx": "Dayan et al\\.", "year": 1993}, {"title": "Hierarchical reinforcement learning with the maxq value function decomposition", "author": ["Dietterich", "Thomas G"], "venue": "J. Artif. Intell. Res.(JAIR),", "citeRegEx": "Dietterich and G.,? \\Q2000\\E", "shortCiteRegEx": "Dietterich and G.", "year": 2000}, {"title": "Long shortterm memory", "author": ["Hochreiter", "Sepp", "Schmidhuber", "J\u00fcrgen"], "venue": "Neural computation,", "citeRegEx": "Hochreiter et al\\.,? \\Q1997\\E", "shortCiteRegEx": "Hochreiter et al\\.", "year": 1997}, {"title": "Reinforcement learning with unsupervised auxiliary tasks", "author": ["Jaderberg", "Max", "Mnih", "Volodymyr", "Czarnecki", "Wojciech Marian", "Schaul", "Tom", "Leibo", "Joel Z", "Silver", "David", "Kavukcuoglu", "Koray"], "venue": "arXiv preprint arXiv:1611.05397,", "citeRegEx": "Jaderberg et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Jaderberg et al\\.", "year": 2016}, {"title": "Hierarchical learning in stochastic domains: Preliminary results", "author": ["Kaelbling", "Leslie Pack"], "venue": "In ICML,", "citeRegEx": "Kaelbling and Pack.,? \\Q2014\\E", "shortCiteRegEx": "Kaelbling and Pack.", "year": 2014}, {"title": "A clockwork rnn", "author": ["Koutn\u0131\u0301k", "Jan", "Greff", "Klaus", "Gomez", "Faustino", "Schmidhuber", "J\u00fcrgen"], "venue": "In ICML,", "citeRegEx": "Koutn\u0131\u0301k et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Koutn\u0131\u0301k et al\\.", "year": 2014}, {"title": "Hierarchical deep reinforcement learning: Integrating temporal abstraction and intrinsic motivation", "author": ["Kulkarni", "Tejas D", "Narasimhan", "Karthik R", "Saeedi", "Ardavan", "Tenenbaum", "Joshua B"], "venue": "arXiv preprint arXiv:1604.06057,", "citeRegEx": "Kulkarni et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Kulkarni et al\\.", "year": 2016}, {"title": "Building machines that learn and think like people", "author": ["Lake", "Brenden M", "Ullman", "Tomer D", "Tenenbaum", "Joshua B", "Gershman", "Samuel J"], "venue": "arXiv preprint arXiv:1604.00289,", "citeRegEx": "Lake et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Lake et al\\.", "year": 2016}, {"title": "End-to-end training of deep visuomotor policies", "author": ["Levine", "Sergey", "Finn", "Chelsea", "Darrell", "Trevor", "Abbeel", "Pieter"], "venue": "arXiv preprint arXiv:1504.00702,", "citeRegEx": "Levine et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Levine et al\\.", "year": 2015}, {"title": "Continuous control with deep reinforcement learning", "author": ["Lillicrap", "Timothy P", "Hunt", "Jonathan J", "Pritzel", "Alexander", "Heess", "Nicolas", "Erez", "Tom", "Tassa", "Yuval", "Silver", "David", "Wierstra", "Daan"], "venue": "arXiv preprint arXiv:1509.02971,", "citeRegEx": "Lillicrap et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Lillicrap et al\\.", "year": 2015}, {"title": "Human-level control through deep reinforcement learning", "author": ["Dharshan", "Wierstra", "Daan", "Legg", "Shane", "Hassabis", "Demis"], "venue": "Nature, 518(7540):529\u2013533,", "citeRegEx": "Dharshan et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Dharshan et al\\.", "year": 2015}, {"title": "Asynchronous methods for deep reinforcement learning", "author": ["Mnih", "Volodymyr", "Badia", "Adria Puigdomenech", "Mirza", "Mehdi", "Graves", "Alex", "Lillicrap", "Timothy P", "Harley", "Tim", "Silver", "David", "Kavukcuoglu", "Koray"], "venue": null, "citeRegEx": "Mnih et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Mnih et al\\.", "year": 2016}, {"title": "Spatial localization does not require the presence of local cues", "author": ["Morris", "Richard GM"], "venue": "Learning and motivation,", "citeRegEx": "Morris and GM.,? \\Q1981\\E", "shortCiteRegEx": "Morris and GM.", "year": 1981}, {"title": "A focused back-propagation algorithm for temporal pattern recognition", "author": ["Mozer", "Michael C"], "venue": "Complex systems,", "citeRegEx": "Mozer and C.,? \\Q1989\\E", "shortCiteRegEx": "Mozer and C.", "year": 1989}, {"title": "Reinforcement learning with hierarchies of machines", "author": ["Parr", "Ronald", "Russell", "Stuart"], "venue": null, "citeRegEx": "Parr et al\\.,? \\Q1998\\E", "shortCiteRegEx": "Parr et al\\.", "year": 1998}, {"title": "Temporal abstraction in reinforcement learning", "author": ["Precup", "Doina"], "venue": "PhD thesis, University of Massachusetts,", "citeRegEx": "Precup and Doina.,? \\Q2000\\E", "shortCiteRegEx": "Precup and Doina.", "year": 2000}, {"title": "Planning with closed-loop macro actions", "author": ["Precup", "Doina", "Sutton", "Richard S", "Singh", "Satinder P"], "venue": "Technical report,", "citeRegEx": "Precup et al\\.,? \\Q1997\\E", "shortCiteRegEx": "Precup et al\\.", "year": 1997}, {"title": "Theoretical results on reinforcement learning with temporally abstract options", "author": ["Precup", "Doina", "Sutton", "Richard S", "Singh", "Satinder"], "venue": "In European Conference on Machine Learning (ECML). Springer,", "citeRegEx": "Precup et al\\.,? \\Q1998\\E", "shortCiteRegEx": "Precup et al\\.", "year": 1998}, {"title": "Universal value function approximators", "author": ["Schaul", "Tom", "Horgan", "Dan", "Gregor", "Karol", "Silver", "David"], "venue": null, "citeRegEx": "Schaul et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Schaul et al\\.", "year": 2015}, {"title": "Neural sequence chunkers", "author": ["Schmidhuber", "J\u00fcrgen"], "venue": "Technical report,", "citeRegEx": "Schmidhuber and J\u00fcrgen.,? \\Q1991\\E", "shortCiteRegEx": "Schmidhuber and J\u00fcrgen.", "year": 1991}, {"title": "Trust region policy optimization", "author": ["Schulman", "John", "Levine", "Sergey", "Moritz", "Philipp", "Jordan", "Michael I", "Abbeel", "Pieter"], "venue": "In ICML,", "citeRegEx": "Schulman et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Schulman et al\\.", "year": 2015}, {"title": "High-dimensional continuous control using generalized advantage estimation", "author": ["Schulman", "John", "Moritz", "Philipp", "Levine", "Sergey", "Jordan", "Michael", "Abbeel", "Pieter"], "venue": null, "citeRegEx": "Schulman et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Schulman et al\\.", "year": 2016}, {"title": "Td models: Modeling the world at a mixture of time scales", "author": ["Sutton", "Richard S"], "venue": "In ICML,", "citeRegEx": "Sutton and S.,? \\Q1995\\E", "shortCiteRegEx": "Sutton and S.", "year": 1995}, {"title": "Between mdps and semi-mdps: A framework for temporal abstraction in reinforcement learning", "author": ["Sutton", "Richard S", "Precup", "Doina", "Singh", "Satinder"], "venue": "Artificial intelligence,", "citeRegEx": "Sutton et al\\.,? \\Q1999\\E", "shortCiteRegEx": "Sutton et al\\.", "year": 1999}, {"title": "A deep hierarchical approach to lifelong learning in minecraft", "author": ["Tessler", "Chen", "Givony", "Shahar", "Zahavy", "Tom", "Mankowitz", "Daniel J", "Mannor", "Shie"], "venue": "arXiv preprint arXiv:1604.07255,", "citeRegEx": "Tessler et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Tessler et al\\.", "year": 2016}, {"title": "Strategic attentive writer for learning macro-actions", "author": ["Vezhnevets", "Alexander", "Mnih", "Volodymyr", "Osindero", "Simon", "Graves", "Alex", "Vinyals", "Oriol", "Agapiou", "John", "kavukcuoglu", "koray"], "venue": null, "citeRegEx": "Vezhnevets et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Vezhnevets et al\\.", "year": 2016}, {"title": "Multi-scale context aggregation by dilated convolutions", "author": ["Yu", "Fisher", "Koltun", "Vladlen"], "venue": null, "citeRegEx": "Yu et al\\.,? \\Q2016\\E", "shortCiteRegEx": "Yu et al\\.", "year": 2016}], "referenceMentions": [{"referenceID": 25, "context": "Deep reinforcement learning has recently enjoyed successes in many domains (Mnih et al., 2015; Schulman et al., 2015; Levine et al., 2015; Mnih et al., 2016; Lillicrap et al., 2015).", "startOffset": 75, "endOffset": 181}, {"referenceID": 13, "context": "Deep reinforcement learning has recently enjoyed successes in many domains (Mnih et al., 2015; Schulman et al., 2015; Levine et al., 2015; Mnih et al., 2016; Lillicrap et al., 2015).", "startOffset": 75, "endOffset": 181}, {"referenceID": 16, "context": "Deep reinforcement learning has recently enjoyed successes in many domains (Mnih et al., 2015; Schulman et al., 2015; Levine et al., 2015; Mnih et al., 2016; Lillicrap et al., 2015).", "startOffset": 75, "endOffset": 181}, {"referenceID": 14, "context": "Deep reinforcement learning has recently enjoyed successes in many domains (Mnih et al., 2015; Schulman et al., 2015; Levine et al., 2015; Mnih et al., 2016; Lillicrap et al., 2015).", "startOffset": 75, "endOffset": 181}, {"referenceID": 28, "context": "Building hierarchical agents is a long standing topic in reinforcement learning (Sutton et al., 1999; Precup, 2000; Dayan & Hinton, 1993; Dietterich, 2000; Boutilier et al., 1997; Dayan, 1993; Kaelbling, 2014; Parr & Russell, 1998; Precup et al., 1997; 1998; Schmidhuber, 1991; Sutton, 1995; Wiering & Schmidhuber, 1997; Vezhnevets et al., 2016; Bacon et al., 2017).", "startOffset": 80, "endOffset": 365}, {"referenceID": 3, "context": "Building hierarchical agents is a long standing topic in reinforcement learning (Sutton et al., 1999; Precup, 2000; Dayan & Hinton, 1993; Dietterich, 2000; Boutilier et al., 1997; Dayan, 1993; Kaelbling, 2014; Parr & Russell, 1998; Precup et al., 1997; 1998; Schmidhuber, 1991; Sutton, 1995; Wiering & Schmidhuber, 1997; Vezhnevets et al., 2016; Bacon et al., 2017).", "startOffset": 80, "endOffset": 365}, {"referenceID": 21, "context": "Building hierarchical agents is a long standing topic in reinforcement learning (Sutton et al., 1999; Precup, 2000; Dayan & Hinton, 1993; Dietterich, 2000; Boutilier et al., 1997; Dayan, 1993; Kaelbling, 2014; Parr & Russell, 1998; Precup et al., 1997; 1998; Schmidhuber, 1991; Sutton, 1995; Wiering & Schmidhuber, 1997; Vezhnevets et al., 2016; Bacon et al., 2017).", "startOffset": 80, "endOffset": 365}, {"referenceID": 30, "context": "Building hierarchical agents is a long standing topic in reinforcement learning (Sutton et al., 1999; Precup, 2000; Dayan & Hinton, 1993; Dietterich, 2000; Boutilier et al., 1997; Dayan, 1993; Kaelbling, 2014; Parr & Russell, 1998; Precup et al., 1997; 1998; Schmidhuber, 1991; Sutton, 1995; Wiering & Schmidhuber, 1997; Vezhnevets et al., 2016; Bacon et al., 2017).", "startOffset": 80, "endOffset": 365}, {"referenceID": 0, "context": "Building hierarchical agents is a long standing topic in reinforcement learning (Sutton et al., 1999; Precup, 2000; Dayan & Hinton, 1993; Dietterich, 2000; Boutilier et al., 1997; Dayan, 1993; Kaelbling, 2014; Parr & Russell, 1998; Precup et al., 1997; 1998; Schmidhuber, 1991; Sutton, 1995; Wiering & Schmidhuber, 1997; Vezhnevets et al., 2016; Bacon et al., 2017).", "startOffset": 80, "endOffset": 365}, {"referenceID": 28, "context": "The options framework (Sutton et al., 1999; Precup, 2000) is a popular formulation for considering the problem with a two level hierarchy.", "startOffset": 22, "endOffset": 57}, {"referenceID": 28, "context": "Options are typically learned using sub-goals and \u2018pseudo-rewards\u2019 that are provided explicitly (Sutton et al., 1999; Dietterich, 2000; Dayan & Hinton, 1993).", "startOffset": 96, "endOffset": 157}, {"referenceID": 23, "context": "For a simple, tabular case (Wiering & Schmidhuber, 1997; Schaul et al., 2015), each state can be used as a sub-goal.", "startOffset": 27, "endOffset": 77}, {"referenceID": 29, "context": "Recently (Tessler et al., 2016; Kulkarni et al., 2016) have demonstrated that combining deep learning with predefined sub-goals delivers promising results in challenging environments like Minecraft and Atari, however sub-goal discovery was not addressed.", "startOffset": 9, "endOffset": 54}, {"referenceID": 11, "context": "Recently (Tessler et al., 2016; Kulkarni et al., 2016) have demonstrated that combining deep learning with predefined sub-goals delivers promising results in challenging environments like Minecraft and Atari, however sub-goal discovery was not addressed.", "startOffset": 9, "endOffset": 54}, {"referenceID": 0, "context": "A recent work of (Bacon et al., 2017) shows the possibility of learning options jointly with a policy-over-options in an end-to-end fashion by extending the policy gradient theorem to options.", "startOffset": 17, "endOffset": 37}, {"referenceID": 0, "context": "Consequently, regularisers (Bacon et al., 2017; Vezhnevets et al., 2016) are usually introduced to steer the solution towards multiple options of extended length.", "startOffset": 27, "endOffset": 72}, {"referenceID": 30, "context": "Consequently, regularisers (Bacon et al., 2017; Vezhnevets et al., 2016) are usually introduced to steer the solution towards multiple options of extended length.", "startOffset": 27, "endOffset": 72}, {"referenceID": 8, "context": "The recently proposed UNREAL agent (Jaderberg et al., 2016) also demonstrates a strong improvement by using unsupervised auxiliary tasks to help refine its internal representations.", "startOffset": 35, "endOffset": 59}, {"referenceID": 16, "context": "Here we use an advantage actor critic (Mnih et al., 2016):", "startOffset": 38, "endOffset": 57}, {"referenceID": 16, "context": "This is substantially the same CNN as in (Mnih et al., 2016; 2015), the only difference is that in the pre-processing stage we retain all colour channels.", "startOffset": 41, "endOffset": 66}, {"referenceID": 10, "context": "This idea is similar to clockwork RNNs (Koutn\u0131\u0301k et al., 2014), however there the top level \u201cticks\u201d at a fixed, slow pace, whereas the dLSTM observes all the available training data instead.", "startOffset": 39, "endOffset": 62}, {"referenceID": 16, "context": "The LSTM (Hochreiter & Schmidhuber, 1997) architecture is a widely used recurrent network and it was demonstrated to perform very well on a suite of reinforcement learning problems (Mnih et al., 2016).", "startOffset": 181, "endOffset": 200}, {"referenceID": 16, "context": "We use the A3C method (Mnih et al., 2016) for all reinforcement learning experiments.", "startOffset": 22, "endOffset": 41}, {"referenceID": 16, "context": "It was shown to achieve state-of-the-art results on several challenging benchmarks (Mnih et al., 2016).", "startOffset": 83, "endOffset": 102}, {"referenceID": 11, "context": "Interestingly, two of the learnt sub-goals correspond to roughly the same locations as the ones hand-crafted in (Kulkarni et al., 2016) (ladder and key), but here they are learnt by the agent itself.", "startOffset": 112, "endOffset": 135}, {"referenceID": 30, "context": "Frostbite is a hard game (Vezhnevets et al., 2016; Lake et al., 2016) that requires both long-term credit assignment and good exploration.", "startOffset": 25, "endOffset": 69}, {"referenceID": 12, "context": "Frostbite is a hard game (Vezhnevets et al., 2016; Lake et al., 2016) that requires both long-term credit assignment and good exploration.", "startOffset": 25, "endOffset": 69}, {"referenceID": 0, "context": "Option-critic architecture (Bacon et al., 2017) is, to the best of our knowledge, the only other end-to-end trainable system with sub-policies.", "startOffset": 27, "endOffset": 47}, {"referenceID": 0, "context": "The experimental results for Option-Critic on 4 ATARI (Bacon et al., 2017) games show scores similar those from a flat DQN (Mnih et al.", "startOffset": 54, "endOffset": 74}, {"referenceID": 16, "context": "Notice that our baseline (Mnih et al., 2016) is much stronger than DQN.", "startOffset": 25, "endOffset": 44}, {"referenceID": 0, "context": "Transition policy gradient First we consider a \u2018nonFeudal\u2019 FuN \u2013 it has exactly the same network architecture as FuN, but the Managers output g is trained with gradients coming directly from the Worker and no intrinsic reward is used, much like in Option-Critic architecture (Bacon et al., 2017).", "startOffset": 275, "endOffset": 295}, {"referenceID": 26, "context": "Second, g is learnt using a standard policy gradient approach with the Manager emitting the mean of a Gaussian distribution from which goals are sampled (as if the Manager were solving a continuous control problem (Schulman et al., 2016; Mnih et al., 2016; Lillicrap et al., 2015)).", "startOffset": 214, "endOffset": 280}, {"referenceID": 16, "context": "Second, g is learnt using a standard policy gradient approach with the Manager emitting the mean of a Gaussian distribution from which goals are sampled (as if the Manager were solving a continuous control problem (Schulman et al., 2016; Mnih et al., 2016; Lillicrap et al., 2015)).", "startOffset": 214, "endOffset": 280}, {"referenceID": 14, "context": "Second, g is learnt using a standard policy gradient approach with the Manager emitting the mean of a Gaussian distribution from which goals are sampled (as if the Manager were solving a continuous control problem (Schulman et al., 2016; Mnih et al., 2016; Lillicrap et al., 2015)).", "startOffset": 214, "endOffset": 280}, {"referenceID": 30, "context": "(These modifications adapt all the \u201chard-wired\u201d Action repeat is a heuristic used in all successful agents (Mnih et al., 2015; 2016; Bellemare et al., 2016b; Vezhnevets et al., 2016).", "startOffset": 107, "endOffset": 182}], "year": 2017, "abstractText": "We introduce FeUdal Networks (FuNs): a novel architecture for hierarchical reinforcement learning. Our approach is inspired by the feudal reinforcement learning proposal of Dayan and Hinton, and gains power and efficacy by decoupling end-to-end learning across multiple levels \u2013 allowing it to utilise different resolutions of time. Our framework employs a Manager module and a Worker module. The Manager operates at a lower temporal resolution and sets abstract goals which are conveyed to and enacted by the Worker. The Worker generates primitive actions at every tick of the environment. The decoupled structure of FuN conveys several benefits \u2013 in addition to facilitating very long timescale credit assignment it also encourages the emergence of sub-policies associated with different goals set by the Manager. These properties allow FuN to dramatically outperform a strong baseline agent on tasks that involve long-term credit assignment or memorisation. We demonstrate the performance of our proposed system on a range of tasks from the ATARI suite and also from a 3D DeepMind Lab environment.", "creator": "LaTeX with hyperref package"}}}