{"id": "1511.00573", "review": {"conference": "NIPS", "VERSION": "v1", "DATE_OF_SUBMISSION": "2-Nov-2015", "title": "From random walks to distances on unweighted graphs", "abstract": "such large unweighted appropriately directed smooth graphs thus are commonly used to capture relations between entities. similarly a fundamental conceptual problem applied in the experimental analysis of systematically such networks data is essentially to properly define the similarity or dissimilarity between any two vertices. continuing despite resolving the significance of this problem, historical statistical utility characterization of the proposed metrics has been broadly limited. together we notably introduce and develop substantially a standardized class of techniques for analyzing random walks on graphs using stochastic residual calculus. besides using these techniques methods we successively generalize results on translating the degeneracy constraints of hitting arrival times twice and analyze a metric based purely on manipulating the intrinsic laplace transformed hitting visit time ( ltht ). importantly the comparative metric serves solely as a theoretically natural, provably constrained well - independently behaved analytic alternative to the expected averaged hitting time. we establish accurately a general correspondence process between hitting times of the complete brownian motion coloring and analogous hitting pass times encountered on the graph. specifically we effectively show again that the ltht approximation is not consistent with respect to mapping the underlying metric of a complex geometric graph, preserves clustering overall tendency, and remains robust against random addition conditions of non - geometric edges. screening tests on simulated and modified real - world proxy data simulations show consistently that the ltht estimation matches theoretical predictions generally and neither outperforms alternatives.", "histories": [["v1", "Mon, 2 Nov 2015 16:23:06 GMT  (2643kb,D)", "http://arxiv.org/abs/1511.00573v1", "To appear in NIPS 2015"]], "COMMENTS": "To appear in NIPS 2015", "reviews": [], "SUBJECTS": "stat.ML cs.AI cs.SI", "authors": ["tatsunori b hashimoto", "yi sun", "tommi s jaakkola"], "accepted": true, "id": "1511.00573"}, "pdf": {"name": "1511.00573.pdf", "metadata": {"source": "CRF", "title": "From random walks to distances on unweighted graphs", "authors": ["Tatsunori B. Hashimoto", "Yi Sun", "Tommi S. Jaakkola"], "emails": ["thashim@mit.edu", "yisun@mit.edu", "tommi@mit.edu"], "sections": [{"heading": "1 Introduction", "text": "Many network metrics have been introduced to measure the similarity between any two vertices. Such metrics can be used for a variety of purposes, including uncovering missing edges or pruning spurious ones. Since the metrics tacitly assume that vertices lie in a latent (metric) space, one could expect that they also recover the underlying metric in some well-defined limit. Surprisingly, there are nearly no known results on this type of consistency. Indeed, it was recently shown [19] that the expected hitting time degenerates and does not measure any notion of distance.\nWe analyze an improved hitting-time metric \u2013 Laplace transformed hitting time (LTHT) \u2013 and rigorously evaluate its consistency, cluster-preservation, and robustness under a general network model which encapsulates the latent space assumption. This network model, specified in Section 2, posits that vertices lie in a latent metric space, and edges are drawn between nearby vertices in that space. To analyze the LTHT, we develop two key technical tools. We establish a correspondence between functionals of hitting time for random walks on graphs, on the one hand, and limiting It\u00f4 processes (Corollary 4.4) on the other. Moreover, we construct a weighted random walk on the graph whose limit is a Brownian motion (Corollary 4.1). We apply these tools to obtain three main results.\nFirst, our Theorem 3.5 recapitulates and generalizes the result of [19] pertaining to degeneration of expected hitting time in the limit. Our proof is direct and demonstrates the broader applicability of the techniques to general random walk based algorithms. Second, we analyze the Laplace transformed hitting time as a one-parameter family of improved distance estimators based on random walks on the graph. We prove that there exists a scaling limit for the parameter \u03b2 such that the LTHT can become the shortest path distance (Theorem S5.2) or a consistent metric estimator averaging over many paths (Theorem 4.5). Finally, we prove that the LTHT captures the advantages\nar X\niv :1\n51 1.\n00 57\n3v 1\n[ st\nat .M\nL ]\n2 N\nov 2\nof random-walk based metrics by respecting the cluster structure (Theorem 4.6) and robustly recovering similarity queries when the majority of edges carry no geometric information (Theorem 4.9). We now discuss the relation of our work to prior work on similarity estimation.\nQuasi-walk metrics: There is a growing literature on graph metrics that attempts to correct the degeneracy of expected hitting time [19] by interpolating between expected hitting time and shortest path distance. The work closest to ours is the analysis of the phase transition of the p-resistance metric in [1] which proves that p-resistances are nondegenerate for some p; however, their work did not address consistency or bias of p-resistances. Other approaches to quasi-walk metrics such as logarithmic-forest [3], distributed routing distances [16], truncated hitting times [12], and randomized shortest paths [8, 21] exist but their statistical properties are unknown. Our paper is the first to prove consistency properties of a quasi-walk metric.\nNonparametric statistics: In the nonparametric statistics literature, the behavior of k-nearest neighbor and \u03b5-ball graphs has been the focus of extensive study. For undirected graphs, Laplacian-based techniques have yielded consistency for clusters [18] and shortest paths [2] as well as the degeneracy of expected hitting time [19]. Algorithms for exactly embedding k-nearest neighbor graphs are similar and generate metric estimates, but require knowledge of the graph construction method, and their consistency properties are unknown [13]. Stochastic differential equation techniques similar to ours were applied to prove Laplacian convergence results in [17], while the process-level convergence was exploited in [6]. Our work advances the techniques of [6] by extracting more robust estimators from process-level information.\nNetwork analysis: The task of predicting missing links in a graph, known as link prediction, is one of the most popular uses of similarity estimation. The survey [9] compares several common link prediction methods on synthetic benchmarks. The consistency of some local similarity metrics such as the number of shared neighbors was analyzed under a single generative model for graphs in [11]. Our results extend this analysis to a global, walk-based metric under weaker model assumptions."}, {"heading": "2 Continuum limits of random walks on networks", "text": ""}, {"heading": "2.1 Definition of a spatial graph", "text": "We take a generative approach to defining similarity between vertices. We suppose that each vertex i of a graph is associated with a latent coordinate xi \u2208 Rd and that the probability of finding an edge between two vertices depends solely on their latent coordinates. In this model, given only the unweighted edge connectivity of a graph, we define natural distances between vertices as the distances between the latent coordinates xi. Formally, let X = {x1, x2, . . .} \u2282 Rd be an infinite sequence of points drawn i.i.d. from a differentiable density with bounded log gradient p(x) with compact support D. A spatial graph is defined by the following:\nDefinition 2.1 (Spatial graph). Let \u03b5n : Xn \u2192 R>0 be a local scale function and h : R\u22650 \u2192 [0, 1] a piecewise continuous function with h(x) = 0 for x > 1, h(1) > 0, and h left-continuous at 1. The spatial graph Gn corresponding to \u03b5n and h is the random graph with vertex set Xn and a directed edge from xi to xj with probability pij = h(|xi \u2212 xj |\u03b5n(xi)\u22121).\nThis graph was proposed in [6] as the generalization of k-nearest neighbors to isotropic kernels. To make inference tractable, we focus on the large-graph, small-neighborhood limit as n \u2192 \u221e and \u03b5n(x) \u2192 0. In particular, we will suppose that there exist scaling constants gn and a deterministic continuous function \u03b5 : D \u2192 R>0 so that\ngn \u2192 0, gnn 1 d+2 log(n)\u2212 1 d+2 \u2192\u221e, \u03b5n(x)g\u22121n \u2192 \u03b5(x) for x \u2208 Xn,\nwhere the final convergence is uniform in x and a.s. in the draw of X . The scaling constant gn represents a bound on the asymptotic sparsity of the graph.\nWe give a few concrete examples to make the quantities h, gn, and \u03b5n clear.\n1. The directed k-nearest neighbor graph is defined by setting h(x) = 1x\u2208[0,1], the indicator function of the unit interval, \u03b5n(x) the distance to the kth nearest neighbor, and gn = (k/n)1/d the rate at which \u03b5n(x) approaches zero.\n2. A Gaussian kernel graph is approximated by setting h(x) = exp(\u2212x2/\u03c32)1x\u2208[0,1]. The truncation of the Gaussian tails at \u03c3 is an analytic convenience rather than a fundamental limitation, and the bandwidth can be varied by rescaling \u03b5n(x)."}, {"heading": "2.2 Continuum limit of the random walk", "text": "Our techniques rely on analysis of the limiting behavior of the simple random walk Xnt on a spatial graph Gn, viewed as a discrete-time Markov process with domain D. The increment at step t of Xnt is a jump to a random point in Xn which lies within the ball of radius \u03b5n(Xnt ) around Xnt . We observe three effects: (A) the random walk jumps more frequently towards regions of high density; (B) the random walk moves more quickly whenever \u03b5n(Xnt ) is large; (C) for \u03b5n small and a large step count t, the random variable Xnt \u2212Xn0 is the sum of many small independent (but not necessarily identically distributed) increments. In the n \u2192 \u221e limit, we may identify Xnt with a continuous-time stochastic process satisfying (A), (B), and (C) via the following result, which is a slight strengthening of [6, Theorem 3.4] obtained by applying [15, Theorem 11.2.3] in place of the original result of Stroock-Varadhan. Theorem 2.2. The simple random walk Xnt converges uniformly in Skorokhod space D([0,\u221e), D) after a time scaling t\u0302 = tg2n to the It\u00f4 process Yt\u0302 valued in the space of continuous functions C([0,\u221e), D) with reflecting boundary conditions on D defined by\ndYt\u0302 = \u2207 log(p(Yt\u0302))\u03b5(Yt\u0302)2/3dt\u0302+ \u03b5(Yt\u0302)/ \u221a 3dWt\u0302. (1)\nEffects (A), (B), and (C) may be seen in the stochastic differential equation (1) as follows. The direction of the drift is controlled by \u2207 log(p(Yt\u0302)), the rate of drift is controlled by \u03b5(Yt\u0302)2, and the noise is driven by a Brownian motion Wt\u0302 with location-dependent scaling \u03b5(Yt\u0302)/ \u221a 3.1 We view Theorem 2.2 as a method to understand the simple random walk Xnt through the continuous walk Yt\u0302. Attributes of stochastic processes such as stationary distribution or hitting time may be defined for both Yt\u0302 and X n t , and in many cases Theorem 2.2 implies that an appropriately-rescaled version of the discrete attribute will converge to the continuous one. Because attributes of the continuous process Yt\u0302 can reveal information about proximity between points, this provides a general framework for inference in spatial graphs. We use hitting times of the continuous process to a domain E \u2282 D to prove properties of the hitting time of a simple random walk on a graph via the limit arguments of Theorem 2.2."}, {"heading": "3 Degeneracy of expected hitting times in networks", "text": "The hitting time, commute time, and resistance distance are popular measures of distance based upon the random walk which are believed to be robust and capture the cluster structure of the network. However, it was shown in a surprising result in [19] that on undirected geometric graphs the scaled expected hitting time from xi to xj converges to inverse of the degree of xj .\nIn Theorem 3.5, we give an intuitive explanation and generalization of this result by showing that if the random walk on a graph converges to any limiting It\u00f4 process in dimension d \u2265 2, the scaled expected hitting time to any point converges to the inverse of the stationary distribution. This answers the open problem in [19] on the degeneracy of hitting times for directed graphs and graphs with general degree distributions such as directed k-nearest neighbor graphs, lattices, and power-law graphs with convergent random walks. Our proof can be understood as first extending the transience or neighborhood recurrence of Brownian motion for d \u2265 2 to more general It\u00f4 processes and then connecting hitting times on graphs to their It\u00f4 process equivalents."}, {"heading": "3.1 Typical hitting times are large", "text": "We will prove the following lemma that hitting a given vertex quickly is unlikely. Let T xixj ,n be the hitting time to xj of Xnt started at xi and T xi E be the continuous equivalent for Yt\u0302 to hit E \u2282 D .\n1Both the variance \u0398(\u03b5n(x)2) and expected value \u0398(\u2207 log(p(x))\u03b5n(x)2) of a single step in the simple random walk are \u0398(g2n). The time scaling t\u0302 = tg2n in Theorem 2.2 was chosen so that as n\u2192 \u221e there are g\u22122n discrete steps taken per unit time, meaning the total drift and variance per unit time tend to a non-trivial limit.\nLemma 3.1 (Typical hitting times are large). For any d \u2265 2, c > 0, and \u03b4 > 0, for large enough n we have P(T xixj ,n > cg \u22122 n ) > 1\u2212 \u03b4.\nTo prove Lemma 3.1, we require the following tail bound following from the Feynman-Kac theorem. Theorem 3.2 ([10, Exercise 9.12] Feynman-Kac for the Laplace transform). The Laplace transform of the hitting time (LTHT) u(x) = E[exp(\u2212\u03b2T xE)] is the solution to the boundary value problem with boundary condition u|\u2202E = 1:\n1 2 Tr[\u03c3TH(u)\u03c3] + \u00b5(x) \u00b7 \u2207u\u2212 \u03b2u = 0.\nThis will allow us to bound the hitting time to the ball B(xj , s) of radius s centered at xj . Lemma 3.3. For x, y \u2208 D, d \u2265 2, and any \u03b4 > 0, there exists s > 0 such that E[e\u2212TxB(y,s) ] < \u03b4.\nProof. We compare the Laplace transformed hitting time of the general It\u00f4 process to that of Brownian motion via Feynman-Kac and handle the latter case directly. Details are in Section S2.1.\nWe now use Lemma 3.3 to prove Lemma 3.1.\nProof of Lemma 3.1. Our proof proceeds in two steps. First, we have T xixj ,n \u2265 T xi B(xj ,s),n a.s. for any s > 0 because xj \u2208 B(xj , s), so by Theorem 2.2, we have\nlim n\u2192\u221e\nE[e\u2212T xi xj,n g\u22122n ] \u2264 lim n\u2192\u221e E[e\u2212T xi B(xj,s),n g\u22122n ] = E[e\u2212T xi B(xj,s) ]. (2)\nApplying Lemma 3.3, we have E[e\u2212T xi B(xj,s) ] < 12\u03b4e\n\u2212c for some s > 0. For large enough n, this combined with (2) implies P(T xixj ,n \u2264 cg\u22122n )e\u2212c < \u03b4e\u2212c and hence P(T xixj ,n \u2264 cg\u22122n ) < \u03b4."}, {"heading": "3.2 Expected hitting times degenerate to the stationary distribution", "text": "To translate results from It\u00f4 processes to directed graphs, we require a regularity condition. Let qt(xj , xi) denote the probability that Xnt = xj conditioned on X n 0 = xi. We make the following technical conjecture which we assume holds for all spatial graphs. (?) For t = \u0398(g\u22122n ), the rescaled marginal nqt(x, xi) is a.s. eventually uniformly equicontinuous. 2 Let \u03c0Xn(x) denote the stationary distribution of Xnt . The following was shown in [6, Theorem 2.1] under conditions implied by our condition (?) (Corollary S2.6). Theorem 3.4. Assuming (?), for a\u22121 = \u222b p(x)2\u03b5(x)\u22122dx, we have the a.s. limit\n\u03c0\u0302(x) := lim n\u2192\u221e\nn\u03c0Xn(x) = a p(x)\n\u03b5(x)2 .\nWe may now express the limit of expected hitting time in terms of this result. Theorem 3.5. For d \u2265 2 and any i, j, we have\nE[T xixj ,n] n a.s.\u2192 1 \u03c0\u0302(xj) .\nProof. We give a sketch. By Lemma 3.1, the random walk started at xi does not hit xj within cg\u22122n steps with high probability. By Theorem S2.5, the simple random walk Xnt mixes at exponential rate, implying in Lemma S2.8 that the probability of first hitting at step t > cg\u22122n is approximately the stationary distribution at xj . Expected hitting time is then shown to approximate the expectation of a geometric random variable. See Section S2 for a full proof.\nTheorem 3.5 is illustrated in Figures 1A and 1B, which show with only 3000 points, expected hitting times on a k-nearest neighbor graph degenerates to the stationary distribution. 3\n2Assumption (?) is related to smoothing properties of the graph Laplacian and is known to hold for undirected graphs [4]. No directed analogue is known, and [6] conjectured a weaker property for all spatial graphs. See Section S1 for further details.\n3Surprisingly, [19] proved that 1-D hitting times diverge despite convergence of the continuous equivalent. This occurs because the discrete walk can jump past the target point. In Section S2.4, we consider 1-D hitting"}, {"heading": "4 The Laplace transformed hitting time (LTHT)", "text": "In Theorem 3.5 we showed that expected hitting time is degenerate because a simple random walk mixes before hitting its target. To correct this we penalize longer paths. More precisely, consider for \u03b2\u0302 > 0 and \u03b2n = \u03b2\u0302g2n the Laplace transforms E[e\u2212\u03b2\u0302T x E ] and E[e\u2212\u03b2nT x E,n ] of T xE and T x E,n.\nThese Laplace transformed hitting times (LTHT\u2019s) have three advantages. First, while the expected hitting time of a Brownian motion to a domain is dominated by long paths, the LTHT is dominated by direct paths. Second, the LTHT for the It\u00f4 process can be derived in closed form via the FeynmanKac theorem, allowing us to make use of techniques from continuous stochastic processes to control the continuum LTHT. Lastly, the LTHT can be computed both by sampling and in closed form as a matrix inversion (Section S3). Now define the scaled log-LTHT as\n\u2212 log(E[e\u2212\u03b2nT xi xj,n ])/ \u221a 2\u03b2ngn.\nTaking different scalings for \u03b2n with n interpolates between expected hitting time (\u03b2n \u2192 0 on a fixed graph) and shortest path distance (\u03b2n \u2192\u221e) (Figures 1C, D, and E). In Theorem 4.5, we show that the intermediate scaling \u03b2n = \u0398(\u03b2\u0302g2n) yields a consistent distance measure retaining the unique properties of hitting times. Most of our results on the LTHT are novel for any quasi-walk metric.\nWhile considering the Laplace transform of the hitting time is novel to our work, this metric has been used in the literature in an ad-hoc manner in various forms as a similarity metric for collaboration networks [20], hidden subgraph detection [14], and robust shortest path distance [21]. However, these papers only considered the elementary properties of the limits \u03b2n \u2192 0 and \u03b2n \u2192 \u221e. Our consistency proof demonstrates the advantage of the stochastic process approach."}, {"heading": "4.1 Consistency", "text": "It was shown previously that for n fixed and \u03b2n \u2192 \u221e, \u2212 log(E[\u2212\u03b2nT xixj ,n])/\u03b2ngn converges to shortest path distance from xi to xj . We investigate more precise behavior in terms of the scaling of \u03b2n. There are two regimes: if \u03b2n = \u03c9(log(gdnn)), then the shortest path dominates and the LTHT converges to shortest path distance (See Theorem S5.2). If \u03b2n = \u0398(\u03b2\u0302g2n), the graph log-LTHT converges to its continuous equivalent, which for large \u03b2\u0302 averages over random walks concentrated around the geodesic. To show consistency for \u03b2n = \u0398(\u03b2\u0302g2n), we proceed in three steps: (1) we reweight the random walk on the graph so the limiting process is Brownian motion; (2) we show that log-LTHT for Brownian motion recovers latent distance; (3) we show that log-LTHT for the reweighted walk converges to its continuous limit; (4) we conclude that log-LTHT of the reweighted walk recovers latent distance.\n(1) Reweighting the random walk to converge to Brownian motion: We define weights using the estimators p\u0302 and \u03b5\u0302 for p(x) and \u03b5(x) from [6].\ntimes to small out neighbors which corrects this problem and derive closed form solutions (Theorem S2.12). This hitting time is non-degenerate but highly biased due to boundary terms (Corollary S2.14).\nTheorem 4.1. Let p\u0302 and \u03b5\u0302 be consistent estimators of the density and local scale and A be the adjacency matrix. Then the random walk X\u0302nt defined below converges to a Brownian motion.\nP(X\u0302nt+1 = xj | X\u0302nt = xi) = { Ai,j p\u0302(xj) \u22121 \u2211 k Ai,kp\u0302(xk) \u22121 \u03b5\u0302(xi) \u22122 i 6= j\n1\u2212 \u03b5\u0302(xi)\u22122 i = j\nProof. Reweighting by p\u0302 and \u03b5\u0302 is designed to cancel the drift and diffusion terms in Theorem 2.2 by ensuring that as n grows large, jumps have means approaching 0 and variances which are asymptotically equal (but decaying with n). See Theorem S4.1. 4\n(2) Log-LTHT for a Brownian motion: Let Wt be a Brownian motion with W0 = xi, and let T xi B(xj ,s) be the hitting time of Wt to B(xj , s). We show that log-LTHT converges to distance.\nLemma 4.2. For any \u03b1 < 0, if \u03b2\u0302 = s\u03b1, as s\u2192 0 we have\n\u2212 log(E[exp(\u2212\u03b2\u0302T xiB(xj ,s))])/ \u221a 2\u03b2\u0302 \u2192 |xi \u2212 xj |.\nProof. We consider hitting time of Brownian motion started at distance |xi \u2212 xj | from the origin to distance s of the origin, which is controlled by a Bessel process. See Subsection S6.1 for details.\n(3) Convergence of LTHT for \u03b2n = \u0398(\u03b2\u0302g2n): To compare continuous and discrete log-LTHT\u2019s, we will first define the s-neighborhood of a vertex xi onGn as the graph equivalent of the ballB(xi, s). Definition 4.3 (s-neighborhood). Let \u03b5\u0302(x) be the consistent estimate of the local scale from [6] so that \u03b5\u0302(x) \u2192 \u03b5(x) uniformly a.s. as n \u2192 \u221e. The \u03b5\u0302-weight of a path xi1 \u2192 \u00b7 \u00b7 \u00b7 \u2192 xil is the sum\u2211l\u22121 m=1 \u03b5\u0302(xim) of vertex weights \u03b5\u0302(xi). For s > 0 and x \u2208 Gn, the s-neighborhood of x is\nNBsn(x) := {y | there is a path x\u2192 y of \u03b5\u0302-weight \u2264 g\u22121n s}.\nFor xi, xj \u2208 Gn, let T\u0302 xiB(xj ,s) be the hitting time of the transformed walk onGn from xi to NB s n(xj). We now verify that hitting times to the s-neighborhood on graphs and the s-radius ball coincide.\nCorollary 4.4. For s > 0, we have g2nT\u0302 xi NBsn(xj),n d\u2192 T xiB(xj ,s).\nProof. We verify that the ball and the neighborhood have nearly identical sets of points and apply Theorem 2.2. See Subsection S6.2 for details.\n(4) Proving consistency of log-LTHT: Properly accounting for boundary effects, we obtain a consistency result for the log-LTHT for small neighborhood hitting times.\nTheorem 4.5. Let xi, xj \u2208 Gn be connected by a geodesic not intersecting \u2202D. For any \u03b4 > 0, there exists a choice of \u03b2\u0302 and s > 0 so that if \u03b2n = \u03b2\u0302g2n, for large n we have with high probability\n\u2223\u2223\u2223\u2223\u2212 log(E[exp(\u2212\u03b2nT\u0302 xi NBsn(xj),n )])/ \u221a 2\u03b2\u0302 \u2212 |xi \u2212 xj | \u2223\u2223\u2223\u2223 < \u03b4.\nProof of Theorem 4.5. The proof has three steps. First, we convert to the continuous setting via Corollary 4.4. Second, we show the contribution of the boundary is negligible. The conclusion follows from the explicit computation of Lemma S6.1. Full details are in Section S6.\nThe stochastic process limit based proof of Theorem 4.5 implies that the log-LTHT is consistent and robust to small perturbations to the graph which preserve the same limit (Supp. Section S8).\n4This is a special case of a more general theorem for transforming limits of graph random walks (Theorem S4.1). Figure S1 shows that this modification is highly effective in practice."}, {"heading": "4.2 Bias", "text": "Random walk based metrics are often motivated as recovering a cluster preserving metric. We now show that the log-LTHT of the un-weighted simple random walk preserves the underlying cluster structure. In the 1-D case, we provide a complete characterization. Theorem 4.6. Suppose the spatial graph has d = 1 and h(x) = 1x\u2208[0,1]. Let T xi\nNB \u03b5\u0302(xj)gn n (xj),n\nbe\nthe hitting time of a simple random walk from xi to the out-neighborhood of xj . It converges to\n\u2212 log(E[\u2212\u03b2T xi NB \u03b5\u0302(xj)gn n (xj),n\n])/ \u221a 8\u03b2 \u2192 \u222b xj xi \u221a m(x)dx+ o ( log(1 + e\u2212 \u221a 2\u03b2)/ \u221a 2\u03b2 ) ,\nwhere m(x) = 2\u03b5(x)2 + 1 \u03b2 \u2202 log(p(x)) \u2202x2 + 1 \u03b2\n( \u2202 log(p(x))\n\u2202x\n)2 defines a density-sensitive metric.\nProof. Apply the WKBJ approximation for Schrodinger equations to the Feynman-Kac PDE from Theorem 3.2. See Corollary S7.2 and Corollary S2.13 for a full proof.\nThe leading order terms of the density-sensitive metric appropriately penalize crossing regions of large changes to the log density; this is not the case for the expected hitting time (Theorem S2.12)."}, {"heading": "4.3 Robustness", "text": "While shortest path distance is a consistent measure of the underlying metric, it breaks down catastrophically with the addition of a single non-geometric edge and does not meaningfully rank vertices that share an edge. In contrast, we show that LTHT breaks ties between vertices via the resource allocation (RA) index, a robust local similarity metric under Erdo\u030bs-R\u00e9nyi-type noise. 5 Definition 4.7. The noisy spatial graph Gn over Xn with noise terms q1(n), . . ., qn(n) is constructed by drawing an edge from xi to xj with probability\npij = h(|xi \u2212 xj |\u03b5n(xi)\u22121)(1\u2212 qj(n)) + qj(n).\nDefine the directed RA index in terms of the out-neighborhood set NBn(xi) and the in-neighborhood set NBinn (xi) as Rij := \u2211 xk\u2208NBn(xi)\u2229NBinn(xj) |NBn(xk)|\n\u22121 and two step log-LTHT by M tsij := \u2212 log(E[exp(\u2212\u03b2T xixj ,n) | T xixj ,n > 1]). 6 We show two step log-LTHT and RA index give equivalent methods for testing if vertices are within distance \u03b5n(x). Theorem 4.8. If \u03b2 = \u03c9(log(gdnn)) and xi and xj have at least one common neighbor, then\nM tsij \u2212 2\u03b2 \u2192 \u2212 log(Rij) + log(|NBn(xi)|).\nProof. Let Pij(t) be the probability of going from xi to xj in t steps, and Hij(t) the probability of not hitting before time t. Factoring the two-step hitting time yields\nM tsij = 2\u03b2 \u2212 log(Pij(2))\u2212 log ( 1 + \u221e\u2211\nt=3\nPij(t) Pij(2) Hij(t)e\n\u2212\u03b2(t\u22122) ) .\nLet kmax be the maximal out-degree in Gn. The contribution of paths of length greater than 2 vanishes because Hij(t) \u2264 1 and Pij(t)/Pij(2) \u2264 k2max, which is dominated by e\u2212\u03b2 for \u03b2 = \u03c9(log(gnn)). Noting that Pij(2) =\nRij |NBn(xi)| concludes. For full details see Theorem S9.1.\nFor edge identification within distance \u03b5n(x), the RA index is robust even at noise level q = o(g d/2 n ).\n5Modifying the graph by changing fewer than g2n/n edges does not affect the continuum limit of the random graph, and therefore preserve the LTHT with parameter \u03b2 = \u0398(g2n). While this weak bound allows on average o(1) noise edges per vertex, it does show that the LTHT is substantially more robust than shortest paths without modification. See Section S8 for proofs.\n6The conditioning T xixj ,n > 1 is natural in link-prediction tasks where only pairs of disconnected vertices are queried. Empirically, we observe it is critical to performance (Figure 3).\nTheorem 4.9. If qi = q = o(g d/2 n ) for all i, for any \u03b4 > 0 there are c1, c2 and hn so that for any i, j, with probability at least 1\u2212 \u03b4 we have \u2022 |xi \u2212 xj | < min{\u03b5n(xi), \u03b5n(xj)} if Rijhn < c1; \u2022 |xi \u2212 xj | > 2 max{\u03b5n(xi), \u03b5n(xj)} if Rijhn > c2.\nProof. The minimal RA index follows from standard concentration arguments (see S9.2)."}, {"heading": "5 Link prediction tasks", "text": "We compare the LTHT against other baseline measures of vertex similarity: shortest path distance, expected hitting time, number of common neighbors, and the RA index. A comprehensive evaluation of these quasi-walk metrics was performed in [8] who showed that a metric equivalent to the LTHT performed best. We consider two separate link prediction tasks on the largest connected component of vertices of degree at least five, fixing \u03b2 = 0.2.7 The degree constraint is to ensure that local methods using number of common neighbors such as the resource allocation index do not have an excessive number of ties. Code to generate figures in this paper are contained in the supplement.\nCitation network: The KDD 2003 challenge dataset [5] includes a directed, unweighted network of e-print arXiv citations whose dense connected component has 11,042 vertices and 222,027 edges. We use the same benchmark method as [9] where we delete a single edge and compare the similarity of the deleted edge against the set of control pair of vertices i, j which do not share an edge. We count the fraction of pairs on which each method rank the deleted edge higher than all other methods. We find that LTHT is consistently best at this task (Figure 2). 8\nAssociative Thesaurus network: The Edinburgh associative thesaurus [7] is a network with a dense connected component of 7754 vertices and 246,609 edges in which subjects were shown a set of ten words and for each word was asked to respond with the first word to occur to them. Each vertex represents a word and each edge is a weighted, directed edge where the weight from xi to xj is the number of subjects who responded with word xj given word xi.\nWe measure performance by whether strong associations with more than ten responses can be distinguished from weak ones with only one response. We find that the LTHT performs best and that preventing one-step jumps is critical to performance as predicted by Theorem 4.8 (Figure 3)."}, {"heading": "6 Conclusion", "text": "Our work has developed an asymptotic equivalence between hitting times for random walks on graphs and those for diffusion processes. Using this, we have provided a short extension of the proof for the divergence of expected hitting times, and derived a new consistent graph metric that is theoretically principled, computationally tractable, and empirically successful at well-established link prediction benchmarks. These results open the way for the development of other principled quasi-walk metrics that can provably recover underlying latent similarities for spatial graphs.\n7Results are qualitatively identical when varying \u03b2 from 0.1 to 1; see supplement for details. 8The two-step LTHT is not shown since it is equivalent to the LTHT in missing link prediction."}, {"heading": "1 Uniform equicontinuity of the marginals 1", "text": ""}, {"heading": "2 Hitting times 3", "text": "2.1 Typical hitting times are large . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 3 2.2 Exponential mixing on spatial graphs . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 5 2.3 Expected hitting times degenerate to the stationary distribution . . . . . . . . . . . . . . . . 6 2.4 The case of one dimension . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 10"}, {"heading": "3 Computing the LTHT 11", "text": ""}, {"heading": "4 Reweighting the random walk 12", "text": "4.1 General construction and application to Brownian motion . . . . . . . . . . . . . . . . . . . . 12 4.2 Technical moment estimates . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 13"}, {"heading": "5 Consistency at \u03b2 = \u03c9(log(gdnn)) via shortest paths 15", "text": ""}, {"heading": "6 Consistency of LTHT 16", "text": "6.1 LTHT of the Brownian motion . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 6.2 Proof of Corollary 4.4 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 16 6.3 Proof of Theorem 4.5 . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 19"}, {"heading": "7 1-D bias calculation 22", "text": ""}, {"heading": "8 Basic noise resistance 24", "text": ""}, {"heading": "9 Resource allocation index 26", "text": "9.1 RA index reduction . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 26 9.2 RA index robustness . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . . 27"}, {"heading": "1 Uniform equicontinuity of the marginals", "text": "We discuss condition (?) stated in the main text. We conjecture and assume that the following technical condition holds on all spatial graphs.\n(?) For t = \u0398(g\u22122n ), the rescaled marginal density nqt(x, xi) is a.s. eventually uniformly equicontinuous.\nTo make the terminology we use in (?) clear, we rephrase it as follows.\nDefinition S1.1 (Condition ?). If t = \u0398(g\u22122n ), with probability 1, for any \u03b4 > 0, there exist \u03b3 > 0 and n0 so that for n > n0, any xk \u2208 Xn, and any xi, xj \u2208 Xn with |xi \u2212 xj | < \u03b3, we have\n|nqt(xi, xk)\u2212 nqt(xj , xk)| < \u03b4.\nThis statement allows us to convert the weak convergence in distribution ensured by Theorem 2.2 and the results of (Stroock & Varadhan, 1971) to the convergence in density required by Corollary S2.6. Such a statement rules out the possibility that the density function qt(x, xi) oscillates at frequencies increasing with n as n\u2192\u221e. Controlling regularity of qt(x, xi) seems to be a critical ingredient for approaching (?).\nIn the case of an undirected graph, (?) follows from results in the literature. The strong local limit law for simple random walks shown in (Croydon & Hambly, 2008) yields an even stronger result than (?). In addition, in the same setting, the convergence result for spectral clustering of (von Luxburg et al., 2008) yields an equicontinuity result for eigenvectors of the Laplacian which implies (?).\nHowever, for directed graphs no such result exists, and non-reversibility of the Markov chain seems to be an obstacle to proving such a result. Some results on utilizing the directed Laplacian as a smoothing operator (Zhou et al., 2005) exist in this direction. We believe these techniques could lead to an approach to (?) but thus far they have not yielded a sufficiently strong equicontinuity result.\nRemark 1. In Hashimoto et al. (2015), a similar conjecture was made on the uniform equicontinuity of the rescaled stationary distribution n\u03c0Xn(x). We believe \u201cuniform equicontinuity\u201d should be corrected to \u201ceventual uniform equicontinuity\u201d there. In Corollary S2.6, we show that (?) implies the conjecture of Hashimoto et al. (2015).\nOne consequence of equicontinuity is that convergence in distribution implies convergence in density. We prove this for the marginal distribution q\u0302t\u0302(xk, xi) of Yt\u0302 for the purpose of Theorem 3.5, following the original strategy of (Hashimoto et al., 2015).\nLemma S1.2 (Convergence of marginal densities). If tng 2 n = t\u0302 = \u0398(1), then under (?) we have\nlim n\u2192\u221e\nnqtn(x, xi) = q\u0302t\u0302(x, xi)\np(x) ,\nwhere the convergence is uniform in x and xi.\nProof. The a.s. weak convergence of processes of Theorem 2.2 (which is uniform in xi) implies by (Ethier & Kurtz, 1986, Theorem 4.9.12) that the empirical marginal distribution\nd\u00b5n = n\u2211\nj=1\nqtn(xj , xi)\u03b4xj\nconverges weakly to the marginal distribution d\u00b5 = q\u0302t\u0302(x, xi)dx for Yt\u0302. For any x \u2208 X and \u03b4 > 0, weak convergence against the test function 1B(x,\u03b4) yields\n\u2211\ny\u2208Xn,|y\u2212x|<\u03b4 qtn(y, xi)\u2192\n\u222b\n|y\u2212x|<\u03b4 q\u0302t\u0302(y, xi)dy.\nBy eventual uniform equicontinuity of nqt(x, xi), for any \u03b5 > 0 there is small enough \u03b4 > 0 so that for all n we have \u2223\u2223\u2223\u2223\u2223\u2223 \u2211 y\u2208Xn,|y\u2212x|<\u03b4 qtn(y, xi)\u2212 |Xn \u2229B(x, \u03b4)|qtn(x, xi) \u2223\u2223\u2223\u2223\u2223\u2223 \u2264 n\u22121|Xn \u2229B(x, \u03b4)|\u03b5,\nwhich implies that\nlim n\u2192\u221e qtn(x, xi)p(x)n = lim \u03b4\u21920 lim n\u2192\u221e\nV \u22121d \u03b4 \u2212dnqtn(x, xi)\n\u222b\n|y\u2212x|<\u03b4 p(y)dy\n= lim \u03b4\u21920 lim n\u2192\u221e\nV \u22121d \u03b4 \u2212d|Xn \u2229B(x, \u03b4)|qtn(x, xi) = lim \u03b4\u21920 V \u22121d \u03b4\n\u2212d \u222b\n|y\u2212x|<\u03b4 q\u0302t\u0302(y, xi)dy = q\u0302t\u0302(x, xi).\nWe conclude the desired\nlim n\u2192\u221e\nnqt(x, xi) = q\u0302t\u0302(x, xi)\np(x) ,\nwhere uniformity in x comes from (?) and uniformity in xi comes from uniformity of Theorem 2.2."}, {"heading": "2 Hitting times", "text": "In this section, we prove Theorem 3.5 to generalize the result of von Luxburg et al. (2014) on degenerate behavior of hitting times via Lemma 3.1. Our proof consists of two parts. First, we show that by Lemma 3.1 we can make the random walk mix before hitting any point. Next, we use this to show that if the chain is sufficiently mixed, then the expected hitting time is degenerate."}, {"heading": "2.1 Typical hitting times are large", "text": "In this subsection, we give a complete proof of Lemma 3.3, reproduced here. Recall that T xiE is the hitting time of Yt from xi to a domain E \u2282 D. We will require a more general version of the Feynman-Kac theorem. Theorem S2.1 ((\u00d8ksendal, 2003, Exercise 9.12) Feynman-Kac). Let Zt be an Ito\u0302 process in Rd defined by\ndZt = \u00b5(Zt)dt+ \u03c3(Zt)dBt.\nFor a function V (x) and T xE the hitting time to a domain E \u2282 D, the function\nu(x) = E [ e\u2212 \u222b TxE 0 V (Zs)ds ]\nis the solution to the boundary value problem\n1 2 Tr[\u03c3THu\u03c3] + \u00b5(x) \u00b7 \u2207u\u2212 V (x)u = 0\nwith boundary condition u|\u2202E = 1.\nLemma S2.2. For x, y \u2208 D, d \u2265 2, and any \u03b4 > 0, there exists s > 0 such that E[e\u2212TxB(y,s) ] < \u03b4.\nProof. We use Feynman-Kac to compare E[e\u2212T x B(y,s) ] for the general process to that of Brownian motion. By Theorem 3.2, us(x) = E[e\u2212T x B(y,s) ] satisfies the boundary value problem\n\u2206us + 2\u2207p(x) \u00b7 \u2207us \u2212 2us\u03b5(x)\u22122 = 0\nwith us|B(y,s) \u2261 1. This is equivalent to \u2211\ni\n( \u2202i[p(x) 2\u2202ius]\u2212 2\nd us p(x)2 \u03b5(x)2\n) = 0.\nSet vs(x) = p(x)us(x) and change variables to obtain\n\u2211\ni\n( \u2202i[p(x)\u2202ivs \u2212 vs(x)\u2202ip(x)]\u2212 2\nd vs p(x) \u03b5(x)2\n) = p(x)\u2206vs \u2212\u2206p(x)vs \u2212 vs 2p(x)\n\u03b5(x)2 = 0,\nwhich is equivalent to\n\u2206vs \u2212 (\u2206p(x) p(x) + 2\u03b5(x)\u22122 ) vs = 0\nwith boundary condition vs|\u2202B(y,s) = 1. Theorem S2.1 for V (x) = \u2206p(x)p(x) + 2\u03b5(x)\u22122 implies\nvs(x) = E [ e\u2212 \u222b TxB(y,s) 0 \u2206p(Br) p(Br) +2\u03b5(Br) \u22122dr ]\nfor Bt Brownian motion started at x and T x\nB(y,s) the hitting time of Bt to B(y, s). For a constant C depending on p and \u03b5, we have\nus(x) = vs(x) p(x) \u2264 E[e\u2212CT x B(y,s) ].\nApplying Lemma S2.3 with this C implies us(x) < \u03b4e \u2212c, as needed.\nLemma S2.3. For x, y \u2208 D, let Bt be a Brownian motion with reflecting boundary condition in D started at x and T xB(y,s) its hitting time to B(y, s). Then for any sufficiently small C, c, \u03b4 > 0, there exists some s > 0 so that\nE[e\u2212CT x B(y,s) ] < \u03b4e\u2212c.\nProof. Fix c > 0 and \u03b4 > 0 small enough so that e\u2212c\u03b4 < 1/10. If |x\u2212 y| = p, by Theorem 3 of Byczkowski et al. (2013), the probability density of T xB(y,s) started at x if there were no outer boundary is bounded by\np(t) < C1 s3(p\u2212 s)e\u2212 (p\u2212s)\n2\n2t\npt3/2\n{ ((t/s2) d\u22123 2 + (p/s) d\u22123 2 )\u22121 d > 2\n(p/s+t/s2)1/2(1+log(p/s)) (1+log(1+t/ps))(1+log(p/s+t/s2)) d = 2\nfor some constant C1. Choosing constants: We claim that we can choose s, p, and r with r > p > s > 0 so that:\n(a) B(y, r) is contained entirely in the domain D;\n(b1) r 2\u2212d\u2212p2\u2212d r2\u2212d\u2212s2\u2212d > max{1/2, 1\u2212e \u2212c\u03b4 1\u2212 12 e\u2212c\u03b4 } if d > 2;\n(b2) log r\u2212log plog r\u2212log s > max{1/2, 1\u2212e \u2212c\u03b4\n1\u2212 12 e\u2212c\u03b4 } if d = 2;\n(c1) C1s d ( C\u22121 + \u222b\u221e 1 ud/2\u22122e\u2212(p\u2212s) 2udu ) < 14\u03b4e \u2212c if d > 2;\n(c2a) C1s 2 \u222b\u221e 1 e\u2212Ct(ps+ t)1/2dt < 18\u03b4e \u2212c if d = 2;\n(c2b) C1s 2(ps+ 1)1/2 \u222b 1 0 t\u22123/2e\u2212(p\u2212s) 2/2tdt < 18\u03b4e \u2212c if d = 2.\nFor d > 2, we have that\n\u0393(d/2\u2212 1) (p\u2212 s)d\u22122 = (p\u2212 s)\n2\u2212d \u222b \u221e\n0\nxd/2\u22122e\u2212xdx = \u222b \u221e\n0\nud/2\u22122e\u2212(p\u2212s) 2udu >\n\u222b \u221e\n1\nud/2\u22122e\u2212(p\u2212s) 2udu.\nThen for p = 2qr and s = qr, we have that\nr2\u2212d \u2212 p2\u2212d r2\u2212d \u2212 s2\u2212d = 1\u2212 2d\u22122qd\u22122 1\u2212 qd\u22122 > 1\u2212 2 d\u22122qd\u22122\nand that\nsd \u0393(d/2\u2212 1) (p\u2212 s)d\u22122 < q 2r2\u0393(d/2\u2212 1)\nTherefore, sending r \u2192 0 and q \u2192 0 gives a choice of r > p > s satisfying (a), (b1), and (c1) as needed. For d = 2, notice that for t = u\u22121, we have\n\u222b 1\n0\nt\u22123/2e\u2212(p\u2212s) 2/2tdt =\n\u222b \u221e\n1\nu\u22121/2e\u2212(p\u2212s) 2u/2du.\nObserve now that\n(p\u2212 s)\u22121\u0393(1/2) = (p\u2212 s)\u22121 \u222b \u221e\n0\nt\u22121/2e\u2212tdt = \u222b \u221e\n0\nu\u22121/2e\u2212(p\u2212s) 2udu >\n\u222b \u221e\n1\nu\u22121/2e\u2212(p\u2212s) 2udu,\nwhence we conclude that\nC1 s2 \u221a ps+ 1\np\u2212 s \u0393(1/2) > C1s 2(ps+ 1)1/2\n\u222b 1\n0\nt\u22123/2e\u2212(p\u2212s) 2/2tdt.\nAgain choose p = 2qr and s = qr, for which we obtain\nC1s 2(ps+ 1)1/2\n\u222b 1\n0\nt\u22123/2e\u2212(p\u2212s) 2/2tdt < C1\u0393(1/2)qr \u221a 4q2r2 + 1.\nSending q and r to 0 then yields r > p > s satisfying (a), (b2) because q \u2192 0, (c2a) because s \u2192 0 and (ps+ t)1/2 < (1 + t)1/2, and (c2b) by the estimate above. Bounding the Laplace transform: Having chosen r > p > s > 0 with the desired properties, we have for any z \u2208 D that\nE[e\u2212CT z B(y,s) ] \u2264 max |x\u2212y|=p E[e\u2212CT x B(y,s) ].\nOur strategy will be to bound E[e\u2212CT x B(y,s) ] for any x with |x \u2212 y| = p. Fix such an x. Let E be the event that the walk hits B(y, s) before B(y, r). By Theorem 3.17 of Mo\u0308rters & Peres (2010), the probability of E is r 2\u2212d\u2212p2\u2212d r2\u2212d\u2212s2\u2212d if d > 2 and log r\u2212log p log r\u2212log s if d = 2. By our choice of parameters, this probability is at least P(E) > max{1/2, 1\u2212e\u2212c\u03b4 1\u2212 12 e\u2212c\u03b4\n}. Let E\u2032[e\u2212CT x B(y,s) ] denote the case where there is no outside boundary. For d > 2, we have\nE\u2032[e\u2212CT x B(y,s) ] < C1s d\n\u222b \u221e\n0\ne\u2212Ctt\u2212d/2e\u2212(p\u2212s) 2/2tdt\n< C1s d ( C\u22121 + \u222b 1\n0\nt\u2212d/2e\u2212(p\u2212s) 2/2tdt\n)\n< C1s d ( C\u22121 + \u222b \u221e\n1\nud/2\u22122e\u2212(p\u2212s) 2udu\n)\n< 1 4 \u03b4e\u2212c\nby the choice of s and p. For d = 2, we have\nE\u2032[e\u2212CT x B(y,s) ] < C1s 2\n\u222b \u221e\n0\ne\u2212Ctt\u22123/2e\u2212(p\u2212s) 2/2t(ps+ t)1/2dt <\n1 4 \u03b4e\u2212c\nagain by our choice of s and p. Conditioning on E, we find that\nE[e\u2212CT x B(y,s) |E] \u2264 P(E)\u22121E\u2032[e\u2212CTxB(y,s) ] < 1 2 \u03b4e\u2212c.\nThis implies the desired\nE[e\u2212CT x B(y,s) ] \u2264 P(E)E[e\u2212CTxB(y,s) ] + (1\u2212 P(E)) < \u03b4e\u2212c."}, {"heading": "2.2 Exponential mixing on spatial graphs", "text": "In this subsection, we show that mixing rates are exponential on spatial graphs as assuming (?).\nLemma S2.4 (Uniform Doeblin condition). Assuming (?), there exist \u03b1 > 0 and K <\u221e so that for some n0 > 0 and t\u03020 > 0, we have for n > n0 and t\u0302 > t\u03020 that\n1. minx,xi\u2208Xn q n dt\u0302g\u22122n e (x, xi) > \u03b1 n ;\n2. maxx,xi\u2208Xn q n dt\u0302g\u22122n e (x, xi) < K n .\nProof. By Lemma S1.2, assuming (?) we have nqndt\u0302g\u22122n e (x, xi)\u2192 q\u0302t\u0302(x, xi)/p(x), where convergence is uniform in x and xi. Therefore, we may choose n0 > 0 and t\u03020 > 0 so that for n > n0 and t\u0302 > t\u03020, we have for any x, xi \u2208 Xn that\nmin x,xi\u2208D q\u0302t\u0302(x, xi)/p(x) \u2264 nqndt\u0302g\u22122n e(x, xi) \u2264 maxx,xi\u2208D q\u0302t\u0302(x, xi)/p(x),\nwhere the first and last quantities are well-defined by compactness of D. Taking\n\u03b1 = 1\n2 min x,y\u2208D q\u0302t\u0302(x, y)/p(x) and K = 2 max x,y\u2208D q\u0302t\u0302(x, y)/p(x)\nthus fulfills the desired conditions.\nTheorem S2.5. Then we may choose t\u03020, n0 > 0 and C, \u03b2 > 0 so that for t\u0302 > t\u03020, n > n0 and xi, x \u2208 Xn, we have\n|qndt\u0302g\u22122n e(x, xi)\u2212 \u03c0Xn(x)| < C exp(\u2212\u03b2t\u0302)\u03c0Xn(x).\nProof. By Lemma S2.4, the family of processes Xnt satisfies the uniform Doeblin condition of (Eloranta, 1990, Section 2.8). The claim follows by the consequences for exponential mixing given in the analogue of (Eloranta, 1990, Theorem 2.7).\nCorollary S2.6. Assuming (?), the rescaled stationary distribution n\u03c0Xn(x) is a.s. eventually uniformly equicontinuous.\nProof. Choose \u03b1,K, t\u03021, n1 by Lemma S2.4 so that for n > n1, t\u0302 > t\u03021, we have\n\u03b1 n < qndt\u0302g\u22122n e(x, xi) < K n .\nChoose C, \u03b2, t\u03022, n2 by Theorem S2.5 so that for n > n2, t\u0302 > t\u03022, we have\n|qndt\u0302g\u22122n e(x, xi)\u2212 \u03c0Xn(x)| < C exp(\u2212\u03b2t\u0302)\u03c0Xn(x).\nThus, for n > max{n1, n2} and t\u0302 > max{t\u03021, t\u03022}, we have\n|qndt\u0302g\u22122n e(x, xi)\u2212 \u03c0Xn(x)| < C exp(\u2212\u03b2t\u0302)\u03c0Xn(x) < CK n exp(\u2212\u03b2t\u0302). (1)\nNow, for any \u03b3 > 0, choose n0 > max{n1, n2} and t\u03020 > max{t\u03021, t\u03022} large enough and \u03b4 > 0 so that \u2022 CKn0 exp(\u2212\u03b2t\u03020) < \u03b3/3; \u2022 by eventual uniform equicontinuity of nqndt\u03020g\u22122n e(x, xi), for n > n0, if |x\u2212 y| < \u03b4, then\n|nqndt\u03020g\u22122n e(x, xi)\u2212 nq n dt\u03020g\u22122n e(y, xi)| < \u03b3/3.\nNow, for n > n0 and |x\u2212 y| < \u03b4, we find that\n|n\u03c0Xn(x)\u2212 n\u03c0Xn(y)| \u2264 |nqndt\u03020g\u22122n e(x, xi)\u2212 nq n dt\u03020g\u22122n e(y, xi)|+ |nq n dt\u03020g\u22122n e(x, xi)\u2212 n\u03c0Xn(x)|\n+ |nqndt\u03020g\u22122n e(y, xi)\u2212 n\u03c0Xn(y)|\n< \u03b3/3 + 2CK\nn exp(\u2212\u03b2t\u03020)\n< \u03b3,\nwhere we apply (1). This implies that n\u03c0Xn(x) is eventually uniformly equicontinuous, as needed."}, {"heading": "2.3 Expected hitting times degenerate to the stationary distribution", "text": "For any xj , let \u03c0 \u2032 Xn be the stationary distribution of the simple random walk on the graph G \u2032 n formed from Gn by removing xj and all edges incident to it.\nLemma S2.7. Assuming (?), the rescaled stationary density n\u03c0\u2032Xn(x) is a.s. eventually uniformly equicontinuous and satisfies\nlim n\u2192\u221e\nn\u03c0\u2032Xn(x) = \u03c0\u0302(x).\nProof. Let q\u2032t(x, xi) be the marginal distribution of the simple random walk on the modified graph G \u2032 n. Because G\u2032n is also a spatial graph, by (Hashimoto et al., 2015, Theorem 3.4), the time-rescaled simple random walks on G\u2032n and Gn converge to the same continuous-time Ito\u0302 process, and we have under (?) that\nlim n\u2192\u221e\nn\u03c0\u2032Xn(xi) = \u03c0\u0302(xi),\nwhere the convergence is uniform in xi.\nLemma S2.8. There exist t0 > 0, n0 > 0, and C, \u03b2 > 0 so that for all t\u0302 > t0 and n > n0 and any integer t > t\u0302g\u22122n , we have\n\u2223\u2223\u2223\u2223\u2223\u2223 nP ( T xixj ,n = t | T xixj ,n \u2265 t ) \u2212 n \u2211\nx\u2208NBinn(xj)\n\u03c0\u2032Xn(x) |NBn(x)| \u2223\u2223\u2223\u2223\u2223\u2223 < C exp(\u2212\u03b2tg2n).\nProof. By Theorem S2.5, we may choose t\u03020 > 0, n0 > 0, C1 > 0, and \u03b2 > 0 so that for t\u0302 > t\u03020 and n > n1, we have\n|q\u2032dt\u0302g\u22122n e\u22121(x, xi)\u2212 \u03c0 \u2032 Xn(x)| < C1 exp(\u2212\u03b2t\u0302)\u03c0\u2032Xn(xj).\nWe claim that the desired result will hold for t\u03020 and this n0. By definition, we have\nP ( T xixj ,n = t | T xixj ,n \u2265 t ) =\n\u2211\nx\u2208NBinn(xj)\nq\u2032t\u22121(x, xi)\n|NBn(x)|\nfrom which we conclude that for t > t\u03020g \u22122 n we have\n\u2223\u2223\u2223\u2223P ( T xixj ,n = t | T xixj ,n \u2265 t ) \u2212 \u2211\nx\u2208NBinn(xj)\n\u03c0\u2032Xn(x) |NBn(x)|\n\u2223\u2223\u2223\u2223 \u2264 \u2223\u2223\u2223\u2223 \u2211\nx\u2208NBinn(xj)\nq\u2032t\u22121(x, xi)\u2212 \u03c0\u2032Xn(x) |NBn(x)| \u2223\u2223\u2223\u2223\n< C1 exp(\u2212\u03b2tg2n) \u2211\nx\u2208NBinn(xj)\n\u03c0\u2032Xn(x) |NBn(x)|\n< C1 exp(\u2212\u03b2tg2n) |NBinn (xj)|\nminx |NBn(x)| max x\n\u03c0\u2032Xn(x).\nWe now show there exists C2 > 0 such that |NBinn(xj)|\nminx |NBn(x)| < C2 almost surely due to the construction of gn and \u03b5. By the out-degree estimate of an isotropic graph (Hashimoto et al., 2015, Theorem S3.2)1, we have\n|NBn(x)| |Xn \u2229B(x, \u03b5n(x))| \u2192 C(h)p(x)\nfor some constant C(h) independent of x and n. Further, since the number of points in |Xn \u2229B(x, \u03b5n(x))| \u223c Pois(\u03b5n(x)\ndVdp(x)), we obtain for a constant 0 < Cx <\u221e dependent on p, Vd and C(h) that |NBn(x)| \u03b5n(x)dn \u2192 Cx.\nFor the denominator minx |NBn(x)|, the above limit immediately implies that minx |NBn(x)|\u03b5\u2212dn n\u22121 \u2192 minx Cx > 0 by the lower bounds on p(x) and \u03b5n(x).\nFor the numerator, note that by construction of \u03b5, for any \u03b4 > 0 there exists a n such that \u03b5n(x) \u2212d < (1 + \u03b4) maxx \u03b5(x) \u2212dg\u2212dn almost surely. By the expectation in (Hashimoto et al., 2015, Theorem S3.2), the out-neighborhood of a graph constructed with uniform scale maxx \u03b5(x)gn asymptotically dominate the inneighborhood of the original graph. Therefore,\nmax x |NBn(x)in|\u03b5(x)\u2212dg\u2212dn n\u22121 < max x Cx(1 + \u03b4) <\u221e.\nCombining the two bounds gives that\n|NBinn (xj)| minx |NBn(x)| < (1 + \u03b4) maxx Cx\u03b5(x) d minx Cx\u03b5(x)d .\nThe ratio maxx Cxminx Cx is bounded by definition of p(x), and therefore there exists C2 > 0 such that |NBinn(xj)| minx |NBn(x)| < C2 almost surely. Finally, by Lemma S2.7, there exists C3 > 0 such that \u03c0 \u2032 Xn(x) \u2264 C3/n for large enough n. The original statement follows by setting C = C1C2C3.\n1Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of \u03b5n(x)\u2212d.\nLemma S2.9. We have the limit\nlim n\u2192\u221e\n\u2211\nx\u2208NBinn(xj)\n1\n|NBn(x)| = 1.\nProof. We will proceed through three estimates. Estimating \u03b5(x) for x \u2208 NBinn (xj): For \u03c3 > 0, define \u03b3 = \u03c3minx \u03b5(x) > 0. We may choose \u03b4 > 0 so that if |x \u2212 y| < \u03b4, then |\u03b5(x) \u2212 \u03b5(y)| < \u03b3. Choose n0 so that if n > n0 then gn maxx \u03b5(x) < \u03b4/2. For n > n0, we find that for x \u2208 NBinn (xj), we have\n|x\u2212 xj | \u2264 \u03b5n(x) \u2264 gn max x \u03b5(x) < \u03b4\nand therefore that |\u03b5(x)\u2212 \u03b5(xj)| < \u03c3min\nx \u03b5(x) \u2264 \u03c3\u03b5(xj).\nThis implies that for n > n0 we have\n(1\u2212 \u03c3)\u03b5(xj) < \u03b5(x) < (1 + \u03c3)\u03b5(xj). (2)\nEstimating |NBn(x)| for x \u2208 NBinn (xj): By (Hashimoto et al., 2015, Theorem S3.2), we have\n|NBn(x)| |Xn \u2229B(x, \u03b5n(x))| \u2192 C(h)p(x)\nfor some constant C(h) independent of x and n.2 For any \u03c4 > 0, we may therefore find some n1 so that for n > n1 we have\n(1\u2212 \u03c4)C(h)p(x)|Xn \u2229B(x, \u03b5n(x))| < |NBn(x)| < (1 + \u03c4)C(h)p(x)|Xn \u2229B(x, \u03b5n(x))|.\nOn the other hand, by (2), for x \u2208 NBinn (xj) and any \u03c3 > 0 there is some n0 so that for n > n0 we have\n|Xn \u2229B(x, (1\u2212 \u03c3)\u03b5n(xj))| < |Xn \u2229B(x, \u03b5n(x))| < |Xn \u2229B(x, (1 + \u03c3)\u03b5n(xj))|. (3)\nEstimating |NBinn (xj)|: By (2) and an analogue of the proof of (Hashimoto et al., 2015, Theorem S3.2), we have for x \u2208 NBinn (xj) that for any \u03c1 > 0, there is n2 > 0 so that if n > n2 then\n(1\u2212 \u03c1)C(h)p(x)|Xn \u2229B(x, (1\u2212 \u03c3)\u03b5n(xj))| < |NBinn (xj)| < (1 + \u03c1)C(h)p(x)|Xn \u2229B(x, (1 + \u03c3)\u03b5n(xj))|. (4)\nCompleting the proof: The conclusion follows by taking \u03c4, \u03c3, \u03c1\u2192 0, choosing n large, and combining (3) and (4). Lemma S2.10. The quantity \u03b8n(xj) = \u2211 x\u2208NBinn(xj) \u03c0\u2032Xn (x) |NBn(x)| satisfies\nlim n\u2192\u221e n\u03b8n(xj) = \u03c0\u0302(xj).\nProof. Fix a sequence of points y1, y2, . . . in X with yk \u2208 G\u2032k so that limk\u2192\u221e yk = xj . Fix any \u03b4 > 0. By Lemma S2.7, we may find some n0 so that for n > n0, for each x \u2208 NBinn (xj) we have\n|\u03c0\u2032Xn(x)\u2212 \u03c0\u2032Xn(yn)| < \u03b4/2.\nThis implies that for n > n0 we have\n\u2223\u2223\u2223\u2223\u2223\u2223 n\u03b8n(xj)\u2212 n\u03c0\u2032Xn(yn) \u2211\nx\u2208NBinn(xj)\n1\n|NBn(x)| \u2223\u2223\u2223\u2223\u2223\u2223 < \u03b4 2\n\u2211\nx\u2208NBinn(xj)\n1\n|NBn(x)| .\nThe result then follows by Lemma S2.9 and Lemma S2.7.\n2Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of \u03b5n(x)\u2212d.\nTheorem S2.11. For any xi and xj, we have\nE[T xixj ,n] n \u2192 1 \u03c0\u0302(xj) ,\nwhere the convergence is a.s. in the draw of X . Proof. By definition, we have\nE[T xixj ,n | T xixj ,n > t\u0302g\u22122n ] \u2265 E[T xixj ,n] \u2265 P(T xixj ,n > t\u0302g\u22122n )E[T xixj ,n | T xixj ,n > t\u0302g\u22122n ]. (5)\nBy Lemma 3.1, for any \u03b4 > 0 and t\u03020 > 0, there is some n1 so that for n > n1 and t\u0302 > t\u03020 we have P(T xixj ,n > t\u0302g \u22122 n ) > (1\u2212 \u03b4). Define now pt = P(T xixj ,n = t | T xixj ,n \u2265 t); by definition we have\nE[T xixj ,n | T xixj ,n > t\u0302g\u22122n ] = \u221e\u2211\nt=dt\u0302g\u22122n e\ntpt\nt\u22121\u220f\nr=dt\u0302g\u22122n e\n(1\u2212 pr).\nBy Lemma S2.8, we have for some n2 that for n > n2 and t > t\u03020g \u22122 n that\n|pt \u2212 \u03b8n(xj)| < C exp(\u2212\u03b2tg2n)\nn\nso in particular for \u03b4 = 12 minx\u2208D \u03c0\u0302(x) and \u03c4 = 2 maxx\u2208D \u03c0\u0302(x), we have for some n3 that for n > n3 we have\n\u03b4 < npt < \u03c4 and \u03b4 < n\u03b8n(xj) < \u03c4.\nFor n4 large enough that 1\u2212 \u03c4/n4 > \u03b4/n4, for n > n4 we have \u2223\u2223\u2223\u2223\u2223\u2223 pt t\u22121\u220f\nr=dt\u0302g\u22122n e\n(1\u2212 pr)\u2212 \u03b8n(xj)(1\u2212 \u03b8n(xj))t\u2212dt\u0302g \u22122 n e \u2223\u2223\u2223\u2223\u2223\u2223 < t\u22121\u2211\nr=dt\u0302g\u22122n e\nC exp(\u2212\u03b2rg2n) n (1\u2212 \u03c4/n)t\u2212dt\u0302g\u22122n e\u22121\n< C\nn\ne\u2212\u03b2t\u0302\n1\u2212 e\u2212\u03b2g2n (1\u2212 \u03c4/n) t\u2212dt\u0302g\u22122n e\u22121.\nThis implies that\n1\nn \u2223\u2223\u2223\u2223\u2223\u2223 E[T xixj ,n | T xixj ,n > t\u0302g\u22122n ]\u2212 \u221e\u2211\nt=dt\u0302g\u22122n e\nt\u03b8n(xj)(1\u2212 \u03b8n(xj))t\u2212dt\u0302g \u22122 n e \u2223\u2223\u2223\u2223\u2223\u2223 < \u221e\u2211\nt=dt\u0302g\u22122n e\nC n2 e\u2212\u03b2t\u0302 1\u2212 e\u2212\u03b2g2n (1\u2212 \u03c4/n) t\u2212dt\u0302g\u22122n e\u22121\n< C \u03c4(n\u2212 \u03c4) e\u2212\u03b2t\u0302 1\u2212 e\u2212\u03b2g2n ,\nwhere we note that for n > 2\u03c4 , we have\nC \u03c4(n\u2212 \u03c4) e\u2212\u03b2t\u0302 1\u2212 e\u2212\u03b2g2n < 2Ce\u2212\u03b2t\u0302 \u03c4 n\u22121(g\u22122n + 1 2 + 1 12 g2n).\nBecause limn\u2192\u221e n\u22121(g\u22122n + 1 2 + 1 12g 2 n) = 0, considering n > max{n1, n2, n3, n4}, we conclude that\nlim n\u2192\u221e\n1 n E[T xixj ,n | T xixj ,n > t\u0302g\u22122n ] = limn\u2192\u221e 1 n\n\u221e\u2211\nt=dt\u0302g\u22122n e\nt\u03b8n(xj)(1\u2212 \u03b8n(xj))t\u2212dt\u0302g \u22122 n e\n= lim n\u2192\u221e\n1\nn 1\u2212 \u03b8n(xj) + \u03b8n(xj)dt\u0302g\u22122n e \u03b8n(xj)\n= lim n\u2192\u221e\n1\nn\u03b8n(xj) =\n1\n\u03c0\u0302(xj) ,\nwhere the last equality follows from Lemma S2.10. Now by (5), we conclude that\nlim n\u2192\u221e\n1 n E[T xixj ,n] = 1 \u03c0\u0302(xj) ."}, {"heading": "2.4 The case of one dimension", "text": "The Laplacian-based bounds in (von Luxburg et al., 2014) suggest that the hitting time should diverge even when the dimension of the underlying geometric graph is 1. This is a very surprising result, since the continuous random walk in one dimension converges to a non-trivial limit. We provide another explanation of this result in our framework.\nIntuitively, this happens since we are concerned with the hitting time to a single point, and the discrete random walk may jump over the point, while the continuous walk cannot. To demonstrate this, we show that considering the hitting time to a sufficiently large out-neighborhood of a vertex instead of the vertex itself fixes this problem.\nPick xi, xj \u2208 Gn, and let Xnt be the simple random walk on Gn. Suppose without loss of generality that xi < xj and define\n\u03b3 = inf n min xi\u2208Xn xi\nto be the left boundary of D. Pick a sequence of sets of vertices Sn \u2282 Xn so that every element in Sn is reachable from xj in o(g \u22121 n ) steps and the removal of Sn from Gn disconnects Gn. Let T xi Sn\nbe the hitting time to any point in Sn. We will use the Feynman-Kac theorem for functionals of hitting time.\nTheorem S2.12 ((\u00d8ksendal, 2003, Exercise 9.12) Feynman-Kac). Let Zt be an Ito\u0302 process in Rd defined by\ndZt = \u00b5(Zt)dt+ \u03c3(Zt)dBt.\nFor a function f(x) and T xE the hitting time to a domain E \u2282 D, the function\nu(x) = E [\u222b TxE 0 f(Zs)ds ]\nis the solution to the boundary value problem\n1 2 Tr[\u03c3THu\u03c3] + \u00b5(x) \u00b7 \u2207u+ f(x) = 0\nwith boundary condition u|\u2202E = 1. Theorem S2.13. Such a sequence of vertex sets Sn always exists and the expected hitting time E[T xiSn,n] converges to a non-degenerate continuum limit defined by\nE[T xiSn,ng 2 n]\u2192 \u222b xj xi 1 p(y)2 \u222b y \u03b3 2p(z)2 \u03b5(z)2 dzdy.\nProof. First we prove a sequence Sn exists. Take the set of points S\u0302n = {xk : |xk \u2212 xj | < cn} for a sequence cn with cn \u2192 0 and cngn \u2192\u221e. Let s be the maximum shortest path distance to any element in S\u0302n. Then we have s = o(g\u22121n ) since cn \u2192 0 and the length of the shortest path between any two points scales as \u0398(g\u22121n ). Therefore the set Sn defined by all points whose shortest path distance to xj is at most s fulfills the requirements.\nLet T\u0302ij be the hitting time to xj of Yt\u0302 started at xi. Note that it is not infinite because we have d = 1. By Corollary 4.4 and the fact that sg\u22121n \u2192 0, we have\nT xiSn,ng 2 n d\u2192 T\u0302ij .\nFinally, by Theorem S2.12 with f(x) \u2261 1, the expected hitting time u(x) to xj under the continuous process Yt\u0302 started at x is the solution to the boundary value problem\n1 2 \u03b5(x)2u\u2032\u2032(x) + p\u2032(x) p(x) \u03b5(x)2u\u2032(x) + 1 = 0\nWe may rewrite this as\np(x)2u\u2032\u2032(x) + 2p(x)p\u2032(x)u\u2032(x) = \u22122p(x) 2\n\u03b5(x)2 ,\nafter which integration of both sides and application of u\u2032(\u03b3) = 0 implies that\np(x)2u\u2032(x) = \u2212 \u222b x\n\u03b3\n2p(z)2\n\u03b5(z)2 dz.\nAnother integration and application of u(xj) = 0 implies that\nu(x) = \u2212 \u222b x\nxj\n1\np(y)2\n\u222b y\n\u03b3\n2p(z)2\n\u03b5(z)2 dzdy.\nSetting x = xi then implies that\nlim n\u2192\u221e E[T xiSn,ng 2 n] = E[T\u0302ij ] = \u222b xj xi 1 p(y)2 \u222b y \u03b3 2p(z)2 \u03b5(z)2 dzdy.\nFor cases where the kernel function takes values in {0, 1}, such as the k-nearest neighbor graph, the following corollary is useful.\nCorollary S2.14. Suppose that Gn is constructed by the kernel h(x) = 1[0,1]. Then the expected hitting time of Xnt started at xi to the out-neighbors of xj converges to the limit of Theorem S2.13\nProof. From the fact that the out-neighborhood of xj satisfies the conditions for Sn in Theorem S2.13.\nAlthough this metric is nontrivial in the sense that it retains some information about the latent space metric, it is still highly distorted. We examine this phenomenon in the case of \u03b5(x) = 1 and p(x) = 1 in the following Corollary.\nCorollary S2.15. If \u03b5(x) = 1 and p(x) = 1 in Corollary S2.14, for any xi and xj the rescaled expectation of the hitting time T xiNBn(xj),n of X n t started at xi to the out-neighborhood of xj has the limit\nE[T xiNBn(xj),ng 2 n]\u2192 |xj \u2212 xi| \u00b7 |xj + xi \u2212 2\u03b3|.\nProof. This follows by applying Theorem S2.13 with our \u03b5(x) and p(x).\nRemark 2. Note that the boundary condition in Corollary 2.15 induces a large non-uniform multiplicative error. Because of this, the expected hitting time is not consistent even in the ideal situation of a onedimensional latent space with random walk converging to Brownian motion. Compare this result with Theorem 4.5, which shows a much stronger consistency property."}, {"heading": "3 Computing the LTHT", "text": "Algorithmically, computing the LTHT can be done in two major ways: matrix inversion, or sampling. For the results in the paper, we use the direct sampling method of drawing a simple random walk and calculating the exponentially discounted hitting time. This same computation can be performed using a truncated power method (Yazdani, 2013, Algorithm 1).\nAlternative approaches for computing the LTHT involve the following matrix inversion method. Let P be the transition matrix for some random walk. Then the LTHT E[exp(\u2212\u03b2T xixj ,n)] is given by\nE[exp(\u2212\u03b2T xixj ,n)] = (I \u2212W exp(\u2212\u03b2))\u22121ji .\nNote that this expression is a close discrete analog of Feynman-Kac (Theorem 2.1). This relationship was used in prior work (Smith et al., 2014, Eq. 22) to calculate the LTHT in a different setting and formulation. Correctness of this expression can be seen via the series expansion which was computed as a normalizer for randomized shortest paths (Franc\u0327oisse et al., 2013, Algorithm 2). This method has been used to calculate the LTHT in in prior work (Kivima\u0308ki et al., 2014)."}, {"heading": "4 Reweighting the random walk", "text": "Recall that Anij was the adjacency matrix of Gn. In Corollary S4.2, we give a complete proof of Theorem 4.1 from the maintext."}, {"heading": "4.1 General construction and application to Brownian motion", "text": "Let an(x) and bn(x) be scalar functions on Xn with possibly stochastic dependence on Xn so that\nlim n\u2192\u221e an(x) = a(x) and lim n\u2192\u221e bn(x) = b(x)\nuniformly in x for some deterministic a(x) and b(x).\nTheorem S4.1. If an(x) is a.s. eventually equicontinuous, a(x) is smooth with bounded gradient, and b(x) is continuous and bounded in (0, 1], the weighted random walk Zt defined by the transition matrix\nP(Zt+1 = xj | Zt = xi) = { Ani,j an(xj)\u2211 xk\u2208NBn(xi) an(xk) bn(xi) i 6= j\n1\u2212 bn(xi) i = j\nconverges to the Ito\u0302 process with drift \u2207 log(p(x)a(x))/3 and diffusion \u03b5(x)2b(x)/3.\nProof. To show convergence to an Ito\u0302 process, it suffices to check the Stroock-Varadhan criterion (Stroock & Varadhan, 1971). Since the boundary for both the original and modified walk are the same, we only need check that\nE[Zt+1 \u2212 xi | Zt = xi] p\u2212\u2192 1\n3 \u2207[p(xi)a(xi)] p(xi)a(xi) \u03b5(xi) 2b(xi), and\nE[(Zt+1 \u2212 xi)2 | Zt = xi] p\u2212\u2192 1\n3 \u03b5(xi)\n2b(xi).\nFor this, by definition we have that\nE[Zt+1 \u2212 xi | Zt = xi] = P(Zt+1 6= xi) 1\u2211\nxk\u2208NBn(xi) an(xk)\n\u2211\nxk\u2208NBn(xi) (xk \u2212 xi)an(xk), and\nE[(Zt+1 \u2212 xi)2 | Zt = xi] = P(Zt+1 6= xi) 1\u2211\nxk\u2208NBn(xi) an(xk)\n\u2211\nxk\u2208NBn(xi) (xk \u2212 xi)2an(xk),\nfrom which the desired estimates follow by using P(Zt+1 6= xi) = bn(xi) and the values and concentration of conditional moments E[f(Zt \u2212 Zt\u22121) | Zt\u22121, Zt 6= Zt\u22121] given by applying Lemma S4.3 and Lemma S4.4 to f(x) = x and f(x) = x2.\nCorollary S4.2. Let p\u0302 and \u03b5\u0302 be consistent estimators of the density and local scale and A be the adjacency matrix. Then the random walk X\u0302nt defined by the following transition\nP(X\u0302nt+1 = xj | X\u0302nt = xi) = { Ai,j p\u0302(xj) \u22121 \u2211 k Ai,kp\u0302(xk) \u22121 \u03b5\u0302(xi) \u22122 i 6= j\n1\u2212 \u03b5\u0302(xi)\u22122 i = j\nconverges to a Brownian motion.\nProof. Set an(x) = p\u0302(x) \u22121 and bn(x) = \u03b5\u0302(x)\u22122 as estimated by (Hashimoto et al., 2015) so that limn\u2192\u221e an(x) = p(x)\u22121 and limn\u2192\u221e bn(x) = \u03b5(x)\u22122. These satisfy the conditions of Theorem S4.1 and yield limiting drift and diffusion coefficients for Brownian motion."}, {"heading": "4.2 Technical moment estimates", "text": "In this subsection, we give the moment estimates necessary in the proof of Theorem S4.1. We first derive the expected values of each moment quantity averaged over draws of Xn. Lemma S4.3 (Expected values of reweighting). Let x = Xnt and y = X n t+1. Then the conditional expectation after weighting by an(x) converges to the weighted draw over p(x)an(x); that is, we have a.s. that\nlim n\u2192\u221e\n\u2223\u2223\u2223\u2223 1\nhn |NBn(x)|E\n[ an(y)\u2211\nz\u2208NBn(x) an(z) f(y \u2212 x) | y 6= x\n]\n\u2212 1 hn\n\u222b\ny\u2208B(x,\u03b5n(x)) f(y \u2212 x) p(y)a(y)\u222b z\u2208B(x,\u03b5n(x)) p(z)a(z)dz dy\n\u2223\u2223\u2223\u2223 = 0.\nProof. By the continuity of p and a.s. eventual equicontinuity of an(y), we have supy\u2208B(x,\u03b5n(x)) |an(y)p(y)\u2212 an(x)p(x)| \u2192 0 and supy\u2208B(x,\u03b5n(x)) |p(y)\u2212 p(x)| \u2192 0. These together imply\n\u222b y\u2208B(x,\u03b5n(x)) an(y)p(y)dy\u222b\ny\u2208B(x,\u03b5n(x)) p(y)dy a.s.\u2212\u2212\u2192 a(x). (6)\nBecause an(x) \u2192 a(x) uniformly in x, for any \u03b4 > 0, we may choose n0 so that for n > n0, we have |an(x) \u2212 a(x)| < \u03b4/2 and \u03b5n(x) is small enough so that if |y \u2212 x| < \u03b5n(x), then |a(y) \u2212 a(x)| < \u03b4/2. For n > n0, we then have\nsup z\u2208NBn(x) |an(z)\u2212 a(x)| \u2264 sup z\u2208NBn(x) |an(z)\u2212 a(z)|+ |a(z)\u2212 a(x)| < \u03b4.\nThis shows that supz\u2208NBn(x) |an(z)\u2212 a(x)| \u2192 0 and therefore \u2211 z\u2208NBn(x) an(z)\n|NBn(x)| a.s.\u2212\u2212\u2192 a(x). (7)\nApplying (6) and (7), we find that\nlim n\u2192\u221e\n\u2223\u2223\u2223\u2223 1\nhn |NBn(x)|E\n[ an(y)\u2211\nz\u2208NBn(x) an(z) f(y \u2212 x) | x 6= y\n]\n\u2212 1 hn\nE [an(y)f(y \u2212 x) | x 6= y] \u222b y\u2208B(x,\u03b5n(x)) p(y)dy\u222b\ny\u2208B(x,\u03b5n(x)) an(y)p(y)dy\n\u2223\u2223\u2223\u2223\u2192 0.\nWe apply the argument of (Hashimoto et al., 2015, Lemma 3.2) to this iterated expectation to obtain\nlim n\u2192\u221e\n\u2223\u2223\u2223\u2223 1\nhn E [an(y)f(y \u2212 x) | x 6= y]\n\u222b y\u2208B(x,\u03b5n(x)) p(y)dy\u222b\ny\u2208B(x,\u03b5n(x)) an(y)p(y)dy\n\u2212 1 hn\n\u222b\ny\u2208B(x,\u03b5n(x)) f(y \u2212 x) p(y)a(y)\u222b z\u2208B(x,\u03b5n(x)) p(z)a(z)dz dy\n\u2223\u2223\u2223\u2223\u2192 0.\nEvaluating the integrals for f(x) = x and f(x) = x2 in Lemma S4.3 implies that the expected value of an increment of the reweighted walk across all draws of Xn limits to \u2207 log[p(x)a(x)]/3 and the expected variance of the increment limits to \u03b5(x)2b(x)/3. However, in order to apply the Stroock-Varadhan criteria we require that this hold with high probability over all draws of Xn. Lemma S4.4 (Strong LLN for local moments). For a function f(x) such that supx\u2208B(0,\u03b5) |f(x)| < \u03b5 for small \u03b5 > 0, we have a.s. that\nlim n\u2192\u221e\n\u2223\u2223\u2223\u2223 1\nhn\n\u2211\ny\u2208NBn(x)\nan(y)\u2211 z\u2208NBn(x) an(z) f(y \u2212 x)\u2212 1 hn\n\u222b\ny\u2208B(x,\u03b5n(x)) f(y \u2212 x) p(y)a(y)\u222b z\u2208B(x,\u03b5n(x)) p(z)a(z)dz dy\n\u2223\u2223\u2223\u2223 = 0.\nProof. Define the quantity\n\u00b5(x) = 1\nhn\n\u222b\ny\u2208B(x,\u03b5n(x)) f(y \u2212 x) p(y)a(y)\u222b z\u2208B(x,\u03b5n(x)) p(z)a(z)dz dy.\nWe wish to bound\npn(t) = P   \u2223\u2223\u2223\u2223 1\nhn\n\u2211\ny\u2208NBn(x)\nan(y)\u2211 z\u2208NBn(x) an(z)\nf(y \u2212 x)\u2212 \u00b5(x) \u2223\u2223\u2223\u2223 \u2265 t   . (8)\nBy a.s. eventual equicontinuity of an(y), we have for some c > 0 and large enough n that\nan(y)\u2211 z\u2208NBn(x) an(z) \u2264 c 1|NBn(x)| .\nBy the construction of \u03b5n(x), if |y \u2212 x| < \u03b5n(x), then |f(y \u2212 x)| \u2264 \u03b5n(x). Combining these two we apply Hoeffding\u2019s inequality to obtain that\npn(t) \u2264 2 exp ( \u22122h\n2 n|NBn(x)|2c2t2 |NBn(x)|\u03b5n(x)2\n) = o(n\u22122t 2\u03c9(1)), (9)\nwhere we use that |NBn(x)| = \u03c9 ( n2/(d+2) log(n)d/(d+2) ) . This completes the proof by Borel-Cantelli."}, {"heading": "5 Consistency at \u03b2 = \u03c9(log(gdnn)) via shortest paths", "text": "Definition S5.1. Define the f -length of any path \u03b3 \u2282 D as given in (Alamgir & von Luxburg, 2012) as\nDf,\u03b3 =\n\u222b\n\u03b3\nf(\u03b3(t))|\u03b3\u2032(t)|dt.\nLet the f -distance from x to y be the minimum path length between two points\nDf (x, y) = min \u03b3\u2208C1,\u03b3(0)=x,\u03b3(1)=y Df,\u03b3 .\nTheorem S5.2. Let \u03b2 = \u03c9(log(gdnn)), then for f(x) = \u03b5(x) \u22121 we have\n\u2212 log(E[exp(\u2212\u03b2T xixj ,n)])/\u03b2gn \u2192 Df (xi, xj).\nProof. Define Hij(t) to be the probability of not hitting xj by step t, and Pij(t) to be the probability of going from xi to xj in exactly t steps. The expected value is the series\n\u2212 log(E[exp(\u2212\u03b2T xixj ,n)])/\u03b2gn = \u2212\u03b2\u22121gn log ( \u221e\u2211\nt=0\nPij(t)Hij(t) exp(\u2212\u03b2t) ) .\nNow, let Dij be the length of the shortest path from i to j. By definition Hij(Dij) = 1 and\n\u2212 log(E[exp(\u2212\u03b2T xixj ,n)])/\u03b2gn = Dijgn\u2212log(Pij(Dij)) gn \u03b2 \u2212log\n 1 + \u221e\u2211\nt=Dij+1\nPij(t)\nPij(Dij) Hij(t) exp(\u2212\u03b2(t\u2212Dij))\n  gn\n\u03b2 .\nThis forms the upper bound\n\u2212 log(E[exp(\u2212\u03b2T xixj ,n)])/\u03b2gn \u2264 Dijgn \u2212 log(Pij(Dij)) gn \u03b2 .\nThe probability Pij(Dij) of hitting xj in exactly Dij steps is lower bounded by (g d nn) \u2212Dij since by definition at least one path exists. This implies that log(Pij(Dij)) = o(g \u22121 n log(g d nn)) and therefore\nDijgn \u2264 \u2212 log(E[exp(\u2212\u03b2T xixj ,n)])/\u03b2gn \u2264 Dijgn \u2212 o(1),\nwhere the lower bound follows because it is impossible to reach vertex xj in less than Dij steps. By (Alamgir & von Luxburg, 2012) for the k-nearest neighbor case and (Hashimoto et al., 2015) with Lemma S6.3 for the other cases of a spatial graph, Dijgn converges to the f -distance defined by \u03b5(x) \u22121, completing the proof."}, {"heading": "6 Consistency of LTHT", "text": "In this section, we prove some results needed in the proof of Theorem 4.5."}, {"heading": "6.1 LTHT of the Brownian motion", "text": "Lemma S6.1. Let Wt be a Brownian motion with W0 = xi. Let T xi B(xj ,s) be the hitting time of Wt to B(xj , s). For any \u03b1 < 0, if \u03b2\u0302 = s \u03b1, as s\u2192 0 we have\n\u2212 log(E[exp(\u2212\u03b2\u0302T xiB(xj ,s))])/ \u221a 2\u03b2\u0302 \u2192 |xi \u2212 xj |.\nProof of Lemma 6.1. Let Bt = |Wt| be the order \u03bd = d/2\u2212 1 Bessel process. The LTHT of Bt to hit xj \u00b1 s is equivalent to the LTHT of Wt to hit B(xj , s). Defining w = |xi \u2212 xj |, by (Borodin & Salminen, 2002, Eq 4.2.0.1), this is:\nE[exp(\u2212\u03b2\u0302T xiB(xj ,s))] = K(\u03bd, w\n\u221a 2\u03b2\u0302)w\u2212\u03bd\nK(\u03bd, s \u221a 2\u03b2\u0302)s\u2212\u03bd ,\nwhere K(\u03bd, w) is a modified Bessel function of the second kind. Write \u2212 log(E[exp(\u2212\u03b2\u0302T xiB(xj ,s))])/ \u221a\n2\u03b2\u0302 = c1 + c2 for\nc1 = \u2212 log(K(\u03bd, w \u221a 2\u03b2\u0302)w\u2212\u03bd)/ \u221a 2\u03b2\u0302 c2 = \u2212 log(K(\u03bd, s \u221a 2\u03b2\u0302)s\u2212\u03bd)/ \u221a 2\u03b2\u0302.\nTaylor expansion of c1 at \u03b2\u0302 \u22121 = 0 yields\nc1 = w \u2212 log(\u03c02/(8\u03b2\u0302)) + 4 log(w\u22121/2\u2212\u03bd)\n4 \u221a 2\u03b2\u0302\n+ o\n( \u03bd2\nw\u03b2\u0302\n) ,\nhence c1 \u2192 w. For c2, note that \u03bd log(s)/ \u221a 2\u03b2\u0302 \u2192 0 and for s small,\nK(\u03bd, s \u221a 2\u03b2\u0302) \u223c    \u2212 log(s \u221a 2\u03b2\u0302) d = 2\n1 2\u0393(s \u221a 2\u03b2\u0302)( 12s \u221a 2\u03b2\u0302)\u2212\u03bd d > 2 .\nby (Abramowitz & Stegun, 1972, p375). Checking that \u2212 log(K(\u03bd, s \u221a 2\u03b2\u0302))/ \u221a 2\u03b2\u0302 \u2192 0 and combining estimates gives \u2212 log(E[exp(\u2212\u03b2\u0302T xiB(xj ,s))])/ \u221a 2\u03b2\u0302 = c1 + c2 \u2192 w."}, {"heading": "6.2 Proof of Corollary 4.4", "text": "We prove here Corollary S6.2. We recall the setup. For points xi, xj \u2208 Gn and s > 0, T\u0302 xiB(xj ,s) is the hitting time of the de-biased walk on Gn from xi to NB s n(xj). In the continuous setting, T xi B(xj ,s) is the hitting time of Brownian motion with reflecting boundary conditions in D from xi to B(xj , s). We would like to show the following.\nCorollary S6.2. For s > 0, we have g2nT\u0302 xi B(xj ,s) d\u2192 T xiB(xj ,s).\nOur proof consists of two steps. First, we show that hitting NBsn(xj) is equivalent to hitting B(xj , s) with the discrete walk. Second, we use S4.2 to show convergence in distribution of this second hitting time. We require a few lemmas.\nLemma S6.3. For any \u03b4 > 0 and s > 0 so that B(xj , s+ \u03b4) \u2282 D, we have with high probability that\nXn \u2229B(xj , s\u2212 \u03b4) \u2282 NBsn(xj) \u2282 B(xj , s+ \u03b4).\nProof. Recall that NBsn(xj) is defined as\nNBsn(x) := {y | there is a path x\u2192 y of \u03b5\u0302-weight \u2264 s}.\nThe estimator \u03b5\u0302(x) is appropriately scaled such that \u03b5\u0302(x) \u2192 \u03b5(x) uniformly and almost surely. Thus, we need to show that \u03b5\u0302-weighted shortest path distance converges to true shortest path distance up to error \u0398(gn).\nWe first present the simpler case of a constant kernel h(x) \u2261 1 over [0, 1]; this includes the k-nearest neighbor and \u03b5-ball cases. Let Dij be the minimum \u03b5\u0302-weight of a path from xi to xj . The proof of (Hashimoto et al., 2015, Theorem S4.5) shows that in this case\n\u2223\u2223\u2223|xi \u2212 xj | \u2212Dijgn \u2223\u2223\u2223 \u2264 \u03b5n(xj). (10)\nIf xk \u2208 Xn \u2229 B(xj , s \u2212 \u03b4), this implies that Djkgn \u2192 |xk \u2212 xj | \u2264 s \u2212 \u03b4. Therefore Djkgn \u2264 s with high probability and xk \u2208 NBsn(xj). If xk \u2208 NBsn(xj), this implies that Dik \u2264 s. By Equation (6.2), we have s \u2265 Dijgn \u2192 |xi \u2212 xj |. Therefore xk \u2208 B(xj , s+ \u03b4) with high probability.\nThe proof for the case of generic h(x) is closely analogous. The same proof as used for (Hashimoto et al., 2015, Theorem S4.5) shows that there exists some k such that |xk \u2212 xj | \u2264 \u03b5n(xk) such that\n\u2223\u2223\u2223\u2223|xi \u2212 xj | \u2212Dikgn \u2223\u2223\u2223\u2223 \u2264 \u03b5n(x).\nAt this stage, a difference arises. The proof of (Hashimoto et al., 2015, Theorem S4.5) bounds the number of steps necessary to reach distance \u03b5n(xj) to the target, but for a general choice of h(x) this does not guarantee that we can reach xj .\nFor general h(x), we instead show that two extra jumps are sufficient. Because h(1) > 0 and h is continuous at 1, there exists some interval (c1, 1) and some c2 > 0 such that\ninf x\u2208(c1,1) h(x) > c2.\nThis annulus will yield a lower bound on the true connectivity. If |xi \u2212 xj | \u2264 \u03b5n(xi), then the probability that there is some point xk such that the path xi \u2192 xk \u2192 xj exists in Gn is governed by\nP(Dij > 2) = (1\u2212 c2)2|NBn(xi)\u2229NB in n (xj)|\nwhere |NBn(xi) \u2229 NBinn (xj)| \u223c Pois(gdnn\u03c4(xi \u2212 xj))\nand \u03c4(z) is the total overlapping density between the connectivity kernel of xi and xj . This is lower bounded by the annulus; for any d > 2 the annuli have nonzero overlap volume and\n\u03c4(z) \u2265 c22 \u222b\nx\u2208B(0,1) 11>|x|>c111>|1\u2212x|>c1dx \u2265 0.\nThis implies that |NBn(xi) \u2229 NBinn (xj)| = \u0398(k) with high probability and therefore\nP(Dij > 2) = (1\u2212 c2)2|NBn(xi)\u2229NB in n (xj)| \u2192 0.\nThus, there exists a two step path from xi to xj whenever |xi \u2212 xj | < \u03b5n(xi). Combined with the analogue of (Hashimoto et al., 2015, Theorem S4.5), this shows that with high probability there is a walk of \u03b5\u0302-weight at most |xi \u2212 xk|+ 2\u03b5n(xk) from xi to xk. We conclude in the same way as in the constant kernel case.\nWe now require a lemma on the continuity of functions on Skorokhod space. For this, we recall the metric which induces the relevant topology on Skorokhod space. Let \u039b be the set of strictly increasing continuous bijections [0,\u221e)\u2192 [0,\u221e). The Skorokhod metric on D([0,\u221e), D) and D([0,\u221e),R\u22650) is given by\n\u03c3(f, g) = inf \u03bb\u2208\u039b\nmax{||\u03bb\u2212 id||, ||f \u2212 g \u25e6 \u03bb||},\nwhere || \u00b7 || denotes the sup-norm on the relevant space. Lemma S6.4. Let B \u2282 D be any ball and T xB the hitting time from x to B of Brownian motion with reflecting boundary condition in D. As a map D([0,\u221e), D) \u2192 R\u22650, the hitting time T x\nB is continuous on the subset of C([0,\u221e), D) of paths whose hitting time to B is finite. Proof. Denote by CB the subset of C([0,\u221e), D) of paths whose hitting time to B is finite. We first claim that the function dB : D([0,\u221e), D)\u2192 D([0,\u221e),R\u22650) given by composition with the function dB : D \u2192 B giving the distance to B is continuous. For any \u03b5 > 0, pick \u03b4 by uniform continuity of dB so that \u03b4 < \u03b5 and if |x\u2212 y| < \u03b4, then |dB(x)\u2212 dB(y)| < \u03b5. If \u03c3(f, g) < \u03b4, we have\n\u03c3(dB(f), dB(g)) = inf \u03bb\u2208\u039b\nmax{||\u03bb\u2212 id||, ||dB \u25e6 f \u2212 dB \u25e6 g \u25e6 \u03bb||}.\nBecause \u03c3(f, g) < \u03b4, we may find \u03bb \u2208 \u039b so that ||f \u2212 g \u25e6 \u03bb|| < \u03b4 and ||\u03bb\u2212 id|| < \u03b4. By our choice of \u03b4, this implies that max{||\u03bb\u2212 id||, ||dB \u25e6 f \u2212 dB \u25e6 g \u25e6 \u03bb||} < \u03b5 and therefore that \u03c3(dB(f), dB(g)) < \u03b5, establishing continuity.\nNow, the image of CB under dB is the subset C0 of C([0,\u221e),R\u22650) of paths whose hitting time to 0 is finite. By (Whitt, 1980, Theorem 7.1), the first passage time to 0 is continuous on C0. The hitting time T x\nB\nis the composition of the first passage time and dB , hence is continuous on CB as claimed.\nLemma S6.5. Let B \u2282 D be any ball containing at least one point of Gn. For xi \u2208 Gn, let T xiB,n be the hitting time from xi to B of the de-biased random walk on G. Then g 2 nT\u0302 xi B,n\nd\u2192 T xB. Proof. First, note that both the de-biased random walk and Brownian motion with reflecting boundary condition started at xi have a.s. finite hitting time to B. By Lemma S6.4, the hitting time to B is a.s. continuous on the subset of D([0,\u221e), D) containing their trajectories. The desired convergence in distribution then follows from Corollary S4.2, the continuous mapping theorem (see (Whitt, 1980, Section 1)), and noting the time-rescaling used in Corollary S4.2.\nProof of Corollary S6.2. Recall that T xiB(xj ,p),n is the hitting time of the simple random walk on Gn to B(xj , p). By Lemma S6.3, for any \u03b4 > 0, we have with high probability that\nT xiB(xj ,s+\u03b4),n \u2264 T\u0302 xi B(xj ,s),n \u2264 T xiB(xj ,s\u2212\u03b4),n.\nApplying Lemma S6.5 to B(xj , s\u00b1 \u03b4), we see that\ng2nT xi B(xj ,s\u00b1\u03b4),n d\u2192 T xiB(xj ,s\u00b1\u03b4),\nwhich shows that T xi B(xj ,s\u2212\u03b4) \u2264 limn\u2192\u221e g 2 nT\u0302 xi B(xj ,s),n\n\u2264 T xiB(xj ,s+\u03b4) for all \u03b4 > 0. Sending \u03b4 \u2192 0 yields the result."}, {"heading": "6.3 Proof of Theorem 4.5", "text": "We prove here Theorem 6.6. Recall we chose an estimator \u03b5\u0302(x)\u2192 \u03b5(x). Theorem S6.6. Let xi and xj be points in Gn connected by a geodesic not intersecting \u2202D. For any \u03b4 > 0, there exists a choice of \u03b2\u0302 and s > 0 so that if \u03b2 = \u03b2\u0302g2n, we have for large n with high probability that \u2223\u2223\u2223\u2223\u2212 log(E[exp(\u2212\u03b2T\u0302 xi B(xj ,s),n )])/ \u221a 2\u03b2\u0302 \u2212 |xi \u2212 xj | \u2223\u2223\u2223\u2223 < \u03b4.\nOur proof will proceed by converting to the continuous setting by Corollary 6.2 and then reducing to the case of Brownian motion without boundary which was analyzed in Lemma 6.1. Because we are in the setting of Brownian motion with reflecting boundary conditions, we must apply the \u201cprinciple of not feeling the boundary\u201d to show that our results are unaffected by it. For this, we define some events to condition on.\nLet G be the geodesic from xi to xj , and for a distance scale \u03c1, let G(\u03c1) be the set of all points of distance less than \u03c1 from G. Choose \u03c1 small enough so that G(\u03c1) \u2282 D. For a distance s > 0, let Bt be a Brownian motion without boundary started at xi, and let T xi B(xj ,s) be its hitting time to B(xj , s). For a time t\n? > 0, define the following events:\n\u2022 let E1 be the event that T xi B(xj ,s) < t ?;\n\u2022 let E2 be the event that E1 holds and Bt hits B(xj , s) before G(\u03c1); \u2022 let E3 and E4 denote the analogous events for Brownian motion with boundary.\nNotice that P(E2) = P(E4). In the rest of this section, we will consider the scalings t? = s\u03b3 and \u03b2\u0302 = s\u03b1 for some \u03b3 > 0 and \u03b1 < 0 so that \u03b1+ \u03b3 > 0, so that \u03b2\u0302t? \u2192\u221e as s\u2192 0.\nLet pRt (x, y), p K t (x, y), p G t (x, y), and p F t (x, y) be the transition density of Brownian motion started at x and run for time t with reflecting boundary condition, killed at \u2202D, killed at \u2202G(\u03c1), and no boundary condition, respectively. For ? \u2208 {R,K,G, F}, let h?(T ) be the probability that the respective process hits B(xj , s) before time T , and let h\n?(t, x) be the density of hitting at x \u2208 B(xj , s) at time t. Note that pKt (x, y) \u2264 pRt (x, y), pKt (x, y) \u2264 pFt (x, y), and pGt (x, y) \u2264 pFt (x, y). We have the following three lemmas, which are instances of \u201cthe principle of not feeling the boundary.\u201d\nLemma S6.7. For x, y a distance at least \u03c1\u2032 > 0 to \u2202G(\u03c1), there are constants t0 > 0 and \u03bb > 0 dependent only on \u03c1 so that for t < t0, we have\npGt (x, y)\npFt (x, y) \u2265 1\u2212 e\u2212\u03bbt\u22121 .\nProof. This follows from (Hsu, 1995, Theorem 1.2) and the results of (Varadhan, 1967).\nLemma S6.8. For x, y a distance at least \u03c1\u2032 > 0 to \u2202D, there are constants t0 > 0 and \u03bb > 0 dependent only on \u03c1 so that for t < t0, we have\npKt (x, y)\npFt (x, y) \u2265 1\u2212 e\u2212\u03bbt\u22121 .\nProof. This follows from (Hsu, 1995, Theorem 1.2) and the results of (Varadhan, 1967).\nLemma S6.9. For x, y a distance at least \u03c1\u2032 > 0 to \u2202D, there are constants t0 > 0 and \u03bb > 0 dependent only on \u03c1 so that for t < t0, we have\npKt (x, y)\npRt (x, y) \u2265 1\u2212 e\u2212\u03bbt\u22121 .\nProof. Note that our domainD is a Lipschitz domain in the sense of (Bass & Hsu, 1991, Section 3). Therefore, by (Bass & Hsu, 1991, Theorem 3.1, Theorem 3.4, and Remark 3.11), the reflecting Brownian motion in D has transition density pRt (x, y) satisfying\nC1t \u2212d/2e\u2212c1 |x\u2212y|2 t \u2264 pRt (x, y) \u2264 C2t\u2212d/2e\u2212c2 |x\u2212y|2 t (11)\nfor constants c1, c2, C1, C2 and small enough t. This verifies the conditions of (Hsu, 1995, Theorem 1.2), yielding the conclusion.\nWe now prove a general lemma on when the probability of hitting B(xj , s) before a time t ? is asymptot-\nically equal for two processes.\nLemma S6.10. Let Q be a diffusion process with transition densities pQt (x, y), and let p K t (x, y) of Q killed at some boundary. If for some \u03bb > 0 and small enough s, we have for all t < t? and x, y \u2208 B that\n1 \u2265 p K t (xi, x) pQt (xi, x) \u2265 1\u2212 e\u2212\u03bbt\u22121 and 1 \u2265 p K t (x, y) pQt (x, y) \u2265 1\u2212 e\u2212\u03bbt\u22121 ,\nthen the probabilities hK(t?) and hQ(t?) that K and Q hit B(xj , s) before t ? are asymptotically equal.\nProof. Let B = B(xj , s), and consider s small enough so that B(xj , s) \u2282 D. For x \u2208 B and t > 0, let hK(t, x) and hQ(t, x) be the densities of the first passage time to B, and let hK(T ) and hQ(T ) be the probabilities that the respective first passage times are at most T . Note that hK(t, x) \u2264 hQ(t, x). For ? \u2208 {K,Q}, we have\nh?(t, x) = p?t (xi, x)\u2212 \u222b t\n0\n\u222b\ny\u2208B p?t\u2212\u03c4 (y, x)h ?(\u03c4, y)dyd\u03c4\nso we may integrate to obtain\nh?(T ) =\n\u222b T\n0\n\u222b\nx\u2208B p?t (xi, x)dtdx\u2212\n\u222b T\n0\n\u222b t\n0\n\u222b\nx,y\u2208B p?t\u2212\u03c4 (y, x)h ?(\u03c4, y) dydxd\u03c4dt. (12)\nDefine the differences d(T ) := hQ(T )\u2212hK(T ), d(t, x) = hQ(t, x)\u2212hK(t, x), and et(x, y) := pQt (x, y)\u2212pKt (x, y). By assumption, if x = xi or x, y \u2208 B, we have\net(x, y) \u2264 e\u2212\u03bbt \u22121 pQt (x, y).\nSubtracting (12) for ? \u2208 {K,Q}, we obtain\nd(T ) =\n\u222b T\n0\n\u222b\nx\u2208B et(xi, x)dtdx+\n\u222b T\n0\n\u222b t\n0\n\u222b\nx,y\u2208B et\u2212\u03c4 (y, x)h\nK(\u03c4, y) dydxd\u03c4dt\n+\n\u222b T\n0\n\u222b t\n0\n\u222b\nx,y\u2208B pKt\u2212\u03c4 (y, x)d(\u03c4, y) dydxd\u03c4dt\n\u2264 \u222b T\n0\n\u222b\nx\u2208B e\u2212\u03bbt \u22121 pQt (xi, x)dtdx+\n\u222b T\n0\n\u222b t\n0\n\u222b\nx,y\u2208B e\u2212\u03bb(t\u2212\u03c4) \u22121 pQt\u2212\u03c4 (y, x)h K(\u03c4, y) dydxd\u03c4dt\n+\n\u222b T\n0\n\u222b t\n0\n\u222b\ny\u2208B d(\u03c4, y)d\u03c4dtdy\n\u2264 \u222b T\n0\ne\u2212\u03bbt \u22121 dt+\n\u222b T\n0\n\u222b t\n0\n\u222b\ny\u2208B e\u2212\u03bb(t\u2212\u03c4) \u22121 hK(\u03c4, y) dyd\u03c4dt+\n\u222b T\n0\nd(\u03c4)d\u03c4\n\u2264 2 \u222b T\n0\ne\u2212\u03bbt \u22121 dt+\n\u222b T\n0\nd(\u03c4)d\u03c4\n\u2264 2Te\u2212\u03bbT\u22121 + \u222b T\n0\nd(\u03c4)d\u03c4.\nBy Gronwall\u2019s inequality, this implies that\nd(T ) \u2264 2Te\u2212\u03bbT\u22121 + 2 \u222b T\n0\n\u03c4e\u2212\u03bb\u03c4 \u22121 (T \u2212 \u03c4)d\u03c4 \u2264 2(T + T 3)e\u2212\u03bbT\u22121 .\nWe conclude that lim s\u2192\u221e d(t?) = lim s\u2192\u221e hQ(t?)\u2212 hK(t?) = 0.\nLemma S6.11. As s\u2192 0, we have P(E2 | E1)\u2192 1.\nProof. Let B = B(xj , s). By Lemma 6.7 with \u03c1 \u2032 small enough, we have for some \u03bb > 0 and small enough s that for all t < t? and x, y \u2208 B that\npGt (xi, x)\npFt (xi, x) \u2265 1\u2212 e\u2212\u03bbt\u22121 and p\nG t (x, y)\npFt (x, y) \u2265 1\u2212 e\u2212\u03bbt\u22121 .\nNotice that P(E2) is the probability that the Brownian motion killed at G(\u03c1) hits B before t? and P(E1) is the probability that the free Brownian motion hits B before t?. Therefore, Lemma 6.10 implies that\nlim s\u21920 P(E1) = lim s\u21920 P(E2),\nfrom which we conclude that\nlim s\u21920 P(E2 | E1) = lim s\u21920 P(E2) P(E1) = 1.\nLemma S6.12. As s\u2192 0, we have P(E4 | E3)\u2192 1.\nProof. Applying Lemma 6.10 twice using Lemmas 6.9 and 6.8 implies that\nlim s\u2192\u221e P(E1) = lim s\u2192\u221e hF (t?) = lim s\u2192\u221e hK(t?) = lim s\u2192\u221e hR(t?) = lim s\u2192\u221e P(E3).\nWe conclude from Lemma 6.11 that\nlim s\u2192\u221e P(E4 | E3) = lim s\u2192\u221e P(E4) P(E3) = lim s\u2192\u221e P(E2) P(E1) = lim s\u2192\u221e P(E2 | E1) = 1.\nProof of Theorem 6.6. Throughout this proof, we will take t? = s\u03b3 and \u03b2\u0302 = s\u03b1 for some fixed \u03b1 < 0 and \u03b3 > 0 so that \u03b1+ \u03b3 > 0. We will pick a small s > 0 at the end of the proof. Bounding the effect of conditioning on E4 on the process with boundary: By Corollary 6.2, for any \u03b2\u0302 we have that\n\u2212 log(E[exp(\u2212\u03b2\u0302g2nT\u0302 xiB(xj ,s),n)])/ \u221a 2\u03b2\u0302 d\u2192 \u2212 log(E[exp(\u2212\u03b2\u0302T xiB(xj ,s))])/ \u221a 2\u03b2\u0302.\nConditioning on E3 and E4, we see that\nE[exp(\u2212\u03b2\u0302T xiB(xj ,s))] = E[exp(\u2212\u03b2\u0302T xi B(xj ,s)) | Ec3]P(Ec3)\n+ E[exp(\u2212\u03b2\u0302T xiB(xj ,s)) | E4]P(E4) + E[exp(\u2212\u03b2\u0302T xiB(xj ,s)) | E3 \u2229 Ec4]P(Ec4 | E3)P(E3).\nBy definition of E3, we have 0 \u2264 E[exp(\u2212\u03b2\u0302T xi B(xj ,s)) | Ec3]P(Ec3) \u2264 e\u2212\u03b2\u0302t ? . By the trivial bound exp(\u2212\u03b2\u0302T xiB(xj ,s)) \u2264 1, we find that\n0 \u2264 E[exp(\u2212\u03b2\u0302T xiB(xj ,s)) | E3 \u2229 Ec4]P(Ec4 | E3)P(E3) \u2264 1\u2212 P(E4 | E3).\nBy Lemma 6.12, for any \u03c4 > 0, for small enough s > 0 we have e\u2212\u03b2\u0302t ? < \u03c4 and 1 \u2212 P(E4 | E3) < \u03c4 . Noting also that P(E4) = P(E2) and E[exp(\u2212\u03b2\u0302T xi B(xj ,s)) | E4] = E[exp(\u2212\u03b2\u0302T\u0302 xi B(xj ,s)\n) | E2], we conclude for small enough s that \u2223\u2223\u2223E[exp(\u2212\u03b2\u0302T xiB(xj ,s))]\u2212 E[exp(\u2212\u03b2\u0302T\u0302 xi B(xj ,s) ) | E2]P(E2) \u2223\u2223\u2223 < 2\u03c4. (13)\nBounding the effect of conditioning on E2 on the process without boundary: We now compare to the computations for Brownian motion without boundary. By conditioning on E1 and E2, we have that\nE[exp(\u2212\u03b2\u0302T\u0302 xiB(xj ,s))] = E[exp(\u2212\u03b2\u0302T\u0302 xi B(xj ,s) ) | Ec1]P(Ec1) + E[exp(\u2212\u03b2\u0302T\u0302 xiB(xj ,s)) | E2]P(E2) + E[exp(\u2212\u03b2\u0302T\u0302 xiB(xj ,s)) | E1 \u2229 E c 2] (1\u2212 P(E2 | E1))P(E1).\nWe again note that\n0 \u2264 E[exp(\u2212\u03b2\u0302T\u0302 xiB(xj ,s)) | E c 1]P(Ec1) \u2264 e\u2212\u03b2\u0302t ?\nand 0 \u2264 E[exp(\u2212\u03b2\u0302T\u0302 xiB(xj ,s)) | E1 \u2229 E c 2] (1\u2212 P(E2 | E1))P(E1) \u2264 1\u2212 P(E2 | E1). These together with Lemma 6.11 imply that for any \u03c4 > 0, for small enough s > 0 we have that e\u2212\u03b2\u0302t ?\n< \u03c4 and 1\u2212 P(E2 | E1) < \u03c4 . We conclude for small enough s that\n\u2223\u2223\u2223E[exp(\u2212\u03b2\u0302T\u0302 xiB(xj ,s))]\u2212 E[exp(\u2212\u03b2\u0302T\u0302 xi B(xj ,s) ) | E2]P(E2) \u2223\u2223\u2223 < 2\u03c4. (14)\nCombining (13) and (14), we conclude for small enough s that \u2223\u2223\u2223E[exp(\u2212\u03b2\u0302T xiB(xj ,s))]\u2212 E[exp(\u2212\u03b2\u0302T\u0302 xi B(xj ,s) )] \u2223\u2223\u2223 < 4\u03c4. (15)\nAggregating the estimates: To conclude, for any \u03b4 > 0 and \u03b2\u03020 > 0, choose \u03c4 > 0 small enough so that if |x\u2212 y| < 4\u03c4 , then for all \u03b2\u0302 > \u03b2\u03020, we have\n\u2223\u2223\u2223\u2223log(x)/ \u221a 2\u03b2\u0302 \u2212 log(y)/ \u221a 2\u03b2\u0302 \u2223\u2223\u2223\u2223 < \u03b4/3.\nNow, choose s > 0 small enough and n large enough so that \u03b2\u0302 > \u03b2\u03020, and for this \u03c4 , we have:\n\u2022 by our previous discussion, (15) holds; \u2022 by Lemma S6.1, we have\n\u2223\u2223\u2223\u2223\u2212 log(E[exp(\u2212\u03b2\u0302T\u0302 xi B(xj ,s) )])/ \u221a 2\u03b2\u0302 \u2212 |xi \u2212 xj | \u2223\u2223\u2223\u2223 < \u03b4/3;\n\u2022 by Corollary S6.2, we have \u2223\u2223\u2223\u2223\u2212 log(E[exp(\u2212\u03b2\u0302T xi B(xj ,s))])/ \u221a 2\u03b2\u0302 + log(E[exp(\u2212\u03b2\u0302g2nT\u0302 xiB(xj ,s),n)])/ \u221a 2\u03b2\u0302 \u2223\u2223\u2223\u2223 < \u03b4/3.\nFor these choices of \u03c4 , s, and n, we have by (15) that \u2223\u2223\u2223\u2223log(E[exp(\u2212\u03b2\u0302T xi B(xj ,s))])/ \u221a 2\u03b2\u0302 \u2212 log(E[exp(\u2212\u03b2\u0302T\u0302 xiB(xj ,s))])/ \u221a 2\u03b2\u0302 \u2223\u2223\u2223\u2223 < \u03b4/3.\nCombining the last three inequalities yields the desired \u2223\u2223\u2223\u2223log(E[exp(\u2212\u03b2\u0302g2nT xi B(xj ,s),n)])/ \u221a 2\u03b2\u0302 \u2212 |xi \u2212 xj | \u2223\u2223\u2223\u2223 < \u03b4."}, {"heading": "7 1-D bias calculation", "text": "We repeat the full theorem statement and proof for the bias characterization.\nTheorem S7.1. Let T xixj be the hitting time to xj of a 1-dimensional Ito\u0302 process with drift \u00b5(x) = \u2202 log(p(x)) \u2202x \u03b5 2(x) and diffusion \u03b52(x) started at xi with reflecting boundary \u03b3 for \u03b3 < xi < xj. The Laplace transform of T xi xj admits the asymptotic expansion\nE[\u2212 exp(\u03b2T xixj )] = c1\nf(xi)1/4p(xi) exp\n( \u2212 \u221a \u03b2 \u222b xj xi \u221a f(s)ds ) ( 1 + ( 1 + o\n( 1\u221a \u03b2 )) exp ( \u22122 \u221a \u03b2 \u222b xi \u03b3 \u221a f(x)dx ) + o(exp(\u2212\u03b2)) ) ,\nwhere f(x) = 2\u03b5(x)2 + 1 \u03b2 \u2202 log(p(x)) \u2202x2 + 1 \u03b2\n( \u2202 log(p(x))\n\u2202x\n)2 , and c1 is a normalization constant depending on p, \u03b5,and\nj to make E[\u2212\u03b2T xixj ] = 1.\nProof. Let E[exp(\u2212\u03b2T xixj )] = u(xi), where u(x) is the hitting time to xj from point x. By Feynman-Kac, this is\n\u22022u \u2202x2 + 2 \u2202 log(p(x)) \u2202x \u2202u \u2202x + q(x)u = 0,\nwhere q(x) = \u22122\u03b2\u03b5(x)\u22122. Rewrite this as a perturbation of a second order ODE via the change of variables to obtain\ny(x) = u(x) exp\n(\u222b x\n\u03b3\n\u2202 log(p(y))\n\u2202y dy\n) = u(x)p(x)p(\u03b3)\u22121\nf(x) = 2\n\u03b5(x)2 +\n1\n\u03b2\n( \u2202 log(p(x))\n\u2202x2 +\n( \u2202 log(p(x))\n\u2202x\n)2)\n1\n\u03b2\n\u22022y\n\u2202x = f(x)y(x).\nSince this is a type of Schrodinger\u2019s equation with f(x) 6= 0 everywhere we can apply the WKBJ asymptotic expansion (Bender & Orszag, 1999, section 10.1) to obtain\ny(x) = c1\nf(x)1/4 exp\n( \u2212 \u221a \u03b2 \u222b x\nx0\n\u221a f(s)ds ) +\nc2 f(x)1/4 exp\n(\u221a \u03b2 \u222b x\nx0\n\u221a f(s)ds ) + o(exp(\u2212\u03b2)).\nSince we assumed xi < xj and by the boundary condition u(xj) = 1 we have\nu(x) = c2p(\u03b3)\nf(x)1/4p(x) exp\n( \u2212 \u221a \u03b2 \u222b xj x \u221a f(s)ds ) +\nc1p(\u03b3)\nf(x)1/4p(x) exp\n(\u221a \u03b2 \u222b xj x \u221a f(s)ds ) + o(exp(\u2212\u03b2)).\nTo obtain the boundary conditions, note that u\u2032(\u03b3) = 0. Taking the derivative for y(x)p(x), setting to zero and solving for c2 results in\nc2 = c1 exp(\u22122\u221a\u03b2 \u222b xj \u03b3 \u221a f(s)ds)(p(\u03b3)4 \u221a \u03b2f(\u03b3)3/2 + f \u2032(\u03b3))\u2212 f(\u03b3)p\u2032(\u03b3)\n4 \u221a \u03b2f(\u03b3)3/2p(\u03b3)\u2212 p(\u03b3)f \u2032(\u03b3) + 4f(\u03b3)p\u2032(\u03b3) + o(exp(\u2212\u03b2)),\nfrom which we obtain\nc2 = c1 exp\n( \u22122 \u221a \u03b2 \u222b xj \u03b3 \u221a f(s)ds ( 1 + o (\u221a 1 \u03b2 ))) .\nPulling out the \u2212\u221a\u03b2 term, we get\nu(xi) = E[exp(\u2212\u03b2T xixj )] = c1p(\u03b3)\nf(xi)1/4p(xi) exp\n( \u2212 \u221a \u03b2 \u222b xj xi \u221a f(s)ds )\n( 1 + ( 1 + o ( 1\u221a \u03b2 )) exp ( \u22122 \u221a \u03b2 \u222b xi \u03b3 \u221a f(x)dx ) + o(exp(\u2212\u03b2)) ) .\nWe now connect this statement to the discrete walk.\nCorollary S7.2. Let T xiB(xj ,s),n be the discrete hitting time to a s ball around xj where s is selected as given in Theorem S2.13. Then the simple random walk over a graph constructed on density p(x) and scale \u03b5(x) has the following log-LTHT under the boundary conditions of Theorem S4.6\n\u2212 log(E[exp(\u2212\u03b2T xiB(xj ,s),ng 2 n)])/\n\u221a 2\u03b2 \u2192 \u222b xj xi \u221a\u221a\u221a\u221a 1 \u03b5(x) + 1 \u03b2 ( \u2202 log(p(x)) \u2202x2 + ( \u2202 log(p(x)) \u2202x )2) dx\n+ log(p(xi)/p(xj)) + log(f(xi)/f(xj))/4\u221a 2\u03b2 + o(log(1 + e\u2212\n\u221a 2\u03b2)/ \u221a 2\u03b2).\nProof. Taking the logarithm of the result of Theorem 7.1 and noting the initial condition u(xj) = 1 implies that asymptotically we have\nc1 \u221d (\n1\nf(xj)1/4p(xj) (1 + o(e\u22122\n\u221a \u03b2)) )\u22121 \u2192 f(xj)1/4p(xj),\nwhich completes the continuous statement. The convergence of the hitting time to its discrete counterpart follows from Theorem S2.13."}, {"heading": "8 Basic noise resistance", "text": "We give details for the basic noise bound from the main text footnote. Our goal is to prove the following statement about random walks. Theorem S8.1. Let Gn be generated by the noise model of definition 4.7 with \u2211 j qj = o(g 2 n). Then the simple random walk over Gn converges to the same limit as the noiseless case in Theorem 2.2.\nProof. Since the boundaries of both noisy and noiseless graphs are identical, we need only verify the moment conditions in the proof of Theorem 2.2. In particular we require that under any noise q, we have\nlim n\u2192\u221e\ng\u22122n E[Xnt+1 \u2212Xnt |Xnt ] = \u2207 log(p(Xnt ))\u03b5(Xnt )2\nlim n\u2192\u221e\ng\u22122n Cov[X n t+1|Xnt ] = \u03b5(Xnt )2 \u00b7 In\nlim n\u2192\u221e\ng\u22122n E[|Xnt+1 \u2212Xnt |2+\u03b1 | Xnt ] = 0,\nwhich we show in the Lemma S8.2 and S8.3 below. By the Stroock-Varadhan criterion, this implies convergence to Theorem 2.2, as well as any macroscopic quantities such as hitting times, or LTHTs with \u03b2 = \u0398(g2n).\nWe now prove the moment bounds required for convergence of the noisy graph.\nLemma S8.2 (Noisy moments). If the noisy graph Gn is generated by the noise model of Definition 4.7, for any choice of latent noise parameters qj such that \u2211 j qj = o(g 2 n) then we have for \u03b1 > 0 that\nlim n\u2192\u221e\ng\u22122n E[Xnt+1 \u2212Xnt |Xnt ] = \u2207 log(p(Xnt ))\u03b5(Xnt )2\nlim n\u2192\u221e\ng\u22122n Cov[X n t+1|Xnt ] = \u03b5(Xnt )2 \u00b7 In\nlim n\u2192\u221e\ng\u22122n E[|Xnt+1 \u2212Xnt |2+\u03b1 | Xnt ] = 0.\nProof. Let X denote quantities in the noise-free graph. We recall from (Hashimoto et al., 2015, Theorem 3.3) that\nlim n\u2192\u221e\ng\u22122n E[X n t+1 \u2212X n t |X n t = x] = \u2207 log(p(x))\u03b5(x)2\nlim n\u2192\u221e\ng\u22122n Cov[X n t+1|X n t = x] = \u03b5(x) 2 \u00b7 In\nlim n\u2192\u221e\ng\u22122n E[|X n t+1 \u2212X n t |2+\u03b1 | X n t = x] = 0.\nLet q\u0302 = \u2211 i qi so that q\u0302 = o(g 2 n). In the noisy graph, we first check the expectation via\nlim n\u2192\u221e g\u22122n E[Xnt+1 \u2212Xnt | Xnt = x] = lim n\u2192\u221e (1\u2212 q\u0302)g\u22122n E[X n t+1 \u2212X n t | X n t = x] + g \u22122 n\n\u2211\ni\nqi(xi \u2212 x)\n= lim n\u2192\u221e\ng\u22122n E[X n t+1 \u2212X n t |X n t = x]\n= \u2207 log(p(x))\u03b5(x)2.\nThe covariance follows because for all indices i and j we have\nlim n\u2192\u221e\ng\u22122n E[(Xnt+1 \u2212Xnt )i(Xnt+1 \u2212Xnt )j | Xnt = x]\n= lim n\u2192\u221e\n(1\u2212 q\u0302)g\u22122n E[(Xnt+1 \u2212Xnt )i(Xnt+1 \u2212Xnt )j | X n t = x] + g \u22122 n\n\u2211\nk\nqk(xk \u2212 x)i(xk \u2212 x)j\n= lim n\u2192\u221e\ng\u22122n E[(X n t+1 \u2212X n t )i(X n t+1 \u2212X n t )j |X n t = x]\n= \u03b4ij\u03b5(x) 2.\nFinally, the higher moments follow because we have\nlim n\u2192\u221e\ng\u22122n E[|Xnt+1 \u2212Xnt |2+\u03b1 | Xnt = x]\n= lim n\u2192\u221e\ng\u22122n (1\u2212 q\u0302)g\u22122n E[|X n t+1 \u2212X n t |2+\u03b1 | X n t = x] + g \u22122 n\n\u2211\ni\nqi|xi \u2212 x|2+\u03b1\n= lim n\u2192\u221e\ng\u22122n (1\u2212 q\u0302)g\u22122n E[|X n t+1 \u2212X n t |2+\u03b1 | X n t = x]\n= 0,\nwhere we use that |xi \u2212 x|2+\u03b1 = O(1).\nLemma S8.3 (Strong LLN for noisy moments). For a function f(x) such that supx\u2208B(0,\u03b5) |f(x)| < \u03b5 and supx\u2208D |f(x)| < C for some constant C, given (?) we have uniformly in x \u2208 Xn that\ng\u22122n \u2211\ny\u2208NBn(x)\n1\n|NBn(x)| f(y \u2212 x) a.s.\u2192 g\u22122n\n\u222b\ny\u2208B(x,\u03b5n(x)) f(y \u2212 x) p(y) p\u03b5n(x)(x) dy.\nProof. Denote the claimed value of the limit by \u00b5(x). Let the set of non-noise out-neighbors of x be NBn(x) and the set of noise out-neighbors of x be N\u0303Bn(x), where we consider noise edges to be strictly non-geometric edges. We have uniformly in x \u2208 cX that\ng\u22122n\n\u2211 y\u2208NBn(x) f(y \u2212 x) + \u2211 y\u2208N\u0303Bn(x) f(y \u2212 x)\n|NBn(x)|+ |N\u0303Bn(x)| = g\u22122n \u2211 y\u2208NBn(x) f(y \u2212 x) + o(Cg2n) |NBn(x)|+ o(g2n)\na.s.\u2192 g\u22122n \u2211\ny\u2208NBn(x)\nf(y \u2212 x) |NBn(x)| ,\nso the result follows by the noise-less result in (Hashimoto et al., 2015).\nNow the behavior of noisy hitting times can be recovered by combining Lemma S8.1 with the convergence result of Corollary S6.2. Theorem S8.4. Let Gn be a noisy geometric graph with noise \u2211 j qj = o(g 2 n). For any \u03b4, there exists some \u03b2 = \u03b2\u0302g2n, s, c such that \u2223\u2223\u2223\u2223\u2212 log(E[exp(\u2212\u03b2T xiB(xj ,s),n)])\u221a\n2\u03b2 gn \u2212 c|xi \u2212 xj |\n\u2223\u2223\u2223\u2223 \u2264 \u03b4\nwith high probability as n\u2192\u221e.\nProof. By Lemma S8.1, the noisy and noise-free walks converge to the same continuum limit, and this guarantees that by Corollary S6.2 that their hitting times converge in distribution. Applying Theorem 4.5 gives the desired result.\nThis is a basic, but useful result for robustness of hitting times. Up to o(1) noise edges can be allowed for each vertex without disrupting the global convergence of hitting times.\n(a) Modified LTHT rapidly converges to RA index. (b) Conditioning on t > 1 substantially outperforms naive LTHT."}, {"heading": "9 Resource allocation index", "text": "Recall that the directed RA index was defined by\nRij = \u2211\nxk\u2208NBn(xi)\u2229NBinn(xj)\n1\n|NBn(xk)|\nand the modified log-LTHT was defined by\nMmodij = \u2212 log(E[exp(\u2212\u03b2T xixj ,n) | T xixj ,n > 1])."}, {"heading": "9.1 RA index reduction", "text": "Theorem S9.1. If \u03b2 = \u03c9(log(gdnn)) and xi and xj have at least one common neighbor, then\nMmodij \u2212 2\u03b2 \u2192 \u2212 log(Rij) + log(|NBn(xi)|).\nProof. Let Pij(t) be the probability of going from xi to xj in t steps, and Hij(t) the probability of not hitting before time t. Factoring the two-step hitting time yields\nMmodij = 2\u03b2 \u2212 log(Pij(2))\u2212 log ( 1 + \u221e\u2211\nt=3\nPij(t) Pij(2) Hij(t)e\n\u2212\u03b2(t\u22122) ) .\nLet kmax be the maximal out-degree which occurs in Gn. By assumption, at least one of the at most k 2 max two-step paths from xi goes to xj , we have the bound Pij(t) Pij(2)\n\u2264 k2max. For \u03b2 = \u03c9(log(gdnn)), we see that \u03b2 = \u03c9(2 log(kmax)) with high probability. Applying the bounds Hij(t) \u2264 1 and Pij(t)Pij(2) \u2264 k 2 max, we obtain\n\u221e\u2211\nt=3\nPij(t) Pij(2) Hij(t)e \u2212\u03b2(t\u22122) \u2264 k 2 max e\u03b2 \u2212 1 = o(k \u22121 max).\nWe conclude that Mmodij \u2192 2\u03b2 \u2212 log(Pij(2)). It remains to verify that log(Pij(2)) is related to the resource allocation index by\nlog(Pij(2)) = log   1 |NBn(xi)|\n\u2211\nk\u2208NBn(xi)\u2229NBinn (xj)\n1\nNBn(xk)\n  = log(Rij)\u2212 log(|NBn(xi)|)."}, {"heading": "9.2 RA index robustness", "text": "We verify the robustness of the RA index by directly bounding the statistics involved.\nTheorem S9.2. If qi = q = o(g d/2 n ) for all i, then for any \u03b4 > 0 there exist cutoffs c1, c2 and scaling hn so that with probability at least 1\u2212 \u03b4, for any i, j we have \u2022 |xi \u2212 xj | < min{\u03b5n(xi), \u03b5n(xj)} if Rijhn < c1; \u2022 |xi \u2212 xj | > 2 max{\u03b5n(xi), \u03b5n(xj)} if Rijhn > c2.\nProof. Decompose the out-degree of xi into expectation and noise terms by\n|NBn(xi)| = nq + ki + zi, where ki = \u03b5n(xi)\ndp(xi)Vdn, Vd is the volume of the d-unit ball, and zi is a random variable giving the remaining error. The number of noise edges has a binomial distribution with n draws and success probability q, and the number of geometric edges has a Poisson distribution with rate ki. Therefore, the Chebyshev inequality implies\nP(|zi| > c) \u2264 ki + nq(1\u2212 q) c2 < ki + nq c2 . (16)\nLet \u03b41 = \u03b4/4 and define c by the equality\n\u03b41 = ki + nq(1\u2212 q)\nc2 (17)\nso that c = \u03b4 \u22121/2 1 \u221a ki + nq. For the rest of the proof, we condition on the event that |zi| < c. By Taylor expanding 1|NBn(xi)| in zi, we have that\n1\n|NBn(xi)| =\n1 nq + ki \u2212 zi (nq + ki)2 +O\n( z2i\n(nq + ki)3\n)\n= 1\nnq + ki \u2212O\n( c\n(nq + ki)2\n) . (18)\nBy (17), we see that |zi| < c with probability at least 1\u2212 \u03b41, which implies that c\n(nq + ki)2 < \u03b4 \u22121/2 1 (nq + ki) \u22123/2.\nBy the definition of the RA index, we obtain\nRij = \u2211\nxk\u2208NBn(xi)\u2229NBinn(xj)\n( 1\nnq + ki +O(\u03b4\n\u22121/2 1 (nq + ki) \u22123/2) ) .\nSince our domain is compact, we may define\nk+n = sup x \u03b5n(x) dp(x)Vdn and k \u2212 n = inf x \u03b5n(x) dp(x)Vdn.\nBy construction, k+n > ki > k \u2212 n for all i. Let Cij := |NBn(xi) \u2229 NBinn (xj)|. Then we have\nCij\nnq + k+n \u2212O\n( Cij\n\u03b4 1/2 1 (nq + k + n )3/2\n) \u2264 Rij \u2264 Cij\nnq + k\u2212n +O\n( Cij\n\u03b4 1/2 1 (nq + k \u2212 n )3/2\n) . (19)\nChoose the scaling\nhn = nq + k+n k+n .\nWe will now bound Cij to control hnRij . To do this, decompose Cij as\nCij = C g ij + C n1 ij + C n2 ij ,\nwhere Cgij , C n1 ij , and C n2 ij are defined as follows.\n1. Geometric edges (Cgij): If |xi \u2212 xj | < min{\u03b5n(xi), \u03b5n(xj)} then they share common neighbors due to the geometric graph. Specifically their number of common neighbors has Poisson distribution with mean at least \u03c4dki(1\u2212 q), where \u03c4d is a constant independent of n defined as the overlapping density of two kernels at a unit distance.\n2. One noise edge (Cn1ij ): The edge xi \u2192 xk occurs by noise but xk \u2192 xj is geometric. There are at most k+n such vertices with in-edges to xj and so this is at most a binomial random variable with k + n draws\nand success probability q.\n3. Two noise edges (Cn2ij ): Both xi \u2192 xk and xk \u2192 xj may occur by noise, this is at most a binomial random variable with n\u2212 k\u2212n draws and success probability q2.\nThe case of |xi\u2212xj | < min{\u03b5n(xi), \u03b5n(xj)}: All types of edges may occur, so we obtain the moment bounds\nE [ Cij\nk+n\n] \u2265 \u03c4d(1\u2212 q)\nk\u2212n k+n\nVar\n[ Cij\nk+n\n] \u2264 \u03c4d(1\u2212 q)k \u2212 n\n(k+n )2 + (n\u2212 k\u2212n )q2(1\u2212 q2) + k+n q(1\u2212 q) (k+n )2 < \u03c4d(1\u2212 q)k\u2212n (k+n )2 + nq2 + k+n q (k+n )2 .\nNotice that k+n k\u2212n is bounded between the minimum and maximum of \u03b5n(x)p(x)\u03b5n(y)p(y) for x, y \u2208 D, so limn\u2192\u221e E [ Cij k+n ] \u2265\ncij for some cij > 0. Further, we find that Var [ Cij\nk+n\n] \u2192 0. These imply that for large enough n, we have\nCij k+n > cij with probability at least 1\u2212 \u03b41. Therefore, if |xi \u2212 xj | < min{\u03b5n(xi), \u03b5n(xj)}, we have\nlim n\u2192\u221e hnRij \u2265 lim n\u2192\u221e\nCij k+n \u2212O\n( Cij\n\u03b41/2(nq + k+n )1/2k + n\n) \u2265 cij . (20)\nThe case of |xi \u2212 xj | > 2 max{\u03b5n(xi), \u03b5n(xj)}: Only noise cases occur, hence we have the moment bounds\nE [ Cij\nk\u2212n\n] \u2264 q\n2(n\u2212 k\u2212n ) + qk+n k\u2212n < q2n k\u2212n + qk+n k\u2212n\nVar\n[ Cij\nk\u2212n\n] \u2264 (n\u2212 k \u2212 n )q\n2(1\u2212 q2) + k+n q(1\u2212 q) (k\u2212n )2 < qn (k\u2212n )2 + qk+n (k\u2212n )2 .\nBecause q = o(g d/2 n ), both the expectation and variance converge to zero and for large enough n, we have Cij/k \u2212 n \u2192 0 probability at least 1\u2212 \u03b41. Therefore, if |xi \u2212 xj | > 2 max{\u03b5n(xi), \u03b5n(xj)}, for we have\nlim n\u2192\u221e hnRij \u2264 lim n\u2192\u221e\nCij(nq + k + n ) k+n (nq + k \u2212 n ) +O\n( Cij(nq + k + n )\n\u03b41/2k+n (nq + k \u2212 n )3/2\n) \u2192 0. (21)\nCombining the cases: Taking hn = nq+k+n k+n , we combine (20) and (21) to conclude that the desired holds with probability at least 1\u2212 3\u03b41 > 1\u2212 \u03b4 for any c1 \u2264 cij and c2 > 0."}], "references": [{"title": "Some potential theory for reflecting Brownian motion in H\u00f6lder and Lipschitz", "author": ["Bass", "Richard F", "Hsu", "Pei"], "venue": "Proceedings of the 29th International Conference on Machine Learning", "citeRegEx": "Bass et al\\.,? \\Q2012\\E", "shortCiteRegEx": "Bass et al\\.", "year": 2012}, {"title": "Hitting times of Bessel processes", "author": ["J. lecki", "M. Ryznar"], "venue": "Potential Anal.,", "citeRegEx": "lecki and Ryznar,? \\Q2013\\E", "shortCiteRegEx": "lecki and Ryznar", "year": 2013}, {"title": "Local limit theorems for sequences of simple random walks on graphs", "author": ["Croydon", "David A", "Hambly", "Ben M"], "venue": "Potential Analysis,", "citeRegEx": "Croydon et al\\.,? \\Q2008\\E", "shortCiteRegEx": "Croydon et al\\.", "year": 2008}, {"title": "\u03b1-congruence for markov processes", "author": ["Eloranta", "Kari"], "venue": "The Annals of Probability, pp", "citeRegEx": "Eloranta and Kari.,? \\Q1990\\E", "shortCiteRegEx": "Eloranta and Kari.", "year": 1990}, {"title": "Markov processes: characterization and convergence", "author": ["Ethier", "Stewart N", "Kurtz", "Thomas G"], "venue": null, "citeRegEx": "Ethier et al\\.,? \\Q1986\\E", "shortCiteRegEx": "Ethier et al\\.", "year": 1986}, {"title": "A bag-of-paths framework for network data analysis", "author": ["Fran\u00e7oisse", "Kevin", "Kivim\u00e4ki", "Ilkka", "Mantrach", "Amin", "Rossi", "Fabrice", "Saerens", "Marco"], "venue": "arXiv preprint arXiv:1302.6766,", "citeRegEx": "Fran\u00e7oisse et al\\.,? \\Q2013\\E", "shortCiteRegEx": "Fran\u00e7oisse et al\\.", "year": 2013}, {"title": "Metric recovery from directed unweighted graphs", "author": ["Hashimoto", "Tatsunori B", "Sun", "Yi", "Jaakkola", "Tommi S"], "venue": "In Proceedings of the Eighteenth International Conference on Artificial Intelligence and Statistics,", "citeRegEx": "Hashimoto et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Hashimoto et al\\.", "year": 2015}, {"title": "On the principle of not feeling the boundary for diffusion processes", "author": ["Hsu", "Elton P"], "venue": "J. London Math. Soc. (2),", "citeRegEx": "Hsu and P.,? \\Q1995\\E", "shortCiteRegEx": "Hsu and P.", "year": 1995}, {"title": "Developments in the theory of randomized shortest paths with a comparison of graph node distances", "author": ["Kivim\u00e4ki", "Ilkka", "Shimbo", "Masashi", "Saerens", "Marco"], "venue": "Physica A: Statistical Mechanics and its Applications,", "citeRegEx": "Kivim\u00e4ki et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Kivim\u00e4ki et al\\.", "year": 2014}, {"title": "Brownian motion. Cambridge Series in Statistical and Probabilistic Mathematics", "author": ["M\u00f6rters", "Peter", "Peres", "Yuval"], "venue": null, "citeRegEx": "M\u00f6rters et al\\.,? \\Q2010\\E", "shortCiteRegEx": "M\u00f6rters et al\\.", "year": 2010}, {"title": "Stochastic differential equations: An introduction with applications", "author": ["\u00d8ksendal", "Bernt"], "venue": "Universitext. SpringerVerlag, Berlin, sixth edition,", "citeRegEx": "\u00d8ksendal and Bernt.,? \\Q2003\\E", "shortCiteRegEx": "\u00d8ksendal and Bernt.", "year": 2003}, {"title": "Bayesian discovery of threat networks", "author": ["Smith", "Steven T", "Kao", "Edward K", "Senne", "Kenneth D", "Bernstein", "Garrett", "Philips", "Scott"], "venue": "IEEE Transactions on Signal Processing,", "citeRegEx": "Smith et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Smith et al\\.", "year": 2014}, {"title": "Diffusion processes with boundary conditions", "author": ["Stroock", "Daniel W", "Varadhan", "SR Srinivasa"], "venue": "Communications on Pure and Applied Mathematics,", "citeRegEx": "Stroock et al\\.,? \\Q1971\\E", "shortCiteRegEx": "Stroock et al\\.", "year": 1971}, {"title": "Diffusion processes in a small time interval", "author": ["S.R.S. Varadhan"], "venue": "Comm. Pure Appl. Math.,", "citeRegEx": "Varadhan,? \\Q1967\\E", "shortCiteRegEx": "Varadhan", "year": 1967}, {"title": "Consistency of spectral clustering", "author": ["von Luxburg", "Ulrike", "Belkin", "Mikhail", "Bousquet", "Olivier"], "venue": "The Annals of Statistics,", "citeRegEx": "Luxburg et al\\.,? \\Q2008\\E", "shortCiteRegEx": "Luxburg et al\\.", "year": 2008}, {"title": "Hitting and commute times in large random neighborhood graphs", "author": ["von Luxburg", "Ulrike", "Radl", "Agnes", "Hein", "Matthias"], "venue": "Journal of Machine Learning Research,", "citeRegEx": "Luxburg et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Luxburg et al\\.", "year": 2014}, {"title": "Some useful functions for functional limit theorems", "author": ["Whitt", "Ward"], "venue": "Math. Oper. Res.,", "citeRegEx": "Whitt and Ward.,? \\Q1980\\E", "shortCiteRegEx": "Whitt and Ward.", "year": 1980}, {"title": "Similarity Learning Over Large Collaborative Networks", "author": ["Yazdani", "Majid"], "venue": "PhD thesis, E\u0301cole Polytechnique Fe\u0301de\u0301rale de Lausanne,", "citeRegEx": "Yazdani and Majid.,? \\Q2013\\E", "shortCiteRegEx": "Yazdani and Majid.", "year": 2013}, {"title": "Learning from labeled and unlabeled data on a directed graph", "author": ["Zhou", "Dengyong", "Huang", "Jiayuan", "Sch\u00f6lkopf", "Bernhard"], "venue": "In Proceedings of the 22nd International Conference on Machine Learning,", "citeRegEx": "Zhou et al\\.,? \\Q2005\\E", "shortCiteRegEx": "Zhou et al\\.", "year": 2005}], "referenceMentions": [{"referenceID": 18, "context": "Some results on utilizing the directed Laplacian as a smoothing operator (Zhou et al., 2005) exist in this direction.", "startOffset": 73, "endOffset": 92}, {"referenceID": 6, "context": "5, following the original strategy of (Hashimoto et al., 2015).", "startOffset": 38, "endOffset": 62}, {"referenceID": 6, "context": "In Hashimoto et al. (2015), a similar conjecture was made on the uniform equicontinuity of the rescaled stationary distribution n\u03c0Xn(x).", "startOffset": 3, "endOffset": 27}, {"referenceID": 6, "context": "In Hashimoto et al. (2015), a similar conjecture was made on the uniform equicontinuity of the rescaled stationary distribution n\u03c0Xn(x). We believe \u201cuniform equicontinuity\u201d should be corrected to \u201ceventual uniform equicontinuity\u201d there. In Corollary S2.6, we show that (?) implies the conjecture of Hashimoto et al. (2015). One consequence of equicontinuity is that convergence in distribution implies convergence in density.", "startOffset": 3, "endOffset": 323}, {"referenceID": 14, "context": "5 to generalize the result of von Luxburg et al. (2014) on degenerate behavior of hitting times via Lemma 3.", "startOffset": 34, "endOffset": 56}, {"referenceID": 6, "context": "1Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of \u03b5n(x)\u2212d.", "startOffset": 45, "endOffset": 69}, {"referenceID": 6, "context": "2Note that there is a typographical error in Hashimoto et al. (2015) adding an additional factor of \u03b5n(x)\u2212d.", "startOffset": 45, "endOffset": 69}, {"referenceID": 8, "context": "This method has been used to calculate the LTHT in in prior work (Kivim\u00e4ki et al., 2014).", "startOffset": 65, "endOffset": 88}, {"referenceID": 6, "context": "Set an(x) = p\u0302(x) \u22121 and bn(x) = \u03b5\u0302(x)\u22122 as estimated by (Hashimoto et al., 2015) so that limn\u2192\u221e an(x) = p(x)\u22121 and limn\u2192\u221e bn(x) = \u03b5(x)\u22122.", "startOffset": 57, "endOffset": 81}, {"referenceID": 6, "context": "By (Alamgir & von Luxburg, 2012) for the k-nearest neighbor case and (Hashimoto et al., 2015) with Lemma S6.", "startOffset": 69, "endOffset": 93}, {"referenceID": 13, "context": "2) and the results of (Varadhan, 1967).", "startOffset": 22, "endOffset": 38}, {"referenceID": 13, "context": "2) and the results of (Varadhan, 1967).", "startOffset": 22, "endOffset": 38}, {"referenceID": 6, "context": "so the result follows by the noise-less result in (Hashimoto et al., 2015).", "startOffset": 50, "endOffset": 74}], "year": 2015, "abstractText": "Large unweighted directed graphs are commonly used to capture relations between entities. A fundamental problem in the analysis of such networks is to properly define the similarity or dissimilarity between any two vertices. Despite the significance of this problem, statistical characterization of the proposed metrics has been limited. We introduce and develop a class of techniques for analyzing random walks on graphs using stochastic calculus. Using these techniques we generalize results on the degeneracy of hitting times and analyze a metric based on the Laplace transformed hitting time (LTHT). The metric serves as a natural, provably well-behaved alternative to the expected hitting time. We establish a general correspondence between hitting times of the Brownian motion and analogous hitting times on the graph. We show that the LTHT is consistent with respect to the underlying metric of a geometric graph, preserves clustering tendency, and remains robust against random addition of non-geometric edges. Tests on simulated and real-world data show that the LTHT matches theoretical predictions and outperforms alternatives.", "creator": "LaTeX with hyperref package"}}}