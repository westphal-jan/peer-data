{"id": "1610.08904", "review": {"conference": "NIPS", "VERSION": "v1", "DATE_OF_SUBMISSION": "27-Oct-2016", "title": "Local Similarity-Aware Deep Feature Embedding", "abstract": "existing deep embedding methods in vision tasks are capable of learning a sparse tensor space from images, where average distances evaluate to zero similarity metric. divers discover learning techniques effective are efficient, hard sample mining applications usually achieved, with geometry identified through computing the invariant measurement distance. conversely, the exact euclidean distance cannot faithfully characterize smooth primary similarity division in a complex - feature vector, where the intraclass distance in a maximum - density region may be more than the interclass separation in low - density regions. than other paper, we represent a position - parallel linear metric ( pddm ) unit, which is properly simply encoding a similarity metric associated to local correlation mapping. fast facility can be used to construct genuinely managed samples in local local neighborhood that guide relatively closest embedding learning : an intact and robust neighbourhood. the code layer grows appealing in although it is true to any convolutional networks beyond actively trained end - long - end. using local similarity - aware feature embedding not only utilizes faster convergence - louder comprehension after many complex image retrieval tools, its large coding bandwidth routinely leads to superior generalization results under certain large volume simple neighbor scenarios tensor transfer filtering requiring quasi - limit learning extensions imagenet 2010 and imagenet - 10k profiles.", "histories": [["v1", "Thu, 27 Oct 2016 17:51:18 GMT  (629kb,D)", "http://arxiv.org/abs/1610.08904v1", "9 pages, 4 figures, 2 tables. Accepted to NIPS 2016"]], "COMMENTS": "9 pages, 4 figures, 2 tables. Accepted to NIPS 2016", "reviews": [], "SUBJECTS": "cs.CV cs.LG", "authors": ["chen huang", "chen change loy", "xiaoou tang"], "accepted": true, "id": "1610.08904"}, "pdf": {"name": "1610.08904.pdf", "metadata": {"source": "CRF", "title": "Local Similarity-Aware Deep Feature Embedding", "authors": ["Chen Huang", "Chen Change Loy", "Xiaoou Tang"], "emails": ["chuang@ie.cuhk.edu.hk", "ccloy@ie.cuhk.edu.hk", "xtang@ie.cuhk.edu.hk"], "sections": [{"heading": "1 Introduction", "text": "Deep embedding methods aim at learning a compact feature embedding f(x) \u2208 Rd from image x using a deep convolutional neural network (CNN). They have been increasingly adopted in a variety of vision tasks such as product visual search [1, 14, 29, 33] and face verification [13, 27]. The embedding objective is usually in a Euclidean sense: the Euclidean distance Di,j = \u2016f(xi)\u2212 f(xj)\u20162 between two feature vectors should preserve their semantic relationship encoded pairwise (by contrastive loss [1]), in triplets [27, 33] or even higher order relationships (e.g., by lifted structured loss [29]).\nIt is widely observed that an effective data sampling strategy is crucial to ensure the quality and learning efficiency of deep embedding, as there are often many more easy examples than those meaningful hard examples. Selecting overly easy samples can in practice lead to slow convergence and poor performance since many of them satisfy the constraint well and give nearly zero loss, without exerting any effect on parameter update during the back-propagation [3]. Hence hard example mining [7] becomes an indispensable step in state-of-the-art deep embedding methods. These methods usually choose hard samples by computing the convenient Euclidean distance in the embedding space. For instance, in [27, 29], hard negatives with small Euclidean distances are found online in a mini-batch. An exception is [33] where an online reservoir importance sampling scheme is proposed to sample discriminative triplets by relevance scores. Nevertheless, these scores are computed offline with different hand-crafted features and distance metrics, which is suboptimal.\nWe question the effectiveness of using a single and global Euclidean distance metric for finding hard samples, especially for real-world vision tasks that exhibit complex feature variations due to pose, lighting, and appearance. As shown in a fine-grained bird image retrieval example in Figure 1(a), the diversity of feature patterns learned for each class throughout the feature space can easily lead\n30th Conference on Neural Information Processing Systems (NIPS 2016), Barcelona, Spain.\nar X\niv :1\n61 0.\n08 90\n4v 1\n[ cs\n.C V\n] 2\n7 O\nct 2\n01 6\nto a larger intraclass Euclidean distance than the interclass distance. Such a heterogeneous feature distribution yields a highly overlapped similarity score distribution for the positive and negative pairs, as shown in the left chart of Figure 1(b). We observed similar phenomenon for the global Mahalanobis metric [11, 12, 21, 35, 36] in our experiments. It is not difficult to see that using a single and global metric would easily mislead the hard sample mining. To circumvent this issue, Cui et al. [3] resorted to human intervention for harvesting genuinely hard samples.\nMitigating the aforementioned issue demands an improved metric that is adaptive to the local feature structure. In this study we wish to learn a local-adaptive similarity metric online, which will be exploited to search for high-quality hard samples in local neighborhood to facilitate a more effective deep embedding learning. Our key challenges lie in the formulation of a new layer and loss function that jointly consider the similarity metric learning, hard samples selection, and deep embedding learning. Existing studies [13, 14, 27, 29, 33] only consider the two latter objectives but not together with the first. To this end, we propose a new Position-Dependent Deep Metric (PDDM) unit for similarity metric learning. It is readily pluggable to train end-to-end with an existing deep embedding learning CNN. We formulate the PDDM such that it learns locally adaptive metric (unlike the global Euclidean metric), through a non-linear regression on both the absolute feature difference and feature mean (which encodes absolute position) of a data pair. As depicted in the right chart of Figure 1(b), the proposed metric yields a similarity score distribution that is more distinguishable than the conventional Euclidean metric. As shown in Figure 1(c), hard samples are mined from the resulting similarity score space and used to optimize the feature embedding space in a seamless manner. The similarity metric learning in PDDM and embedding learning in the associated CNN are jointly optimized using a novel large-margin double-header hinge loss.\nImage retrieval experiments on two challenging real-world vision datasets, CUB-200-2011 [32] and CARS196 [15], show that our local similarity-aware feature embedding significantly outperforms state-of-the-art deep embedding methods that come without the online metric learning and associated hard sample mining scheme. Moreover, the proposed approach incurs a far lower computational cost and encourages faster convergence than those structured embedding methods (e.g., [29]), which need to compute a fully connected dense matrix of pairwise distances in a mini-batch. We further demonstrate our learned embedding is generalizable to new classes in large open set scenarios. This is validated in the transfer learning and zero-shot learning (using the ImageNet hierarchy as auxiliary knowledge) tasks on ImageNet 2010 and ImageNet-10K [5] datasets.\nj\u0302x\nTraining data\nMini-batches ...\nCNN CNN CNN\nCNN\ni\u0302x \u02c6( )if x\n\u02c6( )jf x\n\u02c6( )kf x\n\u02c6( )lf x\nDouble-header hinge loss\nFeature embedding:\n(a) PDDM-Net architecture (b) PDDM learning unit\n1 1( , )x y ( , )m mx y\nl\u0302 x\nk\u0302 x Hard quadruplet\nL2 , \u02c6( , )\n\u02c6,\u02c6\u02c6( , )\n\u02c6,\u02c6\u02c6( , )\n\u02c6 \u02c6( , ) argmin \u02c6 argmax\n\u02c6 argmax\ni j i j P\ni k i k N\nj l j l N\ni j S\nk S\nl S\n\n\n\n\n\n\n...\nL2 L2\nL2\nPDDM PDDM\nPDDM\n\u02c6\u02c6,i k S \u02c6 \u02c6,i jS\n\u02c6\u02c6,j l S D ou\nbl e-\nhe ad er\nhi ng\ne lo ss\n\u02c6( )if x \u02c6( )kf x \u02c6( )jf x \u02c6( )lf x\nSimilarity score:\n\u02c6 \u02c6,i jS\u02c6\u02c6,i kS \u02c6\u02c6,j l\nS ( )p S\n( )if x L2\n( )jf x L2\n( ) ( )i jf x f x L2\n( ) ( ) 2 i jf x f x L2\nPDDM\nSimilarity score\n,i jS\nCat\nj\u0302x\nMini-batches\n...\nCNN\nCNN\nCNN\nCNN\ni\u0302x \u02c6( )if x\n\u02c6( )jf x\n\u02c6( )kf x\n\u02c6( )lf x\nDouble-header hinge lossFeature embedding\n(a) Overall network architecture (b) PDDM unit\n1 1( , )x y\n( , )m mx y\nl\u0302 x\nk\u0302 x\nHard quadruplet\nL2\n, \u02c6( , )\n\u02c6,\u02c6\u02c6( , )\n\u02c6,\u02c6\u02c6( , )\n\u02c6 \u02c6( , ) argmin\n\u02c6 argmax\n\u02c6 argmax\ni j i j P\ni k i k N\nj l j l N\ni j S\nk S\nl S\n\n\n\n\n\n\nL2\nL2\nL2\nPDDM\nPDDM\nPDDM\n\u02c6\u02c6,i k S\n\u02c6 \u02c6,i jS\n\u02c6\u02c6,j l S D ou\nbl e-\nhe ad\ner\nhi ng\ne lo\nss\nSimilarity score\n( )if x L2\n( )jf x L2\n( ) ( )i jf x f x L2\n( ) ( ) 2 i jf x f x\nL2\nPDDM\n,i jS\nCat\nFC\nFCFC\nFC\nFigure 2: (a) The overall network architecture. All CNNs have shared architectures and parameters. (b) The PDDM unit."}, {"heading": "2 Related work", "text": "Hard sample mining in deep learning: Hard sample mining is a popular technique used in computer vision for training robust classifier. The method aims at augmenting a training set progressively with false positive examples with the model learned so far. It is the core of many successful vision solutions, e.g. pedestrian detection [4, 7]. In a similar spirit, contemporary deep embedding methods [27, 29] choose hard samples in a mini-batch by computing the Euclidean distance in the embedding space. For instance, Schroff et al. [27] selected online the semi-hard negative samples with relatively small Euclidean distances. Wang et al. [33] proposed an online reservoir importance sampling algorithm to sample triplets by relevance scores, which are computed offline with different distance metrics. Similar studies on image descriptor learning [28] and unsupervised feature learning [34] also select hard samples according to the Euclidean distance-based losses in their respective CNNs. We argue in this paper that the global Euclidean distance is a suboptimal similarity metric for hard sample mining, and propose a locally adaptive metric for better mining.\nMetric learning: An effective similarity metric is at the core of hard sample mining. Euclidean distance is the simplest similarity metric, and it is widely used by current deep embedding methods where Euclidean feature distances directly correspond the similarity. Similarities can be encoded pairwise with a contrastive loss [1] or in more flexible triplets [27, 33]. Song et al. [29] extended to even higher order similarity constraints by lifting the pairwise distances within a mini-batch to the dense matrix of pairwise distances. Beyond Euclidean metric, one can actually turn to the parametric Mahalanobis metric instead. Representative works [12, 36] minimize the Mahalanobis distance between positive sample pairs while maximizing the distance between negative pairs. Alternatives directly optimize the Mahalanobis metric for nearest neighbor classification via the method of Neighbourhood Component Analysis (NCA) [11], Large Margin Nearest Neighbor (LMNN) [35] or Nearest Class Mean (NCM) [21]. However, the common drawback of the Mahalanobis and Euclidean metrics is that they are both global and are far from being ideal in the presence of heterogeneous feature distribution (see Figure 1(a)). An intuitive remedy would be to learn multiple metrics [9], which would be computationally expensive though. Xiong et al. [37] proposed a single adaptive metric using the absolute position information in random forest classifiers. Our approach shares the similar intuition, but incorporates the position information by a deep CNN in a more principled way, and can jointly learn similarity-aware deep features instead of using hand-crafted ones as in [37]."}, {"heading": "3 Local similarity-aware deep embedding", "text": "LetX = {(xi, yi)} be an imagery dataset, where yi is the class label of image xi. Our goal is to jointly learn a deep feature embedding f(x) from image x into a feature space Rd, and a similarity metric Si,j = S(f(xi), f(xj)) \u2208 R1, such that the metric can robustly select hard samples online to learn a discriminative, similarity-aware feature embedding. Ideally, the learned features (f(xi), f(xj)) from the set of positive pairs P = {(i, j)|yi = yj} should be close to each other with a large similarity score Si,j , while the learned features from the set of negative pairs N = {(i, j)|yi 6= yj} should be pushed far away with a small similarity score. Importantly, this relationship should hold independent of the (heterogeneous) feature distribution in Rd, where a global metric Si,j can fail. To adapt Si,j to the latent structure of feature embeddings, we propose a Position-Dependent Deep Metric (PDDM) unit that can be trained end-to-end, see Figure 2(b).\nThe overall network architecture is shown in Figure 2(a). First, we use PDDM to compute similarity scores for the mini-batch samples during a particular forward pass. The scores are used to select one hard quadruplet from the local sets of positive pairs P\u0302 \u2208 P and negative pairs N\u0302 \u2208 N in the batch. Then each sample in the hard quadruplet is separately fed into four identical CNNs with shared parameters W to extract d-dimensional features. Finally, a discriminative double-header hinge loss is applied to both the similarity score and feature embeddings. This enables us to jointly optimize the two that benefit each other. We will provide the details in the following."}, {"heading": "3.1 PDDM learning and hard sample mining", "text": "Given a feature pair (fW (xi), fW (xj)) extracted from images xi and xj by an embedding function fW (\u00b7) parameterized by W , we wish to obtain an ideal similarity score yi,j = 1 if (i, j) \u2208 P , and yi,j = 0 if (i, j) \u2208 N . Hence, we seek the optimal similarity metric S\u2217(\u00b7, \u00b7) from an appropriate function space H , and also seek the optimal feature embedding parameters W \u2217:\n(S\u2217(\u00b7, \u00b7),W \u2217) = argmin S(\u00b7,\u00b7)\u2208H,W\n1 |P \u222aN | \u2211\n(i,j)\u2208P\u222aN\nl (S(fW (xi), fW (xj)), yi,j) , (1)\nwhere l(\u00b7) is some loss function. We will omit the parameters W of f(\u00b7) in the following for brevity.\nAdapting to local feature structure. The standard Euclidean or Mahalanobis metric can be seen as a special form of function S(\u00b7, \u00b7) that is based solely on the feature difference vector u = |f(xi)\u2212f(xj)| or its linearly transformed version. These metrics are suboptimal in a heterogeneous embedding space, thus could easily fail the searching of genuinely hard samples. On the contrary, the proposed PDDM leverages the absolute feature position to adapt the metric throughout the embedding space. Specifically, inspired by [37], apart from the feature difference vector u, we additionally incorporate the feature mean vector v = (f(xi) + f(xj))/2 to encode the absolute position. Unlike [37], we formulate a principled learnable similarity metric from u and v in our CNN.\nFormally, as shown in Figure 2(b), we first normalize the features f(xi) and f(xj) onto the unit hypersphere, i.e., \u2016f(x)\u20162 = 1, in order to maintain feature comparability. Such normalized features are used to compute their relative and absolute positions encoded in u and v, each followed by a fully connected layer, an elementwise ReLU nonlinear function \u03c3(\u03be) = max(0, \u03be), and again, `2-normalization r(x) = x/\u2016x\u20162. To treat u and v differently, the fully connected layers applied to them are not shared, parameterized by Wu \u2208 Rd\u00d7d, bu \u2208 Rd and Wv \u2208 Rd\u00d7d, bv \u2208 Rd, respectively. The nonlinearities ensure the model is not trivially equivalent to be the mapping from f(xi) and f(xj) themselves. Then we concatenate the mapped u\u2032 and v\u2032 vectors and pass them through another fully connected layer parameterized by Wc \u2208 R2d\u00d7d, bc \u2208 Rd and the ReLU function, and finally map to a score Si,j = S(f(xi), f(xj)) \u2208 R1 via Ws \u2208 Rd\u00d71, bs \u2208 R1. To summarize:\nu = |f(xi)\u2212 f(xj)| , v = (f(xi) + f(xj)) /2, u\u2032 = r (\u03c3(Wuu+ bu)) , v \u2032 = r (\u03c3(Wvv + bv)) ,\nc = \u03c3 ( Wc [ u\u2032\nv\u2032\n] + bc ) , Si,j =Wsc+ bs. (2)\nIn this way, we transform the seeking of the similarity metric function S(\u00b7, \u00b7) into the joint learning of CNN parameters (Wu,Wv,Wc,Ws, bu, bv, bc, bs for the PDDM unit, andW for feature embeddings). The parameters collectively define a flexible nonlinear regression function for the similarity score.\nDouble-header hinge loss. To optimize all these CNN parameters, we can choose a standard regression loss function l(\u00b7), e.g., logistic regression loss. Or alternatively, we can cast the problem as a binary classification one as in [37]. However, in both cases the CNN is prone to overfitting, because the supervisory binary similarity labels yi,j \u2208 {0, 1} tend to independently push the scores towards two single points. While in practice, the similarity scores of positive and negative pairs live on a 1-D manifold following some distribution patterns on heterogeneous data, as illustrated in Figure 1(b).\nThis motivates us to design a loss function l(\u00b7) to separate the similarity distributions, instead of in an independent pointwise way that is noise-sensitive. One intuitive option is to impose the Fisher criterion [20] on the similarity scores, i.e., maximizing the ratio between the interclass and intraclass scatters of scores. Similarly, it can be reduced to maximize (\u00b5P \u2212 \u00b5N )2/(VarP + VarN ) in our 1-D case, where \u00b5 and Var are the mean and variance of each score distribution. Unfortunately, the\noptimality of Fisher-like criteria relies on the assumption that the data of each class is of a Gaussian distribution, which is obviously not satisfied in our case. Also, a high cost O(m2) is entailed to compute the Fisher loss in a mini-batch with m samples by computing all the pairwise distances.\nConsequently, we propose a faster-to-compute loss function that approximately maximizes the margin between the positive and negative similarity distributions without making any assumption about the distribution\u2019s shape or pattern. Specifically, we retrieve one hard quadruplet from a random batch during each forward pass. Please see the illustration in Figure 1(c). The quadruplet consists of the most dissimilar positive sample pair in the batch (\u0302i, j\u0302) = argmin(i,j)\u2208P\u0302 Si,j , which means their similarity score is most likely to cross the \u201csafe margin\u201d towards the negative similarity distribution in this local range. Next, we build a similarity neighborhood graph that links the chosen positive pair with their respective negative neighbors in the batch, and choose the hard negatives as the other two quadruplet members k\u0302 = argmax(\u0302i,k)\u2208N\u0302 Si\u0302,k, and l\u0302 = argmax(j\u0302,l)\u2208N\u0302 Sj\u0302,l. Using\nthis hard quadruplet (\u0302i, j\u0302, k\u0302, l\u0302), we can now locally approximate the inter-distribution margin as min(Si\u0302,j\u0302\u2212Si\u0302,k\u0302, Si\u0302,j\u0302\u2212Sj\u0302,l\u0302) in a robust manner. This makes us immediately come to a double-header hinge loss Em to discriminate the target similarity distributions under the large margin criterion:\nmin Em = \u2211\ni\u0302,j\u0302 (\u03b5i\u0302,j\u0302 + \u03c4i\u0302,j\u0302), (3) s.t. : \u2200(\u0302i, j\u0302), max ( 0, \u03b1+ Si\u0302,k\u0302 \u2212 Si\u0302,j\u0302 ) \u2264 \u03b5i\u0302,j\u0302 , max ( 0, \u03b1+ Sj\u0302,l\u0302 \u2212 Si\u0302,j\u0302 ) \u2264 \u03c4i\u0302,j\u0302 ,\n(\u0302i, j\u0302) = argmin (i,j)\u2208P\u0302 Si,j , k\u0302 = argmax (\u0302i,k)\u2208N\u0302 Si\u0302,k, l\u0302 = argmax (j\u0302,l)\u2208N\u0302 Sj\u0302,l, \u03b5i\u0302,j\u0302 \u2265 0, \u03c4i\u0302,j\u0302 \u2265 0,\nwhere \u03b5i\u0302,j\u0302 , \u03c4i\u0302,j\u0302 are the slack variables, and \u03b1 is the enforced margin.\nThe discriminative loss has four main benefits: 1) The discrimination of similarity distributions is assumption-free. 2) Hard samples are simultaneously found during the loss minimization. 3) The loss function incurs a low computational cost and encourages faster convergence. Specifically, the searching cost of the hard positive pair (\u0302i, j\u0302) is very small since the positive pair set P\u0302 is usually much smaller than the negative pair set N\u0302 in an m-sized mini-batch. While the hard negative mining only incurs an O(m) complexity. 4) Eqs. (2, 3) can be easily optimized through the standard stochastic gradient descent to adjust the CNN parameters."}, {"heading": "3.2 Joint metric and embedding optimization", "text": "Given the learned PDDM and mined hard samples in a mini-batch, we can use them to solve for a better, local similarity-aware feature embedding at the same time. For computational efficiency, we reuse the hard quadruplet\u2019s features for metric optimization (Eq. (3)) in the same forward pass. What follows is to use the double-header hinge loss again, but to constrain the deep features this time, see Figure 2. The objective is to ensure the Euclidean distance between hard negative features (Di\u0302,k\u0302 or Dj\u0302,l\u0302) is larger than that between hard positive features Di\u0302,j\u0302 by a large margin. Combining the embedding loss Ee and metric loss Em (Eq. (3)) gives our final joint loss function:\nmin Em + \u03bbEe + \u03b3\u2016W\u0303\u20162, where Ee = \u2211\ni\u0302,j\u0302 (oi\u0302,j\u0302 + \u03c1i\u0302,j\u0302), (4) s.t. : \u2200(\u0302i, j\u0302), max ( 0, \u03b2 +Di\u0302,j\u0302 \u2212Di\u0302,k\u0302 ) \u2264 oi\u0302,j\u0302 , max ( 0, \u03b2 +Di\u0302,j\u0302 \u2212Dj\u0302,l\u0302 ) \u2264 \u03c1i\u0302,j\u0302 ,\nDi\u0302,j\u0302 = \u2016f(xi\u0302)\u2212 f(xj\u0302)\u20162, oi\u0302,j\u0302 \u2265 0, \u03c1i\u0302,j\u0302 \u2265 0,\nwhere W\u0303 are the CNN parameters for both the PDDM and feature embedding, and oi\u0302,j\u0302 , \u03c1i\u0302,j\u0302 and \u03b2 are the slack variables and enforced margin for Ee, and \u03bb, \u03b3 are the regularization parameters. Since all features are `2-normalized (see Figure 2), we have \u03b2+Di\u0302,j\u0302\u2212Di\u0302,k\u0302 = \u03b2\u22122f(xi\u0302)f(xj\u0302)+2f(xi\u0302)f(xk\u0302), and can conveniently derive the gradients as those in triplet-based methods [27, 33].\nThis joint objective provides effective supervision in two domains, respectively at the score level and feature level that are mutually informed. Although the score level supervision by Em alone is already capable of optimizing both our metric and feature embedding, we will show the benefits of adding the feature level supervision by Ee in experiments. Note we can still enforce the large margin relations of quadruple features in Ee using the simple Euclidean metric. This is because the quadruple features are selected by our PDDM that is learned in the local Euclidean space as well.\nFigure 3 compares our local similarity-aware feature embedding with existing works. Contrastive [1] embedding is trained on pairwise data {(xi, xj , yi,j)}, and tries to minimize the distance between the positive feature pair and penalize the distance between negative feature pair for being smaller than a margin \u03b1. Triplet embedding [27, 33] samples the triplet data {(xa, xp, xn)} where xa is an anchor point and xp, xn are from the same and different class, respectively. The objective is to separate the intraclass distance between (f(xa), f(xp)) and interclass distance between (f(xa), f(xn)) by margin \u03b1. While lifted structured embedding [29] considers all the positive feature pairs (e.g., (f(xi), f(xj)) in Figure 3) and all their linked negative pairs (e.g., (f(xi), f(xk)), (f(xj), f(xl)) and so on), and enforces a margin \u03b1 between positive and negative distances.\nThe common drawback of the above-mentioned embedding methods is that they sample pairwise or triplet (i.e., anchor) data randomly and rely on simplistic Euclidean metric. They are thus very likely to update from inappropriate hard samples and push the negative pairs towards the already well-separated embedding space (see the red arrow in Figure 3). While our method can use PDDM to find the genuinely hard feature quadruplet (f(xi\u0302), f(xj\u0302), f(xk\u0302), f(xl\u0302)), thus can update feature embedding in the correct direction. Also, our method is more efficient than the lifted structured embedding [29] that requires computing dense pairwise distances within a mini-batch."}, {"heading": "3.3 Implementation details", "text": "We use GoogLeNet [31] (feature dimension d = 128) and CaffeNet [16] (d = 4096) as our base network architectures for retrieval and transfer learning tasks respectively. They are initialized with their pretrained parameters on ImageNet classification. The fully-connected layers of our PDDM unit are initialized with random weights and followed by dropout [30] with p = 0.5. For all experiments, we choose by grid search the mini-batch size m = 64, initial learning rate 1\u00d7 10\u22124, momentum 0.9, margin parameters \u03b1 = 0.5, \u03b2 = 1 in Eqs. (3, 4), and regularization parameters \u03bb = 0.5, \u03b3 = 5 \u00d7 10\u22124 (\u03bb balances the metric loss Em against the embedding loss Ee). To find meaningful hard positives in our hard quadruplets, we ensure that any one class in a mini-batch has at least 4 samples. And, we always scale Si\u0302,j\u0302 into the range [0, 1] by the similarity graph in the batch. The entire network is trained for a maximum of 400 epochs until convergence."}, {"heading": "4 Results", "text": "Image retrieval. The task of image retrieval is a perfect testbed for our method, where both the learned PDDM and feature embedding (under the Euclidean feature distance) can be used to find similar images for a query. Ideally, a good similarity metric should be query-adapted (i.e., positiondependent), and both the metric and features should be able to generalize. We test these properties of our method on two popular fine-grained datasets with complex feature distribution. We deliberately make the evaluation more challenging by preparing training and testing sets that are disjoint in terms of class labels. Specifically, we use the CUB-200-2011 [32] dataset with 200 bird classes and 11,788\nimages. We employ the first 100 classes (5,864 images) for training, and the remaining 100 classes (5,924 images) for testing. Another used dataset is CARS196 [15] with 196 car classes and 16,185 images. The first 98 classes (8,054 images) are used for training, and the other 98 classes are retained for testing (8,131 images). We use the standard Recall@K as the retrieval evaluation metric.\nFigure 4-(top) shows that the proposed PDDM leads to 2\u00d7 faster convergence in 200 epochs (28 hours on a Titan X GPU) and lower converged loss than the regular Euclidean metric, when both are used to mine hard quadruplets for embedding learning. Note the two resulting approaches both incur lower computational costs than [29], with a near linear rather than quadratic [29] complexity in mini-batches. As observed from the retrieval results and their feature distributions in Figure 4-(bottom), our PDDM copes comfortably with large intraclass variations, and generates stable similarity scores for those differently scattered features positioned around a particular query. These results also demonstrate the successful generalization of PDDM on a test set with disjoint class labels.\nTable 1 quantifies the advantages of both of our similarity metric (PDDM) and similarity-aware feature embedding (dubbed \u2018PDDM+Quadruplet\u2019 for short). In the middle rows, we compare the results from using the metrics of Large Margin Deep Metric (LMDM) and our PDDM, both jointly trained with our quadruplet embedding. The LMDM is implemented by deeply regressing the similarity score from the feature difference only, without using the absolute feature position. Although it is also optimized under the large margin rule, it performs worse than our PDDM due to the lack of position information for metric adaptation. In the bottom rows, we test using the learned features under the Euclidean distance. We observed PDDM significantly improves the performance of both triplet and quadruplet embeddings. In particular, our full \u2018PDDM+Quadruplet\u2019 method yields large gains (8%+ Recall@K=1) over previous works [1, 27, 29, 33] all using the Euclidean distance for hard sample mining. Indeed, as visualized in Figure 4, our learned features are typically well-clustered, with sharp boundaries and large margins between many classes.\nDiscussion. We previously mentioned that our PDDM and feature embedding can be learned by only optimizing the metric loss Em in Eq. (3). Here we experimentally prove the necessity of extra supervision from the embedding loss Ee in Eq. (4). Without it, the Recall@K=1 of image retrieval by our \u2018PDDM score\u2019 and \u2018PDDM+Quadruplet\u2019 methods drop by 3.4%+ and 6.5%+, respectively. Another important parameter is the batch size m. When we set it to be smaller than 64, say 32, Recall@K=1 on CUB-200-2011 drops to 55.7% and worse with even smaller m. This is because the chosen hard quadruplet from a small batch makes little sense for learning. When we use large m=132, we have marginal gains but need many more epochs (than 400) to use enough training quadruplets.\nTransfer learning. Considering the good performance of our fully learned features, here we evaluate their generalization ability under the scenarios of transfer learning and zero-shot learning. Transfer learning aims to transfer knowledge from the source classes to new ones. Existing methods explored the knowledge of part detectors [6] or attribute classifiers [17] across classes. Zero-shot learning is an extreme case of transfer learning, but differs in that for a new class only a description rather than labeled training samples is provided. The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22]. These learning scenarios are also related to the open set one [2] where new classes grow continuously.\nFor transfer learning, we follow [21] to train our feature embeddings and a Nearest Class Mean (NCM) classifier [21] on the large-scale ImageNet 20101 dataset, which contains 1,000 classes and more than 1.2 million images. Then we apply the NCM classifier to the larger ImageNet-10K [5] dataset with 10,000 classes, thus do not use any auxiliary knowledge such as parts and attributes. We use the standard flat top-1 accuracy as the classification evaluation metric. Table 2 shows that our features outperform state-of-the-art methods by a large margin, including the deep feature-based ones [18, 21]. We attribute this advantage to our end-to-end feature embedding learning and its large margin nature, which directly translates to good generalization ability.\nFor zero-shot learning, we follow the standard settings in [21, 25] on ImageNet 2010: we learn our feature embeddings on 800 classes, and test on the remaining 200 classes. For simplicity, we also use the ImageNet hierarchy to estimate the mean of new testing classes from the means of related training classes. The flat top-5 accuracy is used as the classification evaluation metric. As can be seen from Table 2, our features achieve top results again among many competing deep CNN-based methods. Considering our PDDM and local similarity-aware feature embedding are both well learned with safe margins between classes, in this zero-shot task, they would be naturally resistent to class boundary confusion between known and unseen classes."}, {"heading": "5 Conclusion", "text": "In this paper, we developed a method of learning local similarity-aware deep feature embeddings in an end-to-end manner. The PDDM is proposed to adaptively measure the local feature similarity in a heterogeneous space, thus it is valuable for high quality online hard sample mining that can better guide the embedding learning. The double-header hinge loss on both the similarity metric and feature embedding is optimized under the large margin criterion. Experiments show the efficacy of our learned feature embedding in challenging image retrieval tasks, and point to its potential of generalizing to new classes in the large and open set scenarios such as transfer learning and zero-shot learning. In the future, it is interesting to study the generalization performance when using the shared attributes or visual-semantic embedding instead of ImageNet hierarchy for zero-shot learning.\nAcknowledgments. This work is supported by SenseTime Group Limited and the Hong Kong Innovation and Technology Support Programme.\n1See http://www.image-net.org/challenges/LSVRC/2010/index."}], "references": [{"title": "Learning visual similarity for product design with convolutional neural networks", "author": ["S. Bell", "K. Bala"], "venue": "TOG, 34(4):98:1\u201398:10", "citeRegEx": "1", "shortCiteRegEx": null, "year": 2015}, {"title": "Towards open world recognition", "author": ["A. Bendale", "T. Boult"], "venue": "CVPR", "citeRegEx": "2", "shortCiteRegEx": null, "year": 2015}, {"title": "Fine-grained categorization and dataset bootstrapping using deep metric learning with humans in the loop", "author": ["Y. Cui", "F. Zhou", "Y. Lin", "S. Belongie"], "venue": "CVPR", "citeRegEx": "3", "shortCiteRegEx": null, "year": 2016}, {"title": "Histograms of oriented gradients for human detection", "author": ["N. Dalal", "B. Triggs"], "venue": "CVPR", "citeRegEx": "4", "shortCiteRegEx": null, "year": 2005}, {"title": "and L", "author": ["J. Deng", "A.C. Berg", "K. Li"], "venue": "Fei-Fei. What does classifying more than 10,000 image categories tell us? In ECCV", "citeRegEx": "5", "shortCiteRegEx": null, "year": 2010}, {"title": "One-shot learning of object categories", "author": ["L. Fei-Fei", "R. Fergus", "P. Perona"], "venue": "TPAMI, 28(4):594\u2013611", "citeRegEx": "6", "shortCiteRegEx": null, "year": 2006}, {"title": "Object detection with discriminatively trained part-based models", "author": ["P.F. Felzenszwalb", "R.B. Girshick", "D. McAllester", "D. Ramanan"], "venue": "TPAMI, 32(9):1627\u20131645", "citeRegEx": "7", "shortCiteRegEx": null, "year": 2010}, {"title": "DeViSE: A deep visual-semantic embedding model", "author": ["A. Frome", "G.S. Corrado", "J. Shlens", "S. Bengio", "J. Dean", "M.A. Ranzato", "T. Mikolov"], "venue": "NIPS", "citeRegEx": "8", "shortCiteRegEx": null, "year": 2013}, {"title": "Learning globally-consistent local distance functions for shape-based image retrieval and classification", "author": ["A. Frome", "Y. Singer", "F. Sha", "J. Malik"], "venue": "ICCV", "citeRegEx": "9", "shortCiteRegEx": null, "year": 2007}, {"title": "Zero-shot object recognition by semantic manifold distance", "author": ["Z. Fu", "T.A. Xiang", "E. Kodirov", "S. Gong"], "venue": "CVPR", "citeRegEx": "10", "shortCiteRegEx": null, "year": 2015}, {"title": "Neighbourhood components analysis", "author": ["J. Goldberger", "G.E. Hinton", "S.T. Roweis", "R.R. Salakhutdinov"], "venue": "NIPS", "citeRegEx": "11", "shortCiteRegEx": null, "year": 2005}, {"title": "Learning distance metrics with contextual constraints for image retrieval", "author": ["S.C.H. Hoi", "W. Liu", "M.R. Lyu", "W.-Y. Ma"], "venue": "CVPR", "citeRegEx": "12", "shortCiteRegEx": null, "year": 2006}, {"title": "Learning deep representation for imbalanced classification", "author": ["C. Huang", "Y. Li", "C.C. Loy", "X. Tang"], "venue": "CVPR", "citeRegEx": "13", "shortCiteRegEx": null, "year": 2016}, {"title": "Unsupervised learning of discriminative attributes and visual representations", "author": ["C. Huang", "C.C. Loy", "X. Tang"], "venue": "CVPR", "citeRegEx": "14", "shortCiteRegEx": null, "year": 2016}, {"title": "3D object representations for fine-grained categorization", "author": ["J. Krause", "M. Stark", "J. Deng", "L. Fei-Fei"], "venue": "ICCVW", "citeRegEx": "15", "shortCiteRegEx": null, "year": 2013}, {"title": "Imagenet classification with deep convolutional neural networks", "author": ["A. Krizhevsky", "I. Sutskever", "G.E. Hinton"], "venue": "NIPS", "citeRegEx": "16", "shortCiteRegEx": null, "year": 2012}, {"title": "Attribute-based classification for zero-shot visual object categorization", "author": ["C.H. Lampert", "H. Nickisch", "S. Harmeling"], "venue": "TPAMI, 36(3):453\u2013465", "citeRegEx": "17", "shortCiteRegEx": null, "year": 2014}, {"title": "Building high-level features using large scale unsupervised learning", "author": ["Q. Le", "M. Ranzato", "R. Monga", "M. Devin", "K. Chen", "G. Corrado", "J. Dean", "A. Ng"], "venue": "ICML", "citeRegEx": "18", "shortCiteRegEx": null, "year": 2012}, {"title": "Visualizing high-dimensional data using t-SNE", "author": ["L. Maaten", "G.E. Hinton"], "venue": "JMLR, 9:2579\u20132605", "citeRegEx": "19", "shortCiteRegEx": null, "year": 2008}, {"title": "PCA versus LDA", "author": ["A.M. Martinez", "A.C. Kak"], "venue": "TPAMI, 23(2):228\u2013233", "citeRegEx": "20", "shortCiteRegEx": null, "year": 2001}, {"title": "Distance-based image classification: Generalizing to new classes at near-zero cost", "author": ["T. Mensink", "J. Verbeek", "F. Perronnin", "G. Csurka"], "venue": "TPAMI, 35(11):2624\u20132637", "citeRegEx": "21", "shortCiteRegEx": null, "year": 2013}, {"title": "Zero-shot learning by convex combination of semantic embeddings", "author": ["M. Norouzi", "T. Mikolov", "S. Bengio", "Y. Singer", "J. Shlens", "A. Frome", "G. Corrado", "J. Dean"], "venue": "ICLR", "citeRegEx": "22", "shortCiteRegEx": null, "year": 2014}, {"title": "Towards good practice in large-scale learning for image classification", "author": ["F. Perronnin", "Z. Akata", "Z. Harchaoui", "C. Schmid"], "venue": "CVPR", "citeRegEx": "23", "shortCiteRegEx": null, "year": 2012}, {"title": "Transfer learning in a transductive setting", "author": ["M. Rohrbach", "S. Ebert", "B. Schiele"], "venue": "NIPS", "citeRegEx": "24", "shortCiteRegEx": null, "year": 2013}, {"title": "Evaluating knowledge transfer and zero-shot learning in a large-scale setting", "author": ["M. Rohrbach", "M. Stark", "B. Schiele"], "venue": "CVPR", "citeRegEx": "25", "shortCiteRegEx": null, "year": 2011}, {"title": "High-dimensional signature compression for large-scale image classification", "author": ["J. Sanchez", "F. Perronnin"], "venue": "CVPR", "citeRegEx": "26", "shortCiteRegEx": null, "year": 2011}, {"title": "FaceNet: A unified embedding for face recognition and clustering", "author": ["F. Schroff", "D. Kalenichenko", "J. Philbin"], "venue": "CVPR", "citeRegEx": "27", "shortCiteRegEx": null, "year": 2015}, {"title": "Fracking deep convolutional image descriptors", "author": ["E. Simo-Serra", "E. Trulls", "L. Ferraz", "I. Kokkinos", "F. Moreno-Noguer"], "venue": "arXiv preprint, arXiv:1412.6537v2", "citeRegEx": "28", "shortCiteRegEx": null, "year": 2015}, {"title": "Deep metric learning via lifted structured feature embedding", "author": ["H.O. Song", "Y. Xiang", "S. Jegelka", "S. Savarese"], "venue": "CVPR", "citeRegEx": "29", "shortCiteRegEx": null, "year": 2016}, {"title": "Dropout: A simple way to prevent neural networks from overfitting", "author": ["N. Srivastava", "G. Hinton", "A. Krizhevsky", "I. Sutskever", "R. Salakhutdinov"], "venue": "JMLR, 15(1):1929\u20131958", "citeRegEx": "30", "shortCiteRegEx": null, "year": 2014}, {"title": "Going deeper with convolutions", "author": ["C. Szegedy", "W. Liu", "Y. Jia", "P. Sermanet", "S. Reed", "D. Anguelov", "D. Erhan", "V. Vanhoucke", "A. Rabinovich"], "venue": "CVPR", "citeRegEx": "31", "shortCiteRegEx": null, "year": 2015}, {"title": "The Caltech-UCSD Birds-200-2011 Dataset", "author": ["C. Wah", "S. Branson", "P. Welinder", "P. Perona", "S. Belongie"], "venue": "Technical Report CNS-TR-2011-001, California Institute of Technology", "citeRegEx": "32", "shortCiteRegEx": null, "year": 2011}, {"title": "Learning fine-grained image similarity with deep ranking", "author": ["J. Wang", "Y. Song", "T. Leung", "C. Rosenberg", "J. Wang", "J. Philbin", "B. Chen", "Y. Wu"], "venue": "CVPR", "citeRegEx": "33", "shortCiteRegEx": null, "year": 2014}, {"title": "Unsupervised learning of visual representations using videos", "author": ["X. Wang", "A. Gupta"], "venue": "ICCV", "citeRegEx": "34", "shortCiteRegEx": null, "year": 2015}, {"title": "Distance metric learning for large margin nearest neighbor classification", "author": ["K.Q. Weinberger", "L.K. Saul"], "venue": "JMLR, 10:207\u2013244", "citeRegEx": "35", "shortCiteRegEx": null, "year": 2009}, {"title": "Distance metric learning with application to clustering with side-information", "author": ["E.P. Xing", "M.I. Jordan", "S.J. Russell", "A.Y. Ng"], "venue": "NIPS", "citeRegEx": "36", "shortCiteRegEx": null, "year": 2003}, {"title": "Random forests for metric learning with implicit pairwise position dependence", "author": ["C. Xiong", "D. Johnson", "R. Xu", "J.J. Corso"], "venue": "SIGKDD", "citeRegEx": "37", "shortCiteRegEx": null, "year": 2012}], "referenceMentions": [{"referenceID": 0, "context": "They have been increasingly adopted in a variety of vision tasks such as product visual search [1, 14, 29, 33] and face verification [13, 27].", "startOffset": 95, "endOffset": 110}, {"referenceID": 13, "context": "They have been increasingly adopted in a variety of vision tasks such as product visual search [1, 14, 29, 33] and face verification [13, 27].", "startOffset": 95, "endOffset": 110}, {"referenceID": 28, "context": "They have been increasingly adopted in a variety of vision tasks such as product visual search [1, 14, 29, 33] and face verification [13, 27].", "startOffset": 95, "endOffset": 110}, {"referenceID": 32, "context": "They have been increasingly adopted in a variety of vision tasks such as product visual search [1, 14, 29, 33] and face verification [13, 27].", "startOffset": 95, "endOffset": 110}, {"referenceID": 12, "context": "They have been increasingly adopted in a variety of vision tasks such as product visual search [1, 14, 29, 33] and face verification [13, 27].", "startOffset": 133, "endOffset": 141}, {"referenceID": 26, "context": "They have been increasingly adopted in a variety of vision tasks such as product visual search [1, 14, 29, 33] and face verification [13, 27].", "startOffset": 133, "endOffset": 141}, {"referenceID": 0, "context": "The embedding objective is usually in a Euclidean sense: the Euclidean distance Di,j = \u2016f(xi)\u2212 f(xj)\u20162 between two feature vectors should preserve their semantic relationship encoded pairwise (by contrastive loss [1]), in triplets [27, 33] or even higher order relationships (e.", "startOffset": 213, "endOffset": 216}, {"referenceID": 26, "context": "The embedding objective is usually in a Euclidean sense: the Euclidean distance Di,j = \u2016f(xi)\u2212 f(xj)\u20162 between two feature vectors should preserve their semantic relationship encoded pairwise (by contrastive loss [1]), in triplets [27, 33] or even higher order relationships (e.", "startOffset": 231, "endOffset": 239}, {"referenceID": 32, "context": "The embedding objective is usually in a Euclidean sense: the Euclidean distance Di,j = \u2016f(xi)\u2212 f(xj)\u20162 between two feature vectors should preserve their semantic relationship encoded pairwise (by contrastive loss [1]), in triplets [27, 33] or even higher order relationships (e.", "startOffset": 231, "endOffset": 239}, {"referenceID": 28, "context": ", by lifted structured loss [29]).", "startOffset": 28, "endOffset": 32}, {"referenceID": 2, "context": "Selecting overly easy samples can in practice lead to slow convergence and poor performance since many of them satisfy the constraint well and give nearly zero loss, without exerting any effect on parameter update during the back-propagation [3].", "startOffset": 242, "endOffset": 245}, {"referenceID": 6, "context": "Hence hard example mining [7] becomes an indispensable step in state-of-the-art deep embedding methods.", "startOffset": 26, "endOffset": 29}, {"referenceID": 26, "context": "For instance, in [27, 29], hard negatives with small Euclidean distances are found online in a mini-batch.", "startOffset": 17, "endOffset": 25}, {"referenceID": 28, "context": "For instance, in [27, 29], hard negatives with small Euclidean distances are found online in a mini-batch.", "startOffset": 17, "endOffset": 25}, {"referenceID": 32, "context": "An exception is [33] where an online reservoir importance sampling scheme is proposed to sample discriminative triplets by relevance scores.", "startOffset": 16, "endOffset": 20}, {"referenceID": 26, "context": "Deep Euclidean metric Triplet loss [27,33] Position-Dependent Deep Metric Double header hinge loss", "startOffset": 35, "endOffset": 42}, {"referenceID": 32, "context": "Deep Euclidean metric Triplet loss [27,33] Position-Dependent Deep Metric Double header hinge loss", "startOffset": 35, "endOffset": 42}, {"referenceID": 18, "context": "Figure 1: (a) 2-D feature embedding (by t-SNE [19]) of the CUB-200-2011 [32] test set.", "startOffset": 46, "endOffset": 50}, {"referenceID": 31, "context": "Figure 1: (a) 2-D feature embedding (by t-SNE [19]) of the CUB-200-2011 [32] test set.", "startOffset": 72, "endOffset": 76}, {"referenceID": 10, "context": "We observed similar phenomenon for the global Mahalanobis metric [11, 12, 21, 35, 36] in our experiments.", "startOffset": 65, "endOffset": 85}, {"referenceID": 11, "context": "We observed similar phenomenon for the global Mahalanobis metric [11, 12, 21, 35, 36] in our experiments.", "startOffset": 65, "endOffset": 85}, {"referenceID": 20, "context": "We observed similar phenomenon for the global Mahalanobis metric [11, 12, 21, 35, 36] in our experiments.", "startOffset": 65, "endOffset": 85}, {"referenceID": 34, "context": "We observed similar phenomenon for the global Mahalanobis metric [11, 12, 21, 35, 36] in our experiments.", "startOffset": 65, "endOffset": 85}, {"referenceID": 35, "context": "We observed similar phenomenon for the global Mahalanobis metric [11, 12, 21, 35, 36] in our experiments.", "startOffset": 65, "endOffset": 85}, {"referenceID": 2, "context": "[3] resorted to human intervention for harvesting genuinely hard samples.", "startOffset": 0, "endOffset": 3}, {"referenceID": 12, "context": "Existing studies [13, 14, 27, 29, 33] only consider the two latter objectives but not together with the first.", "startOffset": 17, "endOffset": 37}, {"referenceID": 13, "context": "Existing studies [13, 14, 27, 29, 33] only consider the two latter objectives but not together with the first.", "startOffset": 17, "endOffset": 37}, {"referenceID": 26, "context": "Existing studies [13, 14, 27, 29, 33] only consider the two latter objectives but not together with the first.", "startOffset": 17, "endOffset": 37}, {"referenceID": 28, "context": "Existing studies [13, 14, 27, 29, 33] only consider the two latter objectives but not together with the first.", "startOffset": 17, "endOffset": 37}, {"referenceID": 32, "context": "Existing studies [13, 14, 27, 29, 33] only consider the two latter objectives but not together with the first.", "startOffset": 17, "endOffset": 37}, {"referenceID": 31, "context": "Image retrieval experiments on two challenging real-world vision datasets, CUB-200-2011 [32] and CARS196 [15], show that our local similarity-aware feature embedding significantly outperforms state-of-the-art deep embedding methods that come without the online metric learning and associated hard sample mining scheme.", "startOffset": 88, "endOffset": 92}, {"referenceID": 14, "context": "Image retrieval experiments on two challenging real-world vision datasets, CUB-200-2011 [32] and CARS196 [15], show that our local similarity-aware feature embedding significantly outperforms state-of-the-art deep embedding methods that come without the online metric learning and associated hard sample mining scheme.", "startOffset": 105, "endOffset": 109}, {"referenceID": 28, "context": ", [29]), which need to compute a fully connected dense matrix of pairwise distances in a mini-batch.", "startOffset": 2, "endOffset": 6}, {"referenceID": 4, "context": "This is validated in the transfer learning and zero-shot learning (using the ImageNet hierarchy as auxiliary knowledge) tasks on ImageNet 2010 and ImageNet-10K [5] datasets.", "startOffset": 160, "endOffset": 163}, {"referenceID": 3, "context": "pedestrian detection [4, 7].", "startOffset": 21, "endOffset": 27}, {"referenceID": 6, "context": "pedestrian detection [4, 7].", "startOffset": 21, "endOffset": 27}, {"referenceID": 26, "context": "In a similar spirit, contemporary deep embedding methods [27, 29] choose hard samples in a mini-batch by computing the Euclidean distance in the embedding space.", "startOffset": 57, "endOffset": 65}, {"referenceID": 28, "context": "In a similar spirit, contemporary deep embedding methods [27, 29] choose hard samples in a mini-batch by computing the Euclidean distance in the embedding space.", "startOffset": 57, "endOffset": 65}, {"referenceID": 26, "context": "[27] selected online the semi-hard negative samples with relatively small Euclidean distances.", "startOffset": 0, "endOffset": 4}, {"referenceID": 32, "context": "[33] proposed an online reservoir importance sampling algorithm to sample triplets by relevance scores, which are computed offline with different distance metrics.", "startOffset": 0, "endOffset": 4}, {"referenceID": 27, "context": "Similar studies on image descriptor learning [28] and unsupervised feature learning [34] also select hard samples according to the Euclidean distance-based losses in their respective CNNs.", "startOffset": 45, "endOffset": 49}, {"referenceID": 33, "context": "Similar studies on image descriptor learning [28] and unsupervised feature learning [34] also select hard samples according to the Euclidean distance-based losses in their respective CNNs.", "startOffset": 84, "endOffset": 88}, {"referenceID": 0, "context": "Similarities can be encoded pairwise with a contrastive loss [1] or in more flexible triplets [27, 33].", "startOffset": 61, "endOffset": 64}, {"referenceID": 26, "context": "Similarities can be encoded pairwise with a contrastive loss [1] or in more flexible triplets [27, 33].", "startOffset": 94, "endOffset": 102}, {"referenceID": 32, "context": "Similarities can be encoded pairwise with a contrastive loss [1] or in more flexible triplets [27, 33].", "startOffset": 94, "endOffset": 102}, {"referenceID": 28, "context": "[29] extended to even higher order similarity constraints by lifting the pairwise distances within a mini-batch to the dense matrix of pairwise distances.", "startOffset": 0, "endOffset": 4}, {"referenceID": 11, "context": "Representative works [12, 36] minimize the Mahalanobis distance between positive sample pairs while maximizing the distance between negative pairs.", "startOffset": 21, "endOffset": 29}, {"referenceID": 35, "context": "Representative works [12, 36] minimize the Mahalanobis distance between positive sample pairs while maximizing the distance between negative pairs.", "startOffset": 21, "endOffset": 29}, {"referenceID": 10, "context": "Alternatives directly optimize the Mahalanobis metric for nearest neighbor classification via the method of Neighbourhood Component Analysis (NCA) [11], Large Margin Nearest Neighbor (LMNN) [35] or Nearest Class Mean (NCM) [21].", "startOffset": 147, "endOffset": 151}, {"referenceID": 34, "context": "Alternatives directly optimize the Mahalanobis metric for nearest neighbor classification via the method of Neighbourhood Component Analysis (NCA) [11], Large Margin Nearest Neighbor (LMNN) [35] or Nearest Class Mean (NCM) [21].", "startOffset": 190, "endOffset": 194}, {"referenceID": 20, "context": "Alternatives directly optimize the Mahalanobis metric for nearest neighbor classification via the method of Neighbourhood Component Analysis (NCA) [11], Large Margin Nearest Neighbor (LMNN) [35] or Nearest Class Mean (NCM) [21].", "startOffset": 223, "endOffset": 227}, {"referenceID": 8, "context": "An intuitive remedy would be to learn multiple metrics [9], which would be computationally expensive though.", "startOffset": 55, "endOffset": 58}, {"referenceID": 36, "context": "[37] proposed a single adaptive metric using the absolute position information in random forest classifiers.", "startOffset": 0, "endOffset": 4}, {"referenceID": 36, "context": "Our approach shares the similar intuition, but incorporates the position information by a deep CNN in a more principled way, and can jointly learn similarity-aware deep features instead of using hand-crafted ones as in [37].", "startOffset": 219, "endOffset": 223}, {"referenceID": 36, "context": "Specifically, inspired by [37], apart from the feature difference vector u, we additionally incorporate the feature mean vector v = (f(xi) + f(xj))/2 to encode the absolute position.", "startOffset": 26, "endOffset": 30}, {"referenceID": 36, "context": "Unlike [37], we formulate a principled learnable similarity metric from u and v in our CNN.", "startOffset": 7, "endOffset": 11}, {"referenceID": 36, "context": "Or alternatively, we can cast the problem as a binary classification one as in [37].", "startOffset": 79, "endOffset": 83}, {"referenceID": 19, "context": "One intuitive option is to impose the Fisher criterion [20] on the similarity scores, i.", "startOffset": 55, "endOffset": 59}, {"referenceID": 26, "context": "Since all features are `2-normalized (see Figure 2), we have \u03b2+D\u00ee,\u0135\u2212D\u00ee,k\u0302 = \u03b2\u22122f(x\u00ee)f(x\u0135)+2f(x\u00ee)f(xk\u0302), and can conveniently derive the gradients as those in triplet-based methods [27, 33].", "startOffset": 180, "endOffset": 188}, {"referenceID": 32, "context": "Since all features are `2-normalized (see Figure 2), we have \u03b2+D\u00ee,\u0135\u2212D\u00ee,k\u0302 = \u03b2\u22122f(x\u00ee)f(x\u0135)+2f(x\u00ee)f(xk\u0302), and can conveniently derive the gradients as those in triplet-based methods [27, 33].", "startOffset": 180, "endOffset": 188}, {"referenceID": 0, "context": "The contrastive [1], triplet [27, 33] and lifted structured [29] embeddings select hard samples by the Euclidean distance that is not adaptive to the local feature structure.", "startOffset": 16, "endOffset": 19}, {"referenceID": 26, "context": "The contrastive [1], triplet [27, 33] and lifted structured [29] embeddings select hard samples by the Euclidean distance that is not adaptive to the local feature structure.", "startOffset": 29, "endOffset": 37}, {"referenceID": 32, "context": "The contrastive [1], triplet [27, 33] and lifted structured [29] embeddings select hard samples by the Euclidean distance that is not adaptive to the local feature structure.", "startOffset": 29, "endOffset": 37}, {"referenceID": 28, "context": "The contrastive [1], triplet [27, 33] and lifted structured [29] embeddings select hard samples by the Euclidean distance that is not adaptive to the local feature structure.", "startOffset": 60, "endOffset": 64}, {"referenceID": 0, "context": "Contrastive [1] embedding is trained on pairwise data {(xi, xj , yi,j)}, and tries to minimize the distance between the positive feature pair and penalize the distance between negative feature pair for being smaller than a margin \u03b1.", "startOffset": 12, "endOffset": 15}, {"referenceID": 26, "context": "Triplet embedding [27, 33] samples the triplet data {(xa, xp, xn)} where xa is an anchor point and xp, xn are from the same and different class, respectively.", "startOffset": 18, "endOffset": 26}, {"referenceID": 32, "context": "Triplet embedding [27, 33] samples the triplet data {(xa, xp, xn)} where xa is an anchor point and xp, xn are from the same and different class, respectively.", "startOffset": 18, "endOffset": 26}, {"referenceID": 28, "context": "While lifted structured embedding [29] considers all the positive feature pairs (e.", "startOffset": 34, "endOffset": 38}, {"referenceID": 28, "context": "Also, our method is more efficient than the lifted structured embedding [29] that requires computing dense pairwise distances within a mini-batch.", "startOffset": 72, "endOffset": 76}, {"referenceID": 30, "context": "3 Implementation details We use GoogLeNet [31] (feature dimension d = 128) and CaffeNet [16] (d = 4096) as our base network architectures for retrieval and transfer learning tasks respectively.", "startOffset": 42, "endOffset": 46}, {"referenceID": 15, "context": "3 Implementation details We use GoogLeNet [31] (feature dimension d = 128) and CaffeNet [16] (d = 4096) as our base network architectures for retrieval and transfer learning tasks respectively.", "startOffset": 88, "endOffset": 92}, {"referenceID": 29, "context": "The fully-connected layers of our PDDM unit are initialized with random weights and followed by dropout [30] with p = 0.", "startOffset": 104, "endOffset": 108}, {"referenceID": 0, "context": "And, we always scale S\u00ee,\u0135 into the range [0, 1] by the similarity graph in the batch.", "startOffset": 41, "endOffset": 47}, {"referenceID": 31, "context": "Specifically, we use the CUB-200-2011 [32] dataset with 200 bird classes and 11,788", "startOffset": 38, "endOffset": 42}, {"referenceID": 31, "context": "CUB-200-2011 Figure 4: Top: a comparison of the training convergence curves of our method with Euclidean- and PDDM-based hard quadruplet mining on the test sets of CUB-200-2011 [32] and CARS196 [15] datasets.", "startOffset": 177, "endOffset": 181}, {"referenceID": 14, "context": "CUB-200-2011 Figure 4: Top: a comparison of the training convergence curves of our method with Euclidean- and PDDM-based hard quadruplet mining on the test sets of CUB-200-2011 [32] and CARS196 [15] datasets.", "startOffset": 194, "endOffset": 198}, {"referenceID": 31, "context": "Table 1: Recall@K (%) on the test sets of CUB-200-2011 [32] and CARS196 [15] datasets.", "startOffset": 55, "endOffset": 59}, {"referenceID": 14, "context": "Table 1: Recall@K (%) on the test sets of CUB-200-2011 [32] and CARS196 [15] datasets.", "startOffset": 72, "endOffset": 76}, {"referenceID": 0, "context": "CUB-200-2011 CARS196 K 1 2 4 8 16 32 1 2 4 8 16 32 Contrastive [1] 26.", "startOffset": 63, "endOffset": 66}, {"referenceID": 26, "context": "4 Triplet [27, 33] 36.", "startOffset": 10, "endOffset": 18}, {"referenceID": 32, "context": "4 Triplet [27, 33] 36.", "startOffset": 10, "endOffset": 18}, {"referenceID": 28, "context": "8 LiftedStruct [29] 47.", "startOffset": 15, "endOffset": 19}, {"referenceID": 14, "context": "Another used dataset is CARS196 [15] with 196 car classes and 16,185 images.", "startOffset": 32, "endOffset": 36}, {"referenceID": 28, "context": "Note the two resulting approaches both incur lower computational costs than [29], with a near linear rather than quadratic [29] complexity in mini-batches.", "startOffset": 76, "endOffset": 80}, {"referenceID": 28, "context": "Note the two resulting approaches both incur lower computational costs than [29], with a near linear rather than quadratic [29] complexity in mini-batches.", "startOffset": 123, "endOffset": 127}, {"referenceID": 0, "context": "In particular, our full \u2018PDDM+Quadruplet\u2019 method yields large gains (8%+ Recall@K=1) over previous works [1, 27, 29, 33] all using the Euclidean distance for hard sample mining.", "startOffset": 105, "endOffset": 120}, {"referenceID": 26, "context": "In particular, our full \u2018PDDM+Quadruplet\u2019 method yields large gains (8%+ Recall@K=1) over previous works [1, 27, 29, 33] all using the Euclidean distance for hard sample mining.", "startOffset": 105, "endOffset": 120}, {"referenceID": 28, "context": "In particular, our full \u2018PDDM+Quadruplet\u2019 method yields large gains (8%+ Recall@K=1) over previous works [1, 27, 29, 33] all using the Euclidean distance for hard sample mining.", "startOffset": 105, "endOffset": 120}, {"referenceID": 32, "context": "In particular, our full \u2018PDDM+Quadruplet\u2019 method yields large gains (8%+ Recall@K=1) over previous works [1, 27, 29, 33] all using the Euclidean distance for hard sample mining.", "startOffset": 105, "endOffset": 120}, {"referenceID": 4, "context": "Table 2: The flat top-1 accuracy (%) of transfer learning on ImageNet-10K [5] and flat top-5 accuracy (%) of zero-shot learning on ImageNet 2010.", "startOffset": 74, "endOffset": 77}, {"referenceID": 4, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 70, "endOffset": 73}, {"referenceID": 25, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 74, "endOffset": 78}, {"referenceID": 22, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 79, "endOffset": 83}, {"referenceID": 17, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 84, "endOffset": 88}, {"referenceID": 20, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 89, "endOffset": 93}, {"referenceID": 21, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 105, "endOffset": 109}, {"referenceID": 7, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 117, "endOffset": 120}, {"referenceID": 23, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 125, "endOffset": 129}, {"referenceID": 24, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 130, "endOffset": 134}, {"referenceID": 20, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 135, "endOffset": 139}, {"referenceID": 9, "context": "Transfer learning on ImageNet-10K Zero-shot learning on ImageNet 2010 [5] [26] [23] [18] [21] Ours ConSE [22] DeViSE [8] PST [24] [25] [21] AMP [10] Ours 6.", "startOffset": 144, "endOffset": 148}, {"referenceID": 5, "context": "Existing methods explored the knowledge of part detectors [6] or attribute classifiers [17] across classes.", "startOffset": 58, "endOffset": 61}, {"referenceID": 16, "context": "Existing methods explored the knowledge of part detectors [6] or attribute classifiers [17] across classes.", "startOffset": 87, "endOffset": 91}, {"referenceID": 16, "context": "The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22].", "startOffset": 46, "endOffset": 50}, {"referenceID": 20, "context": "The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22].", "startOffset": 70, "endOffset": 78}, {"referenceID": 24, "context": "The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22].", "startOffset": 70, "endOffset": 78}, {"referenceID": 9, "context": "The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22].", "startOffset": 107, "endOffset": 115}, {"referenceID": 23, "context": "The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22].", "startOffset": 107, "endOffset": 115}, {"referenceID": 7, "context": "The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22].", "startOffset": 130, "endOffset": 137}, {"referenceID": 21, "context": "The description can be in terms of attributes [17], WordNet hierarchy [21, 25], semantic class label graph [10, 24], or text data [8, 22].", "startOffset": 130, "endOffset": 137}, {"referenceID": 1, "context": "These learning scenarios are also related to the open set one [2] where new classes grow continuously.", "startOffset": 62, "endOffset": 65}, {"referenceID": 20, "context": "For transfer learning, we follow [21] to train our feature embeddings and a Nearest Class Mean (NCM) classifier [21] on the large-scale ImageNet 20101 dataset, which contains 1,000 classes and more than 1.", "startOffset": 33, "endOffset": 37}, {"referenceID": 20, "context": "For transfer learning, we follow [21] to train our feature embeddings and a Nearest Class Mean (NCM) classifier [21] on the large-scale ImageNet 20101 dataset, which contains 1,000 classes and more than 1.", "startOffset": 112, "endOffset": 116}, {"referenceID": 4, "context": "Then we apply the NCM classifier to the larger ImageNet-10K [5] dataset with 10,000 classes, thus do not use any auxiliary knowledge such as parts and attributes.", "startOffset": 60, "endOffset": 63}, {"referenceID": 17, "context": "Table 2 shows that our features outperform state-of-the-art methods by a large margin, including the deep feature-based ones [18, 21].", "startOffset": 125, "endOffset": 133}, {"referenceID": 20, "context": "Table 2 shows that our features outperform state-of-the-art methods by a large margin, including the deep feature-based ones [18, 21].", "startOffset": 125, "endOffset": 133}, {"referenceID": 20, "context": "For zero-shot learning, we follow the standard settings in [21, 25] on ImageNet 2010: we learn our feature embeddings on 800 classes, and test on the remaining 200 classes.", "startOffset": 59, "endOffset": 67}, {"referenceID": 24, "context": "For zero-shot learning, we follow the standard settings in [21, 25] on ImageNet 2010: we learn our feature embeddings on 800 classes, and test on the remaining 200 classes.", "startOffset": 59, "endOffset": 67}], "year": 2016, "abstractText": "Existing deep embedding methods in vision tasks are capable of learning a compact Euclidean space from images, where Euclidean distances correspond to a similarity metric. To make learning more effective and efficient, hard sample mining is usually employed, with samples identified through computing the Euclidean feature distance. However, the global Euclidean distance cannot faithfully characterize the true feature similarity in a complex visual feature space, where the intraclass distance in a high-density region may be larger than the interclass distance in low-density regions. In this paper, we introduce a Position-Dependent Deep Metric (PDDM) unit, which is capable of learning a similarity metric adaptive to local feature structure. The metric can be used to select genuinely hard samples in a local neighborhood to guide the deep embedding learning in an online and robust manner. The new layer is appealing in that it is pluggable to any convolutional networks and is trained end-to-end. Our local similarity-aware feature embedding not only demonstrates faster convergence and boosted performance on two complex image retrieval datasets, its large margin nature also leads to superior generalization results under the large and open set scenarios of transfer learning and zero-shot learning on ImageNet 2010 and ImageNet-10K datasets.", "creator": "LaTeX with hyperref package"}}}