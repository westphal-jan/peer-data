{"id": "1002.4908", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "26-Feb-2010", "title": "Adaptive Bound Optimization for Online Convex Optimization", "abstract": "we introduce a new online convex optimization algorithm that adaptively chooses its regularization function based on the exact loss functions observed since so far. this is in contrast to previous algorithms that use a fixed regularization function such are as l2 - squared, and modify it only via a single time - dependent parameter. our algorithm's regret bounds are worst - matching case optimal, and for certain technically realistic classes of loss functions they are much better than existing bounds. these bounds are problem - dependent, which means they can exploit the structure ambiguity of the actual problem instance. critically, however, our algorithm does not need context to really know this structure in advance. rather, we prove competitive guarantees that show the algorithm provides a bound within a constant cost factor of the best possible matching bound ( of a certain functional form ) in hindsight.", "histories": [["v1", "Fri, 26 Feb 2010 01:36:34 GMT  (63kb,S)", "http://arxiv.org/abs/1002.4908v1", null], ["v2", "Wed, 7 Jul 2010 19:07:16 GMT  (21kb)", "http://arxiv.org/abs/1002.4908v2", "Updates to match final COLT version"]], "reviews": [], "SUBJECTS": "cs.LG", "authors": ["h brendan mcmahan", "matthew streeter"], "accepted": false, "id": "1002.4908"}, "pdf": {"name": "1002.4908.pdf", "metadata": {"source": "CRF", "title": "Adaptive Bound Optimization for Online Convex Optimization", "authors": ["H. Brendan McMahan", "Matthew Streeter"], "emails": ["mcmahan@google.com", "mstreeter@google.com"], "sections": [{"heading": null, "text": "ar X\niv :1\n00 2.\n49 08\nv1 [\ncs .L\nG ]\n2 6"}, {"heading": "1 Introduction", "text": "We consider online convex optimization in the full information feedback setting. A closed, bounded convex feasible set F \u2286 Rn is given as input, and on each round t = 1, . . . , T , we must pick a point xt \u2208 F . A convex loss function ft is then revealed, and we incur loss ft(xt). Our regret at the end of T rounds is\nRegret \u2261 T \u2211\nt=1\nft(xt)\u2212min x\u2208F\nT \u2211\nt=1\nft(x). (1)\nExisting algorithms for online convex optimization are worst-case optimal in terms of certain fundamental quantities. In particular, online gradient descent attains a bound of O(DM \u221a T ) where D is the L2 diameter of the feasible set and M is a bound on L2-norm of the gradients of the loss functions. This bound is tight in the worst case, in that it is possible to construct problems where this much regret is inevitable. However, this does not mean that an algorithm that achieves this bound is optimal in a practical sense, as on easy problem instances such an algorithm is still allowed to incur the worst-case regret. In particular, although this bound is minimax optimal when the feasible set is a hypersphere [Abernethy et al., 2008], we will see that it can be arbitrarily bad when the feasible set is the hypercube.\nTo improve over the existing worst-case guarantees, we introduce additional parameters that capture more of the problem\u2019s structure. These parameters depend on the loss functions, which are not known in advance. To address this, we first construct functional upper bounds on regretBR(\u03b81, . . . , \u03b8T ; f1, . . . , fT )\nthat depend on both (properties of) the loss functions ft and algorithm parameters \u03b8t. We then give algorithms for choosing the parameters \u03b8t adaptively (based only on f1, f2, . . . , ft\u22121) and prove that these adaptive schemes provide a regret bound that is only a constant factor worse than the best possible regret bound of the form BR. Formally, if for all possible function sequences f1, . . . fT we have\nBR(\u03b81, . . . , \u03b8T ; f1, . . . , fT ) \u2264 \u03ba inf \u03b8\u2032 1 ,...,\u03b8\u2032 T \u2208\u0398T BR(\u03b8 \u2032 1, . . . , \u03b8 \u2032 T ; f1, . . . , fT )\nfor the adaptively-selected \u03b8t, we say the adaptive scheme is \u03ba-competitive for the bound optimization problem. In Section 1.2, we provide realistic examples where known bounds are much worse than the problem-dependent bounds obtained by our algorithm."}, {"heading": "1.1 Follow the proximally-regularized leader", "text": "We analyze a follow the regularized leader (FTRL) algorithm that adaptively selects regularization functions of the form\nrt(x) = 1\n2 \u2016(Q\n1 2\nt (x\u2212 xt)\u201622 where Qt is a positive semidefinite matrix. Our algorithm plays x1 = 0 on round 1 (we assume without loss of generality that 0 \u2208 F ), and on round t+ 1, selects the point\nxt+1 = argmin x\u2208F\n(\nt \u2211\n\u03c4=1\n( r\u03c4 (x) + f\u03c4 (x) )\n)\n. (2)\nIn contrast to other FTRL algorithms, such as the dual averaging method of Xiao [2009], we center the additional regularization at the current feasible point xt rather than at the origin. Accordingly, we call this algorithm follow the proximally-regularized leader (FTPRL). This proximal centering of additional regularization is similar in spirit to the optimization solved by online gradient descent (and more generally, online mirror descent, [Cesa-Bianchi and Lugosi, 2006]). However, rather than considering only the current gradient, our algorithm considers the sum of all previous gradients, and so solves a global rather than local optimization on each round. We discuss related work in more detail in Section 4.\nThe FTPRL algorithm allows a clean analysis from first principles, which we present in Section 2. The proof techniques are rather different from those used for online gradient descent algorithms, and will likely be of independent interest.\nFor a convex set F , we defineFsym = {x\u2212 x\u2032 | x, x\u2032 \u2208 F}, and write ~Qt as shorthand for (Q1, Q2, . . . , QT ), with ~gt defined analogously. Using this notation, we can state our regret bound as\nRegret \u2264 BR( ~Qt, ~gt) \u2261 1\n2\nT \u2211\nt=1\nmax y\u0302\u2208Fsym\n( y\u0302TQty\u0302 ) +\nT \u2211\nt=1\ngTt Q \u22121 1:t gt (3)\nwhere gt is a subgradient of ft at xt. We prove competitive ratios with respect to this BR for several adaptive schemes for selecting the Qt matrices. In particular, when the FTPRL-Diag scheme is run on a hyperrectangle (a set of the form {x | xi \u2208 [ai, bi]} \u2286 Rn), we achieve\nRegret \u2264 \u221a 2 inf\n~Q\u2208QTdiag BR( ~Qt, ~gt)\nwhere Qdiag = {diag(\u03bb1, . . . , \u03bbn) | \u03bbi \u2265 0}. When the FTPRL-Scale scheme is run on a feasible set of the form F = {x | \u2016Ax\u20162 \u2264 1} for A \u2208 Sn++, it is competitive with arbitrary positive semidefinite matrices:\nRegret \u2264 \u221a 2 inf\n~Q\u2208(Sn + )T\nBR( ~Qt, ~gt) .\nOur analysis of FTPRL reveals a fundamental connection between the shape of the feasible set and the importance of choosing the regularization matrices adaptively. When the feasible set is a hyperrectangle, FTPRL-Diag has stronger bounds than known algorithms, except for degenerate cases where the bounds are identical. In contrast, when the feasible set is a hypersphere, {x | \u2016x\u20162 \u2264 1}, the bound BR is always optimized by choosing Qt = \u03bbtQ for suitable \u03bbt \u2208 Rn. The FTPRL-Scale scheme extends this result to hyperellipsoids by applying a suitable transformation. These results are presented in detail in Section 3."}, {"heading": "1.2 The practical importance of adaptive regularization", "text": "In the past few years, online algorithms have emerged as state-of-the-art techniques for solving largescale machine learning problems [Bottou and Bousquet, 2008, Ma et al., 2009, Zhang, 2004]. Two canonical examples of such large-scale learning problems are text classification on large datasets and predicting click-through-rates for ads on a search engine. For such problems, extremely large feature sets may be considered, but many features only occur rarely, while few occur very often. Our diagonaladaptation algorithm offers improved bounds for problems such as these.\nAs an example, suppose that on each round t, the ith component of \u25bdft(xt) (henceforth gt,i) is 1 with probability i\u2212\u03b1, and is 0 otherwise, for some \u03b1 \u2208 [1, 2). Such heavy-tailed distributions are common in text classification applications, where there is a feature for each word. In this case, gradient descent with a global learning rate obtains an expected regret bound of O( \u221a nT ). In contrast, the algorithms presented in this paper will obtain expected regret\nE\n\n\nn \u2211\ni=1\n\u221a \u221a \u221a \u221a T \u2211\nt=1\ng2t,i\n  \u2264 n \u2211\ni=1\n\u221a \u221a \u221a \u221a T \u2211\nt=1\nE [ g2t,i ] =\nn \u2211\ni=1\n\u221a T i\u2212\u03b1 = O( \u221a T \u00b7 n1\u2212\u03b12 )\nusing Jensen\u2019s inequality. This bound is never worse than the O( \u221a nT ) bound achieved by ordinary gradient descent, and can be substantially better. For example, in problems where a constant fraction of examples contain a new feature, n is \u2126(T ) and the bound for ordinary gradient descent is vacuous. In contrast, the bound for our algorithm is O(T 3\u2212\u03b1\n2 ), which is sublinear for \u03b1 > 1. This performance difference is not merely a weakness in the regret bounds for ordinary gradient descent, but is a difference in actual regret. In concurrent work [Streeter and McMahan, 2010], we showed that for some problem families, a per-coordinate learning rate for online gradient descent provides asymptotically less regret than even the best non-increasing global learning rate (chosen in hindsight, given the observed loss functions). This construction can be adapted to FTPRL as:\nTheorem 1. There exists a family of online convex optimization problems, parametrized by the number of rounds T , where online subgradient descent with a non-increasing learning rate sequence (and FTPRL with non-decreasing coordinate-constant regularization) incurs regret at least \u2126(T 2 3 ), whereas FTPRL with appropriate diagonal regularization matrices Qt has regret O( \u221a T ).\nIn fact, essentially any online learning algorithm with a regret bound of the formO(MD \u221a T ) (where D is the L2 diameter of the feasible region, and M is a bound on the L2 norm of the gradients) will suffer regret \u2126(T 2 3 ) on this family of problems. Note that this does not contradict the O(MD \u221a T ) upper bound on the regret, because in this family of problems D = T 1 6 (and M = 1)."}, {"heading": "1.3 Adaptive algorithms and competitive ratios", "text": "In Section 3, we introduce specific schemes for selecting the regularization matrices Qt for FTPRL, and show that for certain feasible sets, these algorithms provide bounds within a constant factor of those for the best post-hoc choice of matrices, namely\ninf ~Qt\u2208QT\nBR( ~Qt, ~gt) (4)\nwhere Q \u2286 Sn+ is a set of allowed matrices; Sn+ is the set of symmetric positive semidefinite n \u00d7 n matrices, with Sn++ the corresponding set of symmetric positive definite matrices. We consider three different choices for Q: the set of coordinate-constant matrices Qconst = {\u03b1I | \u03b1 \u2265 0}; the set of nonnegative diagonal matrices, Qdiag = {diag(\u03bb1, . . . , \u03bbn) | \u03bbi \u2265 0} ; and, the full set of positive-semidefinite matrices, Qfull = Sn+.\nWe first consider the case where the feasible region is an Lp unit ball, namely F = {x | \u2016x\u2016p \u2264 1}. For p \u2208 [1, 2], we show that a simple algorithm (an analogue of standard online gradient descent) that selects matrices from Qconst is \u221a 2-competitive with the best post-hoc choice of matrices from the full set of positive semidefinite matrices Qfull = Sn+. This algorithm is presented in Corollary 1, and the competitive ratio is proved in Theorem 6.\nIn contrast to the result for p \u2208 [1, 2], we show that for Lp balls with p > 2 a coordinate-independent choice of matrices (Qt \u2208 Qconst) does not in general obtain the post-hoc optimal bound (see Section 3.3), and hence per-coordinate adaptation can help. The benefit of per-coordinate adaptation is most pronounced for the L\u221e-ball, where the coordinates are essentially independent. In light of this, we develop an efficient algorithm (FTPRL-Diag, Algorithm 1) for adaptively selecting Qt from Qdiag, which uses scaling based on the width of F in the coordinate directions (Corollary 2). In this corollary, we also show that this algorithm \u221a 2-competitive with the best post-hoc choice of matrices from Qdiag when the feasible set is a hyperrectangle. While per-coordinate adaptation does not help for the unit L2-ball, it can help when the feasible set is a hyperellipsoid. In particular, in the case where F = {x | \u2016Ax\u20162 \u2264 1} for A \u2208 Sn++, we show that an appropriate transformation of the problem can produce significantly better regret bounds. More generally, we show (see Theorem 5) that if one has a \u03ba-competitive adaptive FTPRL scheme for the feasible set {x | \u2016x\u2016 \u2264 1} for an arbitrary norm, it can be extended to provide a \u03ba-competitive algorithm for feasible sets of the form {x | \u2016Ax\u2016 \u2264 1}. Using this result, we can show FTPRL-Scale is \u221a 2-competitive with the best post-hoc choice of matrices from Sn+ when F = {x | \u2016Ax\u20162 \u2264 1} and\nA \u2208 Sn++; it is \u221a 2-competitive with Qdiag when F = {x | \u2016Ax\u2016p \u2264 1} for p \u2208 [1, 2).\nOf course, in many practical applications the feasible set may not be so nicely characterized. We emphasize that our algorithms and analysis are applicable to arbitrary feasible sets, but the quality of the bounds and competitive ratios will depend on how tightly the feasible set can be approximated by a suitably chosen transformed norm ball. In Theorem 3, we show in particular that when FTPRL-Diag is applied to an arbitrary feasible set, it provides a competitive guarantee related to the ratio of the widths of the smallest hyperrectangle that contains F to the largest hyperrectangle contained in F ."}, {"heading": "1.4 Notation and technical background", "text": "We use the notation g1:t as a shorthand for \u2211t\n\u03c4=1 g\u03c4 . Similarly we write Q1:t for a sum of matrices Qt, and f1:t to denote the function f1:t(x) = \u2211t \u03c4=1 f\u03c4 (x). We write x\nTy or x \u00b7 y for the inner product between x, y \u2208 Rn. The ith entry in a vector x is denoted xi \u2208 R; when we have a sequence of vectors xt \u2208 Rn indexed by time, the ith entry is xt,i \u2208 R. We use \u2202f(x) to denote the set of subgradients of f evaluated at x.\nRecall A \u2208 Sn++ means \u2200x 6= 0, xTAx > 0. We use the generalized inequality A \u227b 0 when A \u2208 Sn++, and similarly A \u227a B when B \u2212 A \u227b 0, implying xTAx < xTBx. We define A B analogously for symmetric positive semidefinite matrices Sn+. For B \u2208 Sn+, we write B1/2 for the square root of B, the unique X \u2208 Sn+ such that XX = B (see, for example, Boyd and Vandenberghe [2004, A.5.2]). We also make use of the fact that any A \u2208 Sn+ can be factored as A = PDPT where PTP = I and D = diag(\u03bb1, . . . , \u03bbn) where \u03bbi are the eigenvalues of A.\nFollowing the arguments of Zinkevich [2003], for the remainder we restrict our attention to linear functions. Briefly, the convexity of ft implies ft(x) \u2265 gTt (x \u2212 xt) + ft(xt), where gt \u2208 \u2202f(xt). Because this inequality is tight for x = xt, it follows that regret measured against the affine functions on the right hand side is an upper bound on true regret. Furthermore, regret is unchanged if we replace this affine function with the linear function gTt x. Thus, so long as our algorithm only makes use of the subgradients gt, we may assume without loss of generality that the loss functions are linear.\nTaking into account this reduction and the functional form of the rt, the update of FTPRL is\nxt+1 = argmin x\u2208F\n(\n1\n2\nt \u2211\n\u03c4=1\n(x \u2212 x\u03c4 )TQ\u03c4 (x\u2212 x\u03c4 ) + g1:t \u00b7 x ) . (5)"}, {"heading": "2 Analysis of FTPRL", "text": "In this section, we prove the following bound on the regret of FTPRL for an arbitrary sequence of regularization matrices Qt. In this section \u2016 \u00b7 \u2016 always means the L2 norm, \u2016 \u00b7 \u20162. Theorem 2. Let F \u2286 Rn be a closed, bounded convex set with 0 \u2208 F . Let Q1 \u2208 Sn++, and Q2, . . . , QT \u2208 Sn+. Define rt(x) = 12\u2016Q 1 2 t (x \u2212 xt)\u201622, and At = (Q1:t) 1 2 . Let ft be a sequence of loss functions, with gt \u2208 \u2202ft(xt) a sub-gradient of ft at xt. Then, the FTPRL algorithm that that faces loss functions f , plays x1 = 0, and uses the update of Equation (5) thereafter, has a regret bound\nRegret \u2264 r1:T (\u030ax) + T \u2211\nt=1\n\u2016A\u22121t gt\u20162\nwhere x\u030a = argminx\u2208F f1:T (x) is the post-hoc optimal feasible point.\nTo prove Theorem 2 we will make use of the following bound on the regret of FTPRL, which holds for arbitrary (possibly non-convex) loss functions. The proof is similar to arguments of [Kalai and Vempala, 2005], and is given in Appendix A.\nLemma 1. Let r1, r2, . . . , rT be a sequence of non-negative functions. The regret of FTPRL (which plays xt as defined by Equation (2)) is bounded by\nr1:T (\u030ax) +\nT \u2211\nt=1\n(ft(xt)\u2212 ft(xt+1))\nwhere x\u030a is the post-hoc optimal feasible point.\nOnce Lemma 1 is established, to prove Theorem 2 it suffices to show that for all t,\nft(xt)\u2212 ft(xt+1) \u2264 \u2016A\u22121t gt\u20162. (6)\nTo show this, we first establish an alternative characterization of our algorithm as solving an unconstrained optimization followed by a suitable projection onto the feasible set. Define the projection operator,\nPF ,A(u) = argmin x\u2208F\n\u2016A(x\u2212 u)\u2016\nWe will show that the following is an equivalent formula for xt:\nut+1 = argmin u\u2208Rn\n(r1:t(u) + g1:t \u00b7 u)\nxt+1 = PF ,At (ut+1) . (7)\nThis characterization will be useful, because the unconstrained solutions depend only on the linear functions gt, and the quadratic regularization, and hence are easy to manipulate in closed form.\nTo show this equivalence, first note that because Qt \u2208 Sn+ is symmetric,\nrt(u) = 1\n2 (u\u2212 xt)TQt(u\u2212 xt) =\n1 2 uTQtu\u2212 xTt Qtut + 1 2 xTt Qtxt.\nDefining constants qt = Qtxt and kt = 12x T t Qtxt, we can write\nr1:t(u) = 1\n2 uTQ1:tu\u2212 q1:tu+ k1:t. (8)\nThe equivalence is then a corollary of the following lemma, choosing Q = Q1:t and h = g1:t \u2212 q1:t (note that the constant term k1:t does not influence the argmin).\nLemma 2. Let Q \u2208 Sn++, and consider the function\nf(x) = hTx+ 1\n2 xTQx.\nLet u\u030a = argminu\u2208Rn f(u). Then, letting A = Q 1 2 , we have PF,A(\u030au) = argminx\u2208F f(x).\nProof. Note that \u25bduf(u) = h+Qu, implying that u\u030a = \u2212Q\u22121h. Consider the function\nf \u2032(x) = 1 2 \u2016Q 12 (x\u2212 u\u030a)\u20162 = 1 2 (x\u2212 u\u030a)TQ(x\u2212 u\u030a).\nWe have\nf \u2032(x) = 1\n2\n( xTQx\u2212 2xTQu\u030a+ u\u030aTQu\u030a )\n(because Q is symmetric)\n= 1\n2\n( xTQx+ 2xTQ(Q)\u22121h+ u\u030aTQu\u030a )\n= 1\n2\n( xTQx+ 2xTh+ u\u030aTQu\u030a )\n= f(x) + 1\n2 u\u030aTQu\u030a .\nBecause 12 u\u030a TQu\u030a is constant with respect to x, it follows that\nargmin x\u2208F f(x) = argmin x\u2208F\nf \u2032(x) = PF,A(\u030au),\nwhere the last equality follows from the definition of the projection operator.\nWe now derive a closed-form solution to the unconstrained problem. It is easy to show \u25bdrt(u) = Qtu\u2212Qtxt, and so\n\u25bdr1:t(u) = Q1:tu\u2212 t \u2211\n\u03c4=1\nQ\u03c4x\u03c4 .\nBecause ut+1 is the optimum of the (strongly convex) unconstrained problem, and r1:t is differentiable, we must have \u25bdr1:t(ut+1) + g1:t = 0. Hence, we conclude Q1:tut+1 \u2212 \u2211t \u03c4=1 Q\u03c4x\u03c4 + g1:t = 0, or\nut+1 = Q \u22121 1:t\n(\nt \u2211\n\u03c4=1\nQ\u03c4x\u03c4 \u2212 g1:t ) . (9)\nThis closed-form solution will let us bound the difference between ut and ut+1 in terms of gt. The next Lemma relates this distance to the difference between xt and xt+1, which determines our per round regret (Equation (6)). In particular, we show that the projection operator only makes ut and ut+1 closer together, in terms of distance as measured by the norm \u2016At \u00b7 \u2016. We defer the proof to the end of the section.\nLemma 3. Let Q \u2208 Sn++ with A = Q 1 2 . Let F be a convex set, and let u1, u2 \u2208 Rn, with x1 = PF ,A(u1) and x2 = PF ,A(u2). Then,\n\u2016A(x2 \u2212 x1)\u2016 \u2264 \u2016A(u1 \u2212 u2)\u2016.\nWe now prove the following lemma, which will immediately yield the desired bound on ft(xt) \u2212 ft(xt+1).\nLemma 4. Let Q \u2208 Sn++ with A = Q 1 2 . Let v, g \u2208 Rn, and let u1 = \u2212Q\u22121v and u2 = \u2212Q\u22121(v + g). Then, letting x1 = PF ,A(u1) and x2 = PF ,A(u2),\ngT(x1 \u2212 x2) \u2264 \u2016A\u22121g\u20162.\nProof. The fact that Q = ATA \u227b 0 implies that \u2016A \u00b7 \u2016 and \u2016A\u22121 \u00b7 \u2016 are dual norms (see for example [Boyd and Vandenberghe, 2004, Sec. 9.4.1, pg. 476]). Using this fact,\ngT(x1 \u2212 x2) \u2264 \u2016A\u22121g\u2016 \u00b7 \u2016A(x1 \u2212 x2)\u2016 \u2264 \u2016A\u22121g\u2016 \u00b7 \u2016A(u1 \u2212 u2)\u2016 (Lemma 3) = \u2016A\u22121g\u2016 \u00b7 \u2016A(Q\u22121g)\u2016 (Equation (9)) = \u2016A\u22121g\u2016 \u00b7 \u2016A(A\u22121A\u22121)g)\u2016 (Because Q\u22121 = (AA)\u22121) = \u2016A\u22121g\u2016 \u00b7 \u2016A\u22121g\u2016.\nProof of Theorem 2: First note that because rt(xt) = 0 and rt is non-negative,xt = argminx\u2208F rt(x). For any functions f and g, if x\u2217 = argminx\u2208F f(x) and x \u2217 = argminx\u2208F g(x), then\nx\u2217 = argmin x\u2208F (f(x) + g(x)) .\nThus we have\nxt = argmin x\u2208F (g1:t\u22121x+ r1:t\u22121(x))\n= argmin x\u2208F (g1:t\u22121x+ r1:t(x)) (Because xt = argmin x\u2208F rt(x).)\n= argmin x\u2208F\n(\nhx+ 1\n2 xTQ1:tx\n)\nwhere the last line follows from Equation (8), letting h = g1:t\u22121 \u2212 q1:t = g1:t\u22121 \u2212 \u2211t\n\u03c4=1 Q\u03c4x\u03c4 , and dropping the constant k1:t. For xt+1, we have directly from the definitions\nxt+1 = argmin x\u2208F (g1:tx+ r1:t(x)) = argmin x\u2208F\n(\n(h+ gt)x+ 1\n2 xTQ1:tx\n)\n.\nThus, Lemma 2 implies xt = PF ,At(\u2212(Q1:t)\u22121h) and similarly xt+1 = PF ,At(\u2212(Q1:t)\u22121(h + gt)). Thus, by Lemma 4, gt(xt \u2212 xt+1) \u2264 \u2016A\u22121t gt\u20162. The theorem then follows from Lemma 1.\nProof of Lemma 3: Define\nB(x, u) = 1 2 \u2016A(x\u2212 u)\u20162 = 1 2 (x\u2212 u)TQ(x\u2212 u),\nso we can write equivalently x1 = argmin\nx\u2208F B(x, u1).\nThen, note that \u25bdxB(x, u1) = Qx\u2212Qu1, and so we must have (Qx1\u2212Qu1)T(x2\u2212x1) \u2265 0; otherwise for \u03b4 sufficiently small the point x1+ \u03b4(x2\u2212x1) would belong to F (by convexity) and would be closer to u1 than x1 is. Similarly, we must have (Qx2 \u2212Qu2)T(x1 \u2212 x2) \u2265 0. Combining these, we have the following equivalent inequalities:\n(Qx1 \u2212Qu1)T(x2 \u2212 x1)\u2212 (Qx2 \u2212Qu2)T(x2 \u2212 x1) \u2265 0 (x1 \u2212 u1)TQ(x2 \u2212 x1)\u2212 (x2 \u2212 u2)TQ(x2 \u2212 x1) \u2265 0 \u2212(x2 \u2212 x1)TQ(x2 \u2212 x1) + (u2 \u2212 u1)TQ(x2 \u2212 x1) \u2265 0\n(u2 \u2212 u1)TQ(x2 \u2212 x1) \u2265 (x2 \u2212 x1)Q(x2 \u2212 x1).\nLetting u\u0302 = u2 \u2212 u1, and x\u0302 = x2 \u2212 x1, we have x\u0302TQx\u0302 \u2264 u\u0302TQx\u0302. Since Q is positive semidefinite, we have (u\u0302 \u2212 x\u0302)TQ(u\u0302 \u2212 x\u0302) \u2265 0, or equivalently u\u0302TQu\u0302 + x\u0302TQx\u0302 \u2212 2x\u0302TQu\u0302 \u2265 0 (using the fact Q is also symmetric). Thus,\nu\u0302TQu\u0302 \u2265 \u2212x\u0302TQx\u0302+ 2x\u0302TQu\u0302 \u2265 \u2212x\u0302TQx\u0302+ 2x\u0302TQx\u0302 = x\u0302TQx\u0302, and so\n\u2016A(u2 \u2212 u1)\u20162 = u\u0302TQu\u0302 \u2265 x\u0302TQx\u0302 = \u2016A(x2 \u2212 x1)\u20162."}, {"heading": "3 Specific Adaptive Algorithms and Competitive Ratios", "text": "Before proceeding to the specific results, we establish several results that will be useful in the subsequent arguments. In order to prove that adaptive schemes for selecting Qt have good competitive ratios for the bound optimization problem, we will need to compare the bounds obtained by the adaptive scheme to the optimal post-hoc bound of Equation (4). Suppose the sequence Q1, . . . , QT is optimal for Equation (4), and consider the alternative sequence Q\u20321 = Q1:T and Q \u2032 t = 0 for t > 1. Using the fact that Q1:t Q1:t\u22121 implies Q \u22121 1:t Q\u221211:t\u22121, it is easy to show the alternative sequence also achieves the minimum. It follows that a sequence with Q1 = Q on the first round, and Qt = 0 thereafter is always optimal. Hence, to solve for the post-hoc bound we can solve an optimization of the form\ninf Q\u2208Q max y\u2208Fsym\n(\n1 2 yTQy\n)\n+\nT \u2211\nt=1\ngTt Q \u22121gt. (10)\nWhen F is symmetric (x \u2208 F implies \u2212x \u2208 F ), we can replace the optimization over Fsym with optimization over F :\ninf Q\u2208Q max y\u2208F\n( 2yTQy ) +\nT \u2211\nt=1\ngTt Q \u22121gt. (11)\nFor simplicity of exposition, we assume g1,i > 0 for all i, which ensures that only positive definite matrices can be optimal.1 This assumption also ensures Q1 \u2208 Sn++ for the adaptive schemes discussed below, as required by Theorem 2. This is without loss of generality, as we can always hallucinate an initial loss function with arbitrarily small components, and this changes regret by an arbitrarily small amount.\nWe will use the following Lemma from [Streeter and McMahan, 2010]. A proof is included in Appendix B.\nLemma 5. For any non-negative real numbers x1, x2, . . . , xn,\nn \u2211\ni=1\nxi \u221a\n\u2211i j=1 xj\n\u2264 2\n\u221a \u221a \u221a \u221a n \u2211\ni=1\nxi ."}, {"heading": "3.1 Adaptive coordinate-constant regularization", "text": "We derive bounds where Qt is chosen from the set Qconst, and show that this algorithm comes within a factor of \u221a 2 of using the best constant regularization strength \u03bbI . This algorithm achieves a bound of O(DM \u221a T ) where D is the diameter of the feasible region and M is a bound on \u2016gt\u20162, matching the best possible bounds in terms of these parameters [Abernethy et al., 2008].\nCorollary 1. Suppose F has L2 diameter D. Then, if we run FTPRL with diagonal matrices such that\n(Q1:t)ii = \u03b1\u0304t = 2 \u221a Gt\nD\n1In the case where F has 0 width in some direction, the infimum will not be attained by a finite Q, but by a sequence that assigns 0 penalty (on the right-hand side) to the components of the gradient in the direction of 0 width, requiring some entries in Q to go to \u221e.\nwhere Gt = \u2211t\n\u03c4=1 \u2211n i=1 g 2 \u03c4,i, then\nRegret \u2264 2D \u221a\nGT .\nIf \u2016gt\u20162 \u2264 M , then GT \u2264 M2T , and this translates to a bound of O(DM \u221a T ). When F =\n{x | \u2016x\u20162 \u2264 D/2}, this bound is \u221a 2-competitive for the bound optimization problem over Qconst.\nWe will prove a much stronger competitive guarantee for this algorithm in Theorem 6.\nProof. Let the diagonal entries of Qt all be \u03b1t = \u03b1\u0304t \u2212 \u03b1\u0304t\u22121 (with \u03b1\u0304(0) = 0), so \u03b11:t = \u03b1\u0304t. Note \u03b1t \u2265 0, and so this choice is feasible. We consider the left and right-hand terms of Equation (3) separately. For the left-hand term, letting y\u0302t be an arbitrary sequence of points from Fsym, and noting y\u0302Tt y\u0302t \u2264 \u2016y\u0302t\u20162 \u00b7 \u2016y\u0302t\u20162 \u2264 D2,\n1\n2\nT \u2211\nt=1\ny\u0302Tt Qty\u0302t = 1\n2\nT \u2211\nt=1\ny\u0302Tt y\u0302t\u03b1t \u2264 1\n2 D2\nT \u2211\nt=1\n\u03b1t = 1\n2 D2\u03b1\u0304T = D\n\u221a\nGT\nFor the right-hand term, we have\nT \u2211\nt=1\ngTt Q \u22121 1:t gt =\nT \u2211\nt=1\nn \u2211\ni=1\ng2t,i \u03b11:t = T \u2211\nt=1\nD\n2\n\u2211n i=1 g 2 t,i\u221a\nGt \u2264 D\n\u221a\nGT ,\nwhere the last inequality follows from Lemma 5. In order to make a competitive guarantee, we must prove a lower bound on the post-hoc optimal bound function BR, Equation (10). This is in contrast to the upper bound that we must show for the regret of the algorithm. When F = {x | \u2016x\u20162 \u2264 D/2}, Equation (10) simplifies to exactly\nmin \u03b1\u22650\n(\n1 2 \u03b1D2 + 1 \u03b1 GT\n)\n= D \u221a\n2GT (12)\nand so we conclude the adaptive algorithm is \u221a 2-competitive for the bound optimization problem."}, {"heading": "3.2 Adaptive diagonal regularization", "text": "In this section, we introduce and analyze FTPRL-Diag, a specialization of FTPRL that uses regularization matrices from Qdiag. Let Di = maxx,x\u2032\u2208F |xi \u2212 x\u2032i|, the width of F along the ith coordinate. We construct a bound on the regret of FTPRL-Diag in terms of these Di. The Di implicitly define a hyperrectangle that contains F . When F is in fact such a hyperrectangle, our bound is \u221a 2-competitive with the best post-hoc optimal bound using matrices from Qdiag.\nCorollary 2. Let F be a convex feasible set of width Di in coordinate i. We can construct diagonal matrices Qt such that the ith entry on the diagonal of Q1:t is given by:\n\u03bb\u0304t,i = 2\nD i\n\u221a \u221a \u221a \u221a t \u2211\n\u03c4=1\ng2\u03c4,i.\nAlgorithm 1 FTPRL-Diag\nInput: feasible set F \u2286 \u00d7ni=1[ai, bi] Initialize x1 = 0 \u2208 F (\u2200i), Gi = 0, qi = 0, \u03bb0,i = 0, Di = bi \u2212 ai for t = 1 to T do\nPlay the point xt, incur loss ft(xt) Let gt \u2208 \u2202ft(xt) for i = 1 to n do Gi = Gi + g 2 t,i\n\u03bbt,i = 2 Di\n\u221a Gi \u2212 \u03bb1:t\u22121,i\nqi = qi + xt,i\u03bbt,i ut+1,i = (g1:t,i \u2212 qi)/\u03bb1:t,i\nend for At = diag( \u221a \u03bb1:t,1, . . . , \u221a\n\u03bb1:t,n) xt+1 = ProjectF ,At(ut+1)\nend for\nAlgorithm 2 FTPRL-Scale\nInput: feasible set F \u2286 {x | \u2016Ax\u2016 \u2264 1}, with A \u2208 Sn++ Let F\u0302 = {x | \u2016x\u2016 \u2264 1} Initialize x1 = 0, (\u2200i) Di = bi \u2212 ai for t = 1 to T do\nPlay the point xt, incur loss ft(xt) Let gt \u2208 \u2202ft(xt) g\u0302t = (A \u22121)Tgt \u03b1\u0304 = \u221a\n\u2211t \u03c4=1 \u2211n i=1 g\u0302 2 \u03c4,i\n\u03b1t = \u03b1\u0304\u2212 \u03b11:t\u22121 qt = \u03b1txt u\u0302t+1 = (1/\u03b1\u0304)(q1:t \u2212 g1:t) At = (\u03b1\u0304I) 1 2 x\u0302t+1 = ProjectF\u0302,At(u\u0302t+1) xt+1 = A\n\u22121x\u0302 end for\nThen the regret of FTPRL satisfies\nRegret \u2264 2 n \u2211\ni=1\nDi\n\u221a \u221a \u221a \u221a T \u2211\nt=1\ng2t,i.\nWhen F is a hyperrectangle, then this algorithm is \u221a 2-competitive with the post-hoc optimal choice of Qt from the Qdiag. That is,\nRegret \u2264 \u221a 2 inf Q\u2208Qdiag\n(\nmax y\u0302\u2208Fsym\n(\n1 2 y\u0302TQy\u0302\n)\n+\nT \u2211\nt=1\ngTt Q \u22121gt\n)\n.\nProof. The construction of Q1:t in the theorem statement implies (Qt)ii = \u03bbt,i \u2261 \u03bb\u0304t,i \u2212 \u03bb\u0304t\u22121,i. These entries are guaranteed to be non-negative as \u03bb\u0304t,i is a non-decreasing function of t.\nWe begin from Equation (3), letting y\u0302t be an arbitrary sequence of points from Fsym. For the lefthand term,\n1\n2\nT \u2211\nt=1\ny\u0302Tt Qty\u0302t = 1\n2\nT \u2211\nt=1\nn \u2211\ni=1\ny\u03022t,i\u03bbt,i \u2264 1\n2\nn \u2211\ni=1\nD2i\nT \u2211\nt=1\n\u03bbt,i = 1\n2\nn \u2211\ni=1\nD2i \u03bb\u0304T,i =\nn \u2211\ni=1\nDi\n\u221a \u221a \u221a \u221a T \u2211\nt=1\ng2t,i.\nFor the right-hand term, we have\nT \u2211\nt=1\ngTt Q \u22121 1:t gt =\nT \u2211\nt=1\nn \u2211\ni=1\ng2t,i \u03bb\u0304t,i = n \u2211\ni=1\nDi 2\nT \u2211\nt=1\ng2t,i \u221a\n\u2211t \u03c4=1 g 2 \u03c4,i\n\u2264 n \u2211\ni=1\nDi\n\u221a \u221a \u221a \u221a T \u2211\nt=1\ng2t,i,\nwhere the last inequality follows from Lemma 5. Summing these bounds on the two terms of Equation (3) yields the stated bound on regret.\nNow, we consider the case where the feasible set is exactly a hyperrectangle, that is, F = {x | xi \u2208 [ai, bi]} where Di = bi \u2212 ai. Then, the the optimization of Equation (10) decomposes on a per-coordinate basis, and in particular there exists a y\u0302 \u2208 Fsym so that y\u03022i = D2i in each coordinate. Thus, for Q = diag(\u03bb1, . . . , \u03bbn), the bound function is exactly\nn \u2211\ni=1\n1 2 \u03bbiD 2 i + 1\n\u03bbi\nT \u2211\nt=1\ng2t,i.\nChoosing \u03bbi = 1Di\n\u221a\n2 \u2211T t=1 g 2 t,i minimizes this quantity, producing a post-hoc bound of\n\u221a 2 n \u2211\ni=1\nDi\n\u221a \u221a \u221a \u221a T \u2211\nt=1\ng2t,i,\nverifying that the adaptive scheme is \u221a 2-competitive with matrices from Qdiag.\nThe regret guarantees of FTPRL-Diag algorithm hold on arbitrary feasible sets, but the competitive guarantee only applies for hyperrectangles. We now extend this result, showing that a competitive guarantee can be made based on how well the feasible set is approximated by hyperrectangles.\nTheorem 3. Let F be an arbitrary feasible set, bounded by a hyperrectangle Hout of width Wi in coordinate i; further, let H in be a hyperrectangle contained by F , of width wi > 0 in coordinate i. That is, H in \u2286 F \u2286 Hout. Let \u03b2 = maxi Wiwi . Then, the FTPRL-Diag is \u221a 2\u03b2-competitive with Qdiag on F .\nProof. By Corollary 2, the adaptive algorithm achieves regret bounded by 2 \u2211n\ni=1 Wi\n\u221a\n\u2211T t=1 g 2 t,i. We\nnow consider the best post-hoc bound achievable with diagonal matrices on F . Considering Equation (10), it is clear that for any Q,\nmax y\u2208Fsym\n1 2 yTQy +\nT \u2211\nt=1\ngTt Q \u22121gt \u2265 max\ny\u2208H insym\n1 2 yTQy +\nT \u2211\nt=1\ngTt Q \u22121gt,\nsince the feasible set for the maximization (Fsym) is larger on the left-hand side. But, on the right-hand side we have the post-hoc bound for diagonal regularization on a hyperrectangle, which we computed in the previous section to be \u221a 2 \u2211n\ni=1 wi\n\u221a\n\u2211T t=1 g 2 t,i. Because wi \u2265 Wi\u03b2 by assumption, this is lower\nbounded by \u221a 2\n\u03b2 \u2211n i=1 Wi\n\u221a\n\u2211T t=1 g 2 t,i, which proves the theorem.\nHaving had success with L\u221e, we now consider the potential benefits of diagonal adaptation for other Lp-balls."}, {"heading": "3.3 A post-hoc bound for diagonal regularization on Lp balls", "text": "Suppose the feasible set F is an unit Lp-ball, that is F = {x | \u2016x\u2016p \u2264 1}. We consider the post-hoc bound optimization problem of Equation (11) with Q = Qdiag. Our results are summarized in the following theorem.\nTheorem 4. For p > 2, the optimal regularization matrix for BR in Qdiag is not coordinate-constant (i.e., not contained in Qconst), except in the degenerate case where Gi \u2261 \u2211T t=1 g 2 t,i is the same for all i. However, for p \u2264 2, the optimal regularization matrix in Qdiag always belongs to Qconst.\nProof. Since F is symmetric, the optimal post-hoc choice will be in the form of Equation (11). Letting Q = diag(\u03bb1, . . . , \u03bbn), we can re-write this optimization problem as\nmax y:\u2016y\u2016p\u22641\n(\n2\nn \u2211\ni=1\ny2i \u03bbi\n)\n+\nn \u2211\ni=1\nGi \u03bbi . (13)\nTo determine the optimal \u03bb vector, we first derive a closed form for the solution to the maximization problem on the left hand side, assuming p \u2265 2 (we handle the case p < 2 separately below). First note that the inequality \u2016y\u2016p \u2264 1 is equivalent to \u2211n i=1 |yi|p \u2264 1. Making the change of variable zi = y2i , this is equivalent to \u2211n\ni=1 z p 2\ni \u2264 1, which is equivalent to \u2016z\u2016 p2 \u2264 1 (the assumption p \u2265 2 ensures that \u2016 \u00b7 \u2016 p\n2 is a norm). Hence, the left-hand side optimization reduces to\nmax z:\u2016z\u2016 p\n2 \u22641\n2\nn \u2211\ni=1\nzi\u03bbi = \u2016\u03bb\u2016q,\nwhere q = pp\u22122 , so that \u2016 \u00b7 \u2016 p2 and \u2016 \u00b7 \u2016q are dual norms (allowing q = \u221e for p = 2). Thus, for p \u2265 2, the above bound simplifies to\nB(\u03bb) = 2\u2016\u03bb\u2016q + n \u2211\ni=1\nGi \u03bbi . (14)\nFirst suppose p > 2, so that q is finite. Then, taking the gradient of B(\u03bb),\n\u2207B(\u03bb)i = 2\nq\n(\nn \u2211\ni=1\n\u03bbqi\n) 1 q \u22121\n\u00b7 q\u03bbq\u22121i \u2212 Gi \u03bb2i = 2\n(\n\u03bbi \u2016\u03bb\u2016q\n)q\u22121 \u2212 Gi\n\u03bb2i ,\nusing 1q \u2212 1 = \u2212 1q (q \u2212 1). If we make all the \u03bbi\u2019s equal (say, to \u03bb1), then for the left-hand side we get\n(\n\u03bbi \u2016\u03bb\u2016q\n)q\u22121 =\n(\n\u03bb1\n(n\u03bbq1) 1 q\n)q\u22121\n=\n(\n1 n 1 q\n)q\u22121 = n 1 q \u22121 .\nThus the ith component of the gradient is 2n 1 q \u22121 \u2212 Gi\n\u03bb2 1\n, and so if not all the Gi\u2019s are equal, some\ncomponent of the gradient is non-zero. Because B(\u03bb) is differentiable and the \u03bbi \u2265 0 constraints cannot be tight (recall g1 > 0), this implies a constant \u03bbi cannot be optimal, hence the optimal regularization matrix is not in Qconst.\nFor p \u2208 [1, 2], we show that the solution to Equation (13) is\nB\u221e(\u03bb) \u2261 2\u2016\u03bb\u2016\u221e + n \u2211\ni=1\nGi \u03bbi . (15)\nFor p = 2 this follows immediately from Equation (14), because when p = 2 we have q = \u221e. For p \u2208 [1, 2), the solution to Equation (13) is at least B\u221e(\u03bb), because we can always set yi = 1 for\nwhatever \u03bbi is largest and set yj = 0 for j 6= i. If p < 2 then the feasible set F is a subset of the unit L2 ball, so the solution to Equation (13) is upper bounded by the solution when p = 2, namely B\u221e(\u03bb). It follows that the solution is exactly B\u221e(\u03bb). Because the left-hand term of B\u221e(\u03bb) only penalizes for the largest \u03bbi, and on the right-hand we would like all \u03bbi as large as possible, a solution of the form \u03bb1 = \u03bb2 = \u00b7 \u00b7 \u00b7 = \u03bbn must be optimal."}, {"heading": "3.4 Full matrix regularization on hyperspheres and hyperellipsoids", "text": "In this section, we develop an algorithm for feasible sets F \u2286 {x | \u2016Ax\u2016p \u2264 1}, where p \u2208 [1, 2] and A \u2208 Sn++. When F = {x | \u2016Ax\u20162 \u2264 1}, this algorithm, FTPRL-Scale, is \u221a 2-competitive with\narbitrary Q \u2208 Sn+. For F = {x | \u2016Ax\u2016p \u2264 1} with p \u2208 [1, 2) it is \u221a 2-competitive with Qdiag.\nFirst, we show that rather than designing adaptive schemes specifically for linear transformations of norm balls, it is sufficient (from the point of view of analyzing FTPRL) to consider unit norm balls if suitable pre-processing is applied. In the same fashion that pre-conditioning may speed batch subgradient descent algorithms, we show this approach can produce significantly improved regret bounds when A is poorly conditioned (the ratio of the largest to smallest eigenvalue is large).\nTheorem 5. Fix an arbitrary norm \u2016 \u00b7 \u2016, and define an online linear optimization problem I = (F , (g1, . . . , gT )) where F = {x | \u2016Ax\u2016 \u2264 1} with A \u2208 Sn++. We define the related instance I\u0302 = (F\u0302 , (g\u03021, . . . , g\u0302T )), where F\u0302 = {x\u0302 | \u2016x\u0302\u2016 \u2264 1} and g\u0302t = A\u22121gt. Then:\n\u2022 If we run any algorithm dependent only on subgradients on I\u0302, and it plays x\u03021, . . . , x\u0302T , then by playing the corresponding points xt = A\u22121x\u0302t on I we achieve identical loss and regret.\n\u2022 The post-hoc optimal bound over arbitrary Q \u2208 Sn++ is identical for these two instances.\nProof. First, we note for any suitable function h,\nmin x:\u2016Ax\u2016\u22641 h(x) = min x\u0302:\u2016x\u0302\u2016\u22641\nh(A\u22121x\u0302), (16)\nusing the change of variables x\u0302 = Ax. For the first claim, note that g\u0302Tt = g T t A \u22121, and so for all t, g\u0302Tt x\u0302t = g T t A\n\u22121Axt = gTt xt, implying the losses suffered on I\u0302 and I are identical. Applying Equation (16), we have\nmin x:\u2016Ax\u2016\u22641 gT1:tx = min x\u0302:\u2016x\u0302\u2016\u22641 gT1:tA \u22121x\u0302 = min x\u0302:\u2016x\u0302\u2016\u22641 g\u0302T1:tx\u0302,\nimplying the post-hoc optimal feasible points for the two instances also incur identical loss. Combining these two facts proves the first claim. For the second claim, it is sufficient to show for any Q \u2208 Sn++ applied to the post-hoc bound for problem I, there exists a Q\u0302 \u2208 Sn++ that achieves the same bound for I\u0302 (and vice versa). Consider such a Q for I. Then, again applying Equation (16), we have\nmax y:\u2016Ay\u2016p\u22641\n( 2yTQy ) +\nT \u2211\nt=1\ngTt Q \u22121gt = max\ny\u0302:\u2016y\u0302\u2016\u22641\n( 2y\u0302TA\u22121QA\u22121y\u0302 ) +\nT \u2211\nt=1\ng\u0302Tt AQ \u22121Ag\u0302t.\nThe left-hand side is the value of the post-hoc bound on I from Equation (11). Noting that (A\u22121QA\u22121)\u22121 = AQ\u22121A, the right-hand side is the value of the post hoc bound for I\u0302 using Q\u0302 = A\u22121QA\u22121. The fact A\u22121 and Q are in Sn++ guarantees Q\u0302 \u2208 Sn++ as well, and the theorem follows.\nWe can now define the adaptive algorithm FTPRL-Scale: given a F \u2286 {x | \u2016Ax\u2016p \u2264 1}, it uses the transformation suggested by Theorem 5, applying the coordinate-constant algorithm of Corollary 1 to the transformed instance, and playing the corresponding point mapped back into F .2 Pseudocode is given as Algorithm 2. Theorem 6. The diagonal-constant algorithm analyzed in Corollary 1 is \u221a 2-competitive with Sn+ when\nF = {x | \u2016x\u2016p \u2264 1} for p = 2, and \u221a 2-competitive against Qdiag when p \u2208 [1, 2). Furthermore, when F = {x | \u2016Ax\u2016p \u2264 1} with A \u2208 Sn++, the FTPRL-Scale algorithm (Algorithm 2) achieves these same competitive guarantees. In particular, when F = {x | \u2016x\u20162 \u2264 1}, we have\nRegret \u2264 \u221a 2 inf Q\u2208Sn\n+\n(\nmax y\u2208F\n( 2yTQy ) +\nT \u2211\nt=1\ngTt Q \u22121gt\n)\n.\nProof. The results for Qdiag with p \u2208 [1, 2) follow from Theorems 4 and 5 and Corollary 1. We now consider the p = 2 case. Consider a Q \u2208 Sn++ for Equation (11) (recall only a Q \u2208 Sn++ could be optimal since g1 > 0). We can write Q = PDPT where D = diag(\u03bb1, . . . , \u03bbn) is a diagonal matrix of positive eigenvalues and PPT = I . It is then easy to verify Q\u22121 = PD\u22121PT.\nWhen p = 2 and F = {x | \u2016x\u2016p \u2264 1}, Equation (15) is tight, and so the post-hoc bound for Q is\n2max i\n(\u03bbi) + T \u2211\nt=1\ngTt (PD \u22121PT)gt.\nLet zt = PTgt, so each right-hand term is \u2211n\ni=1 z2t,i \u03bbi\n. It is clear this quantity is minimized when the \u03bbi is chosen as large as possible, while on the left-hand side we are only penalized for the largest eigenvalue of Q (the largest \u03bbi). Thus, a solution where D = \u03b1I for \u03b1 > 0 is optimal. Plugging into the bound, we have\nB(\u03b1) = 2\u03b1+ T \u2211\nt=1\ngTt\n(\nP\n(\n1 \u03b1 I\n) PT ) gt = 2\u03b1+ 1\n\u03b1\nT \u2211\nt=1\ngTt gt = 2\u03b1+ GT \u03b1\nwhere we have used the fact that PPT = I . Setting \u03b1 = \u221a\nGT /2 produces a minimal post-hoc bound of 2 \u221a 2GT . The diameter D is 2, so the coordinate-constant algorithm has regret bound 4 \u221a GT (Corollary 1), proving the first claim of the theorem for p = 2. The second claim follows from Theorem 5.\nSuppose we have a problem instance whereF = {x | \u2016Ax\u20162 \u2264 1}whereA = diag(1/a1, . . . , 1/an) with ai > 0. To demonstrate the advantage offered by this transformation, we can compare the regret bound obtained by directly applying the algorithm of Corollary 1 to that of the FTPRL-Scale algorithm. Assume WLOG that maxi ai = 1, implying the diameter of F is 2. Let g1, . . . , gT be the loss functions for this instance. Recalling Gi = \u2211T t=1 g 2 t,i, applying Corollary 1 directly to this problem gives\nRegret \u2264 4\n\u221a \u221a \u221a \u221a n \u2211\ni=1\nGi. (17)\n2 By a slightly more cumbersome argument, it is possible to show that instead of applying this transformation, FTPRL can be run directly on F using appropriately transformed Qt matrices.\nThis is the same as the bound obtained by online subgradient descent and related algorithms as well. We now consider FTPRL-Scale, which uses the transformation of Theorem 5. Noting D = 2 for the hypersphere and applying Corollary 1 to the transformed problem gives an adaptive scheme with\nRegret \u2264 4\n\u221a \u221a \u221a \u221a n \u2211\ni=1\nT \u2211\nt=1\ng\u03022t,i = 4\n\u221a \u221a \u221a \u221a n \u2211\ni=1\na2i\nT \u2211\nt=1\ng2t,i = 4\n\u221a \u221a \u221a \u221a n \u2211\ni=1\na2iGi.\nThis bound is never worse than the bound of Equation (17), and can be arbitrarily better when many of the ai are much smaller than 1."}, {"heading": "4 Related work", "text": "In the batch convex optimization setting, it is well known that convergence rates can often be dramatically improved through the use of preconditioning, accomplished by an appropriate change of coordinates taking into account both the shape of the objective function and the feasible region [Boyd and Vandenberghe, 2004]. To our knowledge, this is the first work that extends these concepts (necessarily in a quite different form) to the problem of online convex optimization, where they can provide a powerful tool for improving regret (the online analogue of convergence rates).\nPerhaps the closest algorithms in spirit to our diagonal adaptation algorithm are confidence-weighted linear classification [Drezde et al., 2008] and AROW [Crammer et al., 2009], in that they make differentsized adjustments for different coordinates. Unlike our algorithm, these algorithms apply only to classification problems and not to general online convex optimization, and the guarantees are in the form of mistake bounds rather than regret bounds.\nFTPRL is similar to the lazily-projected gradient descent algorithm of [Zinkevich, 2004, Sec. 5.2.3], but with a critical difference: the latter effectively centers regularization outside of the current feasible region (at ut rather than xt). As a consequence, lazily-projected gradient descent only attains low regret via a re-starting mechanism or a constant learning rate (chosen with knowledge of T ). It is our technique of always centering additional regularization inside the feasible set that allows us to make guarantees for adaptively-chosen regularization.\nMost recent state-of-the-art algorithms for online learning are in fact general algorithms for online convex optimization applied to learning problems. Many of these algorithms can be thought of as (significant) extensions of online subgradient descent, including [Duchi and Singer, 2009, Do et al., 2009, Shalev-Shwartz et al., 2007]. Apart from the very general work of [Kalai and Vempala, 2005], few general follow-the-regularized-leader algorithms have been analyzed, with the notable exception of the recent work of Xiao [2009].\nThe notion of proving competitive ratios for regret bounds that are functions of regularization parameters is not unique to this paper. Bartlett et al. [2008] and Do et al. [2009] proved guarantees of this form, but for a different algorithm and class of regularization parameters.\nIn an early version of this work, [Streeter and McMahan, 2010], the authors proved bounds similar to those of Corollary 2 for online gradient descent with per-coordinate learning rates. These results were significantly less general that the ones presented here, and in particular were restricted to the case where F was exactly a hyperrectangle. The FTPRL algorithm and bounds proved in this paper hold for arbitrary feasible sets, with the bound depending on the shape of the feasible set as well as the width along each dimension. Some results similar to those in this work were developed concurrently by Duchi et al. [2010], though for a different algorithm and using different analysis techniques."}, {"heading": "5 Conclusions", "text": "In this work, we analyzed a new algorithm for online convex optimization, which takes ideas both from online subgradient descent as well as follow-the-regularized-leader. In our analysis of this algorithm, we show that the learning rates that occur in standard bounds can be replaced by positive semidefinite matrices. The extra degrees of freedom offered by these generalized learning rates provide the key to proving better regret bounds. We characterized the types of feasible sets where this technique can lead to significant gains, and showed that while it does not help on the hypersphere, it can have dramatic impact when the feasible set is a hyperrectangle.\nThe diagonal adaptation algorithm we introduced can be viewed as an incremental optimization of the formula for the final bound on regret. In the case where the feasible set really is a hyperrectangle, this allows us to guarantee our final regret bound is within a small constant factor of the best bound that could have been obtained had the full problem been known in advance. The diagonal adaptation algorithm is efficient, and exploits exactly the kind of structure that is typical in large-scale real-world learning problems such as click-through-rate prediction and text classification.\nOur work leaves open a number of interesting directions for future work, in particular the development of competitive algorithms for arbitrary feasible sets (without resorting to bounding norm-balls), and the development of algorithms that optimize over richer families of regularization functions."}, {"heading": "A A Proof of the FTRL Bound", "text": "In this section we provide a proof of Lemma 1. The high-level structure of our proof follows Kalai and Vempala\u2019s analysis of the follow the perturbed leader algorithm, in that we prove bounds on three quantities:\n1. the regret of a hypothetical be the leader algorithm (BTL), which on round t plays\nx\u2217t = argmin x\u2208F f1:t(x),\n2. the difference between the regret of BTL and that of the be the regularized leader algorithm (BTRL), which plays\nx\u0302t = argmin x\u2208F (r1:t(x) + f1:t(x)) = xt+1, (18)\nand\n3. the difference between the regret of BTRL and that of FTRL.\nAs shown in [Kalai and Vempala, 2005], the BTL algorithm has regret \u2264 0 even without any restrictions on the loss functions or the feasible set. The proof is a straightforward induction, which we reproduce here for completeness.\nLemma 6 ([Kalai and Vempala, 2005]). Let f1, f2, . . . , fT be an arbitrary sequence of functions, and let F be an arbitrary set. Define x\u2217t \u2261 argminx\u2208F \u2211t \u03c4=1 f\u03c4 (x). Then\nT \u2211\nt=1\nft(x \u2217 t ) \u2264\nT \u2211\nt=1\nft(x \u2217 T ) .\nProof. We prove this by induction on T . For T = 1 it is trivially true. Suppose that it holds for T \u2212 1. Then\nT \u2211\nt=1\nft(x \u2217 t ) = fT (x \u2217 T ) +\nT\u22121 \u2211\nt=1\nf(x\u2217t )\n\u2264 fT (x\u2217T ) + T\u22121 \u2211\nt=1\nf(x\u2217T\u22121) (Induction hypothesis)\n\u2264 fT (x\u2217T ) + T\u22121 \u2211\nt=1\nf(x\u2217T ) (Definition of x \u2217 T\u22121)\n=\nT \u2211\nt=1\nf(x\u2217T ) .\nWe next prove a bound on the regret of BTRL.\nLemma 7. Let r1, r2, . . . , rT be a sequence of non-negative functions. Then BTRL, which on round t plays x\u0302t as defined by equation (18), has regret at most r1:T (\u030ax) where x\u030a is the post-hoc optimal solution.\nProof. Define f \u2032t(x) = ft(x) + rt(x). Observe that x\u0302t = argminx\u2208F f \u2032 1:t(x). Thus, by Lemma 6, we have T \u2211\nt=1\nf \u2032t(x\u0302t) \u2264 min x\u2208F f \u20321:T (x) \u2264 f \u20321:T (\u030ax)\nor equivalently, T \u2211\nt=1\nft(x\u0302t) + rt(x\u0302t) \u2264 r1:T (\u030ax) + f1:T (\u030ax).\nDropping the non-negative rt(x\u0302t) terms on the left hand side proves the lemma.\nBy definition, the total loss of FTRL (which plays xt) exceeds that of BTRL (which plays x\u0302t = xt+1) by \u2211T t=1 ft(xt)\u2212 ft(xt+1). Putting these facts together proves Lemma 1."}, {"heading": "B Proof of Lemma 5", "text": "Proof. The lemma is clearly true for n = 1. Fix some n, and assume the lemma holds for n\u2212 1. Thus,\nn \u2211\ni=1\nxi \u221a\n\u2211i j=1 xj\n\u2264 2\n\u221a \u221a \u221a \u221a n\u22121 \u2211\ni=1\nxi + xn \u221a\n\u2211n i=1 xi\n= 2 \u221a Z \u2212 x+ x\u221a\nZ\nwhere we define Z = \u2211n\ni=1 xi and x = xn. The derivative of the right hand side with respect to x is\u22121\u221a Z\u2212x + 1\u221a Z\n, which is negative for x > 0. Thus, subject to the constraint x \u2265 0, the right hand side is maximized at x = 0, and is therefore at most 2 \u221a Z ."}], "references": [{"title": "Optimal strategies and minimax lower bounds for online convex games", "author": ["Jacob Abernethy", "Peter L. Bartlett", "Alexander Rakhlin", "Ambuj Tewari"], "venue": "In COLT,", "citeRegEx": "Abernethy et al\\.,? \\Q2008\\E", "shortCiteRegEx": "Abernethy et al\\.", "year": 2008}, {"title": "Adaptive online gradient descent", "author": ["Peter L. Bartlett", "Elad Hazan", "Alexander Rakhlin"], "venue": "In NIPS,", "citeRegEx": "Bartlett et al\\.,? \\Q2008\\E", "shortCiteRegEx": "Bartlett et al\\.", "year": 2008}, {"title": "The tradeoffs of large scale learning", "author": ["L\u00e9on Bottou", "Olivier Bousquet"], "venue": "In Advances in Neural Information Processing Systems,", "citeRegEx": "Bottou and Bousquet.,? \\Q2008\\E", "shortCiteRegEx": "Bottou and Bousquet.", "year": 2008}, {"title": "Convex Optimization", "author": ["Stephen Boyd", "Lieven Vandenberghe"], "venue": null, "citeRegEx": "Boyd and Vandenberghe.,? \\Q2004\\E", "shortCiteRegEx": "Boyd and Vandenberghe.", "year": 2004}, {"title": "Prediction, Learning, and Games", "author": ["Nicolo Cesa-Bianchi", "Gabor Lugosi"], "venue": null, "citeRegEx": "Cesa.Bianchi and Lugosi.,? \\Q2006\\E", "shortCiteRegEx": "Cesa.Bianchi and Lugosi.", "year": 2006}, {"title": "Adaptive regularization of weight vectors", "author": ["Koby Crammer", "Alex Kulesza", "Mark Drezde"], "venue": "In NIPS,", "citeRegEx": "Crammer et al\\.,? \\Q2009\\E", "shortCiteRegEx": "Crammer et al\\.", "year": 2009}, {"title": "Proximal regularization for online and batch learning", "author": ["Chuong B. Do", "Quoc V. Le", "Chuan-Sheng Foo"], "venue": "In ICML,", "citeRegEx": "Do et al\\.,? \\Q2009\\E", "shortCiteRegEx": "Do et al\\.", "year": 2009}, {"title": "Confidence-weighted linear classification", "author": ["Mark Drezde", "Koby Crammer", "Fernando Pereira"], "venue": "In ICML,", "citeRegEx": "Drezde et al\\.,? \\Q2008\\E", "shortCiteRegEx": "Drezde et al\\.", "year": 2008}, {"title": "Efficient learning using forward-backward splitting", "author": ["John Duchi", "Yoram Singer"], "venue": "In Advances in Neural Information Processing Systems", "citeRegEx": "Duchi and Singer.,? \\Q2009\\E", "shortCiteRegEx": "Duchi and Singer.", "year": 2009}, {"title": "Adaptive subgradient methods for online learning and stochastic optimization", "author": ["John Duchi", "Elad Hazan", "Yoram Singer"], "venue": null, "citeRegEx": "Duchi et al\\.,? \\Q2010\\E", "shortCiteRegEx": "Duchi et al\\.", "year": 2010}, {"title": "Efficient algorithms for online decision problems", "author": ["Adam Kalai", "Santosh Vempala"], "venue": "Journal of Computer and Systems Sciences,", "citeRegEx": "Kalai and Vempala.,? \\Q2005\\E", "shortCiteRegEx": "Kalai and Vempala.", "year": 2005}, {"title": "Identifying suspicious URLs: an application of large-scale online learning", "author": ["Justin Ma", "Lawrence K. Saul", "Stefan Savage", "Geoffrey M. Voelker"], "venue": "In ICML,", "citeRegEx": "Ma et al\\.,? \\Q2009\\E", "shortCiteRegEx": "Ma et al\\.", "year": 2009}, {"title": "Pegasos: Primal Estimated sub-GrAdient SOlver for SVM", "author": ["Shai Shalev-Shwartz", "Yoram Singer", "Nathan Srebro"], "venue": "In ICML,", "citeRegEx": "Shalev.Shwartz et al\\.,? \\Q2007\\E", "shortCiteRegEx": "Shalev.Shwartz et al\\.", "year": 2007}, {"title": "Less regret via online conditioning", "author": ["Matthew Streeter", "H. Brendan McMahan"], "venue": "Submitted.,", "citeRegEx": "Streeter and McMahan.,? \\Q2010\\E", "shortCiteRegEx": "Streeter and McMahan.", "year": 2010}, {"title": "Dual averaging method for regularized stochastic learning and online optimization", "author": ["Lin Xiao"], "venue": "Advances in Neural Information Processing Systems", "citeRegEx": "Xiao.,? \\Q2009\\E", "shortCiteRegEx": "Xiao.", "year": 2009}, {"title": "Solving large scale linear prediction problems using stochastic gradient descent algorithms", "author": ["Tong Zhang"], "venue": "In ICML,", "citeRegEx": "Zhang.,? \\Q2004\\E", "shortCiteRegEx": "Zhang.", "year": 2004}, {"title": "Online convex programming and generalized infinitesimal gradient ascent", "author": ["Martin Zinkevich"], "venue": "In ICML,", "citeRegEx": "Zinkevich.,? \\Q2003\\E", "shortCiteRegEx": "Zinkevich.", "year": 2003}, {"title": "Theoretical guarantees for algorithms in multi-agent settings", "author": ["Martin Zinkevich"], "venue": "PhD thesis, Pittsburgh, PA,", "citeRegEx": "Zinkevich.,? \\Q2004\\E", "shortCiteRegEx": "Zinkevich.", "year": 2004}], "referenceMentions": [{"referenceID": 0, "context": "In particular, although this bound is minimax optimal when the feasible set is a hypersphere [Abernethy et al., 2008], we will see that it can be arbitrarily bad when the feasible set is the hypercube.", "startOffset": 93, "endOffset": 117}, {"referenceID": 4, "context": "This proximal centering of additional regularization is similar in spirit to the optimization solved by online gradient descent (and more generally, online mirror descent, [Cesa-Bianchi and Lugosi, 2006]).", "startOffset": 172, "endOffset": 203}, {"referenceID": 13, "context": "(2) In contrast to other FTRL algorithms, such as the dual averaging method of Xiao [2009], we center the additional regularization at the current feasible point xt rather than at the origin.", "startOffset": 79, "endOffset": 91}, {"referenceID": 13, "context": "In concurrent work [Streeter and McMahan, 2010], we showed that for some problem families, a per-coordinate learning rate for online gradient descent provides asymptotically less regret than even the best non-increasing global learning rate (chosen in hindsight, given the observed loss functions).", "startOffset": 19, "endOffset": 47}, {"referenceID": 3, "context": "For B \u2208 S +, we write B for the square root of B, the unique X \u2208 S + such that XX = B (see, for example, Boyd and Vandenberghe [2004, A.5.2]). We also make use of the fact that any A \u2208 S + can be factored as A = PDP where PP = I and D = diag(\u03bb1, . . . , \u03bbn) where \u03bbi are the eigenvalues of A. Following the arguments of Zinkevich [2003], for the remainder we restrict our attention to linear functions.", "startOffset": 105, "endOffset": 337}, {"referenceID": 10, "context": "The proof is similar to arguments of [Kalai and Vempala, 2005], and is given in Appendix A.", "startOffset": 37, "endOffset": 62}, {"referenceID": 13, "context": "We will use the following Lemma from [Streeter and McMahan, 2010].", "startOffset": 37, "endOffset": 65}, {"referenceID": 0, "context": "This algorithm achieves a bound of O(DM \u221a T ) where D is the diameter of the feasible region and M is a bound on \u2016gt\u20162, matching the best possible bounds in terms of these parameters [Abernethy et al., 2008].", "startOffset": 183, "endOffset": 207}], "year": 2017, "abstractText": "We introduce a new online convex optimization algorithm that adaptively chooses its regularization function based on the loss functions observed so far. This is in contrast to previous algorithms that use a fixed regularization function such as L2-squared, and modify it only via a single time-dependent parameter. Our algorithm\u2019s regret bounds are worst-case optimal, and for certain realistic classes of loss functions they are much better than existing bounds. These bounds are problem-dependent, which means they can exploit the structure of the actual problem instance. Critically, however, our algorithm does not need to know this structure in advance. Rather, we prove competitive guarantees that show the algorithm provides a bound within a constant factor of the best possible bound (of a certain functional form) in hindsight.", "creator": "LaTeX with hyperref package"}}}