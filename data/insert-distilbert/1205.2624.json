{"id": "1205.2624", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "9-May-2012", "title": "Convexifying the Bethe Free Energy", "abstract": "the introduction of loopy belief propagation ( lbp ) revitalized the application of graphical models known in many domains. many modern recent works present small improvements on the basic lbp algorithm used in an attempt to overcome convergence weaknesses and local optima problems. widely notable among these are convexified free energy approximations that lead to inference procedures with strong provable convergence and quality properties. however, empirically lbp still outperforms most of its convex variants in a variety of difficulty settings, as we also demonstrate here. motivated by this fact we seek convexified convex free energies formulas that directly approximate the bethe polynomials free energy. we show that the proposed such approximations compare favorably with state - of - the art convex approximation free energy approximations.", "histories": [["v1", "Wed, 9 May 2012 17:23:13 GMT  (1289kb)", "http://arxiv.org/abs/1205.2624v1", "Appears in Proceedings of the Twenty-Fifth Conference on Uncertainty in Artificial Intelligence (UAI2009)"]], "COMMENTS": "Appears in Proceedings of the Twenty-Fifth Conference on Uncertainty in Artificial Intelligence (UAI2009)", "reviews": [], "SUBJECTS": "cs.AI cs.LG", "authors": ["ofer meshi", "ariel jaimovich", "amir globerson", "nir friedman"], "accepted": false, "id": "1205.2624"}, "pdf": {"name": "1205.2624.pdf", "metadata": {"source": "CRF", "title": "Convexifying the Bethe Free Energy", "authors": ["Ofer Meshi", "Ariel Jaimovich", "Amir Globerson", "Nir Friedman"], "emails": ["meshi@cs.huji.ac.il", "arielj@cs.huji.ac.il", "gamir@cs.huji.ac.il", "nir@cs.huji.ac.il"], "sections": [{"heading": "1 Introduction", "text": "Computing likelihoods and marginal probabilities is a critical subtask in applications of graphical models. As computing the exact answers is often infeasible, there is a growing need for approximate inference methods. An important class of approximations are variational methods [7] that pose inference in terms of minimizing the free energy functional. In the last decade, loopy belief propagation (LBP), a simple local message passing procedure, proved to be empirically successful and was used in a variety of applications [10]. The seminal work of Yedidia et al. [20] merged these lines of work by formulating loopy belief propagation in terms of optimizing the Bethe free energy, an approximate free energy functional.\nLBP suffers from two inherent problems: it fails to converge in some cases, and may converge to local optima due to the non-convexity of the Bethe free energy. Several approaches have been introduced to fix the non-convergence issue, so that LBP provably converges to a local optimum of the Bethe free energy [17, 22]. However, this still leaves\nthe problem of local optima, and therefore the dependence of the solution on initial conditions. To alleviate this problem, several works [2, 6, 13, 15] construct convex free energy approximations, for which there is a single global optimum. Convexity also paved the way for the introduction of provably convergent message-passing algorithms for calculating likelihood and marginal probabilities [3, 4]. Moreover, some of these approximations provide upper bounds on the partition function [2, 13].\nDespite their algorithmic elegance and convergence properties, convex variants often do not provide better empirical results than LBP. While this observation is shared by many practitioners, it does not have firm theoretical justification. Motivated by this observation, our goal in this work is to construct approximations that are both convex and directly approximate the Bethe free energy. We show how to approximate the Bethe in L2 norm and how to find the best upper bound on it for a given random field. We then illustrate the utility of our proposed approximations by comparing them to previously suggested ones across a variety of models and parameterizations."}, {"heading": "2 Free Energy Approximations", "text": "Probabilistic graphical models provide a succinct language to specify complex joint probabilities over many variables. This is done by factorizing the distribution into a product over local potentials. Let x \u2208 Xn denote a vector of n discrete random variables. Here we focus on Markov Random Fields where the joint probability is given by:\np(x;\u03b8) = 1\nZ(\u03b8) exp {\u2211 \u03b1 \u03b8\u03b1(x\u03b1) + \u2211 i \u03b8i(xi) } (1)\nwhere \u03b1 correspond to subsets of parameters (or factors), and Z(\u03b8) is the partition function that serves to normalize the distribution. We denote marginal distributions over variables and factors by \u00b5i(xi) and \u00b5\u03b1(x\u03b1), respectively, and the vector of all marginals by \u00b5.\nGiven such a model, we are interested in computing the marginal probabilities \u00b5, as well as the partition function\nZ(\u03b8), which is required for calculating the likelihood of evidence, especially in the context of parameter estimation. Finding exact answers for these tasks is theoretically and practically hard and thus many works often resort to approximate inference.\nA class of popular approximate inference approaches are the variational methods that rely on the following exact formulation of logZ(\u03b8) [14]:\nlogZ(\u03b8) = max \u00b5\u2208M(G)\n{ \u03b8T\u00b5 +H(\u00b5) } (2)\nThe setM(G) is known as the marginal polytope associated with a graph G [14]. A vector \u00b5 is in M(G) if it corresponds to the marginals of some distribution p(x):\nM(G) = { \u00b5 \u2223\u2223\u2223\u2203p(x) s.t. \u00b5i(xi) = p(xi)\n\u00b5\u03b1(x\u03b1) = p(x\u03b1)\n} (3)\nH(\u00b5) is defined as the entropy of the unique exponential distribution of the form in Eq. (1) consistent with marginals \u00b5. Finally, the objective in Eq. (2) is the negative of the free energy functional, denoted F [\u00b5,\u03b8].\nThe solution to the optimization problem in Eq. (2) is precisely the desired vector of marginals of the distribution p(x;\u03b8).\nIn itself, this observation is not sufficient to provide an efficient algorithm, since the maximization in Eq. (2) is as hard as the original inference task. Specifically, M(G) is difficult to characterize and the computation of H(\u00b5) is also intractable, so both need to be approximated. First, one can relax the optimization problem to be over an outer bound on the marginal polytope. In particular, it is natural to require that the resulting pseudo-marginals obey some local normalization and marginalization constraints. These constraints define the local polytope\nL(G) = { \u00b5 \u2265 0 \u2223\u2223\u2223 \u2211xi \u00b5i(xi) = 1\u2211 x\u03b1\\xi \u00b5\u03b1(x\u03b1) = \u00b5i(xi) } (4)\nAs for the entropy term, a family of entropy approximations with a long history in statistical physics is based on a weighted sum of local entropies Hc(\u00b5) = \u2211 r crHr(\u00b5r), where r are subsets of variables (regions) and the coefficients cr are called counting numbers [21]. The approximate optimization problem then takes the form:\nlog Z\u0303(\u03b8) = max \u00b5\u2208L(G)\n{ \u03b8T\u00b5 +Hc(\u00b5) } (5)\nThe entropy approximation is defined both by the choice of regions and by the choice of counting numbers. This poses two complementary challenges: defining the regions, and assigning counting numbers for these regions. Here we focus on the second problem, which arises for any choice of regions. For simplicity, we limit ourselves to a common choice of regions \u2014 over variables and factors, although\nthe results to follow can be generalized to more elaborate region choices (e.g., [16, 18]). In this case the approximate entropy takes the form:\nHc(\u00b5) = \u2211 i ciHi(\u00b5i) + \u2211 \u03b1 c\u03b1H\u03b1(\u00b5\u03b1) (6)\nwhere ci and c\u03b1 are the counting numbers for variables and factors, respectively.\nEach set of counting numbers will result in a different approximation. The Bethe entropy approximation Hb(\u00b5) is defined by choosing c\u03b1 = 1, ci = 1 \u2212 di (where di = |{\u03b1 : i \u2208 \u03b1}|) [21].\nConcave Entropy Approximations\nOne shortcoming of the Bethe entropy is that it is not concave, and thus Eq. (5) may have local optima. It is possible to consider instead entropy approximations that are provably concave. Such approximations have been studied extensively in recent years, along with provable convergent algorithms for solving Eq. (5) in these cases. One of the first concave entropy approximations introduced was the tree-reweighting (TRW) method of Wainwright et al.[13]. The TRW entropy approximation is a convex combination of tree entropies and is concave. Furthermore, it is an upper bound on the true H(\u00b5) so that the optimum of Eq. (5) yields an upper bound on logZ(\u03b8).\nMore recently, Heskes [5] derived a set of sufficient condition for c\u03b1, ci to yield a concave function. He showed that an entropy approximation Hc(\u00b5) is provably concave for \u00b5 \u2208 L(G) if there exist auxiliary counting numbers c\u03b1\u03b1, cii, ci\u03b1 \u2265 0 such that\nc\u03b1 = c\u03b1\u03b1 + \u2211 i:i\u2208\u03b1 ci\u03b1 \u2200\u03b1 (7)\nci = cii \u2212 \u2211 \u03b1:i\u2208\u03b1 ci\u03b1 \u2200i (8)"}, {"heading": "3 Message Passing Algorithms", "text": "The optimization problem in Eq. (5) can be solved using generic optimization tools. However, message passing algorithms have proved especially useful for this task. Starting with the work of Yedidia et al.[20] many message passing algorithms have been proposed for optimizing variational approximations. Although not all these algorithms are provably convergent, if they do converge, it is to a fixed point of Eq. (5). Furthermore if the entropy Hc(\u00b5) is concave, this is the global optimum of Eq. (5).\nMost existing algorithms make the assumption that c\u03b1 = 1. Since in this work we want to explore a broader range of approximations, we derive message passing updates for the more general case (for any c\u03b1 6= 0). Our derivation, which follows closely the one of Yedidia et al., results with the following update rules:\nm\u03b1\u2192i(xi) = m0\u03b1\u2192i(xi) c\u03b1 c\u03b1\u2212qi+1n0i\u2192\u03b1(xi) qi\u2212c\u03b1 c\u03b1\u2212qi+1 (9)\nni\u2192\u03b1(xi) = m0\u03b1\u2192i(xi) qi\u22121 c\u03b1\u2212qi+1n0i\u2192\u03b1(xi) 1 c\u03b1\u2212qi+1 (10)\nWhere qi = 1\u2212cidi and:\nm0\u03b1\u2192i(xi) = \u2211 x\u03b1\\xi e 1 c\u03b1 \u03b8\u03b1(x\u03b1) \u220f j \u2208 \u03b1 j 6= i nj\u2192\u03b1(xj)\nn0i\u2192\u03b1(xi) = e \u03b8i(xi) \u220f \u03b2 : i \u2208 \u03b2 \u03b2 6= \u03b1 m\u03b2\u2192i(xi)\nNote that by plugging in the Bethe counting numbers, where c\u03b1 = 1 and ci = 1 \u2212 di , this reduces back to the standard BP messages. Furthermore, if we set c\u03b1 = 1 as in Yedidia et al. [21], then Eq. (9) and Eq. (10) reduce to the two-way algorithm defined there.\nThe above updates are not guaranteed to converge even if Hc(\u00b5) is concave. However, we have found that with dampening of messages it did converge for all the cases we studied."}, {"heading": "4 Properties of Counting Number Space", "text": "Given a specific model, different choices of counting numbers lead to different entropy approximations. But what are good counting numbers and how can we find those for a specific model?\nOne desirable property of counting numbers is that they result in concave entropies, as discussed in Section 2. There are several rationales for choosing those. One is clearly that optimization is globally optimal. The other is that the true entropy H(\u00b5) is itself concave [14].\nAnother approach to deriving good counting numbers is to restrict ourselves to c such that optimization with Hc(\u00b5) is exact for at least some values of \u03b8. For example, suppose we have a model where \u03b8\u03b1(x\u03b1) = 0 for all \u03b1 (i.e., a completely factorized model). How should we constrain c such\nthat these models are optimized correctly? It is easy to see that if c satisfies:\nci + \u2211 \u03b1,i\u2208\u03b1 c\u03b1 = 1 \u2200i (11)\nthen the corresponding Hc(\u00b5) will solve the factorized model exactly. We call c values that obey Eq. (11) variablevalid, as the variables are counted correctly in Hc(\u00b5) [21].\nIn a similar way we can define factor-valid approximations that satisfy:\nc\u03b1 = 1 \u2200\u03b1 (12)\nIntuitively, approximations that satisfy both Eq. (11) and Eq. (12) are valid [21] as they have the appealing property of not over- or under-counting variables and factors in the approximate entropy Hc(\u00b5). Furthermore, for tree structured distributions it has been shown that only valid counting numbers can yield exact results [11].\nFigure 1 illustrates the structure of the above constraints in the space of counting numbers. Note that the Bethe approximation is the single choice of counting numbers that is both factor- and variable-valid. The TRW approximation is, by definition, always variable-valid, and any distribution over spanning trees results in a different value of c\u03b1. Finally, we note that for different model structures the counting number space looks different. For example, the Bethe approximation for tree structured distributions is convex.\nTo better understand the properties of different counting numbers, we perform an experiment where the counting number space is two dimensional and can be visualized. For this we use 5\u00d7 5 toroidal grids in which each variable is connected to four neighboring variables by pairwise factors. The joint probability distribution of the model is given by: p(x;\u03b8) = 1Z(\u03b8) exp {\u2211 i \u03b8ixi + \u2211 (i,j)\u2208G \u03b8i,jxixj\n} with xi, xj \u2208 {\u00b11}. The field parameters \u03b8i were drawn uniformly from the range [\u2212\u03c9F , \u03c9F ], and the interaction parameters \u03b8i,j were drawn either from the range [\u2212\u03c9I , \u03c9I ] or from [0, \u03c9I ] to obtain mixed or attractive potentials respectively [2, 13]. This model structure has inherent symmetry as all factors are pairwise and each variable appears in exactly four factors. Hence, if we choose the counting numbers of the approximation based solely on the structure of the model, we get the same ci for all variables and the same c\u03b1 for all factors.\nFigure 2 shows the performance of various approximations on two models. The first model is sampled in an easy regime with relatively weak interaction parameters while the second model is sampled from a more difficult regime with stronger interaction parameters.\nWe observe that most convex free energy approximations have large errors both in the estimate of the logpartition and in that of the marginal beliefs. When looking at subspaces that tend to empirically perform better\nthan others, the convex subspace does not seem to generally give good approximations. However, we notice that variable-valid approximations stand out as the main region of relatively low error. In fact, we note that to the best of our knowledge all free energy approximations suggested in the literature obey this variable-valid constraint [2, 4, 13, 19, 21].\nThe rightmost column of Figure 2 shows performance of variable-valid approximations. We notice that for almost all models tested the approximation improves as the counting numbers get closer to the Bethe counting numbers. However, in most cases the Bethe approximation outperforms its convex counterparts. We obtained similar results for fully connected graphs and other non-pairwise models (not shown)."}, {"heading": "5 Approximating Bethe", "text": "The experiments in the previous section demonstrate that the Bethe free energy performs well across a variety of parameter settings. Since we would like to work with convex free energies, a key question is which of the convex free energies comes closest to the performance of Bethe.\nIn what follows, we describe several approaches to obtaining counting numbers that satisfy the above requirements. We divide these into static approximations that determine the counting numbers based only on the structure\nof the model, and adaptive approximations that also take the model parameters into account."}, {"heading": "5.1 Static Approximations", "text": "Following the insights of the previous section, it is natural to try to combine the convexity constraints of Eq. (7) and Eq. (8) with the validity constraints defined by Eq. (11). Inside this subspace, a straightforward choice is to find the counting numbers that are closest in terms of Euclidean distance to the Bethe counting numbers. For clarity we denote by b the vector of Bethe counting numbers with bi = 1\u2212di and b\u03b1 = 1. We define the convexBethe-c approximation as the solution to the optimization problem\nargmin c \u2016c\u2212 b\u20162 (13) s.t. ci, c\u03b1 satisfy Eq. (7,8,11).\nThis constrained optimization problem can be formulated as a quadratic program and solved using standard solvers. A similar approach was recently studied by Hazan and Shashua [4].\nHowever, it is not clear that the L2 metric in counting number space is adequate for approximating Bethe. In principle we would like to approximate the Bethe entropy itself rather than its counting numbers. Since Hb(\u00b5) is a function of \u00b5 we would like to find a function Hc(\u00b5) that is\nclosest to it when integrating over all \u00b5 values. We can put this formally as:\nargmin c \u222b L(G) (Hb(\u00b5)\u2212Hc(\u00b5))2 d\u00b5 (14)\ns.t. ci, c\u03b1 satisfy Eq. (7,8).\nWe integrate over L(G) since this is the optimization range in Eq. (5) and thus the relevant domain of approximation. Although this integration seems daunting, we can simplify the problem by noticing that Hb(\u00b5) and Hc(\u00b5) can be written as bTH\u00b5 and cTH\u00b5 respectively, where H\u00b5 is the vector of local entropies. This results in the following quadratic optimization problem:\nargmin c\n(b\u2212 c)TA(b\u2212 c) (15)\ns.t. ci, c\u03b1 satisfy Eq. (7,8).\nwhere A = \u222b L(G) H\u00b5HT\u00b5 d\u00b5\nis the matrix of integration of all pairwise products of local entropy terms. Exact calculation of A is intractable and so we resort to MCMC methods1, by performing a random walk inside L(G). Starting with a random point inside\n1Volume computations over such polytopes are generally difficult, but in some special cases may be solved in closed form [8].\nL(G) (i.e., a set of consistent marginals \u00b5) we sample a legal direction, find the two boundaries along this direction, and then sample uniformly a new point from within the bounded interval. A straightforward argument shows that the stationary distribution of this walk is uniform within L(G). To determine when the random walk is close to the stationary distribution, we apply a heuristic convergence test by running in parallel several chains from different random starting points and comparing their statistics [1]. Once we determine convergence, we then use samples from the different runs to estimate A. Finally, we solve the optimization problem in Eq. (15) with and without enforcing the variable-valid constraints of Eq. (11), and term these approximations convexBethe-\u00b5vv and convexBethe-\u00b5 , respectively.\nWe evaluate the quality of these approximations for calculating the marginals and partition function in 5\u00d7 5 nontoroidal grids with various parameterizations. We compare their performance with the Bethe approximation and the TRW approximation using a uniform distribution over four spanning trees (see [13]) 2. Following Wainwright et al. [13], in each trial we set \u03c9F to a fixed value and gradually increase the interaction strength \u03c9I . For each com-\n2We also used uniform TRW weights over all spanning trees and got similar results (not shown).\nbination of \u03c9F and \u03c9I we sample 20 random models and measure the estimation errors of each approximation (see Figure 3).\nWe first observe that the Bethe approximation outperforms its convex counterparts in terms of partition function approximation under all settings. However we see that when the field meta-parameter is small (\u03c9F = 0.05) and the interaction meta-parameter is large (\u03c9I \u2265 0.8), the convex approximations do better than Bethe in terms of marginal probabilities estimates. These results are consistent with previous studies [2, 4, 13].\nAmong the convex free energies optimal L2 approximation of the Bethe free energy (convexBethe-\u00b5 ) does better than optimal L2 approximation of the Bethe counting numbers (convexBethe-c ) in most of the range of parameters. convexBethe-\u00b5 does not perform well in the low interaction regime (small \u03c9I ). This is presumably due to the fact that it is not forced to be variable-valid, and thus will not be exact for independent (or close to independent) models.\nWhen averaging across all parameter settings, convexBethe-\u00b5 yields the best performance among the convex approximations. We conclude that if one seeks a convex c that performs across a range of parameters, it is advantageous to approximate the Bethe entropy function rather than its counting numbers. However, this comes at a price of lower approximation quality in some regimes. Regarding computation time, both heuristics require extra calculations. We note however, that as the computation does not depend on the model parameters, these extra cal-\nculations need to be performed only once for each model structure. Once the counting numbers are determined, the optimization of the approximate free energy is exactly the same as in standard BP. In addition, the performance of the convexBethe-\u00b5 approximation depends on the quality of the estimation of the matrix A in Eq. (15). This introduces a trade-off between the cost of the MCMC simulation and the quality of the approximation, which can be controlled by the MCMC convergence threshold."}, {"heading": "5.2 Adaptive Approximations", "text": "The approximations we examined so far were based on the structure of the model alone, and were not tuned to its parameters. Intuitively, a good approximation should assign more weight to \u201cstronger\u201d interactions than to weaker ones. Indeed, Wainwright et al. [13], introduce a method for finding the optimal weights in TRW (denoted TRW-opt). The TRW entropy upper bounds the true entropy H(\u00b5) and thus the corresponding variational approximation in Eq. (5) results in an upper-bound on the true partition function. Wainwright et al. thus seek counting numbers that minimize this upper bound.\nHere we present a different and simpler approach for adaptively setting the counting numbers. As in the previous section, our motivation is to approximate the performance of the Bethe approximation via convex free energies. One strategy for doing so is to consider only c where Hc(\u00b5) \u2265 Hb(\u00b5). This implies that the optimum in Eq. (5) will always upper bound the Bethe optimum. To come as close as possible to the Bethe optimum, we can then min-\nimize the optimum of Eq. (5) over the counting numbers c.\nHow can we constrain c to upper bound the Bethe free energy? It turns out that there is a simple condition on c that achieves this, as we show next.\nProposition 5.1: If c \u2208 Cvv then the difference between the approximate free energies can be written as:\nHc(\u00b5)\u2212Hb(\u00b5) = \u2211 \u03b1 (1\u2212 c\u03b1)I\u03b1(\u00b5\u03b1)\nWhere Cvv is the variable-valid subspace and I\u03b1(\u00b5\u03b1) =\u2211 i\u2208\u03b1Hi(\u00b5i)\u2212H\u03b1(\u00b5\u03b1) is the multi-information of the distribution \u00b5\u03b1 (see also [9]).\nSince I\u03b1(\u00b5\u03b1) \u2265 0 always holds, we get that if c\u03b1 \u2264 1 for all \u03b1, then Hc(\u00b5) is an upper bound on the Bethe entropy. This property is not only sufficient but also necessary if we want to find counting numbers for which the bound holds regardless of \u00b5. Note that the TRW counting numbers satisfy this constraint and thus the TRW approximation is also an upper bound on the Bethe free energy. Finally, we notice that due to the convexity constraints (Eq. (7) and Eq. (8)) the resulting entropy approximation is always non-negative (unlike Bethe).\nWe now show how to minimize the upper bound on the Bethe free energy. For this we generalize a result of Wainwright et al.[13]:\nProposition 5.2: Let F\u0303c[\u00b5,\u03b8] be free energy approximation with c \u2208 Cvv. The subgradient of max\u00b5 F\u0303c[\u00b5,\u03b8] is:\n\u2202max\u00b5 F\u0303c[\u00b5,\u03b8] \u2202c\u03b1 = \u2212I\u03b1(\u00b5\u2217\u03b1)\nwhere \u00b5\u2217 maximizes F\u0303c[\u00b5,\u03b8].\nGiven this gradient, we can use a conditional gradient algorithm as in [13] to minimize max\u00b5 F\u0303c[\u00b5,\u03b8] over the set of c that gives an upper bound on Bethe. Our algorithm is identical to TRW-opt except for the choice of search direction within the conditional gradient algorithm. In TRW-opt this involves finding a maximum weighted spanning tree while in our case it involves solving a LP (argminc\u2212cTI subject to the constraints). We denote the result of this optimization process by convexBethe-u . Empirically we find that this method is faster than the TRW iterative optimization algorithm and requires less calls to the inference procedure. More importantly, while finding the optimal counting numbers in TRW is computationally hard for non-pairwise models [14], our method is naturally applicable in the more general setting.\nTo evaluate the above adaptive strategy, we compare it with the convexBethe-c approximation and with the Bethe approximation in the same setting we used for the static approximations (see Figure 4). In addition, Since the choice of the field meta-parameter \u03c9F greatly influences the relative performance of the approximation we conduct experiments to better understand its role. Instead of fixing the\nfield meta-parameter and varying the coupling strength we plot a two-dimensional map where both meta-parameters are free to change (see Figure 5).\nAs we can see in Figure 4 both adaptive heuristics improve on the static ones. Moreover, our convexBethe-u procedure is often more accurate than TRW-opt. Yet, both adaptive methods are still inferior to Bethe approximation for most models we tested, except for the particular regions we discuss above. More extensive comparison for different choices of parameters (Figure 5) reinforces the observation that the accuracy of the approximations differ under various model parameters. This suggests that given the model structure, there is no single \u201cbest\u201d choice of counting numbers which is better under all parametric settings. We do see, however, that the Bethe approximation gives better or equivalent estimates of the log-partition function compared to the convex approximations (negative values in the map) except for the region with a very weak field meta-parameter (\u03c9F \u2248 0) and a strong interaction metaparameter (\u03c9I > 1.5). Furthermore, we see that the advantage of convex approximations over Bethe in marginals estimation is also in the region where \u03c9F is weak and \u03c9I is strong.\nTo examine the generality of these observations, we repeated the experiments described here for models with a structure of fully connected graph over 10 nodes (see Appendix A). These dense models differ from the sparse grid structured models, yet we get very similar results. We also conducted similar experiments for smaller and larger grids (see Appendix A) and for models with non-pairwise potentials (not shown), again with very similar results. We therefore believe that the conclusions we draw here are valid for a wide range of models."}, {"heading": "6 Discussion", "text": "The study of convex free energies was originally motivated by the realization that loopy belief propagation was optimizing the non-convex Bethe free energy. It thus set out to alleviate the non-convexity problem in the Bethe optimization procedure, and indeed has resulted in elegant algorithmic message-passing solutions for convex free energies. Another interesting application of convex free-energies was for optimizing Bethe (or Kikuchi) free energies via sequences of local convex approximations [6]. Although this resulted in faster optimization, it still inherited the localoptima problem of the Bethe optimization. More recently, convex free energy variants were shown to be particularly useful in the context of model selection [12].\nDespite these merits, in terms of quality of the approximation, convex free energies are still often not competitive with Bethe and in fact result in poorer performance over a wide range of parameter settings, as we also show here. This leads to the natural question, which we address in this work: what is the best convex approximation to the Bethe\nfree energy? As we have shown, there are several approaches to this problem, depending on whether we seek a set of counting numbers that is independent of the model parameters, or one that can be tuned adaptively. Our results show that convex Bethe approximations often work better than other schemes. For example, the counting numbers that approximate the Bethe entropy inL2 norm across all \u00b5 values often work better than other choices. Furthermore, our adaptive strategy for choosing the best counting numbers for a given model often works better than other methods such as TRW. Our adaptive procedures are also easily extendible to nonpairwise regions, unlike TRW which becomes intractable in these cases.\nOne might argue that it is more reasonable to directly approximate the true entropy H(\u00b5) rather than the Bethe entropy. The main difficulty with this approach is that H(\u00b5) is not generally known, and thus its approximations are typically quite loose. For example, it is not clear how to go about approximating it in L2 norm, as we do for Bethe here. The Bethe free energy, on the other hand, is tractable and as we show can be approximated in various ways. Thus, even though we lose by not approximating the true entropy, we gain by obtaining tighter approximations to the Bethe entropy, which typically provides good performance.\nAnother conclusion from our results is that variablevalid counting numbers usually outperform non-valid ones. One possible explanation for this fact is that they are guaranteed to give exact results for independent models. An interesting open question is what other constraints we can pose on counting numbers to enforce exactness in different scenarios, and whether we can optimize over the set of such numbers."}, {"heading": "Acknowledgements", "text": "We thank Talya Meltzer, Shai Shalev-Shwartz, Raanan Fatal and Yair Weiss for helpful remarks. This research was supported in part by a grant from the Israel Science Foundation."}, {"heading": "A Results for other graphs", "text": "We show results for adaptive approximations on fully connected graphs over 10 nodes in Figure 6. As can be seen, results are very similar to those of grids.\nFigure 7 shows similar results for 10\u00d7 10 grids."}], "references": [{"title": "Inference from iterative simulation using multiple sequences", "author": ["A. Gelman", "D.B. Rubin"], "venue": "Statistical Science,", "citeRegEx": "1", "shortCiteRegEx": "1", "year": 1992}, {"title": "Approximate inference using conditional entropy decompositions", "author": ["A. Globerson", "T. Jaakkola"], "venue": "In AISTATS,", "citeRegEx": "2", "shortCiteRegEx": "2", "year": 2007}, {"title": "Convergent propagation algorithms via oriented trees", "author": ["A. Globerson", "T. Jaakkola"], "venue": "In UAI,", "citeRegEx": "3", "shortCiteRegEx": "3", "year": 2007}, {"title": "Convergent message-passing algorithms for inference over general graphs with convex free energy", "author": ["T. Hazan", "A. Shashua"], "venue": "In UAI,", "citeRegEx": "4", "shortCiteRegEx": "4", "year": 2008}, {"title": "Convexity arguments for efficient minimization of the Bethe and Kikuchi free energies", "author": ["T. Heskes"], "venue": "Journal of Artificial Intelligence Research,", "citeRegEx": "5", "shortCiteRegEx": "5", "year": 2006}, {"title": "Approximate inference and constrained optimization", "author": ["T. Heskes", "K. Albers", "B. Kappen"], "venue": "In UAI,", "citeRegEx": "6", "shortCiteRegEx": "6", "year": 2003}, {"title": "An introduction to variational approximations methods for graphical models", "author": ["M.I. Jordan", "Z. Ghahramani", "T. Jaakkola", "L.K. Saul"], "venue": "Learning in Graphical Models. Kluwer, Dordrecht,", "citeRegEx": "7", "shortCiteRegEx": "7", "year": 1998}, {"title": "The volume of relaxed boolean-quadric and cut polytopes", "author": ["C.W. Ko", "J. Lee", "E. Steingr\u0131\u0301msson"], "venue": "Discrete Math.,", "citeRegEx": "8", "shortCiteRegEx": "8", "year": 1997}, {"title": "Divergence measures and message passing", "author": ["T.P. Minka"], "venue": "Technical Report MSR-TR-2005-173, Microsoft Research,", "citeRegEx": "9", "shortCiteRegEx": "9", "year": 2005}, {"title": "Loopy belief propagation for approximate inference: An empirical study", "author": ["K. Murphy", "Y. Weiss"], "venue": "In UAI,", "citeRegEx": "10", "shortCiteRegEx": "10", "year": 1999}, {"title": "Estimation and marginalization using kikuchi approximation methods", "author": ["P. Pakzad", "V. Anantharam"], "venue": "Neural Computation,", "citeRegEx": "11", "shortCiteRegEx": "11", "year": 2005}, {"title": "Estimating the \u201dwrong\u201d graphical model: Benefits in the computation-limited setting", "author": ["M.J. Wainwright"], "venue": "Journal of Machine Learning Research,", "citeRegEx": "12", "shortCiteRegEx": "12", "year": 2006}, {"title": "A new class of upper bounds on the log partition function", "author": ["M.J. Wainwright", "T.S. Jaakkola", "A.S. Willsky"], "venue": "IEEE Transactions on Information Theory,", "citeRegEx": "13", "shortCiteRegEx": "13", "year": 2005}, {"title": "Graphical models, exponential families, and variational inference", "author": ["M.J. Wainwright", "M.I. Jordan"], "venue": "Foundations and Trends in Machine Learning,", "citeRegEx": "14", "shortCiteRegEx": "14", "year": 2008}, {"title": "Map estimation, linear programming and belief propagation with convex free energies", "author": ["Y. Weiss", "C. Yanover", "T. Meltzer"], "venue": "In UAI,", "citeRegEx": "15", "shortCiteRegEx": "15", "year": 2007}, {"title": "On the choice of regions for generalized belief propagation", "author": ["M. Welling"], "venue": "In UAI,", "citeRegEx": "16", "shortCiteRegEx": "16", "year": 2004}, {"title": "Belief optimization for binary networks : A stable alternative to loopy belief propagation", "author": ["M. Welling", "Y. Teh"], "venue": "In UAI,", "citeRegEx": "17", "shortCiteRegEx": "17", "year": 2001}, {"title": "Approximations with reweighted generalized belief propagation", "author": ["W. Wiegerinck"], "venue": "In AISTATS,", "citeRegEx": "18", "shortCiteRegEx": "18", "year": 2005}, {"title": "Fractional belief propagation", "author": ["W. Wiegerinck", "T. Heskes"], "venue": "In NIPS,", "citeRegEx": "19", "shortCiteRegEx": "19", "year": 2003}, {"title": "Generalized belief propagation", "author": ["J.S. Yedidia", "W.T. Freeman", "Y. Weiss"], "venue": "In NIPS,", "citeRegEx": "20", "shortCiteRegEx": "20", "year": 2001}, {"title": "Constructing free energy approximations and generalized belief propagation algorithms", "author": ["J.S. Yedidia", "W.T. Freeman", "Y. Weiss"], "venue": "IEEE Transactions on Information Theory,", "citeRegEx": "21", "shortCiteRegEx": "21", "year": 2005}, {"title": "CCCP algorithms to minimize the bethe and kikuchi free energies: Convergent alternatives to belief propagation", "author": ["A. Yuille"], "venue": "Neural Computation,", "citeRegEx": "22", "shortCiteRegEx": "22", "year": 2002}], "referenceMentions": [{"referenceID": 6, "context": "An important class of approximations are variational methods [7] that pose inference in terms of minimizing the free energy functional.", "startOffset": 61, "endOffset": 64}, {"referenceID": 9, "context": "In the last decade, loopy belief propagation (LBP), a simple local message passing procedure, proved to be empirically successful and was used in a variety of applications [10].", "startOffset": 172, "endOffset": 176}, {"referenceID": 19, "context": "[20] merged these lines of work by formulating loopy belief propagation in terms of optimizing the Bethe free energy, an approximate free energy functional.", "startOffset": 0, "endOffset": 4}, {"referenceID": 16, "context": "Several approaches have been introduced to fix the non-convergence issue, so that LBP provably converges to a local optimum of the Bethe free energy [17, 22].", "startOffset": 149, "endOffset": 157}, {"referenceID": 21, "context": "Several approaches have been introduced to fix the non-convergence issue, so that LBP provably converges to a local optimum of the Bethe free energy [17, 22].", "startOffset": 149, "endOffset": 157}, {"referenceID": 1, "context": "To alleviate this problem, several works [2, 6, 13, 15] construct convex free energy approximations, for which there is a single global optimum.", "startOffset": 41, "endOffset": 55}, {"referenceID": 5, "context": "To alleviate this problem, several works [2, 6, 13, 15] construct convex free energy approximations, for which there is a single global optimum.", "startOffset": 41, "endOffset": 55}, {"referenceID": 12, "context": "To alleviate this problem, several works [2, 6, 13, 15] construct convex free energy approximations, for which there is a single global optimum.", "startOffset": 41, "endOffset": 55}, {"referenceID": 14, "context": "To alleviate this problem, several works [2, 6, 13, 15] construct convex free energy approximations, for which there is a single global optimum.", "startOffset": 41, "endOffset": 55}, {"referenceID": 2, "context": "Convexity also paved the way for the introduction of provably convergent message-passing algorithms for calculating likelihood and marginal probabilities [3, 4].", "startOffset": 154, "endOffset": 160}, {"referenceID": 3, "context": "Convexity also paved the way for the introduction of provably convergent message-passing algorithms for calculating likelihood and marginal probabilities [3, 4].", "startOffset": 154, "endOffset": 160}, {"referenceID": 1, "context": "Moreover, some of these approximations provide upper bounds on the partition function [2, 13].", "startOffset": 86, "endOffset": 93}, {"referenceID": 12, "context": "Moreover, some of these approximations provide upper bounds on the partition function [2, 13].", "startOffset": 86, "endOffset": 93}, {"referenceID": 13, "context": "A class of popular approximate inference approaches are the variational methods that rely on the following exact formulation of logZ(\u03b8) [14]:", "startOffset": 136, "endOffset": 140}, {"referenceID": 13, "context": "The setM(G) is known as the marginal polytope associated with a graph G [14].", "startOffset": 72, "endOffset": 76}, {"referenceID": 20, "context": "As for the entropy term, a family of entropy approximations with a long history in statistical physics is based on a weighted sum of local entropies Hc(\u03bc) = \u2211 r crHr(\u03bcr), where r are subsets of variables (regions) and the coefficients cr are called counting numbers [21].", "startOffset": 266, "endOffset": 270}, {"referenceID": 15, "context": ", [16, 18]).", "startOffset": 2, "endOffset": 10}, {"referenceID": 17, "context": ", [16, 18]).", "startOffset": 2, "endOffset": 10}, {"referenceID": 20, "context": "The Bethe entropy approximation Hb(\u03bc) is defined by choosing c\u03b1 = 1, ci = 1 \u2212 di (where di = |{\u03b1 : i \u2208 \u03b1}|) [21].", "startOffset": 108, "endOffset": 112}, {"referenceID": 12, "context": "[13].", "startOffset": 0, "endOffset": 4}, {"referenceID": 4, "context": "More recently, Heskes [5] derived a set of sufficient condition for c\u03b1, ci to yield a concave function.", "startOffset": 22, "endOffset": 25}, {"referenceID": 19, "context": "[20] many message passing algorithms have been proposed for optimizing variational approximations.", "startOffset": 0, "endOffset": 4}, {"referenceID": 20, "context": "[21], then Eq.", "startOffset": 0, "endOffset": 4}, {"referenceID": 13, "context": "The other is that the true entropy H(\u03bc) is itself concave [14].", "startOffset": 58, "endOffset": 62}, {"referenceID": 20, "context": "(11) variablevalid, as the variables are counted correctly in Hc(\u03bc) [21].", "startOffset": 68, "endOffset": 72}, {"referenceID": 20, "context": "(12) are valid [21] as they have the appealing property of not over- or under-counting variables and factors in the approximate entropy Hc(\u03bc).", "startOffset": 15, "endOffset": 19}, {"referenceID": 10, "context": "Furthermore, for tree structured distributions it has been shown that only valid counting numbers can yield exact results [11].", "startOffset": 122, "endOffset": 126}, {"referenceID": 1, "context": "The field parameters \u03b8i were drawn uniformly from the range [\u2212\u03c9F , \u03c9F ], and the interaction parameters \u03b8i,j were drawn either from the range [\u2212\u03c9I , \u03c9I ] or from [0, \u03c9I ] to obtain mixed or attractive potentials respectively [2, 13].", "startOffset": 225, "endOffset": 232}, {"referenceID": 12, "context": "The field parameters \u03b8i were drawn uniformly from the range [\u2212\u03c9F , \u03c9F ], and the interaction parameters \u03b8i,j were drawn either from the range [\u2212\u03c9I , \u03c9I ] or from [0, \u03c9I ] to obtain mixed or attractive potentials respectively [2, 13].", "startOffset": 225, "endOffset": 232}, {"referenceID": 1, "context": "In fact, we note that to the best of our knowledge all free energy approximations suggested in the literature obey this variable-valid constraint [2, 4, 13, 19, 21].", "startOffset": 146, "endOffset": 164}, {"referenceID": 3, "context": "In fact, we note that to the best of our knowledge all free energy approximations suggested in the literature obey this variable-valid constraint [2, 4, 13, 19, 21].", "startOffset": 146, "endOffset": 164}, {"referenceID": 12, "context": "In fact, we note that to the best of our knowledge all free energy approximations suggested in the literature obey this variable-valid constraint [2, 4, 13, 19, 21].", "startOffset": 146, "endOffset": 164}, {"referenceID": 18, "context": "In fact, we note that to the best of our knowledge all free energy approximations suggested in the literature obey this variable-valid constraint [2, 4, 13, 19, 21].", "startOffset": 146, "endOffset": 164}, {"referenceID": 20, "context": "In fact, we note that to the best of our knowledge all free energy approximations suggested in the literature obey this variable-valid constraint [2, 4, 13, 19, 21].", "startOffset": 146, "endOffset": 164}, {"referenceID": 3, "context": "A similar approach was recently studied by Hazan and Shashua [4].", "startOffset": 61, "endOffset": 64}, {"referenceID": 7, "context": "Volume computations over such polytopes are generally difficult, but in some special cases may be solved in closed form [8].", "startOffset": 120, "endOffset": 123}, {"referenceID": 0, "context": "To determine when the random walk is close to the stationary distribution, we apply a heuristic convergence test by running in parallel several chains from different random starting points and comparing their statistics [1].", "startOffset": 220, "endOffset": 223}, {"referenceID": 12, "context": "We compare their performance with the Bethe approximation and the TRW approximation using a uniform distribution over four spanning trees (see [13]) 2.", "startOffset": 143, "endOffset": 147}, {"referenceID": 12, "context": "[13], in each trial we set \u03c9F to a fixed value and gradually increase the interaction strength \u03c9I .", "startOffset": 0, "endOffset": 4}, {"referenceID": 1, "context": "These results are consistent with previous studies [2, 4, 13].", "startOffset": 51, "endOffset": 61}, {"referenceID": 3, "context": "These results are consistent with previous studies [2, 4, 13].", "startOffset": 51, "endOffset": 61}, {"referenceID": 12, "context": "These results are consistent with previous studies [2, 4, 13].", "startOffset": 51, "endOffset": 61}, {"referenceID": 12, "context": "[13], introduce a method for finding the optimal weights in TRW (denoted TRW-opt).", "startOffset": 0, "endOffset": 4}, {"referenceID": 8, "context": "Where Cvv is the variable-valid subspace and I\u03b1(\u03bc\u03b1) = \u2211 i\u2208\u03b1Hi(\u03bci)\u2212H\u03b1(\u03bc\u03b1) is the multi-information of the distribution \u03bc\u03b1 (see also [9]).", "startOffset": 131, "endOffset": 134}, {"referenceID": 12, "context": "[13]: Proposition 5.", "startOffset": 0, "endOffset": 4}, {"referenceID": 12, "context": "Given this gradient, we can use a conditional gradient algorithm as in [13] to minimize max\u03bc F\u0303c[\u03bc,\u03b8] over the set of c that gives an upper bound on Bethe.", "startOffset": 71, "endOffset": 75}, {"referenceID": 13, "context": "More importantly, while finding the optimal counting numbers in TRW is computationally hard for non-pairwise models [14], our method is naturally applicable in the more general setting.", "startOffset": 116, "endOffset": 120}, {"referenceID": 5, "context": "Another interesting application of convex free-energies was for optimizing Bethe (or Kikuchi) free energies via sequences of local convex approximations [6].", "startOffset": 153, "endOffset": 156}, {"referenceID": 11, "context": "More recently, convex free energy variants were shown to be particularly useful in the context of model selection [12].", "startOffset": 114, "endOffset": 118}], "year": 2009, "abstractText": "The introduction of loopy belief propagation (LBP) revitalized the application of graphical models in many domains. Many recent works present improvements on the basic LBP algorithm in an attempt to overcome convergence and local optima problems. Notable among these are convexified free energy approximations that lead to inference procedures with provable convergence and quality properties. However, empirically LBP still outperforms most of its convex variants in a variety of settings, as we also demonstrate here. Motivated by this fact we seek convexified free energies that directly approximate the Bethe free energy. We show that the proposed approximations compare favorably with state-of-the art convex free energy approximations.", "creator": "TeX"}}}