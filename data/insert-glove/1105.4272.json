{"id": "1105.4272", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "21-May-2011", "title": "Calibration with Changing Checking Rules and Its Application to Short-Term Trading", "abstract": "We newspapermen provide 106,800 a quintuplets natural supplemented learning process noninflationary in which a financial trader without a risk ministro receives a yuxin gain 10500 in smas case workarounds when Stock Market ninth is yonezawa inefficient. kokkalis In this mkb process, retractions the degaussing trader helmingham rationally mrkonji\u0107 choose skrepenak his gambles using a prediction garib made trifluoride by a randomized calibrated algorithm. Our strategy is based on Dawid ' s tri-service notion of btry calibration tumult with kickapoo more bondies general changing virudhunagar checking rules madam and zimbabwe on househusband some modification ankrum of Kakade staufen and molestation Foster ' 1.155 s craxi randomized biodegrade algorithm cutlet for computing geisel calibrated saw-mill forecasts.", "histories": [["v1", "Sat, 21 May 2011 17:28:12 GMT  (135kb,D)", "http://arxiv.org/abs/1105.4272v1", "15 pages, 3 figures"]], "COMMENTS": "15 pages, 3 figures", "reviews": [], "SUBJECTS": "cs.LG", "authors": ["vladimir trunov", "vladimir v'yugin"], "accepted": false, "id": "1105.4272"}, "pdf": {"name": "1105.4272.pdf", "metadata": {"source": "CRF", "title": "Calibration with Changing Checking Rules and Its Application to Short-Term Trading", "authors": ["Vladimir Trunov"], "emails": ["vyugin@iitp.ru"], "sections": [{"heading": "1 Introduction", "text": "Predicting sequences is the key problem of machine learning and statistics. The learning process proceeds as follows: observing a finite-state sequence given online a forecaster assigns an subjective estimate to future states. The method of evaluation of these forecasts depends on an underlying learning approach.\nA minimal requirement for testing any prediction algorithm is that it should be calibrated (see Dawid [3]). Dawid gave an informal explanation of calibration for binary outcomes as follows. Let a binary sequence \u03c91, \u03c92, . . . , \u03c9n\u22121 of outcomes be observed by a forecaster whose task is to give a probability pn of a future event \u03c9n = 1. In a typical example, pn is interpreted as a probability that it will rain. Forecaster is said to be well-calibrated if it rains as often as he leads us to expect. It should rain about 80% of the days for which pn = 0.8, and so on.\nA more precise definition is as follows. Let I(p) denote the characteristic function of a subinterval I \u2286 [0, 1], i.e., I(p) = 1 if p \u2208 I, and I(p) = 0, otherwise. An infinite sequence of forecasts p1, p2, . . . is calibrated for an infinite binary sequence of outcomes \u03c91\u03c92 . . . if for characteristic function I(p) of any subinterval of [0, 1] the calibration error tends to zero, i.e.,\u2211n\ni=1 I(pi)(\u03c9i \u2212 pi)\u2211n i=1 I(pi) \u2192 0\nas the denominator of the relation (1) tends to infinity. The indicator function I(pi) determines some \u201cchecking rule\u201d which selects indices i where we compute the deviation between forecasts pi and outcomes \u03c9i.\nar X\niv :1\n10 5.\n42 72\nv1 [\ncs .L\nG ]\n2 1\nM ay\nIf the weather acts adversatively, then Oakes [8] and Dawid [4] show that any deterministic forecasting algorithm will not always be calibrated.\nFoster and Vohra [5] show that calibration is almost surely guaranteed with a randomizing forecasting rule, i.e., where the forecasts pi are chosen using internal randomization and the forecasts are hidden from the weather until weather makes its decision whether to rain or not.\nThe origin of calibration algorithm is the Blackwell\u2019s [1] approachability theorem but, as its drawback, the forecaster has to use linear programming to compute the forecasts. We modify a more computationally efficient method from Kakade and Foster [7], where \u201can almost deterministic\u201d randomized rounding universal forecasting algorithm is presented. For any sequence of outcomes and for any precision of rounding \u2206 > 0, an observer can simply randomly round the deterministic forecast pi up to \u2206 in order to calibrate for this sequence with probability one :\nlim sup n\u2192\u221e\n1\nn n\u2211 i=1 I(p\u0303i)(\u03c9i \u2212 p\u0303i) \u2264 \u2206, (1)\nwhere p\u0303i is a random forecast. This algorithm can be easily extended such that the calibration error tends to zero as n\u2192\u221e.\nThe goal of this paper is to extend Kakade and Foster\u2019s algorithm to arbitrary real valued outcomes and to a more general notion of calibration with changing parameterized checking rules. We present also convergence bounds for calibration depending on the number of parameters.\nA closely related approach for weak calibration is presented in Vovk [10]. We apply this algorithm to technical analysis in finance. We consider real valued outcomes (for example, prices of a stock). In this case, predictions could be interpreted as mean values of future outcomes under some unknown for us probability distributions. We need not any form of such distribution \u2013 we should predict only future means.\nWe provide a natural learning process in which a financial trader (speculator for a rise or for a decline) without a risk of complete ruin receives a gain if the market is inefficient. In this process, the trader rationally choose his gambles using a prediction made by a randomized calibrated algorithm.\nThe learning process is the most traditional one. At each step Forecaster makes a prediction of future price of a stock and Speculator takes the best response to this prediction. He chooses a strategy: dealing for a rise or for a fall, or pass the step. Forecaster uses some randomized algorithm for computing calibrated forecasts.\nLet us give a more precise formulation. Consider a game between Speculator and Stock Market. Let S1, S2, . . . \u2013 be a sequence of prices of a stock. We suppose that prices are bounded and rescaled such that 0 \u2264 Si \u2264 1 for all t and S1 = S0.\nThe protocol of a game is described as follows. Let k is a positive integer number. The initial capital of Speculator is K0 = 0. FOR i = 1, 2 . . . At the beginning of the step i Speculator and Forecaster observe past prices\nS1, . . . , Si\u22121 of a financial instrument (a stock) and some side information. Forecaster announces a random forecast of a stock future price \u2013 random variable p\u0303i \u2208 [0, 1]. Speculator bets by buying or selling a number Mi of shares of the stock by Si\u22121 each. 1 Stock Market announces a price Si of a stock. Speculator receives his total gain (or suffer loss) at the end of step i : Ki = Ki\u22121 +Mi(Si \u2212 Si\u22121). ENDFOR\nIn that follows we consider only playing for a rise and will buy only one share of a stock, so Mi = 0 or Mi = 1.\nLet > 0 be a threshold for entering the game. A decision rule for entering will be the following: at step i enter the game (buy Mi = 1 of shares) if p\u0303i > S\u0303i\u22121 + ; pass the step otherwise (get Mi = 0), where S\u0303i\u22121 is randomized past price. Thereby, we need changing checking rules depending on past outcomes :\nI(pi > Si\u22121 + ) = { 1, if pi > Si\u22121 + , 0, otherwise.\nIt will follow from Theorem 1 (Section 2) that there exists a randomized algorithm computing forecasts calibrated almost surely in a modified sense :\nlim n\u2192\u221e\n1\nn n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )(Si \u2212 p\u0303i) = 0,\nwhere p\u0303i is a random forecast, S\u0303i\u22121 is a randomized past price of a stock, and > 0 is a threshold for entering a game.\nIn Section 3 we construct trading strategies based on calibrated forecasts."}, {"heading": "2 Computing calibrated forecasts", "text": "Let y1, y2, . . . be an infinite sequence of real numbers. An infinite sequence of random variables y\u03031, y\u03032, . . . is called a randomization of y1, y2, . . . if En(y\u0303n) = yn for all n, where En is the symbol of mathematical expectation.\nWe specify a side information \u2013 we add to the protocol of the game signals x\u03041, x\u03042, . . . given online: for any n, a k-dimensional vector x\u0304n \u2208 [0, 1]k is given to Forecaster before he announces a forecast p\u0303n. We consider checking rules of general type:\nI(p, x\u0304) = { 1, (p, x\u0304) \u2208 S, 0, otherwise,\nwhere S \u2286 [0, 1]k+1 and x\u0304 \u2208 [0, 1]k is a signal. In Section 3 we use a set S = {(p, x) : p > x + }, where p, x \u2208 [0, 1] and > 0. At any step i we check (p\u0303i, x\u0303i) \u2208 S, where xi = Si\u22121 and p\u0303i, x\u0303i are randomization of pi, xi. 1 In case Mi > 0 Speculator playing for a rise, in case Mi < 0 Speculator playing for\na fall, Speculator pass the step if Mi = 0. We suppose that Speculator can borrow money for buying Mi shares of a stock and return them after selling.\nThe following theorem on calibration is the main tool for technical analysis presented in Section 3.\nTheorem 1. Given k an algorithm f for computing forecasts and a method of randomization can be constructed such that for any sequence of real numbers S1, S2, . . . and for any sequence of k-dimensional signals x\u03041, x\u03042, . . . the event\nlim n\u2192\u221e\n1\nn n\u2211 i=1 I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i) = 0, (2)\nhas Pr-probability 1, where Pr is a probability distribution generated by a sequence of tuples (p\u0303i, x\u0303i) of random variables, i = 1, 2, . . ., and I is the characteristic function of an arbitrary subset S \u2286 [0, 1]k+1. Here p\u0303i is the randomization of a forecast pi computed by the forecasting algorithm f and x\u0303i is obtained by independent randomization of each coordinate xi,j of the vector x\u0304i, j = 1, . . . k. Also Varn(p\u0303n)\u2192 0 and Varn(x\u0303i,j)\u2192 0 as to n\u2192\u221e for all i and j. 2\nProof. We modify a weak calibration algorithm of Kakade and Foster [7] using also ideas from Vovk [10].\nAt first, we construct an \u2206-calibrated forecasting algorithm, and after that we apply some double trick argument for it.\nLemma 1. Given k an algorithm for computing forecasts and a method of randomization can be constructed such that for any sequence of real numbers S1, S2, . . . and for any sequence of signals x\u03041, x\u03042, . . . the event\nlim sup n\u2192\u221e\n1\nn n\u2211 i=1 I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i) \u2264 \u2206\nhas Pr-probability 1, where Pr and I as in Theorem 1. Also Varn(p\u0303n) \u2264 \u2206 and Varn(x\u0303i,j) \u2264 \u2206 for all n, for all i and j. Proof. At first we define a deterministic forecast and after that we randomize it.\nDivide the interval [0, 1] on subintervals of length \u2206 = 1/K with rational endpoints vi = i\u2206, where i = 0, 1, . . . ,K. Let V denotes the set of these points.\nAny number p \u2208 [0, 1] can be represented as a linear combination of two neighboring endpoints of V defining subinterval containing p : p = \u2211 v\u2208V wv(p)v = wvi\u22121(p)vi\u22121 +wvi(p)vi, where p \u2208 [vi\u22121, vi], i = bp1/\u2206+1c, wvi\u22121(p) = 1\u2212 (p\u2212 vi\u22121)/\u2206, and wvi(p) = 1\u2212 (vi \u2212 p)/\u2206. Define wv(p) = 0 for all other v \u2208 V .\nIn that follows we round some deterministic forecast pn to vi\u22121 with probability wvi\u22121(pn) and to vi with probability wvi(pn). We also round the each coordinate xn,s, s = 1, . . . k, of a signal x\u0304n to vjs\u22121 with probability wvjs\u22121(xn,s) and to vjs with probability wvjs (xn,s), where xn,s \u2208 [vjs\u22121, vjs ].\nLet also Wv(Qn) = wv1(pn)wv2(x\u0304n), where v = (v 1, v2), v1 \u2208 V , v2 =\n(v21 , . . . v 2 k) \u2208 V k, wv2(x\u0304n) = \u220fk s=1 wv2s (xn,s), and Qn = (pn, x\u0304n). For any Qn, Wv(Qn) is a probability distribution in V k+1 :\n\u2211 v\u2208V k+1 Wv(Qn) = 1.\n2 Varn(p\u0303n) = En(p\u0303n \u2212 pn)2.\nIn that follows we define a deterministic forecast pn. Let the forecasts p1, . . . , pn\u22121 already defined (put p1 = 1/2). Let us define for v = (v 1, v2) and Qi = (pi, x\u0304i)\n\u00b5n\u22121(v) = n\u22121\u2211 i=1 Wv(Qi)(Si \u2212 pi).\nWe have\n(\u00b5n(v)) 2 = (\u00b5n\u22121(v)) 2 +\n+2Wv(Qn)\u00b5n\u22121(v)(Sn \u2212 pn) + (Wv(Qn))2(Sn \u2212 p1n)2. (3)\nSumming (3) by v \u2208 V k+1, we obtain:\u2211 v\u2208V k+1 (\u00b5n(v)) 2 = \u2211 v\u2208V k+1 (\u00b5n\u22121(v)) 2 +\n+2(Sn \u2212 pn) \u2211\nv\u2208V k+1 Wv(Qn)\u00b5n\u22121(v) + \u2211 v\u2208V k+1 (Wv(Qn)) 2(Sn \u2212 pn)2. (4)\nChange the order of summation:\n\u2211 v\u2208V k+1 Wv(Qn)\u00b5n\u22121(v) = \u2211 v\u2208V k+1 Wv(Qn) n\u22121\u2211 i=1 Wv(Qi)(Si \u2212 pi) =\n= n\u22121\u2211 i=1 ( \u2211 v\u2208V k+1 Wv(Qn)Wv(Qi))(Si \u2212 pi) =\n= n\u22121\u2211 i=1 (W\u0304 (Qn) \u00b7 W\u0304 (Qi))(Si \u2212 pi) = n\u22121\u2211 i=1 K(Qn, Qi)(Si \u2212 pi),\nwhere W\u0304 (Qn) = (Wv(Qn) : v \u2208 V k+1), W\u0304 (Qn) = (Wv(Qn) : v \u2208 V k+1) be vectors of probabilities of rounding. The dot product of corresponding vectors defines the kernel\nK(Qn, Qi) = K(pn, x\u0304n, pi, x\u0304i) = (W\u0304 (Qn) \u00b7 W\u0304 (Qi)). (5)\nLet pn be equal to the root of the equation\nSn(pn) = \u2211 v\u2208V Wv(pn, x\u0304n)\u00b5n\u22121(v) = n\u22121\u2211 i=1 K(pn, x\u0304n, pi, x\u0304i)(Si \u2212 pi) = 0, (6)\nif a solution exists. Otherwise, if the left hand-side of the equation (6) (which is a continuous by pn function) strictly positive for all pn define pn = 1, define pn = 0 if it is strictly negative. Announce pn as a deterministic forecast.\nThe third term of (4) is upper bounded by 1. Indeed, since |Si \u2212 pi| \u2264 1 for all i, \u2211\nv\u2208V k+1 (Wv(Qn))\n2(Si \u2212 pn)2 \u2264 \u2211\nv\u2208V k+1 Wv(Qn) = 1.\nThen by (4), \u2211\nv\u2208V k+1 (\u00b5n(v))\n2 \u2264 n. Recall that for any v \u2208 V k+1\n\u00b5n(v) = n\u2211 i=1 Wv(Qi)(Si \u2212 pi). (7)\nInsert the term I(v) in the sum (7), where I is the characteristic function of an arbitrary set S \u2286 [0, 1]k+1, sum by v \u2208 V k+1, and exchange the order of summation. Using Cauchy\u2013Schwartz inequality for vectors (I(v) : v \u2208 V k+1), (\u00b5n(v) : v \u2208 V k+1) and Euclidian norm, we obtain\u2223\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 \u2211 v\u2208V k+1 Wv(Qi)I(v)(Si \u2212 pi)\n\u2223\u2223\u2223\u2223\u2223\u2223 = = \u2223\u2223\u2223\u2223\u2223\u2223 \u2211 v\u2208V k+1 I(v) n\u2211 i=1 Wv(Qi)(Si \u2212 pi)\n\u2223\u2223\u2223\u2223\u2223\u2223 \u2264 \u2264 \u221a \u2211 v\u2208V k+1 I(v) \u221a \u2211 v\u2208V k+1 (\u00b5n(v))2 \u2264 \u221a |V k+1|n (8)\nfor all n, where |V k+1| = 1/\u2206k+1 \u2013 is the cardinality of the partition. Let p\u0303i be a random variable taking values v \u2208 V with probabilities wv(pi) (only two of them are nonzero). Recall that x\u0303i is a random variable taking values v \u2208 V k with probabilities wv(x\u0304i).\nLet S \u2286 [0, 1]k and I be its indicator function. For any i the mathematical expectation of a random variable I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i) is equal to\nE(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) = \u2211\nv\u2208V k+1 Wv(Qi)I(v)(Si \u2212 v1), (9)\nwhere v = (v1, v2). By the strong law of large numbers, for some \u00b5n = o(n) (as n \u2192 \u221e), Prprobability of the event\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)\u2212 n\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i))\n\u2223\u2223\u2223\u2223\u2223 \u2264 \u00b5n (10) tends to 1 as n\u2192\u221e. A form of of \u00b5n will be specified later.\nBy definition of deterministic forecast\u2223\u2223\u2223\u2223\u2223\u2223 \u2211 v\u2208V k+1 Wv(Qi)I(v)(Si \u2212 pi)\u2212 \u2211 v\u2208V k+1 Wv(Qi)I(v)(Si \u2212 v1) \u2223\u2223\u2223\u2223\u2223\u2223 < \u2206 for all i, where v = (v1, v2). Summing (9) by i = 1, . . . , n and using the inequality (8), we obtain \u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) \u2223\u2223\u2223\u2223\u2223 =\n= \u2223\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 \u2211 v\u2208V k+1 Wv(Qi)I(v)(Si \u2212 v1) \u2223\u2223\u2223\u2223\u2223\u2223 < \u2206n+ \u221a |V k+1|n (11)\nfor all n, where |V k+1| = 1/\u2206k+1 is the cardinality of the partition. By (11) and (10) we obtain that Pr-probability of the event\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i) \u2223\u2223\u2223\u2223\u2223 \u2264 \u2206n+ \u00b5n + \u221a n/\u2206k+1 (12)\ntends to 1 as n\u2192\u221e. In particular, Pr-probability of the event\nlim sup n\u2192\u221e \u2223\u2223\u2223\u2223\u2223 1n n\u2211 i=1 I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i) \u2223\u2223\u2223\u2223\u2223 \u2264 \u2206 is equal to 1. Lemma is proved.\nTo prove that (2) holds almost surely choose a monotonic sequence of rational numbers \u22061 > \u22062 > . . . such that \u2206s \u2192 0 as s \u2192 \u221e. We also define an increasing sequence of natural numbers n1 < n2 < . . . For any s, we use on steps ns \u2264 n < ns+1 the partition of [0, 1] on subintervals of length \u2206s.\nWe choose ns such that ns \u2265 ( k+2 2 )2 \u2206 \u2212(k+3) s for all s. 3 Put n0 = 0 and\n\u22060 = 1. Also, define the numbers n1, n2, . . . such that the inequality\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) \u2223\u2223\u2223\u2223\u2223 \u2264 4(s+ 1)\u2206sn (13) holds for all ns \u2264 n \u2264 ns+1 and for all s.\nWe define this sequence by mathematical induction on s. Suppose that ns (s \u2265 1) is defined such that the inequality\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i))\n\u2223\u2223\u2223\u2223\u2223 \u2264 4s\u2206s\u22121n (14) holds for all ns\u22121 \u2264 n \u2264 ns, and the inequality\u2223\u2223\u2223\u2223\u2223 ns\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i))\n\u2223\u2223\u2223\u2223\u2223 \u2264 4s\u2206sns (15) also holds. Let us define ns+1. Consider all forecasts p\u0303i defined by the algorithm given above for discretization \u2206 = \u2206s+1. We do not use first ns of these forecasts (more correctly we will use them only in bounds (16) and (17); denote these forecasts p\u03021, . . . , p\u0302ns). We add the forecasts p\u0303i for i > ns to the forecasts defined\n3 This is the minimum point of (11).\nbefore this step of induction (for ns). Let ns+1 be such that the inequality\u2223\u2223\u2223\u2223\u2223 ns+1\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) \u2223\u2223\u2223\u2223\u2223 \u2264 \u2223\u2223\u2223\u2223\u2223 ns\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) \u2223\u2223\u2223\u2223\u2223+ +\n\u2223\u2223\u2223\u2223\u2223 ns+1\u2211 i=ns+1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) + ns\u2211 i=1 E(I(p\u0302i, x\u0303i)(Si \u2212 p\u0302i)) \u2223\u2223\u2223\u2223\u2223+ +\n\u2223\u2223\u2223\u2223\u2223 ns\u2211 i=1 E(I(p\u0302i, x\u0303i)(Si \u2212 p\u0302i)) \u2223\u2223\u2223\u2223\u2223 \u2264 4(s+ 1)\u2206s+1ns+1 (16) holds. Here the first sum of the right-hand side of the inequality (16) is bounded by 4s\u2206sns \u2013 by the induction hypothesis (15). The second and third sums are bounded by 2\u2206s+1ns+1 and by 2\u2206s+1ns, respectively. This follows from (11) and by choice of ns. The induction hypothesis (15) is valid for\nns+1 \u2265 2s\u2206s +\u2206s+1 \u2206s+1(2s+ 1) ns.\nAnalogously,\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) \u2223\u2223\u2223\u2223\u2223 \u2264 \u2223\u2223\u2223\u2223\u2223 ns\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) \u2223\u2223\u2223\u2223\u2223+ + \u2223\u2223\u2223\u2223\u2223 n\u2211\ni=ns+1\nE(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) + ns\u2211 i=1 E(I(p\u0302i, x\u0303i)(Si \u2212 p\u0302i)) \u2223\u2223\u2223\u2223\u2223+ +\n\u2223\u2223\u2223\u2223\u2223 ns\u2211 i=1 E(I(p\u0302i, x\u0303i)(Si \u2212 p\u0302i)) \u2223\u2223\u2223\u2223\u2223 \u2264 4(s+ 1)\u2206sn (17) for ns < n \u2264 ns+1. Here the first sum of the right-hand inequality (16) is also bounded by 4s\u2206sns \u2264 4s\u2206sn \u2013 by the induction hypothesis (15). The second and the third sums are bounded by 2\u2206s+1n \u2264 2\u2206sn and by 2\u2206s+1ns \u2264 2\u2206sn, respectively. This follows from (11) and from choice of \u2206s. The induction hypothesis (14) is valid.\nBy (13) for any s\u2223\u2223\u2223\u2223\u2223 n\u2211 i=1 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) \u2223\u2223\u2223\u2223\u2223 \u2264 4(s+ 1)\u2206sn (18) for all n \u2265 ns if \u2206s satisfies the condition \u2206s+1 \u2264 \u2206s(1\u2212 1s+2 ) for all s.\nBy the law of large numbers (31), the relation (10) can be specified:\nPr { sup n\u2265ns \u2223\u2223\u2223\u2223\u2223 1n n\u2211 i=1 Vi \u2223\u2223\u2223\u2223\u2223 > \u2206s } \u2264 (\u2206s)\u22122e\u22122ns\u2206 2 s (19)\nfor all s, where Vi = I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i) \u2212 E(I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i)) is a sequence of martingale\u2013differences.\nCombining (18) with (19), we obtain\nPr { sup n\u2265ns \u2223\u2223\u2223\u2223\u2223 1n n\u2211 i=1 I(p\u0303i, x\u0303i)(Si \u2212 p\u0303i) \u2223\u2223\u2223\u2223\u2223 \u2265 (4s+ 5)\u2206s } \u2264 (\u2206s)\u22122e\u22122ns\u2206 2 s (20)\nfor all s. The series \u2211\u221e s=1(\u2206s) \u22122e\u22122ns\u2206 2 s is convergent if ns satisfies\nns \u2265 ln s+ 2 ln ln s\u2212 2 ln(\u2206s)\n2\u22062s\nfor all s. Let also \u2206s = o(1/s) as s \u2192 \u221e. Then Borel\u2013Cantelli Lemma implies convergence of (2) almost surely.\nIt is easy to verify that the sequences ns and \u2206s satisfying all the conditions above exist."}, {"heading": "3 Applications to technical analysis", "text": ""}, {"heading": "3.1 Simple trading for a rise", "text": "Let S1, S2, . . . be a sequence of a stock prices. At any step i we use one-dimensional signals xi = Si\u22121, i = 1, 2 . . ., and an indicator function I(pi > xi + ), where is a parameter. 4\nAt the end of the trading period Speculator receives a gain or suffer loss \u2206SI = Si \u2212 Si\u22121 for one share of the stock. The total gain or loss is equal to\nKn = n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )\u2206Si,\nwhere p\u0303i and S\u0303i\u22121 are randomized forecast and past price of the stock respectively. Let us specify details of rounding. The expression \u2206n+ \u221a n/\u2206k+1 from (12) takes its minimal value for \u2206 = (k+12 ) 2 k+3n\u2212 1 k+3 . In this case, the right-hand side\nof the inequality (11) is equal to \u2206n+ \u221a n/\u2206k+1 = 2\u2206n = 2(k+12 ) 2 k+3n1\u2212 1 k+3 .\nWe have k = 1, and hence, we use at any step n the rounding \u2206s = n \u22121/4 s , where s is such that ns < n \u2264 ns+1. We write A \u223c B if positive constants c1 and c2 exist such that c1B \u2264 A \u2264 c2B for all values of parameters from the expressions A and B. Define ns = s M and \u2206s = s \u2212M/4, where M is a positive integer number. Then s \u223c n1/Ms (the constants c1 and c2 depend on M). Easy to verify that all requirements for ns and \u2206s given in Section 2 are valid. By (20) we can define \u00b5n = (4s+5)\u2206sn, where s is such that ns < n \u2264 ns+1. For ns < n \u2264 ns+1 it holds n \u223c ns, hence, \u00b5n \u223c n3/4+1/M . 4 In other approach we can consider a sequence of signals 1, 2, . . ..\nWe represent the total gain by n steps in a form\nKn = \u2211\np\u0303i>S\u0303i\u22121+\n\u2206Si = n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )(Si \u2212 p\u0303i) +\n+ n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )(S\u0303i\u22121 \u2212 Si\u22121) +\n+ n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )(p\u0303i \u2212 S\u0303i\u22121). (21)\nBy (12) the probability that the first addend of the sum (21) is more than \u2212(\u2206sn+\u00b5n+2 \u221a n/\u22062s) tends to 1 as n\u2192\u221e, where s is such that ns < n \u2264 ns+1.\nAccording to Section A.1 the probability that the second addend of the sum (21) is more than \u2212\u2206sn tends to 1 as n \u2192 \u221e. By definition the third addend of the sum (21) is more than\nn\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + ) for all n.\nThen the probability that that the average income per one gamble kn satisfies\nkn = Kn n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + ) \u2265\n \u2212 2\u2206sn+ \u00b5n + 2 \u221a n/\u22062s\nn\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )\n \u223c\n\u223c  \u2212 3n3/4 + n3/4+1/Mn\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )  (22) tends to 1 as n \u2192 \u221e. Using inequalities of Section A.1 and definition of \u2206s and \u00b5n, one can check that the corresponding convergence rate is e \u2212c \u221a n, where c > 0. We summarize this result in the following proposition.\nProposition 1. A randomized trading strategy exists such that given 0 < < 1 and 0 < \u03b3 < 1 with (internal) probability 1\u2212 e\u2212c\u2032 \u221a n if\nn\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + ) \u2265 cn3/4+\u03bd \u03b3 , (23)\nthen kn \u2265 (1\u2212 \u03b3) , where \u03bd = 1/M , c\u2032 and c are positive constants."}, {"heading": "3.2 Trading with a limited risk", "text": "The most important requirement for a trading strategy is guarantee conditions. We present a defensive strategy for Speculator in sense of Shafer and Vovk\u2019s book [9]. This means that starting with some initial capital Speculator never goes\nto debt and receives a gain when a sufficiently long subsequence of forecasts like (23) exists.\nWe modify the strategy given in Section 3.1 to a defensive strategy. Let K0 > 0 be a starting capital of Speculator. Define Mi = \u03b4Ki\u22121, where Ki\u22121 is the capital of Speculator at step i \u2212 1 and \u03b4 is a parameter such that 0 \u2264 \u03b4 \u2264 1. As usual, we suppose that all prices a scaled such that 0 \u2264 Si\u22121 \u2264 1 S1 = S0.\nSpeculator\u2019s capital after ith step is equal to\nKi = Ki\u22121 + \u03b4Ki\u22121\u2206Si. (24)\nAt any step n the logarithm of the capital is equal to\nlnKn = lnK0 + n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + ) ln(1 + \u03b4\u2206Si) \u2265\n\u2265 lnK0 + \u03b4 n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )\u2206Si \u2212\n\u2212\u03b42 n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )(\u2206Si) 2. (25)\nHere we have used the inequality ln(1 + x) \u2265 x\u2212 x2 for |x| \u2264 1. Let L\u0303n = n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + ). Since |\u2206Si\u22121| \u2264 1, a bound\nn\u2211 i=1 I(pi > S\u0303i\u22121 + )(\u2206Si) 2 \u2264 L\u0303n (26)\nis valid for all n. By (22) probability of the event\nn\u2211 i=1 I(pi > S\u0303i\u22121 + )\u2206Si \u2265 L\u0303n \u2212 cn3/4+1/M (27)\ntends to 1 as n\u2192\u221e, where c is a positive constant. Denote\nVarn(S) = 1\nL\u0303n n\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + )(\u2206Si) 2.\nFor practical applications, where Varn(S) 1, we can replace in (26) L\u0303n on L\u0303nVarn(S). Then by (25) and (27) probability of the event\nlnKn \u2265 lnK0 + \u03b4( L\u0303n \u2212 cn3/4+1/M )\u2212 \u03b42Varn(S)L\u0303n (28)\ntends to 1 as n\u2192\u221e. Therefore, probability of the event Kn \u2265 K0 exp ( \u03b4 ( L\u0303n( \u2212 \u03b4Varn(S))\u2212 cn3/4+1/M )) (29)\nFig.1 Calibrated forecasts of prices of LKOH stock\ntends to 1 as n\u2192\u221e. We summarize the result of this section in the following proposition.\nProposition 2. A randomized trading strategy exists such that given 0 < < 1 and 0 < \u03b4 < 1 with (internal) probability 1 \u2212 e\u2212c\u2032 \u221a n the capital Kn of Speculator has a lower bound (29), where c\u2032 and c are positive constants. The capital increases if\nn\u2211 i=1 I(p\u0303i > S\u0303i\u22121 + ) \u2265 cn3/4+\u03bd ( \u2212 \u03b4Varn(S)) ,\nwhere \u03bd = 1/M . Also, Kn > 0 for all n."}, {"heading": "4 Conclusion", "text": "Calibration is an intensively developing area of recent research where several algorithms for computing calibrated forecasts were developed. It is attractive to find some practical applications of these results. Using calibrated forecasts for constructing short-term trading strategies in Stock Market looks very natural.\nIn this paper, we construct such strategies and perform numerical experiments. These experiments show a positive return for six main Russian stocks, and for two stocks we receive a gain even when transaction costs are subtracted.\nTo construct trading strategies we develop a more general notion of calibration and prove convergence results for it. We also present some sufficient conditions under which our trading strategies receive a gain.\nFig.2 Capitals of speculators playing for a rise on six Russian stocks (with no transaction costs \u2013 on the left figure, with transaction costs 0.01% \u2013 on the right\nfigure)"}, {"heading": "A Appendix", "text": "A.1 Large deviation inequality for martingales\nA sequence V1, V2, . . . is called martingale-difference with respect to a sequence of random variables X1, X2, . . . if for any i > 1 the random variable Vi is a function of X1, . . . , Xi and E(Vi+1|X1, . . . , Xi) = 0 almost surely. The following inequalities are consequences of Hoffding-Azuma inequality [2]:\nLet V1, V2, . . . be a martingale\u2013difference with respect to X1, X2, . . ., and Vi \u2208 [Ai, Ai + 1] for some random variable Ai measurable with respect to X1, . . . , Xi. Let Sn =\nn\u2211 i=1 Vi. Then for any t > 0\nP {\u2223\u2223\u2223\u2223Snn \u2223\u2223\u2223\u2223 > t} \u2264 2e\u22122nt2 (30)\nfor all n. A strong law of large numbers is also holds: for any t\nP { sup k\u2265n \u2223\u2223\u2223\u2223Skk \u2223\u2223\u2223\u2223 > t} \u2264 t\u22122e\u22122nt2 (31)\nfor all n. Since the series of the exponents from the right-hand side of the inequality (30) convergent, by Borel\u2013Cantelli Lemma we obtain the martingale strong law of large numbers\nP { lim n\u2192\u221e Sn n = 0 } = 1.\nFig.3 Capital of the weighted average of 12 strategies (two strategies for each stock \u2013 calibration strategy and \u201cbuy and hold\u201d (B&H) strategy\nA.2 Numerical experiments\nIn the numerical experiments, we have used historical data in form of per minute time series of prices of six main stocks of Russian Stock Market in 2010 (From 2010-03-26T10:31 to 2010-09-16T12:15). downloaded from FINAM site: www .finam.ru. Number of trading points in each game is 6 \u00b7 104 min. In our experiments, we dealing only for a rise starting with the same initial capital K0.\nWe have used the threshold = \u2032\u03c3, where \u03c3 is the standard deviation of a price calculating using some sliding window, 0 < \u2032 < 1. A kernel K(p, p\u2032) = cos(\u03c0(p\u2212 p\u2032)) was used as a smooth approximation of (5).\nResults of numerical experiments are shown in Table 1. In the first column, ticker symbols of six stocks from Russian Stock Market are shown. The second column contains the frequencies of steps i where pi > Si\u22121 + . In the third column, the average duration of a gamble is shown. We sell all shares of a stock at step i in case p\u0303i \u2264 Si\u22121 + or Si \u2264 Si\u22121. In fourth and in fifth columns, a relative return (in percentage wise on initial capital) for six main stocks from Russian Stock Market in 2010. We have used a transaction cost at the rate 0.01%. In the sixth column, a return of \u201cbuy and hold\u201d strategy is shown. By this strategy, we buy a holdings of shares for K0 and sell them at the end of the trading period.\nOn Fig.1 the evolution of LKOH prices and their predictions are shown. On Fig. 2 the relative returns of calibration strategies for all six stocks are shown (without and with transaction costs). On Fig.3 a relative return of shortterm trading for six stocks are shown including calibration and buy and hold strategy for each stock. The extra bold line represents a relative return of some averaging strategy AGGR. This strategy is similar to the Freund and Shapire [6] exponential weighting algorithm, where one-day steps are used (see also the last line of Table 1)."}], "references": [{"title": "Asymptotic calibratio", "author": ["D.P.Foster", "R. Vohra"], "venue": "Biometrika. 85,", "citeRegEx": "5", "shortCiteRegEx": "5", "year": 1998}, {"title": "A decision-theoretic generalization of online learning and an application to boosting", "author": ["Y Freund", "R.E. Schapire"], "venue": "Journal of Computer and System Sciences,", "citeRegEx": "6", "shortCiteRegEx": "6", "year": 1997}, {"title": "Probability and Finance. It\u2019s Only a Game", "author": ["G. Shafer", "V. Vovk"], "venue": "New York: Wiley,", "citeRegEx": "9", "shortCiteRegEx": "9", "year": 2001}], "referenceMentions": [{"referenceID": 0, "context": "Foster and Vohra [5] show that calibration is almost surely guaranteed with a randomizing forecasting rule, i.", "startOffset": 17, "endOffset": 20}, {"referenceID": 2, "context": "We present a defensive strategy for Speculator in sense of Shafer and Vovk\u2019s book [9].", "startOffset": 82, "endOffset": 85}, {"referenceID": 1, "context": "This strategy is similar to the Freund and Shapire [6] exponential weighting algorithm, where one-day steps are used (see also the last line of Table 1).", "startOffset": 51, "endOffset": 54}], "year": 2013, "abstractText": "We provide a natural learning process in which a financial trader without a risk receives a gain in case when Stock Market is inefficient. In this process, the trader rationally choose his gambles using a prediction made by a randomized calibrated algorithm. Our strategy is based on Dawid\u2019s notion of calibration with more general changing checking rules and on some modification of Kakade and Foster\u2019s randomized algorithm for computing calibrated forecasts.", "creator": "TeX"}}}