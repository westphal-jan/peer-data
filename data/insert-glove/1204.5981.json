{"id": "1204.5981", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "26-Apr-2012", "title": "Containment, Equivalence and Coreness from CSP to QCSP and beyond", "abstract": "h1-b The 5:37 constraint satisfaction clothing problem (saccharum CSP) and ship-borne its sidetracking quantified extensions, whether enguerrand without (QCSP) leka or with potentiated disjunction (sterkfontein QCSP_or ), straightener correspond islas naturally boroland to the boatbuilders model checking neubauer problem vrain for three geekiness increasingly stronger fragments ocs of coolbaugh positive first - same-sex order ecotourism logic. kolnik Their philanthropical complexity correo is often studied what-if when slouchy parameterised by azzarello a fixed minimally model, canan the so - called long-term template.", "histories": [["v1", "Thu, 26 Apr 2012 16:46:25 GMT  (37kb,D)", "http://arxiv.org/abs/1204.5981v1", null]], "reviews": [], "SUBJECTS": "cs.LO cs.AI", "authors": ["florent madelaine", "barnaby martin"], "accepted": false, "id": "1204.5981"}, "pdf": {"name": "1204.5981.pdf", "metadata": {"source": "CRF", "title": "Containment, Equivalence and Coreness from CSP to QCSP and beyond", "authors": ["Barnaby Martin"], "emails": ["barnabymartin@gmail.com", "florent.madelaine@googlemail.com"], "sections": [{"heading": "1 Introduction", "text": "We consider the following increasingly stronger fragments of first-order logic:\n1. primitive positive first-order ({\u2203,\u2227}-FO)\n2. positive Horn ({\u2203,\u2200,\u2227}-FO)\n3. positive equality-free first-order ({\u2203,\u2200,\u2227,\u2228}-FO); and,\n4. positive first-order logic ({\u2203,\u2200,\u2227,\u2228,=}-FO) \u2217Supported by EPSRC grant EP/G020604/1.\nar X\niv :1\n20 4.\n59 81\nv1 [\ncs .L\nO ]\nThe model checking problem for a logic L takes as input a sentence of L and a structure B and asks whether B models L. The structure B is often assumed to be a fixed parameter and called the template; and, unless otherwise stated, we will assume implicitly that we work in this so-called non-uniform setting.\nFor the above first three fragments, the model checking problem is better known as the constraint satisfaction problem CSP(B), the quantified constraint satisfaction problem QCSP(B) and its extension with disjunction which we shall denote by QCSP\u2228(B). Much of the theoretical research into CSPs is in respect of a large complexity classification project \u2013 it is conjectured that CSP(B) is always either in P or NP-complete [9]. This dichotomy conjecture remains unsettled, although dichotomy is now known on substantial classes (e.g. structures of size \u2264 3 [16, 3] and smooth digraphs [11, 1]). Various methods, combinatorial (graph-theoretic), logical and universal-algebraic have been brought to bear on this classification project, with many remarkable consequences. A conjectured delineation for the dichotomy was given in the algebraic language in [4].\nComplexity classifications for QCSPs appear to be harder than for CSPs. Just as CSP(B) is always in NP, so QCSP(B) is always in Pspace. No overarching polychotomy has been conjectured for the complexities of QCSP(B), as B ranges over finite structures, but the only known complexities are P, NP-complete and Pspace-complete (see [2, 15] for some trichotomies). It seems plausible that these complexities are the only ones that can be so obtained.\nDistinct templates may give rise to the same model-checking-problem or preserve acceptance,\n(L -equivalence) for any sentence \u03d5 of L , A models \u03d5 \u21d4 B models \u03d5\n(L -containment) for any sentence \u03d5 of L , A models \u03d5 \u21d2 B models \u03d5.\nWe will see that containment and therefore equivalence is decidable, and often quite effectively so, for the four logics we have introduced.\nFor example, when L is {\u2203,\u2227}-FO, any two bipartite undirected graphs that have at least one edge are equivalent. Moreover, there is a canonical minimal representative for each equivalence class, the so-called core. For example, the core of the class of bipartite undirected graphs that have at least one edge is the graph K2 that consists of a single edge. The core enjoys many benign properties and has greatly facilitated the classification project for CSPs (which corresponds to the model-checking for {\u2203,\u2227}-FO): it is unique up to isomorphism and sits as an induced substructure in all templates in its equivalence class. A core may be defined as a structure all of whose endomorphisms are automorphisms. To review, therefore, it is well-known that two templates A and B are equivalent iff there are homomorphisms from A to B and from B to A, and in this case there is an (up to isomorphism) unique core C equivalent to both A and B such that C \u2286 A and C \u2286 B.\nThe situation for {\u2203, \u2200,\u2227}-FO and QCSP is somewhat murkier. It is known that non-trivial A and B are equivalent iff there exist integers r and r\u2032 and surjective homomorphisms from Ar to B and from Br\u2032 to A (and one may give a bound on these exponents) [6]. However, the status and properties of \u201ccore-ness\u201d for QCSP were hitherto unstudied.\nWe might call a structure B a Q-core if there is no equivalent A of strictly smaller cardinality. We will discover that this Q-core is a more cumbersome beast than its cousin the core; it need not be unique nor sit as an induced substructure of the templates in its class. However, in many cases we shall see that its behaviour is reasonable and that \u2013 like the core \u2013 it can be very useful in delineating complexity classifications.\nThe erratic behaviour of Q-cores sits in contrast not just to that of cores, but also that of the UX-cores of [13], which are the canonical representatives of the equivalence classes associated with {\u2203,\u2200,\u2227,\u2228}-FO, and were instrumental in deriving a full complexity classification \u2013 a tetrachotomy \u2013 for QCSP\u2228 in [13]. Like cores, they are unique and sit as induced substructures in all templates in their class. Thus, primitive positive logic and positive equality-free logic behave genially in comparison to their wilder cousin positive Horn. In fact this manifests on the algebraic side also \u2013 polymorphisms and surjective hyper-endomorphisms are stable under composition, while surjective polymorphisms are not.\nContinuing to add to our logics, in restoring equality, we might arrive at positive logic. Two finite structures agree on all sentences of positive logic iff they are isomorphic \u2013 so here every finite structure satisfies the ideal of \u201ccore\u201d. When computing a/the smallest substructure with the same behaviour with respect to the four decreasingly weaker logics \u2013 positive logic, positive equality-free, positive Horn, and primitive positive \u2013 we will obtain possibly decreasingly smaller structures. In the case of positive equality-free and primitive positive logic, as pointed out, these are unique up to isomorphism; and for the U -X-core and the core, these will be induced substructures. A Q-core will necessarily contain the core and be included in the U-X-core. This phenomenon is illustrated on Table 1 and will serve as our running example.\nThe paper is organised as follows. In Section 2, we recall folklore results on CSP. In Section 3, we recall results on coreness and spell out containment for {\u2203,\u2200,\u2227,\u2228}-FO that were only implicit in [13]. In Section 4, we move on to QCSP and recall results on the decidability of containment from [6] together with new lower bounds before initiating a study of the notion of core for QCSP."}, {"heading": "2 The case of CSP", "text": "Unless otherwise stated, we consider structures over a fixed relational signature \u03c3. We denote by A the domain of a structure A and for every relation symbol R in \u03c3 of arity r, we write RA for the interpretation of R in A, which is a r-ary relation that is RA \u2286 Ar. We write |A| to denote the cardinality of the set A. A homomorphism (resp., strong homomorphism) from a structure A to a structure B is a function h : A \u2192 B such that (h(a1), . . . , h(ar)) \u2208 RB, if (resp., iff) (a1, . . . , ar) \u2208 RA.\nWe will occasionally consider signatures with constant symbols. We write cA for the interpretation of a constant symbol c and homomorphisms are required to preserve constants as well, that is h(cA) = cB.\nContainment for {\u2203,\u2227}-FO is a special case of conjunctive query containment from databases [5]. We state and prove these results for pedagogical reasons, before moving to the case of {\u2203, \u2200,\u2227,\u2228}-FO. Let us fix some notation first. Given a sentence \u03d5 in {\u2203,\u2227}-FO, we denote by D\u03d5 its canonical database, that is the structure with domain the variables of \u03d5 and whose tuples are precisely those that are atoms of \u03d5. In the other direction, given a finite structure A, we write \u03d5A for the so-called canonical conjunctive query of A, the quantifier-free formula that is the conjunction of the positive facts of A, where the variables v1, . . . , v|A| correspond to the elements a1, . . . , a|A| of A.1 It is well known that there is a homomorphism from D\u03d5 to a structure A if, and only if, A |= \u03d5. Moreover, a winning strategy for \u2203 in the (Hintikka) (A, \u03d5)-game is precisely a homomorphism from D\u03d5 to A. Note also that A is isomorphic to the canonical database of \u2203v1\u2203v2 . . . v|A|\u03d5A. Theorem 1 (Containment). Let A and B be two structures. The following are equivalent.\n(i) for every sentence \u03d5 in {\u2203,\u2227}-FO, if A |= \u03d5 then B |= \u03d5.\n(ii) The exists a homomorphism from A to B.\n(iii) B |= \u2203v1\u2203v2 . . . v|A|\u03d5A. where \u03d5A denotes the canonical conjunctive query of A. Proof. A homomorphism corresponds precisely to a winning strategy in the (A, \u03d5)-game and (ii) and (iii) are equivalent. Clearly, (i) implies (iii) since A |= \u2203v1\u2203v2 . . . v|A|\u03d5A.\nWe now prove that (ii) implies (i). Let h be a homomorphism from A to B. If A |= \u03d5, then there is a homomorphism g from D\u03d5 to A. By composition, g \u25e6 h is a homomorphism from D\u03d5 to B. In other words, g \u25e6 h is a winning strategy witnessing that B |= \u03d5.\nIt is well known that the core is unique up to isomorphism and that it is an induced substructure [12]. It is usually defined via homomorphic equivalence, but because of the equivalence between (i) and (ii) in the above theorem, we may define the core as follows.\nDefinition 1. The core B of a structure A is a minimal substructure of A such that for every sentence \u03d5 in {\u2203,\u2227}-FO, A |= \u03d5 if and only if B |= \u03d5. Corollary 1 (equivalence). Let A and B be two structures. The following are equivalent.\n(i) for every sentence \u03d5 in {\u2203,\u2227}-FO, A |= \u03d5 if and only if B |= \u03d5.\n(ii) There are homomorphisms from A to B and from B to A.\n(iii) The core of A and the core of B are isomorphic. As a preprocessing step, one could replace the template A of a CSP by its core B (see Algorithm\n6.1 in [7]). However, the complexity of this preprocessing step would be of the same order of magnitude as solving a constraint satisfaction problem.2 This drawback, together with the uniform nature of the instance in constraints solvers, means that this preprocessing is not exploited in practice to the best of our knowledge.\nThe notion of a core can be extended and adapted suitably to solve important questions related to data exchange and query rewriting in databases [8]. It is also very useful as a simplifying assumption when classifying the complexity: with the algebraic approach, it allows to study only idempotent algebras [4].\n1Most authors consider the canonical query to be the sentence which is the existential quantification of \u03d5A. 2Checking that a graph is a core is coNP-complete [10]. Checking that a graph is the core of another given graph\nis DP-complete [8]."}, {"heading": "3 The case of QCSP with disjunction", "text": "For {\u2203,\u2200,\u2227,\u2228}-FO, it is no longer the homomorphism that is the correct concept to transfer winning strategies.\nDefinition 2. A surjective hypermorphism f from a structure A to a structure B is a function from the domain A of A to the power set of the domain B of B that satisfies the following properties.\n\u2022 (total) for any a in A, f(a) 6= \u2205.\n\u2022 (surjective) for any b in B, there exists a in A such that f(a) 3 b.\n\u2022 (preserving) if R(a1, . . . , ai) holds in A then R(b1, . . . , bi) holds in B , for all b1 \u2208 f(a1), . . . , bi \u2208 f(ai).\nA strategy for \u2203 in the (Hintikka) (A, \u03d5)-game, where \u03d5 \u2208 {\u2203,\u2200,\u2227,\u2228}-FO, is a set of mappings {\u03c3x : \u2018\u2203x\u2019 \u2208 \u03d5} with one mapping \u03c3x for each existentially quantified variable x of \u03d5. The mapping \u03c3x ranges over the domain A of A; and, its domain is the set of functions from Yx to A, where Yx denotes the universally quantified variables of \u03d5 preceding x.\nWe say that {\u03c3x : \u2018\u2203x\u2019 \u2208 \u03d5} is winning if for any assignment \u03c0 of the universally quantified variables of \u03d5 to A, when each existentially quantified variable x is set according to \u03c3x applied to \u03c0|Yx , then the quantifier-free part \u03c8 of \u03d5 is satisfied under this overall assignment h. When \u03c8 is disjunction-free, this amounts to h being a homomorphism from D\u03c8 to A.\nLemma 1 (strategy transfer). Let A and B be two structures such that there is a surjective hypermorphism from A to B. Then, for every sentence \u03d5 in {\u2203,\u2200,\u2227,\u2228}-FO, if A |= \u03d5 then B |= \u03d5.\nProof. Let f be a surjective hypermorphism from A to B and \u03d5 be a sentence of {\u2203,\u2200,\u2227,\u2228}-FO such that A |= \u03d5. For any element b of B, let f\u22121(b) := {a \u2208 A s. t. b \u2208 f(a)}. We fix an arbitrary linear order over A and write min f\u22121(b) to denote the smallest antecedent of b in A under f .\nLet {\u03c3x : \u2018\u2203x\u2019 \u2208 \u03d5} be a winning strategy in the (A, \u03d5)-game. We construct a strategy {\u03c3\u2032x : \u2018\u2203x\u2019 \u2208 \u03d5} in the (B, \u03d5)-game as follows. Let \u03c0B : Yx \u2192 B be an assignment to the universal variables Yx preceding an existential variable x in \u03d5, we select for \u03c3 \u2032 x(\u03c0) an arbitrary element of f(\u03c3(\u03c0A)) where \u03c0A : Yx \u2192 A is an assignment such that for any universal variable y preceding x, we have \u03c0A(y) := min f\n\u22121(\u03c0B(y)). This strategy is well defined since f is surjective (which means that \u03c0A is well defined) and total (which means that f(\u03c3(\u03c0A)) 6= \u2205). Note moreover that using min in the definition of \u03c0A means that a branch in the tree of the game on B will correspond to a branch in the tree of the game on A. It remains to prove that {\u03c3\u2032x : \u2018\u2203x\u2019 \u2208 \u03d5} is winning. We will see that it follows from the fact that f is preserving.\nAssume first that \u03d5 is a sentence of {\u2203,\u2200,\u2227}-FO. Let D\u03c8 be the canonical database of the quantifier-free part \u03c8 of \u03d5. The winning condition of the (B, \u03d5)-game can be recast as a homomorphism from D\u03c8. Composing with f the homomorphism from D\u03c8 to A (induced by the sequence of compatible assignments \u03c0A to the universal variables and the strategy {\u03c3x : \u2018\u2203x\u2019 \u2208 \u03d5}), we get a surjective hypermorphism from D\u03c8 to B. The map from the domain of D\u03c8 to B induced by the sequence of assignments \u03c0B and the strategy {\u03c3\u2032x : \u2018\u2203x\u2019 \u2208 \u03d5} is a range restriction of this surjective hypermorphism and is therefore a homomorphism (we identify surjective hypermorphism to singletons with homomorphisms).\nWhen \u03d5 is not a sentence of {\u2203,\u2200,\u2227}-FO, we write its quantifier-free part in disjunctive normal form as a disjunction of conjunctions-of-atoms \u03c8i. The winning condition can now be recast as a homomorphism from some D\u03c8i . The above argument applies and the result follows.\nExample 1. Consider the structures A4 and A3 from Table 1. The map f given by f(1) := {1}, f(2) := {2}, f(3) := {3}, f(4) := {1} is a surjective hypermorphism from A4 to A3. The map g given by g(1) := {1, 4}, g(2) := {2}, g(3) := {3} is a surjective hypermorphism from A3 to A4. The two templates are equivalent w.r.t. {\u2203,\u2200,\u2227,\u2228}-FO.\nWe extend the notion of canonical conjunctive query of a structureA. Given a tuple of (not necessarily distinct) elements r := (r1, . . . , rl) \u2208 Al, define the quantifier-free formula \u03d5A(r)(v1, . . . , vl) to be the conjunction of the positive facts of r, where the variables v1, . . . , vl correspond to the elements r1, . . . , rl. That is, R(v\u03bb1 , . . . , v\u03bbi) appears as an atom in \u03d5A(r) iff R(r\u03bb1 , . . . , r\u03bbi) holds in A. When r enumerates the elements of the structure A, this definition coincides with the usual definition of canonical conjunctive query. Note also that there is a strong homomorphism from the canonical database D\u03d5A(r) to A given by the map ri 7\u2192 vi.\nDefinition 3 (Canonical {\u2203,\u2200,\u2227,\u2228}-FO sentence). Let A be a structure and m > 0. Let r be an enumeration of the elements of A.\n\u03b8A,m := \u2203v1, . . . , v|A|\u03d5A(r)(v1, . . . , v|A|) \u2227 \u2200w1, . . . , wm \u2228\nt\u2208Am \u03d5A(r,t)(v,w).\nObserve that A |= \u03b8A,m. Indeed, we may take as witness for the variables v the corresponding enumeration a of the elements of A; and, for any assignment t \u2208 Am to the universal variables w, it is clear that A |= \u03d5A(r,t)(a, t) holds.\nLemma 2 (strategy transfer). Let A and B be two structures. If B |= \u03b8A,|B| then there is a surjective hypermorphism from A to B.\nProof. Let b\u2032 := b\u20321, . . . , b \u2032 |A| be witnesses for v1, . . . , v|A|. Assume that an enumeration b := b1, b2, . . . , b|B| of the elements of B is chosen for the universal variables w1, . . . w|B|. Let t \u2208 Am be the witness s.t. B |= \u03d5A(r)(b\u2032) \u2227 \u03d5A(r,t)(b\u2032,b).\nLet f be the map from the domain of A to the power set of that of B which is the union of the following two partial hyperoperations h and g (i.e. f(ai) := h(ai)\u222a g(ai) for any element ai of A), which guarantee totality and surjectivity, respectively.\n\u2022 (totality) h(ai) := b\u2032i\n\u2022 (surjectivity) g(ti) 3 bi.\nIt remains to show that f is preserving. This follows from B |= \u03d5A(r,t)(b\u2032,b). LetR be a r-ary relational symbol such thatR(ai1 , . . . , air) holds inA. Let b\u2032\u2032i1 \u2208 f(ai1), . . . , b \u2032\u2032 ir \u2208 f(ar). We will show that R(b \u2032\u2032 i1 , . . . , b\u2032\u2032ir) holds in B. Assume for clarity of the exposition and w.l.o.g. that from i1 to ik the image is set according to h and from ik+1 to ir according to g: i.e. for 1 \u2264 j \u2264 k, h(aij) = b\u2032ij = b \u2032\u2032 ij\nand for k + 1 \u2264 j \u2264 r, there is some lj such that tlj = aij and g(tlj) 3 b\u2032\u2032ij = blj . By definition of A(r, t) the atom R(vi1 , . . . , vik , wlk+1 , . . . , wr) appears in \u03d5A(r,t)(v,w). It follows from B |= \u03d5A(r,t)(b\u2032,b) that R(b\u2032\u2032i1 , . . . , b \u2032\u2032 ir) holds in B.\nTheorem 2 (Containment for {\u2203,\u2200,\u2227,\u2228}-FO). Let A and B be two structures. The following are equivalent.\n(i) for every sentence \u03d5 in {\u2203, \u2200,\u2227,\u2228}-FO, if A |= \u03d5 then B |= \u03d5.\n(ii) The exists a surjective hypermorphism from A to B.\n(iii) B |= \u03b8A,|B| where \u0398A,B is a canonical sentence of {\u2203,\u2200,\u2227,\u2228}-FO that is defined in terms of A and |B| and that is modelled by A by construction. Proof. By construction A |= \u03b8A,|B|, so (i) implies (iii). By Lemma 1, (ii) implies (i). By Lemma 2, (iii) implies (i).\nLet U and X be two subsets of A and a surjective hypermorphism h from A to A that satisfies h(U) = A and h\u22121(X) = A. Let B be the substructure of A induced by B := U \u222a X. Then f and g, the range and domain restriction of h to B, respectively, are surjective hypermorphisms between A and B witnessing that A and B satisfy the same sentence of {\u2203,\u2200,\u2227,\u2228}-FO. Note that in particular h induces a retraction of A to a subset of X; and, dually a retraction of the complement structure 3 of B to a subset of U . Additional minimality conditions on U , X and U \u222a X ensure that B is minimal.4 It is also unique up to isomorphism and within B the set U and X are uniquely determined. Consequently, B is called the U -X-core of A (for further details see [13]) and may be defined as follows.\nDefinition 4. The U-Xcore B of a structure A is a minimal substructure of A such that for every sentence \u03d5 in {\u2203,\u2200,\u2227,\u2228}-FO, A |= \u03d5 if and only if B |= \u03d5. Example 2. The map h(1) := {1, 4}, h(2) := {2}, h(3) := {1, 3, 4}, h(4) := {1, 4} is a surjective hypermorphism from A4 to A4 with U = {2, 3} and X := {1, 2}. The substructure induced by U \u222aX is A3. It can be checked that it is minimal.\nThe U -X-core is just like the core an induced substructure. There is one important difference in that U -X-cores should be genuinely viewed as a minimal equivalent substructure induced by two sets. Indeed, when evaluating a sentence of {\u2203,\u2200,\u2227,\u2228}-FO, we may assume w.l.o.g. that all \u2200 variables range over U and all \u2203 variables range over X. This is because for any play of \u2200, we may extract a winning strategy for \u2203 that can even restrict herself to play only on X [13, Lemma 5]. Hence, as a preprocessing step, one could compute U and X and restrict the domain of each universal variable to U and the domain of each universal variable to X. The complexity of this processing step is no longer of the same magnitude and is in general much lower than solving a QCSP\u2228.\n5 Thus, even when taking into account the uniform nature of the instance in a quantified constraints solver, this preprocessing step might be exploited in practice. This could turn out to be ineffective when there are few quantifier alternation (as in bilevel programming), but should be of particular interest when the quantifier alternation increases. Another interesting feature is that storing a winning strategy over U and X together with the surjective hypermorphism h from A to A, allows to recover a winning strategy even when \u2200 plays in an unrestricted manner. This provides a compression mechanism to store certificates."}, {"heading": "4 The case of QCSP", "text": "In primitive positive and positive Horn logic, one normally considers equalities to be permitted. From the perspective of computational complexity of CSP and QCSP, this distinction is unimportant as equalities may be propagated out by substitution. In the case of positive Horn and QCSP,\n3It has the same domain as A and a tuple belongs to a relation R iff it did not in A. 4This is possible since given h1 s.t. h1(U) = A and h2 such that h \u22121 2 (X) = A, their composition h = h2 \u25e6 h1 satisfies both h(U) = A and h\u22121(X) = A. 5The question of U -X-core identification is in DP (and should be complete), whereas QCSP\u2228 is Pspace-complete in general\nthough, equality does allow the distinction of a trivial case that can not be recognised without it. The sentence \u2200x x = x is true exactly on structures of size one. The structures K1 and 2K1, containing empty relations over one element and two elements, respectively, are therefore distinguishable in {\u2203,\u2200,\u2227,=}-FO, but not in {\u2203, \u2200,\u2227}-FO. Since we disallow equalities, many results from this section apply only to non-trivial structures of size \u2265 2. Note that equalities can not be substituted out from {\u2203,\u2200,\u2227,\u2228,=}-FO, thus it is substantially stronger than {\u2203,\u2200,\u2227,\u2228}-FO.\nFor {\u2203,\u2200,\u2227}-FO, the correct concept to transfer winning strategies is that of surjective homomorphism from a power. Recall first that the product A \u00d7 B of two structures A and B has domain {(x, y) : x \u2208 A, y \u2208 B} and for a relation symbol R, RA\u00d7B := { ( (a1, b1), . . . , (ar, br) ) : (a1, . . . , ar) \u2208 RA, (b1, . . . , br) \u2208 RB}; and, similarly for a constant symbol c, cA\u00d7B := (cA, cB). The mth power Am of A is A\u00d7 . . .\u00d7A (m times).\nLemma 3 (strategy transfer). Let A and B be two structures and m \u2265 1 such that there is a surjective homomorphism from Am to B. Then, for every sentence \u03d5 in {\u2203, \u2200,\u2227}-FO, if A |= \u03d5 then B |= \u03d5.\nProof. For m = 1, the proof is similar to Lemma 1. A projection from Am to A is a surjective homomorphism. This means that for every sentence \u03d5 in {\u2203,\u2200,\u2227}-FO, if Ar |= \u03d5 then A |= \u03d5. For the converse, one can consider the \u201cproduct strategy\u201d which consists in projecting over each coordinate of Am and applying the strategy for A. For further details see [6, Lemma 1&2].\nExample 3. Consider an undirected bipartite graphs with at least one edge G and K2 the graph that consists of a single edge. There is a surjective homomorphism from G to K2. Note also that K2\u00d7K2 = K2+K2 (where + stands for disjoint union) which we write as 2K2. Thus, K2j = 2j\u22121K2 (as \u00d7 distributes over +). Hence, if G has no isolated element and m edges there is a surjective homomorphism from K1+log2m2 to G.\nThis examples provides a lower bound for m which we can improve.\nProposition 1 (lower bound). For any m \u2265 2, there are structures A and B with |A| = m and |B| = m+1 such that there is only a surjective homomorphism from Aj to B provided that j \u2265 |A|.\nsketch. We consider a signature that consists of a binary symbol E together with a monadic predicate R. Consider for A an oriented cycle with m vertices, for which R holds for all but one. Consider for B an oriented cycle with m vertices, for which R does not hold, together with a self-loop on which R holds. The square of A will consists of |A| = m oriented cycles with m vertices: one cycle will be a copy of A, all the other will be similar but with two vertices on which R does not hold (this is depicted on Figure 1 in the case m = 3: white vertices do not satisfy R while black ones do). It is only for j = m that we will get as an induced substructure of Aj one copy of an oriented cycle on which R does not hold as in B.\nThere is also a canonical {\u2203,\u2200,\u2227}-FO-sentence which turns out to be in \u03a02-form, that is with a quantifier prefix of the form \u2200?\u2203?. We consider temporarily structures with m constants c1, c2, . . . , cm; let t in A\nm describe the position of these constants in a structure A; and, write At for the corresponding structure with constants. We consider the canonical conjunctive query of the structure with constants \u2297 t\u2208Am At, (where \u2297 denote the product), identifying the constants with some variables w = w1, . . . , wm and using variables v for the other elements. We turn this quantifier-free formula into a sentence by adding the prefix \u2200w\u2203v. Keeping this in mind, we can also give the following direct definition, but it dilutes the intuition somewhat.\nDefinition 5 (Canonical {\u2203,\u2200,\u2227}-FO sentence). Let A be a structure and m > 0. Let r be an enumeration of the elements of A\u0303 := A|A|m.\n\u03c8A,m := \u2200w\u2203v\u03d5A\u0303(r)(v) \u2227 \u2227\nt\u2208Am w1 = vt,t[1] . . . \u2227 wm = vt,t[m].\nObserve that we may propagate the equalities out of \u03c8A,m to obtain an equivalent sentence: e.g. we remove w1 = vt,t[1] and replace every occurrence of vt,t[1] by w1. Observe also that A |= \u03c8A,m. Indeed, assume that t \u2208 Am is the assignment chosen for the universal variables w. There is a natural projection from \u2297 t\u2208Am At to At which is a homomorphism. This homomorphism corresponds precisely to a winning strategy for the existential variables v.\nTheorem 3 (Containment for {\u2203,\u2200,\u2227}-FO). Let A and B be two non-trivial structures. The following are equivalent.\n(i) for every sentence \u03d5 in {\u2203, \u2200,\u2227}-FO, if A |= \u03d5 then B |= \u03d5.\n(ii) There exists a surjective homomorphism from Ar to B, with r \u2264 |A||B|.\n(iii) B |= \u03c8A,|B|\nwhere \u03c8A,|B| is a canonical sentence of {\u2203,\u2200,\u2227}-FO with quantifier prefix \u2200|B|\u2203? that is defined in terms of A and modelled by A by construction.\nsketch. (ii) implies (i) by Lemma 3. (i) implies (iii) since A models \u03c8A,|B|. (iii) implies (ii) by construction of \u03c8A,|B|. We may chose for the universal variables w an enumeration of B. The winning strategy on B induces a surjective homomorphism from Ar (for further details see [6, Theorem 3] and comments on the following page).\nFollowing our approach for the other logics, we now define a minimal representative as follows.\nDefinition 6. A Q-core B of a structure A is a minimal substructure of A such that for every sentence \u03d5 in {\u2203,\u2200,\u2227}-FO, A |= \u03d5 if and only if B |= \u03d5.\nExample 4. Consider A3 and A2 from Table 1. The map f(1) := 1, f(2) := 2, f(3) := 2 is a surjective homomorphism from A3 to A2. The square of A2 is depicted on Figure 2a; and, a surjective homomorphism from it to A3 is depicted on Figure 2b. Thus A3 and A2 are equivalent w.r.t. {\u2203,\u2200,\u2227}-FO. One can also check that A2 is minimal and is therefore a Q-core of A3, and a posteriori of A4.\nThe behaviour of the Q-core differs from its cousins the core and the U -X-core.\nProposition 2. The Q-core of a 3-element structure A is not always an induced substructure of A.\nProof. Consider the signature \u03c3 := \u3008E,R,G\u3009 involving a binary relation E and two unary relations R and G. Let A and B be structures with domain {1, 2, 3} with the following relations.\nEA := {(1, 1), (2, 3), (3, 2)} RA := {1, 2} GA := {1, 3} EB := {(1, 1), (2, 3), (3, 2)} RB := {1} GB := {1}\nSince B is a substructure of A, we have B\u2212\u2192 A. Conversely, the square of A2 contains an edge that has no vertex in the relation R and G, which ensures that A2\u2212\u2192 B (see Figure 3). Observe also that no two-element structure C, and a fortiori no two-element substructure of A agrees with them on {\u2203, \u2200,\u2227}-FO. Indeed, if a structure C agrees on {\u2203,\u2200,\u2227}-FO with B, it agrees also on {\u2203,\u2227}-FO. Thus, the core of B is also the core of C and must appear as an induced substructure of C. This core is the one-element substructure of B induced by 1. In order to have a surjective homomorphism from a power of C to B, this power must contain a non-loop, and so does C. This non-loop must in C be adjacent to another vertex (this is a {\u2203,\u2200,\u2227}-FO-expressible property that holds in B \u2200x\u2203yE(x, y)). The structure C would therefore be a two element structure satisfying\nEC \u2286 {(1, 1), (1, 2), (2, 1)} RC \u2286 {1} GC \u2286 {1}\nA power of C would therefore be connected, which is not the case of B, preventing the existence of any surjective homomorphism.\nWe do not know whether the Q-core of a structure is unique. We will explore in the following section Q-cores over some special classes and show that it behaves well in these cases."}, {"heading": "5 Q-cores over classes", "text": ""}, {"heading": "5.1 The Boolean case", "text": "A Boolean structure B has domain B := {0, 1}. The results of this section apply to arbitrary (not necessarily finite) signatures. We give the following lemma ultimately for illustrative purposes (the gist of its proof will be reused several times). The pH-type T (b) of b \u2208 B is the set of all formulae \u03d5(x) in one free variable x from {\u2203, \u2200,\u2227}-FO such that B |= \u03d5(x) (pH stands for positive Horn).\nLemma 4. If B is a Boolean structure such that the pH-types T (0) and T (1) in B coincide, then B has an automorphism swapping 0 and 1.\nProof. Suppose there is no such automorphism, then w.l.o.g. we may assume there exists a conjunction of atoms \u03b8(x, y), involving only variables x and y, such that B |= \u03b8(0, 1) but B |=/ \u03b8(1, 0). Now, B |= \u03b8(0, 0) iff B |= \u03b8(1, 1), since 0 and 1 are of the same pH-type. If B |= \u03b8(0, 0) then B |= \u2200x\u03b8(x, 0) but B |=/ \u2200x\u03b8(x, 1) (contradiction). Similarly, if B |=/ \u03b8(0, 0) then B |= \u2203x\u03b8(0, x) but B |=/ \u2203x\u03b8(1, x) (contradiction).\nTheorem 4. Let A and B be Boolean structures that are equivalent w.r.t. {\u2203,\u2200,\u2227}-FO. Then A and B are isomorphic.\nProof. We consider the pH-types TA(0) and TA(1) of 0 and 1 in A, respectively (likewise with B superscripts for B).\nCase I. TA(0) = TA(1). It follows that TA(0) = TA(1) = TB(0) = TB(1), since \u03d5(x) \u2208 TA(0) iff A |= \u2200x\u03d5(x) iff B |= \u2200x\u03d5(x) iff \u03b8(x) \u2208 TB(0) etc. In this case the function A \u2192 B given by 0 7\u2192 0 and 1 7\u2192 1 is an isomorphism, as in the proof of Lemma 4. (Of course, 0 7\u2192 1 and 1 7\u2192 0 is also an isomorphism.)\nCase II. TA(0) and TA(1) are incomparable. Let \u03b80(x) be in T A(0) but not in TA(1); and let \u03b81(x) be in T A(1) but not in TA(0). Let z(0) be the witness of \u2203x\u03b80(x) in B; and let z(1) be the witness of \u2203x\u03b81(x) in B. Since A |=/ \u2203x\u03b80(x)\u2227\u03b81(x), B |=/ \u2203x\u03b80(x)\u2227\u03b81(x) and z(0) 6= z(1). We claim z (0 7\u2192 z(0), 1 7\u2192 z(1)) is an isomorphism from A to B. If not, then w.l.o.g. we may assume there exists an atom (maybe with variables identified) \u03b8(x, y) such thatA |= \u03b8(0, 1) but B |=/ \u03b8(z(0), z(1)). Now, A |= \u03b8(0, 0) iff A |= \u03b80(0) \u2227 \u03b8(0, 0) iff A |= \u2203x\u03b80(x) \u2227 \u03b8(x, x) iff B |= \u2203x\u03b80(x) \u2227 \u03b8(x, x) iff B |= \u03b8(z(0), z(0)). The proof is completed as in that of Lemma 4.\nCase III. W.l.o.g. TA(0) \u2286 TA(1) but TA(0) 6= TA(1). Let \u03b81(x) be in TA(1) but not in TA(0). Let z(1) be the witness of \u2203x\u03b81(x) in B. z(1) is unique since B |=/ \u2200x\u03b81(x). Let z(0) be the other element of B. We claim z is an isomorphism from A to B. If not, then there exists a conjunction of atoms \u03b8(x, y) such that (we lose the w.l.o.g.) either A |= \u03b8(0, 1) but B |=/ \u03b8(z(0), z(1)), or B |= \u03b8(0, 1) but A |=/ \u03b8(z(0), z(1)). In fact, we can still deal with both cases at once, since A |= \u03b8(1, 1) iff A |= \u03b81(1) \u2227 \u03b8(1, 1) iff A |= \u2203x\u03b81(x) \u2227 \u03b8(x, x) etc. and B |= \u03b8(1, 1). The proof concludes as in Lemma 4.\nIn the extended logic {\u2203,\u2200,\u2227,=}-FO, it follows that every structure of size at most 2 satisfies the ideal of core. For {\u2203,\u2200,\u2227}-FO we can only say the following.\nProposition 3. Every Boolean structure B is either a Q-core, or its Q-core is the substructure induced by either of its elements. In particular, the Q-core of B is unique up to isomorphism and is an induced substructure of B.\nProof. If B generates the same QCSP as a one-element structure A with domain {0}, then it is clear that the pH-types TB(0), TB(1) and TA(0) coincide. This gives uniqueness and induced substructure in this case. Otherwise, the only possibility \u2013 to violate the statement \u2013 is for B to have as Q-core a non-induced substructure. But this is impossible by Theorem 4.\nLemma 4 does not extend to structures of size three. There exists H1 of size three such that every element of H1 has the same pH-type and yet H1 has no non-trivial automorphism (H1 := {0, 1, 2} and EH1 := {(0, 0), (1, 1), (2, 2), (1, 2)}). However, H1 is not a Q-core."}, {"heading": "5.2 Unary structures", "text": "Let \u03c3 be a fixed relational signature that consists of n unary relation symbols M1,M2, . . . ,Mn. A structure over such a signature is deemed unary.\nLet w be a string of length n over the alphabet {0, 1}. We write w(x) as an abbreviation for the quantifier-free formula \u2227 1\u2264i\u2264n,w[i]=1Mi(x). Each element a of a unary structure A corresponds to a word w, which is the largest word bitwise such that A |= w(x/a). Let w\u2200 be the bitwise \u2227 of the words associated to each element. The unary structure A satisfies the canonical universal sentence \u2200y w\u2200(y) (note that w\u2200 is also the largest word bitwise among such satisfied universal formulae).\nProposition 4. The Q-core of a unary structure A is the unique substructure of A defined as follows. The Q-core of A is the core A\u2032 of A if they share the same canonical universal sentence and the disjoint union of A\u2032 with a single element corresponding to w\u2200 where \u2200y w\u2200(y) is the canonical universal sentence of A.\nProof. A positive Horn sentence over a unary signature is logically equivalent to a conjunction of formulae that do not share any variables. Each conjunct is either a universal formulae of the form \u2200y w(y) or an existential formulae of the form \u2203xw(x).\nThe core A\u2032 is a substructure of the Q-core, so we need only enforce that the Q-core and A\u2032 satisfy the same canonical universal sentence. This is achieved with the optional addition of an element corresponding to w\u2200 where \u2200yw\u2200(y) is the canonical universal sentence of A."}, {"heading": "5.3 Structures with an isolated element", "text": "We say that a pH-sentence is a proper pH-sentence, if it has at least one universally quantified variable x1 that occurs in some atom in the quantifier-free part. Generally, we will say that a sentence is proper if any variable x1 occurs in some atom and we will be always working with such sentences unless otherwise stated (otherwise, we would simply discard x1 and consider the equivalent sentence with one less variable). We will say that a proper pH-sentence \u03c8 induced from a proper pH-sentence \u03d5 by the removal of some conjuncts is a proper subsentence of \u03c8.\nLet \u03c3 be a signature that consists of finitely many relation symbols Ri of respective arity ri. We will consider the set of minimal proper pH-sentences w.r.t. \u03c3, that is all formulae of the form \u2200x1\u2203x2 . . . \u2203xri Ri(x\u0304), where the tuple x\u0304 is a permutation of the variables x1, x2, . . . xri where x1 has been transposed with some other variable. There are r(\u03c3) = \u03a3Ri\u2208\u03c3ri such formulae.\nTheorem 5. Let A be a \u03c3-structure. The following are equivalent.\n1. A does not satisfy any proper pH-sentence.\n2. A does not satisfy any of the r(\u03c3) minimal proper pH-sentences w.r.t. \u03c3.\n3. Ar(\u03c3) contains an isolated element.\nProof. The first point implies trivially the second. We show the converse. Note that any proper pHsentence \u03d5 contains as a proper subinstance a sentence of the form Q1x1Q2x2 . . . \u2200xj . . . Qrxr R(x\u0304), where the Qi represent some arbitrary quantifiers. By assumption, the structure A models \u2203xj\u2200x1\u2200x2 . . . \u2200xr \u00acR(x\u0304). Thus, it follows thatAmodels the weaker sentence \u2200x1\u2200x2 . . . ,\u2203xj . . . \u2200xr \u00acR(x\u0304) (the same strategy for selecting a witness for xj will work) and the even weaker sentence where some universal quantifiers are turned to existential ones, namely those for which Qj is universal (the strategy for these new existential variable can be chosen arbitrarily). So, A does not model the negation of this last sentence which is Q1x1Q2x2 . . . \u2200xj . . . Qrxr R(x\u0304), which is a subinstance of \u03d5. By monotonicity, A does not model \u03d5 either.\nWe now prove that the second point implies the third. Let \u03d5i be the ith minimal proper pHsentence w.r.t. \u03c3. Let ai be a witness for the unique existential variable of \u00ac\u03d5i that A does not satisfy \u03d5i. It is a simple exercise to check that (a1, a2, . . . , ari) is an isolated element of Ar(\u03c3).\nConversely, if a\u0304 := (a1, a2, . . . , ari) is an isolated element of Ar(\u03c3) then a\u0304 is a witness that Ar(\u03c3) does not satisfy any minimal proper pH-sentence \u03d5i. Consequently, there exists some aji witnessing that A does not satisfy \u03d5i and we are done.\nExample 5. In the case of directed graphs, the minimal proper pH-sentences are \u2200x1\u2203x2E(x1, x2) and \u2200x1\u2203x2E(x2, x1). A directed graph which does not satisfy them will satisfy their negation \u2203x1\u2200x2\u00acE(x1, x2) and \u2203x1\u2200x2\u00acE(x2, x1). A witness for the existential x1 in the first sentence will be a source, and in the second sentence a sink, respectively\nSo a directed graph has a source and a sink if, and only if, it does not satisfy any proper pH-sentence, if and only if, its square has an isolated element.\nCorollary 2. The Q-core of a structure A that does not satisfy any proper pH-sentence is the unique substructure of A may be found as follows. The Q-core of A is the core A\u2032 of A, if A\u2032r(\u03c3) contains an isolated element, and the disjoint union of A\u2032 and an isolated element, otherwise.\nProof. By assumption A does not satisfy any proper pH-sentence. Consequently a minimal structure A\u2032 (both w.r.t. domain size and number of tuples) which satisfies the same pH-sentences as A will satisfy the same pp-sentences as A and none of the proper pH-sentences either. It follows that A\u2032 must contain the core of A (and can be no smaller). If this core satisfies no proper pHsentence then we are done and by the previous theorem Ar(\u03c3) has an isolated element. Otherwise, we must look for a structure that contains the core of A and does not satisfy any proper universal sentence. Adding tuples to A can clearly not force this property by monotonicity of QCSP. Thus, the minimal (and unique) such structure will be obtained by the addition of an isolated element. Note that in this second case we have also a substructure of A.\nRemark 1. It follows that checking whether a structure with an isolated element is a Q-core is of the same complexity as checking whether it is a core. Recall that the latter is known to be a co-NP-complete decision problem (the induced sub-structure that ought to be a core is given via an additional monadic predicate M), see [11]. We show that the former is also co-NP-complete (we also assume a monadic predicate as in this particular case the Q-core is an induced substructure), by showing inter-reducibility of both problem.\n(hardness) Let \u3008A,M\u3009 be the input to the core problem (we assume that it is not trivial and that M does not contain any isolated element). If Ar(\u03c3) has an isolated element (it can be done\nin polynomial time as r(\u03c3) does not depend on A)) then we reduce to \u3008A,M\u3009, and to \u3008A\u0303, M\u0303\u3009 otherwise, where A\u0303 consists of the disjoint union of A with an isolated element and M\u0303 is the union of M with this new element.\n(co-NP-complete algorithm) Let \u3008A\u0303, M\u0303\u3009 be the input to the Q-core problem such that A\u0303 has an isolated element. We check whether the alleged Q-core (the substructure of A\u0303 induced by M\u0303) elevated to the rth power has an isolated element. If it does not we answer no. If the alleged Q-core has more than one isolated element we answer also no. Otherwise, we remove at most one isolated element from M\u0303 to derive M \u2286 M\u0303 and reduce to the core question w.r.t. \u3008A\u0303,M\u3009."}, {"heading": "6 The usefulness of Q-cores", "text": "Graphs are relational structures with a single symmetric relation E. We term them partially reflexive (p.r.) to emphasise that any vertex may or may not have a self-loop. A p.r. tree may contain self-loops but no larger cycle Cn for n \u2265 3. A p.r. pseudotree contains at most one cycle Cn for n \u2265 3. A p.r. forest (resp., pseudoforest) is the disjoint union of p.r. trees (resp., p.r. pseudotrees).\nSince p.r. forests (resp., pseudoforests) are closed under substructures, we can be assured that a Q-core of a p.r. forest (resp., pseudoforest) is a p.r. forest (resp., pseudoforest). It is clear from inspection that the Q-core of p.r. forest (resp., pseudoforest, p.r. cycle) is unique up to isomorphism, but we do not prove this as it does not shed any light on the general situation. The doubting reader may substitute \u201ca/ all\u201d for \u201cthe\u201d in future references to Q-cores in this section.\nThe complexity classifications of [14] were largely derived using the properties of equivalence w.r.t. {\u2203,\u2200,\u2227}-FO. This will be the central justification for the following propositions.\nLet K\u2217i and Ki be the reflexive and irreflexive i-cliques, respectively. Let [n] := {1, . . . , n}. For i \u2208 [n] and \u03b1 \u2208 {0, 1}n, let \u03b1[i] be the ith entry of \u03b1. For \u03b1 \u2208 {0, 1}\u2217, let P\u03b1 be the path with domain [n] and edge set {(i, j) : |j \u2212 i| = 1} \u222a {(i, i) : \u03b1[i] = 1} For a tree T and vertex v \u2208 T , let \u03bbT (v) be the shortest distance in T from v to a looped vertex (if T is irreflexive, then \u03bbT (v) is always infinite). Let \u03bbT be the maximum of {\u03bbT (v) : v \u2208 T}. A tree is loop-connected if the self-loops induce a connected subtree. A tree T is quasi-loop-connected if either 1.) it is irreflexive, or 2.) there exists a connected reflexive subtree T0 (chosen to be maximal) such that there is a walk of length \u03bbT from every vertex of T to T0."}, {"heading": "6.1 Partially reflexive forests", "text": "It is not true that, if H is a p.r. forest, then either H admits a majority polymorphism, and QCSP(H) is in NL, or QCSP(H) is NP-hard. However, the notion of Q-core restores a clean delineation.\nProposition 5. Let H be a p.r. forest. Then either the Q-core of H admits a majority polymorphism, and QCSP(H) is in NL, or QCSP(H) is NP-hard.\nProof. We assume that graphs have at least one edge (otherwise the Q-core is K1). Irreflexive forests are a special case of bipartite graphs, which are all equivalent w.r.t. {\u2203,\u2200,\u2227}-FO, their Q-core being K2 when they have no isolated vertex (see example 3) and K2 +K1 otherwise.\nWe assume from now on that graphs have at least one edge and one self-loop. The one vertex case is K\u22171. We assume larger graphs from now on. If the graph contains an isolated element then its Q-core is K1 +K?1. Assume from now on that the graph does not have an isolated element.\nWe deal with the disconnected case first. If the graph is reflexive, then its Q-core is K?1 + K?1. Otherwise, the graph is properly partially reflexive in the sense that it embeds both K?1 and K1. If the graph has an irreflexive component then its Q-core is K2 +K?1. If the graph has no irreflexive component, then its Q-core is K?1 +P10\u03bb where \u03bb is the longest walk from any vertex to a self-loop. To see this last case gives an equivalent QCSP, we may consider power surjective homomorphisms, together with the fact that the Q-core must not satisfy \u2200x\u2203y1, . . . , y\u03bb\u22121 E(x, y1)\u2227E(y1, y2)\u2227 . . .\u2227 E(y\u03bb\u22122, y\u03bb\u22121).\nWe now follow the classification of [14]. If a p.r. forest contains more than one p.r. tree, then the Q-core is among those formed from the disjoint union of exactly two (including the possibility of duplication) of K1, K\u22171, P10\u03bb , K2. Each of these singularly admits a majority polymorphism, therefore so does any of their disjoint unions.\nWe now move on to the connected case, i.e. it remains to consider p.r. trees T . If T is irreflexive, then its Q-core is K2 or K1, which admit majority polymorphisms. If T is loop-connected, then it admits a majority polymorphism [14]. If T is quasi-loop-connected, then it is QCSP-equivalent to one of its subtrees that is loop-connected [14] which will be its Q-core. In all other cases QCSP(T ) is NP-hard, and T does not admit majority [14]."}, {"heading": "6.2 Irreflexive Pseudoforests", "text": "A pseudotree is a graph that involves at most one cycle. A pseudoforest is the disjoint union of a collection of pseudotrees.\nProposition 6. Let H be an irreflexive pseudoforest. Then either the Q-core of H admits a majority polymorphism, and QCSP(H) is in NL, or QCSP(H) is NP-hard.\nProof. We follow the classification of [15]. If H is bipartite, then its Q-core is either K2, K1, K2 +K1 (see [6]) and this admits a majority polymorphism. Otherwise its Q-core contains an odd cycle, which does not admit a majority polymorphism, and QCSP(H) is NP-hard."}, {"heading": "7 Computing a Q-core", "text": "We may use Theorem 2 to provides a first algorithm (Algorithm 1). This does not appear very promising if we wish to use Q-cores as a preprocessing step. We will propose and illustrate a general and less naive method to compute Q-cores by computing U -X-core and cores first.\nAnother nice feature of cores and U -X-cores which implies their uniqueness is the following: any substructure C of A that agrees with it on {\u2203,\u2227}-FO (respectively on {\u2203,\u2200,\u2227,\u2228}-FO) will contain the core (respectively the U -X-core). Consequently, the core and the U -X-core may be computed in a greedy fashion. Assuming that the Q-core would not satisfy this nice property, why should this concern the Q-core? Well, we know that any Q-core will lie somewhere between the U -X-core and the core that are induced substructures: this is a direct consequence of the inclusion of the corresponding fragments of first-order logic and their uniqueness. Moreover, according to our current knowledge, checking for equivalence appears, at least on paper, much easier for {\u2203,\u2200,\u2227,\u2228}-FO than {\u2203,\u2200,\u2227}-FO: compare the number of functions from A to the power set of B (2|B| |A| = 2|B|\u00d7|A|) with the number of functions from Ar to B (|B||A|r) where r could be as large as |A||B| and can certainly be greater than r \u2248 |A| (see Proposition 1). So it make sense to bound the naive search for Q-cores.\nAlgorithm 1: A naive approach to compute the Q-cores.\ninput : A structure A output : The list L of Q-cores of A initialisation: set L := {A} forall the substructure B of A do\nif there exists a surjective homomorphism from A|A||B| to B then if there exists a surjective homomorphism from B|B||A| to A then\nRemove any structure containing B in L; Add B to L;\nend\nend\nend output : List of Q-cores L\nFurthermore, we know that the U -X-core can be identified by specific surjective hypermorphisms that act as the identity on X and contain the identity on U [13] which makes the search for the U -X-core somewhat easier than its definition suggest (see Algorithm 2).\nObserve also that X must contain the core C of the U -X-core B, which is also the core of the original structure A (this is because h induces a so-called retraction of A to the substructure A|X induced by X). Thus we may compute the core greedily from X. Next, we do a little bit better than using our naive algorithm, by interleaving steps where we find a substructure that is {\u2203,\u2200,\u2227}-FO-equivalent, with steps where we compute its U -X-core (one can find a sequence of distinct substructures B, D and B\u2032 such that B is a U -X-core, which is {\u2203,\u2200,\u2227}-FO-equivalent to D, whose U -X-core B\u2032 is strictly smaller than B, see Example 6). Algorithm 3 describes this proposed method informally when we want to compute one Q-core (of course, we would have no guarantee that we get the smallest Q-core, unless the Q-core can be also greedily computed, which holds for all cases we have studied so far).\nIn Algorithm 3, we have purposely not detailed line ??. We could use the characterisation of {\u2203,\u2200,\u2227}-FO-containment via surjective homomorphism from a power of Theorem 3 as in Algorithm 1. Alternatively, we can use a refined form of (iii) in this Theorem and use the canonical sentences in \u03a02-form \u03c8B,m1 and \u03c8D,m2 , with m1 := min(|D|, |U |) and m2 := |U | (see Definition 5). The test would consists in checking that B satisfies \u03c8D,m2 (where we may relativise to universal variables to U and existential variables to X) and D satisfies \u03c8B,m1 . This is correct because we know that we may relativise every universal variable to U within B. Thus, it suffices to consider \u03a02-sentences with at most |U | universal variables. Example 6. We describe a run of Algorithm 3 on input A := A4. During the initialisation, we compute its U -X-core B := A3 and discover that U = {2, 3} and X = {1, 2}. We compute C := A1, the core of the substructure induced by X.\nNote that B = A3 is isomorphic to P110. Next the algorithm guesses a substructure D of B that contains C: e.g. it drops the self-loop around vertex 3 to obtain a structure isomorphic to P010 and checks successfully equivalence w.r.t. {\u2203,\u2200,\u2227}-FO (there is a surjective homomorphism from P010 to P110; and, conversely we can use the surjective homomorphism from P110 \u00d7 P110 to P10 \u00d7 P11 composed with that from the former to P010).\nNext the algorithm computes the U \u2032-X \u2032-core B\u2032 of D which is A2 (witnessed by h\u2032(1) = 1, h\u2032(2) = h\u2032(3) = {1, 2, 3}, U \u2032 := {2}, X \u2032 := {1}) and sets B := B\u2032 = A2.\nAlgorithm 2: A greedy approach to compute the U -X-core.\ninput : a structure A. output : the U -X-core of A. variables : U and X two subsets of A. variable : h a surj. hypermorphism from A to A s.t. h(U) = A and h\u22121(X) = A. variable : B an induced substructure of A such that B = U \u222aX. initialisation: set U := A, X := A, B := A, h the identity repeat\nguess a subset U \u2032 of U and a subset X \u2032 of X; let h\u2032 be a map from B to B; forall the x\u2032 in X \u2032 do set h\u2032(x\u2032) := {x\u2032}; forall the u\u2032 in U \u2032 \\X \u2032 do guess x\u2032 in X \u2032 set h\u2032(u\u2032) := {u\u2032, x\u2032} ; forall the z\u2032 in B \\ (U \u2032 \u222aX \u2032) do\nguess x\u2032 in X \u2032 set h(z\u2032) := {x\u2032}; guess u\u2032 in U \u2032 set h(u\u2032) := h(u\u2032) \u222a {z\u2032};\nend if h\u2032 is a surj. hypermorphism from B to B then\nset B to be the substructure of B induced by U \u2032 \u222aX \u2032; set U := U \u2032, X := X \u2032 and h := h\u2032 \u25e6 h;\nend\nuntil U and X are minimal ; output : B.\nAlgorithm 3: Bounded Search for a Q-core.\ninput : a structure A output : a Q-core B of A initialisation: compute the U -X-core of A as in Algorithm 2; set B to be the U -X-core; set C to be the core C of the substructure of B induced by X; repeat\nguess D a substructure of B that contains C; check that B and C are equivalent w.r.t. {\u2203,\u2200,\u2227}-FO; set B to be the U -X-core of D;\nuntil B is minimal ; output : B.\nThe algorithm stops eventually and outputs A2 as it is minimal."}, {"heading": "8 Conclusion", "text": "We have introduced a notion of Q-core and demonstrated that it does not enjoy all of the properties of cores and U -X-core. In particular, there need not be a unique minimal element w.r.t. size in the equivalence class of structures agreeing on pH-sentences. However, we suspect that the notion of Q-core we give is robust, in that the Q-core of any structure B is unique up to isomorphism; and, that it sits inside any substructure of B that satisfies the same sentence of {\u2203,\u2200,\u2227}-FO, making it computable in a greedy fashion. Thus, the nice behaviour of Q-cores is almost restored, but \u201cinduced substructure\u201d in the properties of core or U -X-core must be replaced by the weaker \u201csubstructure\u201d.\nGeneralising the results about Q-cores of structures with an isolated element to disconnected structures is already difficult. Just as the pH-theory of structures with an isolated element is essentially determined by their pp-theory, so the pH-theory of disconnected structures is essentially determined by its \u2200\u2203\u2217 fragment (see [15])."}], "references": [{"title": "The CSP dichotomy holds for digraphs with no sources and no sinks (a positive answer to a conjecture of Bang-Jensen and Hell)", "author": ["L. Barto", "M. Kozik", "T. Niven"], "venue": "SIAM Journal on Computing 38,", "citeRegEx": "1", "shortCiteRegEx": "1", "year": 2009}, {"title": "The complexity of constraint satisfaction games and QCSP", "author": ["F. B\u00f6rner", "A.A. Bulatov", "H. Chen", "P. Jeavons", "A.A. Krokhin"], "venue": "Inf. Comput. 207,", "citeRegEx": "2", "shortCiteRegEx": "2", "year": 2009}, {"title": "A dichotomy theorem for constraint satisfaction problems on a 3-element set", "author": ["A. Bulatov"], "venue": "J. ACM 53,", "citeRegEx": "3", "shortCiteRegEx": "3", "year": 2006}, {"title": "Classifying the complexity of constraints using finite algebras", "author": ["A. Bulatov", "A. Krokhin", "P.G. Jeavons"], "venue": "SIAM Journal on Computing", "citeRegEx": "4", "shortCiteRegEx": "4", "year": 2005}, {"title": "Optimal implementation of conjunctive queries in relational data bases", "author": ["A.K. Chandra", "P.M. Merlin"], "venue": "In Proceddings of STOC\u201977", "citeRegEx": "5", "shortCiteRegEx": "5", "year": 1977}, {"title": "Quantified constraints and containment problems", "author": ["H. Chen", "F. Madelaine", "B. Martin"], "venue": "In 23rd Annual IEEE Symposium on Logic in Computer Science", "citeRegEx": "6", "shortCiteRegEx": "6", "year": 2008}, {"title": "The complexity of constraint languages", "author": ["D. Cohen", "P. Jeavons"], "venue": "Appears in: Handbook of Constraint Programming", "citeRegEx": "7", "shortCiteRegEx": "7", "year": 2006}, {"title": "Data exchange: getting to the core", "author": ["R. Fagin", "P.G. Kolaitis", "L. Popa"], "venue": "ACM Trans. Database Syst. 30,", "citeRegEx": "8", "shortCiteRegEx": "8", "year": 2005}, {"title": "The computational structure of monotone monadic SNP and constraint satisfaction: A study through Datalog and group theory", "author": ["T. Feder", "M. Vardi"], "venue": "SIAM Journal on Computing", "citeRegEx": "9", "shortCiteRegEx": "9", "year": 1999}, {"title": "The core of a graph", "author": ["P. Hell", "J. Nesetril"], "venue": "Discrete Math", "citeRegEx": "10", "shortCiteRegEx": "10", "year": 1992}, {"title": "On the complexity of H-coloring", "author": ["P. Hell", "J. Ne\u0161et\u0159il"], "venue": "Journal of Combinatorial Theory, Series B", "citeRegEx": "11", "shortCiteRegEx": "11", "year": 1990}, {"title": "Graphs and Homomorphisms", "author": ["P. Hell", "J. Ne\u0161et\u0159il"], "venue": null, "citeRegEx": "12", "shortCiteRegEx": "12", "year": 2004}, {"title": "A tetrachotomy for positive first-order logic without equality", "author": ["F.R. Madelaine", "B. Martin"], "venue": "LICS", "citeRegEx": "13", "shortCiteRegEx": "13", "year": 2011}, {"title": "QCSP on partially reflexive forests", "author": ["B. Martin"], "venue": "In Principles and Practice of Constraint Programming - 17th International Conference,", "citeRegEx": "14", "shortCiteRegEx": "14", "year": 2011}, {"title": "Towards a trichotomy for quantified H-coloring", "author": ["B. Martin", "F. Madelaine"], "venue": "In 2nd Conf. on Computatibility in Europe,", "citeRegEx": "15", "shortCiteRegEx": "15", "year": 2006}, {"title": "The complexity of satisfiability problems", "author": ["T.J. Schaefer"], "venue": "In Proceedings of STOC\u201978", "citeRegEx": "16", "shortCiteRegEx": "16", "year": 1978}], "referenceMentions": [{"referenceID": 8, "context": "Much of the theoretical research into CSPs is in respect of a large complexity classification project \u2013 it is conjectured that CSP(B) is always either in P or NP-complete [9].", "startOffset": 171, "endOffset": 174}, {"referenceID": 15, "context": "structures of size \u2264 3 [16, 3] and smooth digraphs [11, 1]).", "startOffset": 23, "endOffset": 30}, {"referenceID": 2, "context": "structures of size \u2264 3 [16, 3] and smooth digraphs [11, 1]).", "startOffset": 23, "endOffset": 30}, {"referenceID": 10, "context": "structures of size \u2264 3 [16, 3] and smooth digraphs [11, 1]).", "startOffset": 51, "endOffset": 58}, {"referenceID": 0, "context": "structures of size \u2264 3 [16, 3] and smooth digraphs [11, 1]).", "startOffset": 51, "endOffset": 58}, {"referenceID": 3, "context": "A conjectured delineation for the dichotomy was given in the algebraic language in [4].", "startOffset": 83, "endOffset": 86}, {"referenceID": 1, "context": "No overarching polychotomy has been conjectured for the complexities of QCSP(B), as B ranges over finite structures, but the only known complexities are P, NP-complete and Pspace-complete (see [2, 15] for some trichotomies).", "startOffset": 193, "endOffset": 200}, {"referenceID": 14, "context": "No overarching polychotomy has been conjectured for the complexities of QCSP(B), as B ranges over finite structures, but the only known complexities are P, NP-complete and Pspace-complete (see [2, 15] for some trichotomies).", "startOffset": 193, "endOffset": 200}, {"referenceID": 5, "context": "It is known that non-trivial A and B are equivalent iff there exist integers r and r\u2032 and surjective homomorphisms from A to B and from Br to A (and one may give a bound on these exponents) [6].", "startOffset": 190, "endOffset": 193}, {"referenceID": 12, "context": "The erratic behaviour of Q-cores sits in contrast not just to that of cores, but also that of the UX-cores of [13], which are the canonical representatives of the equivalence classes associated with {\u2203,\u2200,\u2227,\u2228}-FO, and were instrumental in deriving a full complexity classification \u2013 a tetrachotomy \u2013 for QCSP\u2228 in [13].", "startOffset": 110, "endOffset": 114}, {"referenceID": 12, "context": "The erratic behaviour of Q-cores sits in contrast not just to that of cores, but also that of the UX-cores of [13], which are the canonical representatives of the equivalence classes associated with {\u2203,\u2200,\u2227,\u2228}-FO, and were instrumental in deriving a full complexity classification \u2013 a tetrachotomy \u2013 for QCSP\u2228 in [13].", "startOffset": 312, "endOffset": 316}, {"referenceID": 12, "context": "In Section 3, we recall results on coreness and spell out containment for {\u2203,\u2200,\u2227,\u2228}-FO that were only implicit in [13].", "startOffset": 114, "endOffset": 118}, {"referenceID": 5, "context": "In Section 4, we move on to QCSP and recall results on the decidability of containment from [6] together with new lower bounds before initiating a study of the notion of core for QCSP.", "startOffset": 92, "endOffset": 95}, {"referenceID": 4, "context": "Containment for {\u2203,\u2227}-FO is a special case of conjunctive query containment from databases [5].", "startOffset": 91, "endOffset": 94}, {"referenceID": 11, "context": "It is well known that the core is unique up to isomorphism and that it is an induced substructure [12].", "startOffset": 98, "endOffset": 102}, {"referenceID": 6, "context": "1 in [7]).", "startOffset": 5, "endOffset": 8}, {"referenceID": 7, "context": "The notion of a core can be extended and adapted suitably to solve important questions related to data exchange and query rewriting in databases [8].", "startOffset": 145, "endOffset": 148}, {"referenceID": 3, "context": "It is also very useful as a simplifying assumption when classifying the complexity: with the algebraic approach, it allows to study only idempotent algebras [4].", "startOffset": 157, "endOffset": 160}, {"referenceID": 9, "context": "Checking that a graph is a core is coNP-complete [10].", "startOffset": 49, "endOffset": 53}, {"referenceID": 7, "context": "Checking that a graph is the core of another given graph is DP-complete [8].", "startOffset": 72, "endOffset": 75}, {"referenceID": 12, "context": "Consequently, B is called the U -X-core of A (for further details see [13]) and may be defined as follows.", "startOffset": 70, "endOffset": 74}, {"referenceID": 0, "context": "t\u2208Am w1 = vt,t[1] .", "startOffset": 14, "endOffset": 17}, {"referenceID": 0, "context": "we remove w1 = vt,t[1] and replace every occurrence of vt,t[1] by w1.", "startOffset": 19, "endOffset": 22}, {"referenceID": 0, "context": "we remove w1 = vt,t[1] and replace every occurrence of vt,t[1] by w1.", "startOffset": 59, "endOffset": 62}, {"referenceID": 10, "context": "Recall that the latter is known to be a co-NP-complete decision problem (the induced sub-structure that ought to be a core is given via an additional monadic predicate M), see [11].", "startOffset": 176, "endOffset": 180}, {"referenceID": 13, "context": "The complexity classifications of [14] were largely derived using the properties of equivalence w.", "startOffset": 34, "endOffset": 38}, {"referenceID": 13, "context": "We now follow the classification of [14].", "startOffset": 36, "endOffset": 40}, {"referenceID": 13, "context": "If T is loop-connected, then it admits a majority polymorphism [14].", "startOffset": 63, "endOffset": 67}, {"referenceID": 13, "context": "If T is quasi-loop-connected, then it is QCSP-equivalent to one of its subtrees that is loop-connected [14] which will be its Q-core.", "startOffset": 103, "endOffset": 107}, {"referenceID": 13, "context": "In all other cases QCSP(T ) is NP-hard, and T does not admit majority [14].", "startOffset": 70, "endOffset": 74}, {"referenceID": 14, "context": "We follow the classification of [15].", "startOffset": 32, "endOffset": 36}, {"referenceID": 5, "context": "If H is bipartite, then its Q-core is either K2, K1, K2 +K1 (see [6]) and this admits a majority polymorphism.", "startOffset": 65, "endOffset": 68}, {"referenceID": 12, "context": "Furthermore, we know that the U -X-core can be identified by specific surjective hypermorphisms that act as the identity on X and contain the identity on U [13] which makes the search for the U -X-core somewhat easier than its definition suggest (see Algorithm 2).", "startOffset": 156, "endOffset": 160}, {"referenceID": 14, "context": "Just as the pH-theory of structures with an isolated element is essentially determined by their pp-theory, so the pH-theory of disconnected structures is essentially determined by its \u2200\u2203\u2217 fragment (see [15]).", "startOffset": 202, "endOffset": 206}], "year": 2012, "abstractText": "The constraint satisfaction problem (CSP) and its quantified extensions, whether without (QCSP) or with disjunction (QCSP\u2228), correspond naturally to the model checking problem for three increasingly stronger fragments of positive first-order logic. Their complexity is often studied when parameterised by a fixed model, the so-called template. It is a natural question to ask when two templates are equivalent, or more generally when one \u201ccontain\u201d another, in the sense that a satisfied instance of the first will be necessarily satisfied in the second. One can also ask for a smallest possible equivalent template: this is known as the core for CSP. We recall and extend previous results on containment, equivalence and \u201ccoreness\u201d for QCSP\u2228 before initiating a preliminary study of cores for QCSP which we characterise for certain structures and which turns out to be more elusive.", "creator": "LaTeX with hyperref package"}}}