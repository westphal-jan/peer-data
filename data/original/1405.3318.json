{"id": "1405.3318", "review": {"conference": "ICML", "VERSION": "v1", "DATE_OF_SUBMISSION": "13-May-2014", "title": "Adaptive Monte Carlo via Bandit Allocation", "abstract": "We consider the problem of sequentially choosing between a set of unbiased Monte Carlo estimators to minimize the mean-squared-error (MSE) of a final combined estimate. By reducing this task to a stochastic multi-armed bandit problem, we show that well developed allocation strategies can be used to achieve an MSE that approaches that of the best estimator chosen in retrospect. We then extend these developments to a scenario where alternative estimators have different, possibly stochastic costs. The outcome is a new set of adaptive Monte Carlo strategies that provide stronger guarantees than previous approaches while offering practical advantages.", "histories": [["v1", "Tue, 13 May 2014 22:29:14 GMT  (1197kb,D)", "http://arxiv.org/abs/1405.3318v1", "The 31st International Conference on Machine Learning (ICML 2014)"]], "COMMENTS": "The 31st International Conference on Machine Learning (ICML 2014)", "reviews": [], "SUBJECTS": "cs.AI cs.LG", "authors": ["james neufeld", "andr\u00e1s gy\u00f6rgy", "csaba szepesv\u00e1ri", "dale schuurmans"], "accepted": true, "id": "1405.3318"}, "pdf": {"name": "1405.3318.pdf", "metadata": {"source": "META", "title": "Adaptive Monte Carlo via Bandit Allocation", "authors": ["James Neufeld", "Andr\u00e1s Gy\u00f6rgy", "Dale Schuurmans", "Csaba Szepesv\u00e1ri"], "emails": ["JNEUFELD@UALBERTA.CA", "GYORGY@UALBERTA.CA", "DAES@UALBERTA.CA", "CSABA.SZEPESVARI@UALBERTA.CA"], "sections": [{"heading": "1. Introduction", "text": "Monte Carlo methods are a pervasive approach to approximating complex integrals, which are widely deployed in all areas of science. Their widespread adoption has led to the development dozens of specialized Monte Carlo methods for any given task, each having their own tunable parameters. Consequently, it is usually difficult for a practitioner to know which approach and corresponding parameter setting might be most effective for a given problem.\nIn this paper we develop algorithms for sequentially allocating calls between a set of unbiased estimators to minimize the expected squared error (MSE) of a combined estimate. In particular, we formalize a new class of adaptive estimation problem: learning to combine Monte Carlo estimators. In this scenario, one is given a set of Monte Carlo estimators that can each approximate the expectation of some function of interest. We assume initially that each estimator is unbiased but has unknown variance. In practice, such estimators could include any unbiased method and/or variance reduction technique, such as unique instantiations of importance, stratified, or rejection sampling; antithetic Proceedings of the 31 st International Conference on Machine Learning, Beijing, China, 2014. JMLR: W&CP volume 32. Copyright 2014 by the author(s).\nvariates; or control variates (Robert & Casella, 2005). The problem is to design a sequential allocation procedure that can interleave calls to the estimators and combine their outputs to produce a combined estimate whose MSE decreases as quickly as possible. To analyze the performance of such a meta-strategy we formalize the notion of MSEregret: the time-normalized excess MSE of the combined estimate compared to the best estimator selected in hindsight, i.e., with knowledge of the distribution of estimates produced by each base estimator.\nOur first main contribution is to show that this meta-task can be reduced to a stochastic multi-armed bandit problem, where bandit arms are identified with base estimators and the payoff of an arm is given by the negative square of its sampled estimate. In particular, we show that the MSEregret of any meta-strategy is equal to its bandit-regret when the procedure is used to play in the corresponding bandit problem. As a consequence, we conclude that existing bandit algorithms, as well as their bounds on banditregret, can be immediately applied to achieve new results for adaptive Monte Carlo estimation. Although the underlying reduction is quite simple, the resulting adaptive allocation strategies provide novel alternatives to traditional adaptive Monte Carlo strategies, while providing strong finite-sample performance guarantees.\nSecond, we consider a more general case where the alternative estimators require different (possibly random) costs to produce their sampled estimates. Here we develop a suitably designed bandit formulation that yields bounds on the MSE-regret for cost-aware estimation. We develop new algorithms for this generalized form of adaptive Monte Carlo, provide explicit bounds on their MSE-regret, and compare their performance to a state-of-the-art adaptive Monte Carlo method. By instantiating a set of viable base estimators and selecting from them algorithmically, rather than tuning parameters manually, we discover that both computation and experimentation time can be reduced.\nThis work is closely related, and complementary to work on adaptive stratified sampling (Carpentier & Munos, 2011), where a strategy is designed to allocate samples between fixed strata to achieve MSE-regret bounds relative\nar X\niv :1\n40 5.\n33 18\nv1 [\ncs .A\nI] 1\n3 M\nay 2\n01 4\nto the best allocation proportion chosen in hindsight. Such work has since been extended to optimizing the number (Carpentier & Munos, 2012a) and structure (Carpentier & Munos, 2012b) of strata for differentiable functions. The method proposed in this paper, however, can be applied more broadly to any set of base estimation strategies and potentially even in combination with these approaches."}, {"heading": "2. Background on Bandit Problems", "text": "The multi-armed bandit (MAB) problem is a sequential allocation task where an agent must choose an action at each step to maximize its long term payoff, when only the payoff of the selected action can be observed (Cesa-Bianchi & Lugosi, 2006; Bubeck & Cesa-Bianchi, 2012b). In the stochastic MAB problem (Robbins, 1952) the payoff for each action k \u2208 {1, 2, . . . ,K} is assumed to be generated independently and identically (i.i.d.) from a fixed but unknown distribution \u03bdk. The performance of an allocation policy can then by analyzed by defining the cumulative regret for any sequence of n actions, given by\nRn . = max 1\u2264k\u2264K E [ n\u2211 t=1 Xk,t \u2212 n\u2211 t=1 XIt,TIt (t) ] , (1)\nwhere Xk,t \u2208 R is the random variable giving the tth payoff of action k, It \u2208 {1, . . . ,K} denotes the action taken by the policy at time-step t, and Tk(t) . = \u2211t s=1 I{Is = k} denotes the number of times action k is chosen by the policy up to time t. Here, I{p} is the indicator function, set to 1 if the predicate p is true, 0 otherwise. The objective of the agent is to maximize the total payoff, or equivalently to minimize the cumulative regret. By rearranging (1) and conditioning, the regret can be rewritten\nRn = K\u2211 k=1 E[Tk(n)](\u00b5\u2217 \u2212 \u00b5k), (2)\nwhere \u00b5k . = E[Xk,t] and \u00b5\u2217 . = maxj=1,...,K \u00b5j .\nThe analysis of the stochastic MAB problem was pioneered by Lai & Robbins (1985) who showed that, when the payoff distributions are defined by a single parameter, the asymptotic regret of any sub-polynomially consistent policy (i.e., a policy that selects non-optimal actions only sub-polynomially many times in the time horizon) is lower bounded by \u2126(log n). In particular, for Bernoulli payoffs\nlim inf n\u2192\u221e Rn log n\n\u2265 \u2211\nk:\u2206k>0\n\u2206k KL(\u00b5k, \u00b5\u2217) , (3)\nwhere \u2206k . = \u00b5\u2217 \u2212 \u00b5k and KL (p, q) . = p log(p/q) + (1 \u2212 p) log(1\u2212p1\u2212q ) for p, q \u2208 [0, 1]. Lai & Robbins (1985) also presented an algorithm based on upper confidence bounds (UCB), which achieves a regret asymptotically matching the lower bound (for certain parametric distributions).\nLater, Auer et al. (2002a) proposed UCB1 (Algorithm 1), which broadens the practical use of UCB by dropping the\nAlgorithm 1 UCB1 (Auer et al., 2002a) 1: for k \u2208 {1, . . . ,K} 2: Play k, observe Xk,1, set \u00b5\u0304k,1 := Xk,1; Tk(1) := 1. 3: end for 4: for t \u2208 {K + 1,K + 2, . . .} 5: Play action k that maximizes \u00b5\u0304j,t\u22121 + \u221a 2 log t Tj(t\u22121) ;\nset Tk(t) = Tk(t \u2212 1) + 1 and Tj(t) = Tj(t \u2212 1) for j 6= k, observe payoff Xk,Tk(t), and compute \u00b5\u0304k,t = (1\u2212 1/Tk(t))\u00b5\u0304k,t\u22121 +Xk,Tk(t)/Tk(t).\n6: end for\nrequirement that payoff distributions fit a particular parametric form. Instead, one need only make the much weaker assumption that the rewards are bounded; in particular, we let Xk,t \u2208 [0, 1]. Auer et al. (2002a) proved that, for any finite number of actions n, UCB1\u2019s regret is bounded by\nRn \u2264 \u2211\nk:\u2206k>0\n8 log n \u2206k + ( 1 + \u03c02 3 ) \u2206k. (4)\nVarious improvements of the UCB1 algorithm have since been proposed. One approach of particular interest is the UCB-V algorithm (Audibert et al., 2009), which takes the empirical variances into account when constructing confidence bounds. Specifically, UCB-V uses the bound\n\u00b5\u0304k,t +\n\u221a 2Vk,Tk(t\u22121)ETk(t\u22121),t\nTk(t\u2212 1) + c 3ETk(t\u22121),t Tk(t\u2212 1) ,\nwhere Vk,s denotes the empirical variance of arm k\u2019s payoffs after s pulls, c > 0, and Es,t is an exploration function required to be a non-decreasing function of s or t (typically Es,t = \u03b6 log(t) for a fixed constant \u03b6 > 0). The UCB-V procedure can then be constructed by substituting the above confidence bound into Algorithm 1, which yields a regret bound that scales with the true variance of each arm\nRn \u2264 c\u03b6 \u2211\nk:\u2206k>0\n(V(Xk,1) \u2206k + 2 ) log n. (5)\nHere c\u03b6 is a constant relating to \u03b6 and c. In the worst case, when V(Xk,1) = 1/4 and \u2206k = 1/2, this bound is slightly worse than UCB1\u2019s bound; however, it is usually better in practice, particularly if some k has small \u2206k and V(Xk,1).\nA more recent algorithm is KL-UCB (Cappe\u0301 et al., 2013), where the confidence bound for arm k is based on solving\nsup { \u00b5 : KL (\u00b5\u0304k,t, \u00b5) \u2264 f(t)\nTk(t)\n} ,\nfor a chosen increasing function f(\u00b7), which can be solved efficiently since KL (p, \u00b7) is smooth and increasing on [p, 1]. By choosing f(t) = log(t) + 3 log log(t) for t \u2265 3 (and f(1)=f(2)=f(3)), KL-UCB achieves a regret bound\nRn \u2264 \u2211\nk:\u2206k>0\n( \u2206k KL (\u00b5k, \u00b5\u2217) ) log n+O( \u221a log(n)) (6)\nAlgorithm 2 Thompson Sampling (Agrawal & Goyal, 2012) Require: Prior parameters \u03b1 and \u03b2 Initialize: S1:K(0) := 0, F1:K(0) := 0 for t \u2208 {1, 2, . . .}\nSample \u03b8t,k\u223cB(Sk(t\u22121)+\u03b1, Fk(t\u22121)+\u03b2), k = 1...K Play k = arg maxj=1,...,K \u03b8t,j ; observe Xt \u2208 [0, 1] Sample X\u0302t \u223c Bernoulli(Xt) if X\u0302t = 1 then set Sk(t) = Sk(t \u2212 1) + 1 else set Fk(t) = Fk(t) + 1\nend for\nfor n \u2265 3, with explicit constants for the \u201chigher order\u201d terms (Cappe\u0301 et al., 2013, Corollary 1). Apart from the higher order terms, this bound matches the lower bound (3). In general, KL-UCB is expected to be better than UCB-V except for large sample sizes and small variances. Note that, given any set of UCB algorithms, one can apply the tightest upper confidence from the set, via the union bound, at the price of a small additional constant in the regret.\nAnother approach that has received significant recent interest is Thompson sampling (TS) (Thompson, 1933): a Bayesian method where actions are chosen randomly in proportion to the posterior probability that their mean payoff is optimal. TS is known to outperform UCB-variants when payoffs are Bernoulli distributed (Chapelle & Li, 2011; May & Leslie, 2011). Indeed, the finite time regret of TS under Bernoulli payoff distributions closely matches the lower bound (3) (Kaufmann et al., 2012):\nRn \u2264 (1+\u03b5) \u2211\nk:\u2206k>0\n\u2206k(log(n) + log log(n))\nKL(\u00b5k, \u00b5\u2217) +C(\u03b5, \u00b51:K),\nfor every \u03b5 > 0, where C is a problem-dependant constant. However, since it is not possible to have Bernoulli distributed payoffs with the same mean and different variances, this analysis is not directly applicable to our setting. Instead, we consider a more general version of Thompson sampling (Agrawal & Goyal, 2012) that converts realvalued to Bernoulli-distributed payoffs through a resampling step (Algorithm 2), which has been shown to obtain\nRn \u2264 ( \u2211 k:\u2206k>0 1 \u22062k )2 log(n). (7)"}, {"heading": "3. Combining Monte Carlo Estimators", "text": "We now formalize the main problem we consider in this paper. Assume we are given a finite number of Monte Carlo estimators, k = 1, . . . ,K, where base estimator k produces a sequence of real-valued random variables (Xk,t)(t=1,2,...) whose mean converges to the unknown target quantity, \u00b5 \u2208 R. Observations from the different estimators are assumed to be independent from each other. We assume, initially, that drawing a sample from each estimator takes constant time, hence the estimators differ only in terms of how\nfast their respective sample means Xk,n = 1n \u2211n t=1Xk,t converge to \u00b5. The goal is to design a sequential estimation procedure that works in discrete time steps: For each round t = 1, 2, . . ., based on the previous observations, the procedure selects one estimator It \u2208 {1, . . . ,K}, whose observation is used by an outer procedure to update the estimate \u00b5\u0302t \u2208 R based on the values observed so far.\nAs is common in the Monte Carlo literature, we evaluate accuracy by the mean-squared error (MSE). That is, we define the loss of the sequential methodA at the end of round n by Ln(A) = E [ (\u00b5\u0302n \u2212 \u00b5)2 ] . A reasonable goal is to\nthen compare the loss, Lk,n = E [ (Xk,n \u2212 \u00b5)2 ] , of each base estimator to the loss ofA. In particular, we propose to evaluate the performance of A by the (normalized) regret\nRn(A) = n2 ( Ln(A)\u2212 min\n1\u2264k\u2264K Lk,n\n) ,\nwhich measures the excess loss of A due to its initial ignorance of estimator quality. Implicit in this definition is the assumption thatA\u2019s time to select the next estimator is negligible compared to the time to draw an observation. Note also that the excess loss is multiplied by n2, which ensures that, in standard settings, when Lk,n \u221d 1/n, a sublinear regret (i.e., |Rn(A|)/n \u2192 0 as n \u2192 \u221e) implies that the loss ofA asymptotically matches that of the best estimator.\nIn the next two sections we will adopt a simple strategy for combining the values returned from the base estimators: A simply returns their (unweighted) average as the estimate \u00b5\u0302n of \u00b5. A more sophisticated approach may be to weight each of these samples inversely proportional to their respective (sample) variances. However, if the adaptive procedure can quickly identify and ignore highly suboptimal arms the savings from the weighted estimator will diminish rapidly. Interestingly, this argument does not immediately translate to the nonuniform cost case considered in Section 5 as will be shown empirically in Section 6."}, {"heading": "4. Combining Unbiased I.I.D. Estimators", "text": "Our main assumption in this section will be the following: Assumption 4.1. Each estimator produces a sequence of i.i.d. random observations with common mean \u00b5 and finite variance; values from different estimators are independent.\nLet \u03c8k denote the distribution of samples from estimator k. Note that \u03a8 = (\u03c8k)1\u2264k\u2264K completely determines the sequential estimation problem. Since the samples coming from estimator k are i.i.d., we have V (Xk,1) = V (Xk,t). Let Vk = V (Xk,1) and V \u2217 = min1\u2264k\u2264K Vk. Furthermore, let Lk,t = V (Xk,1) /t, hence min1\u2264k\u2264K Lk,t = V \u2217/t. We then have the first main result of this section. Theorem 1 (Regret Identity). Consider K estimators for which Assumption 4.1 holds, and let A be an arbitrary allocation procedure. Then, for any n \u2265 1, the MSE-regret\nof the estimation procedure Aavg, estimating \u00b5 using the sample-mean of the observations obtained by A, satisfies\nRn(Aavg) = K\u2211 k=1 E [Tk(n)] (Vk \u2212 V \u2217) . (8)\nThe proof follows from a simple calculation given in Appendix A. Essentially, one can rewrite the loss as Ln(A) = 1 n2E [\u2211K k=1 S 2 k,n + 2 \u2211 k 6=j Sk,nSj,n ] , where Sk,n is the centered sum of observations for arm k. The cross-terms can be shown to cancel by independence, and Wald\u2019s second identity with some algebra gives the result.\nThe tight connection between sequential estimation and bandit problems revealed by (8) allows one to reduce sequential estimation to the design of bandit strategies and vice versa. Furthermore, regret bounds transfer both ways. Theorem 2 (Reduction). Let Assumption 4.1 hold for \u03a8. Define a corresponding bandit problem (\u03bdk) by assigning \u03bdk as the distribution of\u2212X2k,1. Given an arbitrary allocation strategy A, let Bandit(A) be the bandit strategy that consults A to select the next arm after obtaining reward Yt (assumed nonpositive), based on feeding observations (\u2212Yt)1/2 to A and copying A\u2019s choices. Then, the banditregret of Bandit(A) in bandit problem (\u03bdk) is the same as the MSE-regret of A in estimation problem \u03a8. Conversely, given an arbitrary bandit strategy B, let MC(B) be the allocation strategy that consults B to select the next estimator after observing\u2212Y 2t , based on feeding rewards Yt to B and copying B\u2019s choices. Then the MSE-regret of MC(B) in estimation problem \u03a8 is the same as the bandit-regret of B in bandit problem (\u03bdk) (where MC(B) uses the average of observations as its estimate).\nProof of Theorem 2. The result follows from Theorem 1 since Vk = E[X2k,1] \u2212 \u00b52 and V \u2217 = E[X2k\u2217,1]\u2212 \u00b52 where k\u2217 is the lowest variance estimator, hence Vk \u2212 V \u2217 = E[X2k,1] \u2212 min1\u2264k\u2032\u2264K E[X2k\u2032,1]. Furthermore, the bandit problem (\u03bdk) ensures the regret of a procedure that chooses arm k Tk(n) times is \u2211K k=1 E[Tk(n)]\u2206k, where \u2206k = max1\u2264k\u2032\u2264K E[\u2212X2k\u2032,1]\u2212E[\u2212X2k,1] = Vk\u2212V \u2217.\nFrom this theorem one can also derive a lower bound. First, let V(\u03c8) denote the variance of X \u223c \u03c8 and let V\u2217(\u03a8) = min1\u2264k\u2264K V(\u03c8k). For a family F of distributions over the reals, let Dinf(\u03c8, v,F) = inf\u03c8\u2032\u2208F :V(\u03c8\u2032)<vD(\u03c8,\u03c8\u2032), where D(\u03c8, \u03c6) = \u222b log d\u03c8d\u03c6 (x) d\u03c8(x), if the RadonNikodym derivative d\u03c8/d\u03c6 exists, and\u221e otherwise. Note that Dinf(\u03c8, v,F) measures how distinguishable \u03c8 is from distributions in F having smaller variance than v. Further, we let Rn(A,\u03a8) denote the regret of A on the estimation problem specified using the distributions \u03a8. Theorem 3 (MSE-Regret Lower Bound). Let F be the set of distributions supported on [0, 1] and assume that A allocates a subpolynomial fraction to suboptimal estimators\nfor any \u03a8\u2208FK: i.e., E\u03a8[Tk(n)]=O(na) for all a > 0 and k such that V(\u03c8k)>V\u2217(\u03a8). Then, for any \u03a8\u2208F where not all variances are equal and 0<Dinf(\u03c8k,V\u2217(\u03a8),F)<\u221e holds whenever V(\u03c8k)>V\u2217(\u03a8), we have\nlim inf n\u2192\u221e Rn(A,\u03a8) log n\n\u2265 \u2211\nk:V(\u03c8k)>V\u2217(\u03a8)\nV(\u03c8k)\u2212 V\u2217(\u03a8) Dinf(\u03c8k,V\u2217(\u03a8),F) .\nProof. The result follows from Theorem 2 and (Burnetas & Katehakis, 1996, Proposition 1).\nUsing Theorem 2 we can also establish bounds on the MSE-regret for the algorithms mentioned in Section 2.\nTheorem 4 (MSE-Regret Upper Bounds). Let Assumption 4.1 hold for \u03a8 = (\u03c8k) where (for simplicity) we assume each \u03c8k is supported on [0, 1]. Then, after n rounds, MC(B) achieves the MSE-Regret bound of: (4) when using B= UCB1; (5) when using B= UCB-V with c\u03b6 = 10; (6) when using B=UCB-KL; and (7) when using B=TS.1\nAdditionally, due to Theorem 2, one can also obtain bounds on the minimax MSE-regret by exploiting the lower bound for bandits in (Auer et al., 2002b). In particular, the UCB-based bandit algorithms above can all be shown to achieve the minimax rate O( \u221a Kn) up to logarithmic factors, immediately implying that the minimax MSE-regret of MC(B) for B \u2208 {UCB1,UCB-V,KL-UCB} is of order Ln(MC(B))\u2212 L\u2217n = O\u0303(K1/2n\u2212(1+ 1 2 )).2\nAppendix B provides a discussion of how alternative ranges on the observations can be handled, and how the above methods can still be applied when the payoff distribution is unbounded but satisfies moment conditions."}, {"heading": "5. Non-uniform Estimator Costs", "text": "Next, we consider the case when the base estimators can take different amounts of time to generate observations. A consequence of non-uniform estimator times, which we refer to as non-uniform costs, is that the definitions of the loss and regret must be modified accordingly. Intuitively, if an estimator takes more time to produce an observation, it is less useful than another estimator that produces observations with (say) identical variance but in less time.\nTo develop an appropriate notion of regret for this case, we introduce some additional notation. Let Dk,m denote the time needed by estimator k to produce its mth observation, Xk,m. As before, we let Im \u2208 {1, . . . ,K} denote the index of the estimator that A chooses in round m. Let Jm denote the time when A observes the mth sample,\n1 Note that to apply the regret bounds from Section 2, one has to feed the bandit algorithms with 1\u2212 Y 2t instead of \u2212Y 2t in Theorem 2. This modification has no effect on the regret.\n2 O\u0303 denotes the order up to logarithmic factors. To remove such factors one can exploit MOSS (Audibert & Bubeck, 2010).\nYm =XIm,TIm (m); thus, J1 =DI1,1, J2 =J1 +DI2,TI2 (2), and Jm+1 = Jm+DIm,TIm (m) = \u2211m s=1DIs,TIs (s). For convenience, define J0 = 0. Note that round m starts at time Jm\u22121 with A choosing an estimator, and finishes at time Jm when the observation is received and A (instantaneously) updates it estimate. Thus, at time Jm a new estimate \u00b5\u0302m becomes available: the estimate is \u201crenewed\u201d. Let \u00b5\u0302(t) denote the estimate available at time t \u2265 0. Assuming A produces a default estimate \u00b5\u03020 before the first observation, we have \u00b5\u0302(t) = \u00b5\u03020 on [0, J1), \u00b5\u0302(t) = \u00b5\u03021 on [J1, J2), etc. IfN(t) denotes the round index at time t (i.e.,N(t)=1 on [0, J1), N(t)=2 on [J1, J2), etc.) then \u00b5\u0302(t)= \u00b5\u0302N(t)\u22121. The MSE of A at time t \u2265 0 is\nL(A, t) = E [ (\u00b5\u0302(t)\u2212 \u00b5)2 ] .\nBy comparison, the estimate for a single estimator k at time t is \u00b5\u0302k(t) = I{Nk(t) > 1} \u2211Nk(t)\u22121\nm=1 Xk,m Nk(t)\u22121 , where Nk(t) =\n1 on [0, Dk,1), Nk(t) = 2 on [Dk,1, Dk,1 + Dk,2), etc. We set \u00b5\u0302k(t) = 0 on [0, Dk,1) to let \u00b5\u0302k(t) be well-defined on [0, Dk,1). Thus, at time t \u2265 0 the MSE of estimator k is\nLk(t) = E [ (\u00b5\u0302k(t)\u2212 \u00b5)2 ] .\nGiven these definitions, it is natural to define the regret as R(A, t) = t2 ( L(A, t)\u2212 min\n1\u2264k\u2264K Lk(t)\n) .\nAs before, the t2 scaling is chosen so that, under the condition that Lk(t) \u221d 1/t, a sublinear regret implies that A is \u201clearning\u201d. Note that this definition generalizes the previous one: if Dk,m = 1\u2200k, m, then Rn(A) = R(A, n).\nIn this section we make the following assumption.\nAssumption 5.1. For each k, (Xk,m, Dk,m)(m=1,2,...) is an i.i.d. sequence such that E [Xk,1] =\u00b5, Vk . =V (Xk,1)< \u221e, P(Dk,m > 0) = 1 and \u03b4k . = E[Dk,1] = E [Dk,m]<\u221e. Furthermore, we assume that the sequences for different k are independent of each other.\nNote that Assumption 5.1 allows Dk,m to be a deterministic value; a case that holds when the estimators use deterministic algorithms to produce observations. Another situation arises when Dk,m is stochastic (i.e., the estimator uses a randomized algorithm) and (Xk,m, Dk,m) are correlated. In which case \u00b5\u0302k(t) may be a biased estimate of \u00b5. However, if (Xk,m)m and (Dk,m)m are independent and P(Nk(t) > 1) = 1 then \u00b5\u0302k(t) is unbiased. Indeed, in such a case, (Nk(t))t is independent of the partial sums\n( \u2211n m=1Xk,m)n, hence E[\u00b5\u0302k(t)] = E [\u2211Nk(t)\u22121 m=1 Xk,m Nk(t)\u22121 ] =\u2211\u221e\nn=2 P(Nk(t) = n)E [\u2211n\u22121 m=1Xk,m n\u22121 \u2223\u2223\u2223Nk(t) = n] = P(Nk(t)>1)E [X], because \u00b5\u0302k(t)=0 when Nk(t)\u22641.\nUsing Assumption 5.1, a standard argument of renewal reward processes gives Lk(t)\u223c Vk/(t/\u03b4k) = Vk\u03b4k/t, where\nf(t)\u223cg(t) means limt\u2192\u221e f(t)/g(t) = 1. Intuitively, estimator k will produce approximately t/\u03b4k independent observations during [0, t); hence, the variance of their average is approximately Vk/(t/\u03b4k) (made more precise in the proof of Theorem 5). This implies min1\u2264k\u2264K Lk(t)\u223c min1\u2264k\u2264K \u03b4kVk t . Thus, any allocation strategy A competing with the best estimator must draw most of its observations from k satisfying \u03b4kVk = \u03b4\u2217V \u2217 . = min1\u2264k\u2264K \u03b4kVk t . For simplicity, we assume k\u2217 = arg min1\u2264k\u2264K\u03b4kVk is unique, with \u03b4\u2217=\u03b4k\u2217 and V \u2217 = Vk\u2217 .\nAs before, we will consider adaptive strategies that estimate \u00b5 using the mean of the observations: \u00b5\u0302m= Smm such that Sm . = \u2211m s=1 Ys. Hence, the estimate at time t \u2265 J1 is\n\u00b5\u0302(t) = S(t)\nN(t)\u2212 1 , where S(t) = SN(t)\u22121 . (9)\nOur aim is to bound regret of the overall algorithm by bounding the number of times the allocation strategy chooses suboptimal estimators. We will do so by generalizing (2) to the nonuniform-cost case, but unlike the equality obtained in Theorem 1, here we provide an upper bound.\nTheorem 5. Let Assumption 5.1 hold and assume that (Xk,m) are bounded and k\u2217 is unique. Let the estimate of A at time t be defined by the sample mean \u00b5\u0302(t). Let t>0 be such that E [N(t)\u2212 1]>0 and E [Nk\u2217(t)]>0, and assume that for any k 6= k\u2217, E [Tk(N(t))]\u2264 f(t) for some f : (0,\u221e)\u2192 [1,\u221e) such that f(t)\u2264 cf t for some cf > 0 and any t > 0. Assume furthermore that P(Dk,1 > t) \u2264 CDt \u22122 and E [ Nk\u2217(t) 2 ] \u2264 CN t2 for all t > 0. Then, for\nany c < \u221a t/(8\u03b4max) where \u03b4max = maxk \u03b4k, the regret of A at time t is bounded by\nR(A, t) \u2264 (c+ C) \u221a t + C \u2032f(t)\n+ C \u2032\u2032t2 P ( Nk\u2217(t)>E [Nk\u2217(t)] + c \u221a E [Nk\u2217(t)\u2212 1] ) + C \u2032\u2032\u2032t2 P ( N(t)<E [N(t)]\u2212 c \u221a E [N(t)\u2212 1] ) , (10)\nfor some appropriate constants C,C \u2032, C \u2032\u2032, C \u2032\u2032\u2032>0 that depend on the problem parameters \u03b4k, Vk, the upper bound on |Xk,m|, and the constants cf , CD and CN .\nThe proof of the theorem is given in Appendix C. Several comments are in order. First, recall that the optimal regret rate is order \u221a t in this setting, up to logarithmic factors. To obtain such a rate, one need only achieve f(t)=O( \u221a t), which can be attained by stochastic or even adversarial bandit algorithms (Bubeck & Cesa-Bianchi, 2012b) receiving rewards with expectation \u2212\u03b4kVk and a well-concentrated number of samples. The moment condition on Nk\u2217(t) is also not restrictive; for example, if the estimators are rejection samplers, their sampling times will have a geometric distribution that satisfies the polynomial tail condition. Furthermore, ifDk,m\u2265\u03b4\u2212 for some \u03b4\u2212>0 thenNk(t)<t/\u03b4\u2212 for all k, which ensures the moment condition on Nk\u2217(t).\nAlthough it was sufficient to use the negative second moment \u2212X2k,m instead of variance as the bandit reward under uniform costs, this simplification is no longer possible when costs are nonuniform, since \u03b4kVk=\u03b4k(E[X2k,1]\u2212\u00b52) now involves the unknown expectation \u00b5. Several strategies can be followed to bypass this difficulty. For example, given independent costs and observations, one can use each bandit algorithm decision twice, feeding rewards rk,m=\u2212 14 (Dk,2m+Dk,2m+1)(Xk,2m\u2212Xk,2m+1)\n2 whose expectation is \u03b4kVk. Similar constructions using slightly more data can be used for the dependent case.\nNote that ensuring E[Tk(N(t))] \u2264 f(t) can be nontrivial. Typical guarantees for UCB-type algorithms ensure that the expected number of pulls to a suboptimal arm k in n rounds is bounded by a function gk(n). However, due to their dependence, E[Tk(N(t))] cannot generally be bounded by gk(E[N(t)]). Nevertheless, if, for example, Dk,m \u2265 \u03b4\u2212 for some \u03b4\u2212>0, then N(t)\u22121\u2264 t/\u03b4\u2212, hence fk(t)=gk(t/\u03b4 \u2212) can be used.\nFinally, we need to ensure that the last two terms in (10) remain small, which follows if N(t) and Nk\u2217(t) concentrate around their means. In general, P(N < E[N ]\u2212 C \u221a E[N ] log(1/\u03b4)) \u2264 \u03b4 for some constant C, therefore\nc=C \u221a\nlog(1/\u03b4) can be chosen to achieve t2P(N<E[N ]\u2212 c \u221a E[N ]) \u2264 t2\u03b4, hence by chosing \u03b4 to be O(t\u22123/2) we achieve O\u0303( \u221a t) regret. However, to ensure concentration, the allocation strategy must also select the optimal estimator most of the time. For example, Audibert et al. (2009) show that with default parameters, UCB1 and UCB-V will select suboptimal arms with probability \u2126(1/n), making t2P(N < E[N ]\u2212 c \u221a E[N ]) = \u2126(t). However, by increasing the constant 2 in UCB1 and the parameter \u03b6 in UCB-V, it follows from (Audibert et al., 2009) that the chance of using any suboptimal arm more than c log(t) \u221a t times can be made smaller than c/t (where c is some problem-dependent constant). Outside of this small probability event, the optimal arm is used t\u2212 cK log(t) \u221a t times, which is sufficient to show concentration of N(t). In summary, we conclude that O\u0303( \u221a t) regret can be achieved in Theorem 5 under reasonable assumptions."}, {"heading": "6. Experiments", "text": "We conduct experimental investigations in a number of scenarios to better understand the effectiveness of multi-armed bandit algorithms for adaptive Monte Carlo estimation."}, {"heading": "6.1. Preliminary Investigation: A 2-Estimator Problem", "text": "We first consider the performance of allocation strategies on a simple 2-estimator problem. Note that this evaluation differs from standard evaluations of stochastic bandits through the absence of single-parameter payoff distribu-\ntions, such as the Bernoulli, which cannot have identical means yet different variances. This is an important detail, since stochastic bandit algorithms such as KL-UCB and TS are often evaluated on single-parameter payoff distributions, but their advantages in such scenarios might not extend to adaptive Monte Carlo estimation.\nIn particular, we consider problems when Xk,t = \u00b5 + sk(Zt \u2212 12 ), where Zt is standard Bernoulli and sk\u2208(0, 1) is a separate scale parameter for k\u2208{1, 2}. This design permits the maximum range for variance around a mean within a bounded interval. We evaluated the four bandit strategies detailed in Section 2: UCB1, UCB-V, KL-UCB, and TS, where for UCB-V we used the same settings as (Audibert et al., 2009), and for TS we used the uniform Beta prior, i.e., \u03b10 = 1 and \u03b20 = 1.\nThe relative performance of these approaches is reported in Figure 1. TS appears best suited for scenarios where either estimator has high variance, whereas UCB-V is more effective when faced with medium or low variance estimators. Additionally, KL-UCB out-performs UCB-V in high variance settings, but in all such cases was eclipsed by TS."}, {"heading": "6.2. Option Pricing", "text": "We next consider a more practical application of adaptive Monte Carlo estimation to the problem of pricing financial instruments. In particular, following (Douc et al., 2007; Arouna, 2004), we consider the problem of pricing European call options under the assumption that the interest rate evolves in time according to the Cox-Ingersoll-Ross (CIR) model (Cox et al., 1985), a popular model in mathematical finance (details provided in Appendix F). In a nutshell, this model assumes that the interest rate r(t), as a function of time t > 0, follows a square root diffusion model. The price of a European caplet option with \u201cstrike price\u201dK>0, \u201cnominee amount\u201d M > 0 and \u201cmaturity\u201d T > 0 is then given by P = M exp(\u2212 \u222b T 0 r(t)dt) max(r(T ) \u2212 K, 0). The problem is to determine the expected value of P .\nK = 0.06\nK = 0.08\nK = 0.07\nA naive approach to estimating E [P ] is to simulate independent realizations of r(t) for 0 < t \u2264 T . However, any simulation where the interest rate r(T ) lands below the strike price can be ignored since the payoff is zero. Therefore, a common estimation strategy is to use importance sampling by introducing a \u201cdrift\u201d parameter \u03b8 > 0 into the proposal density for r(t), with \u03b8 = 0 meaning no drift; this encourages simulations with higher interest rates. The importance weights for these simulations can then be efficiently calculated as a function of \u03b8 (see Appendix F).\nImportantly, the task of adaptively allocating trials between different importance sampling estimators has been previously studied on this problem, using an unrelated technique known as d-kernel Population Monte Carlo (PMC) (Douc et al., 2007). Space restrictions prevent us from providing a full description of the PMC method, but, roughly speaking, the method defines the proposal density as mixture over the set {\u03b8k} of drift parameters considered. At each time step, PMC samples a new drift value according to this mixture and then simulates an interest rate. After a fixed number of samples, say G (the population size), the mixture coefficient \u03b1k of each drift parameter \u03b8k is adjusted by setting it to be proportional to the sum of importance weights sampled from that parameter: \u03b1k = \u2211G t=1 wtI{It=k}\u2211G\nt=1 wt . The new\nproposal is then used to generate the next population.\nWe approximated the option prices under the same parameter settings as (Douc et al., 2007), namely, \u03bd = 0.016, \u03ba = 0.2, r0 = 0.08, T = 1, M = 1000, \u03c3 = 0.02, and n= 100, for different strike prices K = {0.06, 0.07, 0.08} (see Appendix F). However, we consider a wider set of proposals given by \u03b8k = k/10 for k \u2208 {0, 1, ..., 15}. The results averaged over 1000 simulations are given in Figure 2.\nThese results generally indicate that the more effective bandit approaches are significantly better suited to this allocation task than the PMC approach, particularly in the longer term. Among the bandit based strategies, TS is the clear winner, which, given the conclusions from the previous experiment, is likely due to high level of variance introduced by the option pricing formula. Despite this strong showing for the bandit methods, PMC remains surprisingly competi-\ntive at this task, doing uniformly better than UCB, and better than all other bandit allocation strategies early on for K = 0.06. However, we believe that this advantage of PMC stems from the fact that PMC explore the entire space of mixture distribution (rather than single \u03b8k). It remains an interesting area for future work in bandit-based allocation strategies to extend the existing methods to continuously parameterized settings."}, {"heading": "6.3. Adaptive Annealed Importance Sampling", "text": "Many important applications of Monte Carlo estimation occur in Bayesian inference, where a particularly challenging problem is evaluating the model evidence of a latent variable model. Evaluating such quantities is useful for a variety of purposes, such as Bayesian model comparison and testing/training set evaluation (Robert, 2012). However, the desired quantities are notoriously difficult to estimate in many important settings, due in no small part to the fact that popular high-dimensional Monte Carlo strategies, such as Markov Chain Monte Carlo (MCMC) methods, cannot be directly applied (Neal, 2005).\nNevertheless, a popular approach for approximating such values is annealed importance sampling (AIS) (Neal, 2001) (or more generally sequential Monte Carlo samplers (Del Moral et al., 2006)). In a nutshell, AIS combines the advantages of importance sampling with MCMC by defining a proposal density through a sequence of MCMC transitions applied to a sequence of annealed distributions, which slowly blend between the proposal (prior) and the target (un-normalized posterior). While such a technique can offer impressive practical advantages, it often requires considerable effort to set parameters; in particular, the practitioner must specify the number of annealing steps, the annealing rate or \u201cschedule\u201d, the underlying MCMC method (and its parameters), and the number of MCMC transitions to execute at annealing step. Even when these parameters have been appropriately tuned on preliminary data, there is no assurance that these choices will remain effective when deployed on larger or slightly different data sets.\nHere we consider the problem of approximating the normalization constant for a Bayesian logistic regression\nmodel on different sized subsets of the 8-dimensional Pima Indian diabetes UCI data set (Bache & Lichman, 2013). We consider the problem of allocating resources between three AIS estimators that differ only in the number of annealing steps they use; namely, 400, 2000, and 8000 steps. In each case, we fix the annealing schedule using the power of 4 heuristic suggested by (Kuss & Rasmussen, 2005), with a single slice sampling MCMC transition used at each step (Neal, 2003) (this entails one \u201cstep\u201d in each of the 8 dimensions); see Appendix G for further details.\nA key challenge in this scenario is that the computational costs associated with each arm differ substantially, and, because slice sampling uses an internal rejection sampler, these costs are stochastic. To account for these costs we directly use elapsed CPU-time when drawing a sample from each estimator, as reported by the JAVA VM. This choice reflects the true underlying cost and is particularly convenient since it does not require the practitioner to implement special accounting functionality. Since we do not expect this cost to correlate with the sample returns, we use the independent costs payoff formulation from Section 5: \u2212 14 (Dk,2m +Dk,2m+1)(Xk,2m \u2212Xk,2m+1) 2.\nThe results for the different allocation strategies for training sets of size 5, 10, and 50 are shown in Figure 3. Perhaps the most striking result is the performance improvement achieved by the nonuniformly combined estimators, which are indicated by the dashed lines. These estimators do not change the underlying allocation; instead they improve the final combined estimate by weighting each observation inversely proportional to the sample variance of the estimator that produced it. This performance improvement is an artifact of the nonuniform cost setting, since arms that are very close in terms of Vk\u03b4k can still have considerably different variances, which is especially true for AIS. Also observe that no one arm is optimal for all three training set sizes, consequently, we can see that bandit allocation (Thompson sampling in particular) is able to outperform any static strategy. In practice, this implies that even after exhaus-\ntive parameter tuning, automated adaptation can still offer considerable benefits simply due to changes in the data."}, {"heading": "7. Conclusion", "text": "In this paper we have introduced a new sequential decision making strategy for competing with the best consistent Monte Carlo estimator in a finite pool. When each base estimator produces unbiased values at the same cost, we have shown that the sequential estimation problem maps to a corresponding bandit problem, allowing future improvements in bandit algorithms to be transfered to combining unbiased estimators. We have also shown a weaker reduction for problems where the different estimators take different (possibly random) time to produce an observation.\nWe expect this work to inspire further research in the area. For example, one may consider combining not only finitely many, but infinitely many estimators using appropriate bandit techniques (Bubeck et al., 2011), and/or exploit the fact that the observation from one estimator may reveal information about the variance of others. This is the case for example when the samplers use importance sampling, leading to the (new) stochastic variant of the problem known as \u201cbandits with side-observations\u201d (Mannor & Shamir, 2011; Alon et al., 2013). However, much work remains to be done, such studying in detail the use variance weighted estimators, dealing with continuous families of estimators, or a more thorough empirical investigation of the alternatives available."}, {"heading": "Acknowledgements", "text": "This work was supported by the Alberta Innovates Technology Futures and NSERC. Part of this work was done while Cs.Sz. was visiting Technion, Haifa and Microsoft Research, Redmond, whose support and hospitality are greatly acknowledged."}, {"heading": "A. Proofs for Section 4", "text": "In this section we provide the proof of Theorem 1. For the proof, we will need the following two lemmas:\nLemma 1 (Optional Sampling). Let (Xt)t\u2208N be a sequence of i.i.d. random variables, and (X \u2032t)t\u2208N be its subsequence such that the decision whether to include Xt in the subsequence is independent of future values in the sequence, i.e., Xs for s \u2265 t. Then the sequence (X \u2032t)t\u2208N is an i.i.d. sequence with the same distribution as (Xt)t\u2208N.\nProof. See Theorem 5.2 in Chapter III on page 145 of (Doob, 1953).\nWe also need Wald\u2019s second identity:\nLemma 2 (Wald\u2019s Second Identity). Let (Xt)t\u2208N be a sequence of (Ft; t \u2265 1)-adapted random variables such that E [Xt|Ft\u22121] = \u00b5 and E [ (Xt \u2212 \u00b5)2|Ft\u22121 ] = \u03c32 for any t \u2265 1. Let Sn = \u2211n t=1Xt be the partial sum of the first n random variables (n \u2265 1) and \u03c4 > 0 be some stopping time w.r.t. (Ft; t \u2265 1).3 Then,\nE [ (S\u03c4 \u2212 \u00b5\u03c4)2 ] = \u03c32E [\u03c4 ] .\nProof. See Theorem 14.3 of (Gut, 2005).\nNow, let us return to the proof of Theorem 1. Let It \u2208 {1, . . . ,K} denote the choice thatAmade at the beginning of round t and recall that Tk(t) = \u2211t s=1 I{Is = k}. The observation at the end of round t is Yt = XIt,TIt (t) and the cumulative\nsum of returns after n rounds for arm k is Sk,n = \u2211Tk(n) t=1 Xk,t. Likewise, Sn = \u2211n t=1 Yt = \u2211K k=1 Sk,n. By definition, the estimate after n rounds is\n\u00b5\u0302n = Sn n = 1 n K\u2211 k=1 Sk,n .\nSince the variance of this estimate does not depend on the mean, without loss of generality we may consider the case when \u00b5 = 0, giving\nLn(A) = E [ \u00b5\u03022n ] = 1\nn2 E  K\u2211 k=1 S2k,n + 2 \u2211 k 6=j Sk,nSj,n  (11) We may then observe that for any k 6= j,\nE [Sk,nSj,n] = E [(I{In = k}Yn + Sk,n\u22121)(I{In = j}Yn + Sj,n\u22121)]\n= E[ ((((\n(((( ((\nI{In = k}I{In = j}Y 2n + I{In = k}YnSj,n\u22121 + I{In = j}YnSk,n\u22121 + Sk,n\u22121Sj,n\u22121].\nBy considering the conditional expectation w.r.t. the history up to Yn (including In), i.e., w.r.t. Fn\u22121 = \u03c3(Y1, . . . , Yn\u22121, I1, . . . , In), we have\nE[Sk,nSj,n] = E [E [Sk,nSj,n|Fn\u22121]] = E[(I{In = k}Sj,n\u22121 + I{In = j}Sk,n\u22121)E[Yn|Fn\u22121]] + E[Sk,n\u22121Sj,n\u22121].\nNow, since In \u2208 {1, . . . ,K} and In is Fn\u22121]-measurable, E [Yn|Fn\u22121] = \u2211K k=1 I{In = k}E [ Xk,Tk(n)|Fn\u22121, In = k ] . Further, by Lemma 1, (Xk,Tk(n))n is an i.i.d. sequence, sharing the same distribution as (Xk,t)t. Since \u03c3(Xk,Tk(n)) is independent of \u03c3(Y1, . . . , Yn\u22121, I1, . . . , In\u22121, In, In = k), E [ Xk,Tk(n)|Fn\u22121, In = k ] = E [ Xk,Tk(n) ] = \u00b5 = 0. Therefore, E [Sk,nSj,n] = E[Sk,n\u22121Sj,n\u22121] = . . . = E[Sk,0Sj,0] = 0.\nAs a result, (11) becomes\nLn(A) = 1\nn2 E [ K\u2211 k=1 S2k,n ] = 1 n2 K\u2211 k=1 E[S2k,n].\n3\u03c4 is called a stopping time w.r.t. (Ft; t \u2265 1) if {\u03c4 \u2264 t} \u2208 Ft for all t \u2265 1.\nFrom Wald\u2019s second identity (cf. Lemma 2) we conclude E[S2k,n] = V(Xk)E[Tk(n)] and thus get\nLn(A) = 1\nn2 K\u2211 k=1 V(Xk)E[Tk(n)]. (12)\nUsing the definition of the normalized MSE-regret and that min1\u2264k\u2264K Lk,n = V \u2217/n,\nRn(A) = n2 ( Ln(A)\u2212 V \u2217\nn\n) = K\u2211 k=1 E[Tk(n)](Vk \u2212 V \u2217),\nwhich was the result to be proven."}, {"heading": "B. Handling Unknown Ranges", "text": "The algorithms and bounds of Section 4 can be easily extended to the setting where Xk,t \u2208 [ak, bk] (often a = 0) where ak < bk are a priori known. One option is to scale Xk,t to the common range [0, 1] using X\u0303k,t = (Xk,t \u2212 mink ak)/(maxk bk\u2212mink ak) and then feed 1\u2212X\u03032k,t to the bandit algorithms (as the bandit algorithms expect the rewards in [0, 1] and constant translation of each reward does not change the regret). However, as these algorithms (prepared for \u201cworst case\u201d distributions) are sensitive to the overestimation of the range, this would lead to an unnecessary deterioration of the performance. A better option is to scale each variable separately. Then, the upper-confidence bound based algorithms must be modified by scaling each of the rewards with respect to its own range and then the bounds needs to be scaled back to the original range. Thus, the method that computes the reward upper bounds must be fed with (bk\u2212amin)\n2\u2212(Xk,m\u2212amin)2 (bk\u2212amin)2 \u2208\n[0, 1], where amin = min1\u2264k\u2264K ak. Then, if the method returns an upper bound Bk,m, the bound to be used for selecting the best arm (which should be an upper bound for \u2212E [ (Xk,t \u2212 amin)2 ] ) should be B\u2032k,t = (bk \u2212 amin)2(Bk,t \u2212 1).\nHere we exploit that \u2212E [ (Xk,t \u2212 amin)2 ] = \u2212E [ X2k,t ] + c where the constant c = 2\u00b5amin \u2212 a2min (which is neither known, nor needs to be known or estimated) is common to all the estimators, hence finding the arm that maximizes \u2212E [ (Xk,t \u2212 amin)2 ] is equivalent to finding the arm that maximizes \u2212E [ X2k,t ] . Since the confidence bounds will be loser if the range is larger, we thus see that the algorithm may be sensitive to the ranges rk = bk \u2212 amin. In particular, the 1/n-term in the bound used by UCB-V will scale with r2k and may dominate the bound for smaller values of n. In fact, UCB-V needs n \u2248 r2k samples before this term becomes negligible, which means that for such estimators, the upper confidence bound of UCB-V will be above 1 for r2k steps. Even if we cut the upper confidence bounds at 1, UCB-V will keep using these arms with a large range rk defending against the possibility that the sample variance crudely underestimates the true variance. Since the bound of KL-UCB is in the range [0, 1], KL-UCB is less exposed to this problem.\nBased on Theorem 1, an alternative is to use bandit algorithms to minimize cost where the cost of an arm is defined as the variance of samples from that arm. This may be advantageous when the ranges become large because of unequal lower bounds (ak). To implement this idea one needs to develop new bandit algorithms for cumulative variance minimization, which in fact is explored in Section 5, in the context of estimation under nonuniform-costs.\nFinally, note that the assumption that the samples belong to a known bounded interval is not necessary (it was not used in the reduction results). In fact, the upper-confidence based bandit algorithms mentioned can also be applied when the payoffs are subgaussian with a known subgaussian coefficient,4 or even if the tail is heavier (Bubeck & Cesa-Bianchi, 2012a; Bubeck et al., 2013). In fact, the weaker assumptions under which the multi-armed bandit problem with finitely many arms has been analyzed assumes only that the 1 + \u03b5 moment of the payoff is finite for some known \u03b5 with a known moment bound (Bubeck et al., 2013). These strategies must replace the sample means with more robust estimators and also modify the way the upper confidence bounds are calculated. In our setting, the condition on the moment transfers to the assumption that the 2 + \u03b5 moment E [ |Xk,t|2+\u03b5 ] must be finite with a known upper bound for some \u03b5."}, {"heading": "C. Proofs for Section 5", "text": "In this section we provide the proof of Theorem 5.\n4 A centered random variable X is subgaussian if P(|X| \u2265 t) \u2264 c exp(\u2212t2/(2\u03c32)) for all real t with some c, \u03c3 > 0.\nWe can write the MSE at time t as L(A, t) = E [(\nS(t)\u2212(N(t)\u22121)\u00b5 N(t)\u22121\n)2] . The first step is to replace the denominator with its\nexpectation. The price of this is calculated in the following result:\nLemma 3. Let S,N be random variables, N \u2265 0 such that E [N ] > 0, \u00b5 \u2208 R. Let D = I{N = 0}(a \u2212 \u00b5) + I{N 6= 0} ( S N \u2212 \u00b5 ) . Let d \u2208 R be an almost sure upper bound on |D|I{N 6= 0}. Then, for any c \u2265 0,\nE [ D2 ] \u2264 (a\u2212 \u00b5)2P(N = 0) +\nE [ (S \u2212N\u00b5)2 ] E [N ]2 ( 1 + 2c\u221a E [N ] )2 + d2 [ P(N < E [N ]\u2212 c \u221a E [N ]) + I{E [N ] < 4c2} ] .\n(13)\nFurther, assuming that S = 0 almost surely on {N = 0},\nE [ D2 ] \u2265 (a\u2212 \u00b5)2P(N = 0) +\nE [ (S \u2212N\u00b5)2 ] E [N ]2 ( 1\u2212 2c\u221a E [N ] ) \u2212 d2 E [ N2 ] E [N ]2 P(N > E [N ] + c \u221a E [N ]) .\nThe lemma is useful when N concentrates around its mean. Consider the upper bound on E [ D2 ] . In general, we expect\nP(N < E [N ] \u2212 C \u221a E [N ] log(1/\u03b4)) \u2264 \u03b4 with some numerical constant C. Thus, setting c = C \u221a log(1/\u03b4) results in\nd2 [ P(N < E [N ]\u2212 c \u221a E [N ]) + I{E [N ] < 4c2} ] \u2264 d2\u03b4 + d2I{E [N ] < 4C2 log(1/\u03b4)}. Imagine now that E [N ] = rt\nand choose \u03b4 = t\u2212q with q > 0. Then, as soon as rt > 4C2 \u221a q log(t), the last indicator of (13) becomes zero. Further,\n2c\u221a E[N ]\n= \u221a\n2q log(t) rt \u2192 0 as t\u2192\u221e. Since this term converges at a 1/\n\u221a t rate, we should choose q \u2265 1/2, so that \u03b4 = \u03b4(t)\nconverges at least as fast as this term. However, since later \u201cD gets multiplied by t2\u201d, to get a sublinear rate matching other terms, one should choose q \u2265 3/2.\nProof. Let b = c \u221a E [N ]. First we prove the upper bound. We have\nE [ D2 ] \u2264 E [ D2I{N = 0} ] + E [ D2I{N 6= 0, N \u2265 E [N ]\u2212 b, b \u2264 12E [N ]} ] + E [ D2I{N 6= 0, N < E [N ]\u2212 b} ] + E [ D2I{N 6= 0, b > 12E [N ]}\n] \u2264 (a\u2212 \u00b5)2P(N = 0) + E [ (S \u2212N\u00b5)2\n(E [N ]\u2212 b)2 I{b \u2264 12E [N ]}\n] + d2P(N < E [N ]\u2212 b) + d2I{b > 12E [N ]}\n\u2264 (a\u2212 \u00b5)2P(N = 0) + E [ (S \u2212N\u00b5)2 ] (E [N ]\u2212 b)2 I{b \u2264 12E [N ]}+ d 2P(N < E [N ]\u2212 b) + d2I{b > 12E [N ]} .\nNoting that 1/(1\u2212 x) \u2264 1 + 2x when 0 \u2264 x \u2264 1/2, we get that\n1\nE [N ]\u2212 b I{b \u2264 12E [N ]} =\n1 E [N ] 1\n1\u2212 bE[N ] I{b \u2264 12E [N ]} \u2264\n1\nE [N ]\n( 1 + 2 b\nE [N ]\n) = 1\nE [N ]\n( 1 + 2\nc\u221a E [N ]\n) .\nPutting things together, we get the desired upper bound.\nThe lower bound is proved in a similar fashion. To simplify notation, letN denote the event {0 < N \u2264 E [N ] + b}. Then,\nE [ D2 ] \u2265 (a\u2212 \u00b5)2P(N = 0) + E\n[( (S \u2212N\u00b5)\nN\n)2 I{N} ]\n\u2265 (a\u2212 \u00b5)2P(N = 0) + E [ (S \u2212N\u00b5)2\n(E [N ] + b)2 I{N} ] = (a\u2212 \u00b5)2P(N = 0) + E [ (S \u2212N\u00b5)2\n(E [N ] + b)2\n] \u2212 E [ (S \u2212N\u00b5)2\n(E [N ] + b)2 I{N = 0 or N > E [N ] + b} ] \u2265 (a\u2212 \u00b5)2P(N = 0) + E [N ] 2 (E [N ] + b)2 E [ (S \u2212N\u00b5)2 ] E [N ]2 \u2212 E [ (S \u2212N\u00b5)2 (E [N ] + b)2 I{N > E [N ] + b}\n] (because by assumption E [ (S \u2212N\u00b5)2I{N = 0} ] = 0)\n= (a\u2212 \u00b5)2P(N = 0) + E [N ] 2 (E [N ] + b)2 E [ (S \u2212N\u00b5)2 ] E [N ]2 \u2212 E [ N2 ] (E [N ] + b)2 ( d2P(N > E [N ] + b) ) \u2265 (a\u2212 \u00b5)2P(N = 0) + ( 1\u2212 2b\nE [N ]\n) E [ (S \u2212N\u00b5)2 ] E [N ]2 \u2212 d2 E [ N2 ] P(N > E [N ] + b) E [N ]2 ,\nwhere in the last inequality we used\nE [N ]2\n(E [N ] + b)2 =\n( 1\u2212 b\nE [N ] + b\n)2 \u2265 1\u2212 2b\nE [N ] + b\nand 1/(E [N ] + b) \u2264 1/E [N ]. The above lemma suggests that when bounding E [ (S/N \u2212 \u00b5)2 ] , the main term is E [ (S \u2212N\u00b5)2 ] /E [N ]2. First we develop a lower bound on this when only sampler k is used at every time step.\nLemma 4. Let Assumption 5.1 hold and assume that the random variables |Xk,m \u2212 \u00b5|k,m are a.s. bounded by some constant B > 0. Consider the case when an individual sampler k \u2208 {1, . . . ,K} is used up to time t: Let Nk(t) be the smallest integer such that \u2211Nk(t) m=1 Dk,m \u2265 t and Sk(t) = \u2211Nk(t)\u22121 m=1 Xk,m. Then, for any t > 0 such that E [Nk(t)] > 1, and for any constant \u03b2 > 0 such that P(Dk,1 \u2264 \u03b2) > 0,\nE [ (Sk(t)\u2212 (Nk(t)\u2212 1)\u00b5)2 ] E [Nk(t)\u2212 1]2 \u2265 \u03b4kVk t+ \u03b2 \u2212 2B\u03b4k \u221a Vk\u03b4k t3/2 \u2212 VkE [Dk,1I{Dk,1 > \u03b2}] t (14)\nand\nt\n\u03b4k \u2264 E [Nk(t)] \u2264\nt+ \u03b2\n\u03b4k \u2212 E [Dk,1I{Dk,1 > \u03b2}] , (15)\nIf the random variables (Dk,m) are a.s. bounded by a constant, we can choose \u03b2 to be their common upper bound to cancel the third term of (14). Otherwise, we need to select \u03b2 to strike a good balance between the first and third terms. Note that \u03b2 = o(t) makes the first the same order as \u03b4kVk/t with an error term of order \u03b2/t2. Thus, a reasonable choice is \u03b2 = t3/2, which makes the error term of the same order as the second term of the lower bound.\nProof. We start with the proving the upper bound on E [Nk(t)] in (15). Define D\u0302k,m = min{Dk,m, \u03b2} and let N\u0302k(t) be the smallest integer such that \u2211N\u0302k(t) m=1 D\u0302k,m \u2265 t. Then, clearly N\u0302k(t) \u2265 Nk(t), and by Wald\u2019s identity,\nt > E N\u0302k(t)\u22121\u2211 m=1 D\u0302k,m  \u2265 E N\u0302k(t)\u2211 m=1 D\u0302k,m \u2212 \u03b2 = E [ N\u0302k(t) ] E [ D\u0302k,1 ] \u2212 \u03b2 \u2265 E [Nk(t)] (\u03b4k \u2212 E [Dk,1I{Dk,1 > \u03b2}])\u2212 \u03b2.\nTherefore,\nE [Nk(t)] \u2264 t+ \u03b2\n\u03b4k \u2212 E [Dk,1I{Dk,1 > \u03b2}] ,\nwhere we used that \u03b4k \u2212 E [Dk,1I{Dk,1 > \u03b2}] > 0, which follows from our assumption P(Dk,1 \u2264 \u03b2) > 0, finishing the proof of the upper bound. As for the lower bound, by the definition ofNk(t) and Wald\u2019s identity we have E [Nk(t)] \u03b4k \u2265 t, thus finishing the proof of (15).\nLet us now turn to proving (14). We would like to apply Wald\u2019s second identity to (Sk(t)\u2212(Nk(t)\u22121)\u00b5)2. However, while Nk(t) is a stopping time w.r.t. the (natural) filtration Fm = \u03c3(Xk,1, Dk,1, . . . , Xk,m, Dk,m), Nk(t) \u2212 1 is not. Define F = \u2211Nk(t) m=1 Xk,m \u2212Nk(t)\u00b5: We can apply Wald\u2019s identity to F . Since (Sk(t)\u2212 (Nk(t)\u2212 1)\u00b5)2 = F \u2212 (Xk,Nk(t) \u2212 \u00b5) we get\nE [ (Sk(t)\u2212 (Nk(t)\u2212 1)\u00b5)2 ] = E [ F 2 ] + E [ (Xk,Nk(t) \u2212 \u00b5) 2 ] \u2212 2E [ (Xk,Nk(t) \u2212 \u00b5)F ] \u2265 E [Nk(t)]Vk \u2212 2E [ (Xk,Nk(t) \u2212 \u00b5)F\n] \u2265 E [Nk(t)]Vk \u2212 2B(E [ F 2 ] )1/2\n= E [Nk(t)]Vk \u2212 2B \u221a E [Nk(t)]Vk , (16)\nwhere in the second and last equality we used Lemma 2.\nCombining (15) with (16), we obtain\nE [ (Sk(t)\u2212 (Nk(t)\u2212 1)\u00b5)2 ] E [Nk(t)\u2212 1]2 \u2265 E [Nk(t)]Vk E [Nk(t)]2 \u2212 2B \u221a E [Nk(t)]Vk E [Nk(t)]2\n= Vk\nE [Nk(t)] \u2212\n2B \u221a E [Nk(t)]Vk\nE [Nk(t)]2\n\u2265 \u03b4kVk t+ \u03b2 \u2212 VkE [Dk,1I{Dk,1 > \u03b2}] t+ \u03b2\n\u2212 2B \u221a E [Nk(t)]Vk\nE [Nk(t)]2\n\u2265 \u03b4kVk t+ \u03b2 \u2212 VkE [Dk,1I{Dk,1 > \u03b2}] t+ \u03b2\n\u2212 2B\u03b4k \u221a Vk\u03b4k\nt3/2 .\nIn the next result we give an upper bound on E [ (S(t)\u2212 (N(t)\u2212 1)\u00b5)2 ] /E [N(t)\u2212 1]2. Before stating this lemma, let us recall the definitions of (Im)m=1,2,..., (Tk(m))m=0,1,...,1\u2264k\u2264K , (Ym)m=1,2,..., (Jm)m=0,1,2,... and (N(t))t\u22650: Im \u2208 {1, . . . ,K} is the index of the sampler chosen by A for round m; Tk(m) = \u2211m s=1 I{Is = k} is the number of samples obtained from sampler k by the end of round m (the empty sum is defined as zero); Ym = XIm,TIm (m) is the mth sample observed by A; J0 = 0 and Jm+1 = \u2211m s=1DIs,TIs (s) is the time when A observes the (m + 1)th sample, and so the mth round lasts over the time period [Jm, Jm+1); and N(t) = min {m : Jm \u2265 t} is the index of the round at time t (the indexing of rounds starts at one). Thus, N(t) \u2212 1 is the number of samples observed over the time period [0, t]. Note that \u2211K k=1 Tk(m) = m for any m \u2265 0 and thus, in particular, \u2211K k=1 Tk(N(t)) = N(t). Further, remember that\nSm = \u2211m s=1 Ym and S(t) = SN(t)\u22121. Lemma 5. Let Assumption 5.1 hold and assume that the random variables |Xk,m \u2212 \u00b5|k,m are a.s. bounded by some constant B > 0 and that k\u2217 = arg min1\u2264k\u2264K\u03b4kVk is unique. For s \u2265 0, let f(s) = maxk 6=k\u2217 E [Tk(N(s)\u2212 1)] and assume that cf = sups>0 f(s)/s < +\u221e. Suppose that t \u2265 2\u03b4max and E [N(t)\u2212 1] > 1. Then,\nE [ (S(t)\u2212 (N(t)\u2212 1)\u00b5)2 ] E [N(t)\u2212 1]2 \u2264 \u03b4 \u2217V \u2217 t + C t3/2 + C \u2032f(t) t2 (17)\nfor some constants C,C \u2032 > 0 that depend only on the problem parameters \u03b4k, Vk and cf . Furthermore,\nE [N(t)\u2212 1] \u2265 t \u03b4max \u2212 1 . (18)\nProof. We proceed similarly to the proof of Lemma 4.\nWe first prove (18). By the definition of N(t) and since Dk,m is nonnegative for all k and m,\nt \u2264 JN(t) \u2264 N(t)\u2211 s=1 DIs,TIs (s) = K\u2211 k=1 Tk(N(t))\u2211 m=1 Dk,m .\nNotice that (N(t))t\u22650, (Tk(n))n=0,1,... are stopping times w.r.t. the filtration (Fm;m \u2265 1), where Fm = \u03c3(I1, J1, . . . , Im, Ym). Therefore, Tk(N(t)) is also a stopping time w.r.t. (Fm). Defining T k(t) = E [Tk(N(t))], Wald\u2019s identity yields\nt \u2264 K\u2211 k=1 E [Tk(N(t))] \u03b4k = K\u2211 k=1 T k(t)\u03b4k . (19)\nThen,\nE [N(t)] = K\u2211 k=1 T k(t) \u2265 1 \u03b4max K\u2211 k=1 T k(t)\u03b4k \u2265 t \u03b4max ,\nfinishing the proof of (18).\nNow, let us turn to showing that (17) holds. First, notice that\nS(t)\u2212 (N(t)\u2212 1)\u00b5 = \u2212(YN(t) \u2212 \u00b5) + { SN(t) \u2212N(t)\u00b5 } = \u2212(YN(t) \u2212 \u00b5) + K\u2211 k=1 Sk,Tk(N(t)) \u2212 Tk(N(t))\u00b5.\nHence, with the same calculation as in the proof of Theorem 1 (the difference is that here N(t) is a stopping time while n is a constant in Theorem 1), we get\nE [ K\u2211 k=1 { Sk,Tk(N(t)) \u2212 Tk(N(t))\u00b5 }2] = K\u2211 k=1 T k(t)Vk\nand thus, introducing F = SN(t) \u2212N(t)\u00b5, Vmax = maxk Vk, and V\u0304 = \u2211 k 6=k\u2217 Vk,\nE [ (S(t)\u2212 (N(t)\u2212 1)\u00b5)2 ] = \u22122E [ (YN(t) \u2212 \u00b5)F ] + E [ (YN(t) \u2212 \u00b5)2 ] + K\u2211 k=1 T k(t)Vk\n\u2264 2B(E [ F 2 ] )1/2 + Vmax + K\u2211 k=1 T k(t)Vk\n\u2264 2B \u221a\u221a\u221a\u221a K\u2211 k=1 T k(t)Vk + Vmax + K\u2211 k=1 T k(t)Vk (20)\n\u2264 2B \u221a\u221a\u221a\u221aVmax K\u2211 k=1 T k(t) + Vmax + K\u2211 k=1 T k(t)Vk (21) = 2B \u221a VmaxE [N(t)] + Vmax +\nK\u2211 k=1 T k(t)Vk . (22)\nIntroduce the notation \u03b4\u0304 = \u2211 k 6=k\u2217 \u03b4k and recall that, by assumption, T k(t) \u2264 f(t) for all k 6= k\u2217. On the other hand,\nT k\u2217(t) \u2264 E [N(t)] holds trivially. Therefore, using (22), (19), and (18), we obtain\nE [ (S(t)\u2212 (N(t)\u2212 1)\u00b5)2 ] E [N(t)\u2212 1]2 \u2264 (\u2211 k=1 T k(t)\u03b4k ) \u00b7 {\u2211K k=1 T k(t)Vk + 2B \u221a VmaxE [N(t)] + Vmax } tE [N(t)\u2212 1]2\n\u2264\n( T k\u2217(t)\u03b4 \u2217 + f(t)\u03b4\u0304 ){ T k\u2217Vk\u2217 + f(t)V\u0304 + 2B \u221a VmaxE [N(t)\u2212 1] + 1 + Vmax } tE [N(t)\u2212 1]2\n\u2264\n( E [N(t)\u2212 1] \u03b4\u2217 + \u03b4\u2217 + f(t)\u03b4\u0304 ){ E [N(t)\u2212 1]Vk\u2217 + f(t)V\u0304 + 2B \u221a VmaxE [N(t)\u2212 1] + C0 } tE [N(t)\u2212 1]2\n\u2264 \u03b4 \u2217V \u2217\nt +\nC1 t \u221a E [N(t)\u2212 1] + C2f(t) + C3 tE [N(t)\u2212 1] + C4f 2(t) + C5f(t) + C6 tE [N(t)\u2212 1]2\n\u2264 \u03b4 \u2217V \u2217\nt +\n\u03b4 1/2 maxC1\nt \u221a t\u2212 \u03b4max\n+ \u03b4max(C2f(t) + C3) t(t\u2212 \u03b4max) + \u03b42max(C4f 2(t) + C5f(t) + C6) t(t\u2212 \u03b4max)2\n\u2264 \u03b4 \u2217V \u2217\nt +\nC t3/2 + C \u2032\u2032f(t) t2 + C \u2032\u2032\u2032f2(t) t3\n\u2264 \u03b4 \u2217V \u2217\nt +\nC t3/2 + C \u2032f(t) t2\nwhere C0, C1, C2, C3, C4, C5, C6, C, C \u2032, C \u2032\u2032, C \u2032\u2032\u2032 > 0 are appropriate constants depending on the problem parameters and cf , and in the first to last step we used t \u2265 2\u03b4max and f(t) \u2264 cf t in the last step. This finishes the proof of the second part of the lemma.\nCombining the above two lemmas the proof of Theorem 5 is straightforward. We apply the first inequality of Lemma 3 to D\u0302 = \u00b5\u0302(t)\u2212\u00b5 = S(t)/(N(t)\u22121)\u2212\u00b5 and the second inequality of the lemma to D\u0302\u2217 = \u00b5\u0302k\u2217(t)\u2212\u00b5 = Sk(t)/(Nk\u2217(t)\u22121)\u2212\u00b5. It is easy to see that P(N(t) = 1) and P(Nk\u2217(t) = 1) both decay exponentially fast, so the difference of the first terms is negligible. The difference of the second terms can be handled by Lemmas 4 and 5 and the bounds (15), (18) on E [Nk\u2217(t)], E [N(t)\u2212 1] (note that the lower bound on E [N(t)\u2212 1] can be simplified to t/(2\u03b4max) using t \u2265 2\u03b4max): introducing \u03bb\u2217(\u03b2) = E [Dk\u2217,1I{Dk\u2217,1 > \u03b2}] we obtain E [ (S(t)\u2212 (N(t)\u2212 1)\u00b5)2\n] E [N(t)\u2212 1]2 ( 1 + 2c\u221a E [N(t)\u2212 1] )2 \u2212 E [ (Sk\u2217(t)\u2212 (Nk\u2217(t)\u2212 1)\u00b5)2 ] E [Nk\u2217(t)\u2212 1]2 ( 1\u2212 2c\u221a E [Nk\u2217(t)\u2212 1] )\n\u2264 ( \u03b4\u2217V \u2217\nt +\nC t3/2 + C \u2032f(t) t2\n)( 1 + 2c \u221a\n2\u03b4max\u221a t\n)2 \u2212 ( \u03b4\u2217V \u2217\nt+ \u03b2 \u2212 2B\u03b4\n\u2217 \u221a \u03b4\u2217V \u2217\nt3/2 \u2212 V\n\u2217\u03bb\u2217(\u03b2)\nt\n) ( 1\u2212 c\n\u221a 2\u03b4\u2217\u221a t\n)\n=\n( \u03b4\u2217V \u2217\nt +\nC t3/2 + C \u2032f(t) t2\n)( 1 + 2c \u221a\n2\u03b4max\u221a t + 8c2\u03b4max t\n) \u2212 ( \u03b4\u2217V \u2217\nt+ \u03b2 \u2212 2B\u03b4\n\u2217 \u221a \u03b4\u2217V \u2217\nt3/2 \u2212 V\n\u2217\u03bb\u2217(\u03b2)\nt\n) ( 1\u2212 c\n\u221a 2\u03b4\u2217\u221a t\n)\n\u2264 \u03b2 \u03b4 \u2217V \u2217\nt(t+ \u03b2) + (c+ C \u2032\u2032)t\u22123/2 + C \u2032\u2032\u2032f(t)t\u22122 + C \u2032\u2032\u2032\u2032\u03bb\u2217(\u03b2)t\u22121\n\u2264 \u03b4\u2217V \u2217 \u03b2t\u22122 + (c+ C \u2032\u2032)t\u22123/2 + C \u2032\u2032\u2032f(t)t\u22122 + C \u2032\u2032\u2032\u2032\u03bb\u2217(\u03b2)t\u22121 ,\nwhere we used that by assumption c < \u221a t/(2\u03b4\u2217). Using E [Nk\u2217(t)\u2212 1] \u2265 t/(2\u03b4\u2217), the last term in the bound of Lemma 3\nfor E [ (\u00b5\u0302k\u2217(t)\u2212 \u00b5)2 ] becomes C1t\u22122E [ Nk\u2217(t) 2 ] P(Nk\u2217(t) > E [Nk\u2217(t)] + c \u221a E [Nk\u2217(t)\u2212 1]). By E [N(t)\u2212 1] \u2265\nt/(2\u03b4max), the indicator in the third line of the bound for E [ (\u00b5\u0302(t)\u2212 \u00b5)2 ] can be bounded as I{E [N(t)\u2212 1] < 4c2} \u2264\nI{t < 8\u03b4maxc2} which is zero since by assumption c < \u221a t/(8\u03b4max). Summing up our bounds and keeping the probability\nterms gives E [ (\u00b5\u0302(t)\u2212 \u00b5)2 ] \u2212 E [ (\u00b5\u0302k\u2217(t)\u2212 \u00b5)2 ] \u2264 \u00b52 {P(N(t) = 1)\u2212 P(Nk\u2217(t) = 1)}\n+ \u03b4\u2217V \u2217 \u03b2t\u22122 + (c+ C \u2032\u2032)t\u22123/2 + C \u2032\u2032\u2032f(t)t\u22122 + C \u2032\u2032\u2032\u2032\u03bb\u2217(\u03b2)t\u22121\n+ C1t \u22122E [ Nk\u2217(t) 2 ] P(Nk\u2217(t) > E [Nk\u2217(t)] + c \u221a E [Nk\u2217(t)\u2212 1])\n+ C2P(N(t) < E [N(t)]\u2212 c \u221a E [N(t)\u2212 1]) ,\nthus, finishing the proof."}, {"heading": "D. KL-Based Confidence Bound on Variance", "text": "The following lemma gives a variance estimate based on Kullback-Leibler divergence.\nLemma 6. Let Y1, . . . , Y2n and Q1, . . . , Qn be two independent sequences of independent and identically distributed random variables taking values in [0, 1]. Furthermore, for any t = 1, . . . , n, let\nV\u03042t = 1\n2t t\u2211 s=1 Qt(Y2s \u2212 Y2s\u22121)2. (23)\nThen, for any \u03b4 > 0,\nP [ \u222ant=1 { KL ( 2V\u03042t, 2E [Q1]V[Y1] ) \u2265 \u03b4 t }] \u2264 2ed\u03b4 log nee\u2212\u03b4 .\nProof. Equation (5) of Garivier (2013) states that if Z1, . . . , Zn are independent, identically distributed random variables taking values in [0, 1] and Z\u0304t = 1t \u2211t s=1 Zs for t = 1, . . . , n, then for any \u03b4 > 0,\nP [ \u222ant=1 { KL ( Z\u0304t,E [Z1] ) \u2265 \u03b4 t }] \u2264 2ed\u03b4 log nee\u2212\u03b4 .\nDefining Zt = Qt(Y2t \u2212 Y2t\u22121)2, we see that the above conditions on Zt are satisfied since they are clearly independent and identically distributed for t = 1, . . . , n, and Zt \u2208 [0, 1] since 0 \u2264 Qt, Y2t\u22121, Y2t \u2264 1. Now the statement of the lemma follows since E [Zt] = E [ Qt(Y2t \u2212 Y2t\u22121)2 ] = E [Qt]E [ ((Y2t \u2212 E [Y2t])\u2212 (Y2t\u22121 \u2212 EY2t\u22121))2 ] = 2E [Q1]V[Y1].\nCorollary 1. Let Y1, . . . , Y2n and Q1, . . . , Qn be two independent sequences of independent and identically distributed random variables taking values in [0, 1]. For any t = 2, . . . , n, let V\u0304t be defined by (23) if t is even, and let V\u0304t = V\u0304t\u22121 if t is odd. Furthermore, let\nV\u0304t,min = inf{\u00b5 : KL ( 2V\u0304t, 2\u00b5 ) \u2264 \u03b4/bt/2c}\nand V\u0304t,max = sup{\u00b5 : KL ( 2V\u0304t, 2\u00b5 ) \u2264 \u03b4/bt/2c}.\nThen for any \u03b4 > 0, with probability at least 1\u2212 2ed\u03b4 logbn/2cee\u2212\u03b4 ,\nmax 2\u2264t\u2264n V\u0304t,min \u2264 E [Q]V[Y ] \u2264 min 2\u2264t\u2264n V\u0304t,max ."}, {"heading": "E. Details on Synthetic Experiments", "text": "In considering alternative bounded payout distributions we evaluated 3 natural choices, truncated normal, uniform, and scaled-Bernoulli. The latter non-standard distribution is a transformation of a Bernoulli described by three parameters, a midpoint m \u2208 R, a scale s \u2208 R+, as well as a Bernoulli parameter p. Specifically, if X \u2208 {0, 1} is a Bernoulli random variable with parameter p then the transformation m + (X \u2212 0.5)s provides the corresponding scaled-Bernoulli sample. We conducted experiments using these different distributions, keeping their variances the same, in an attempt to ascertain whether the shape of the distribution might affect the performance of the various bandit allocation algorithms. However, we were unable to uncover an instance where the shape of the distribution had a non-negligible effect on performance. As a result, we decided to conduct our experiments using scaled-Bernoulli distributions as they permit the maximum range for the variance in an bounded interval."}, {"heading": "F. The Cox-Ingersoll-Ross Model", "text": "In the Cox-Ingersoll-Ross (CIR) model the interest rate at time t, denoted r(t), follows a square-root diffusion given by a stochastic differential equation of the form\ndr(t) = (\u03b7 \u2212 \u03bar(t))dt+ \u03c3 \u221a r(t)dW (t),\nwhere \u03b7, \u03ba and \u03c3 are fixed, problem-specific, constants andW is a standard one-dimensional Brownian motion. The payoff of an option for this rate at time T (maturity) is given as\nM max(r(T )\u2212K, 0),\nwhere the strike price K and nominee amount M are parameters of the option. The actual quantify of interest, the price of an option at time 0, is given as\nP\u0304 . = E [ exp(\u2212 \u222b T 0 r(t)dt)M max(r(T )\u2212K, 0) ] .\nThe above integrals may approximated with the Monte Carlo method by first discretizing the interest rate trajectory, r(t), into n points r1:n and simulating\nrt = rt\u22121 + (\u03b7 \u2212 \u03bart\u22121) T\nn + \u03c3\n\u221a rt\u22121 T\nn \u03b5t,\nwhere \u03b5t \u223c N (0, 1), and r0 is given. Given a set of N sampled trajectories, r(1:N)1:n , we may let\npi . = exp ( \u2212T n ( r (i) 1 + r (i) n 2 + n\u2211 t=1 r (i) t )) M max(r(i)n \u2212K, 0),\nand approximate using P\u0304 \u2248 1N \u2211N i=1 pi.\nAn important detail is that the value of the option is exactly zero when the interest rate is below the strike price at maturity. Consequently, when it comes to Monte Carlo simulation, we are less interested in simulating trajectories with lower interest rates. A standard way of exploiting this intuition is an importance sampling variant known as exponential twisting (see (Glasserman, 2003)). Here, instead of sampling the noise \u03b5t directly from the target density, N (0, 1), one uses a skewed proposal density, N (\u03b8, 1), defined by a single drift parameter, \u03b8 \u2208 R. Deriving the importance weights, wi . = exp(\u2212 \u2211n t=1 \u03b5 (i) t \u2212 n\u03b8 2 2 ), then, we arrive with the unbiased approximation P\u0304 \u2248 1 N \u2211N i=1 wipi."}, {"heading": "G. Bayesian Logistic Regression Example", "text": "We consider a standard Bayesian logistic regression model using a multivariate Gaussian prior. To set up the model, for y \u2208 {0, 1}, x \u2208 Rd, \u03b8 \u2208 Rd, let p(y|x, \u03b8) = \u03c3(\u03b8>x)y(1 \u2212 \u03c3(\u03b8>x))1\u2212y , where \u03c3 denotes the logit function and let p(\u03b8) = N (\u03b8; 0, 0.05I), i.e., the density of d dimensional Gaussian with mean 0 and covariance 0.05I . The labeled training examples (x1, y1), . . . , (xT , yT ) are assumed to be generated as follows: First, \u03b8\u2217 \u223c p(\u00b7) is chosen. The sequence (x1, y1), . . . , (xT , yT ) is assumed to be i.i.d. given \u03b8\u2217 and the labels are assumed to satisfy\nP(yt = 1|xt, \u03b8\u2217) = p(yt|xt, \u03b8\u2217) ,\ni.e., yt \u223c Ber(\u03c3(\u03b8>\u2217 xt)). The posterior distribution of \u03b8\u2217 given x1:T and y1:T then follows\npT (\u03b8) . =\n1 Z p0(\u03b8) T\u220f t=1 p(yt|xt, \u03b8)\nwhere the normalization constant is evaluated by integrating out \u03b8, that is\nZ = \u222b p0(\u03b8) T\u220f t=1 p(yt|xt, \u03b8) d\u03b8.\nIn our demonstrations we consider approximating this integral using Monte Carlo integration by drawing i.i.d. samples over \u03b8i for i = 1, ..., N using annealed importance sampling. To do so we first define an annealed target distribution\nfj(\u03b8) = f0(\u03b8) \u03b2jfn(\u03b8)\n1\u2212\u03b2j\nfor some 1 = \u03b21 > \u03b22 > ... > \u03b2n = 0, where fn(\u03b8) = p0(\u03b8), and posterior f0(\u03b8) = pT (\u03b8). The \u03b2j values are set using the power of 4 heuristic suggested by (Kuss & Rasmussen, 2005), that is, given a fixed number of annealing steps n we let \u03b21:n = {0, 1n\u22121 , 2 n\u22121 , ..., 1} 4.\nAdditionally, AIS requires that we specify a sequence of MCMC transitions to use at each annealing step. For this we found that slice sampling (Neal, 2003) moves were most effective (compared to Metropolis-Hastings, Langevin, and Hamiltonian MCMC (Neal, 2011) moves) in additional to being effectively parameter-free. If we let Ti(x, x\u2032) denote the slice sampling transition operator that meets detailed balance w.r.t. target fj , then the AIS algorithm is given by the following procedure:\n\u2022 generate \u03b8(n\u22121) \u223c fn(\u03b8);\n\u2022 generate \u03b8(n\u22122) from \u03b8(n\u22121) using Tn\u22121;\n\u2022 ...\n\u2022 generate \u03b8(1) from \u03b8(2) using T2;\n\u2022 generate \u03b8(0) from \u03b8(1) using T1.\nDefining\nw = fn\u22121(\u03b8\n(n\u22121))\nfn(\u03b8(n\u22121))\nfn\u22122(\u03b8 (n\u22122))\nfn\u22121(\u03b8(n\u22122)) \u00b7 \u00b7 \u00b7 f1(\u03b8\n(1))\nf2(\u03b8(1))\nf0(\u03b8 (0) f1(\u03b8(0))\nwe get that Z = E [w]."}], "references": [{"title": "Analysis of Thompson sampling for the multi-armed bandit problem", "author": ["S. Agrawal", "N. Goyal"], "venue": "In Conference on Learning Theory, pp", "citeRegEx": "Agrawal and Goyal,? \\Q2012\\E", "shortCiteRegEx": "Agrawal and Goyal", "year": 2012}, {"title": "From bandits to experts: A tale of domination and independence", "author": ["N. Alon", "N. Cesa-Bianchi", "C. Gentile", "Y. Mansour"], "venue": null, "citeRegEx": "Alon et al\\.,? \\Q2013\\E", "shortCiteRegEx": "Alon et al\\.", "year": 2013}, {"title": "Adaptive Monte Carlo technique, a variance reduction technique", "author": ["B. Arouna"], "venue": "Monte Carlo Methods and Applications,", "citeRegEx": "Arouna,? \\Q2004\\E", "shortCiteRegEx": "Arouna", "year": 2004}, {"title": "Regret bounds and minimax policies under partial monitoring", "author": ["J. Audibert", "S. Bubeck"], "venue": "Journal of Machine Learning Research,", "citeRegEx": "Audibert and Bubeck,? \\Q2010\\E", "shortCiteRegEx": "Audibert and Bubeck", "year": 2010}, {"title": "Exploration\u2013 exploitation tradeoff using variance estimates in multi-armed bandits", "author": ["J. Audibert", "R. Munos", "Szepesv\u00e1ri", "Cs"], "venue": "Theoretical Computer Science,", "citeRegEx": "Audibert et al\\.,? \\Q1876\\E", "shortCiteRegEx": "Audibert et al\\.", "year": 1876}, {"title": "Finite-time analysis of the multiarmed bandit problem", "author": ["P. Auer", "N. Cesa-Bianchi", "P. Fischer"], "venue": "Machine Learning,", "citeRegEx": "Auer et al\\.,? \\Q2002\\E", "shortCiteRegEx": "Auer et al\\.", "year": 2002}, {"title": "The nonstochastic multiarmed bandit problem", "author": ["P. Auer", "N. Cesa-Bianchi", "Y. Freund", "R. Schapire"], "venue": "SIAM Journal on Computing,", "citeRegEx": "Auer et al\\.,? \\Q2002\\E", "shortCiteRegEx": "Auer et al\\.", "year": 2002}, {"title": "Regret analysis of stochastic and nonstochastic multi-armed bandit problems", "author": ["S. Bubeck", "N. Cesa-Bianchi"], "venue": "Foundations and Trends in Machine Learning,", "citeRegEx": "Bubeck and Cesa.Bianchi,? \\Q2012\\E", "shortCiteRegEx": "Bubeck and Cesa.Bianchi", "year": 2012}, {"title": "Regret analysis of stochastic and nonstochastic multi-armed bandit problems", "author": ["S. Bubeck", "N. Cesa-Bianchi"], "venue": "arXiv preprint arXiv:1204.5721,", "citeRegEx": "Bubeck and Cesa.Bianchi,? \\Q2012\\E", "shortCiteRegEx": "Bubeck and Cesa.Bianchi", "year": 2012}, {"title": "Bandits with heavy tail", "author": ["S. Bubeck", "N. Cesa-Bianchi", "G. Lugosi"], "venue": "IEEE Transactions on Information Theory,", "citeRegEx": "Bubeck et al\\.,? \\Q2013\\E", "shortCiteRegEx": "Bubeck et al\\.", "year": 2013}, {"title": "Optimal adaptive policies for sequential allocation problems", "author": ["A. Burnetas", "M. Katehakis"], "venue": "Advances in Applied Mathematics,", "citeRegEx": "Burnetas and Katehakis,? \\Q1996\\E", "shortCiteRegEx": "Burnetas and Katehakis", "year": 1996}, {"title": "Kullback-Leibler upper confidence bounds for optimal sequential decision making", "author": ["O. Capp\u00e9", "A. Garivier", "O. Maillard", "R. Munos", "G. Stoltz"], "venue": "Annals of Statistics,", "citeRegEx": "Capp\u00e9 et al\\.,? \\Q2013\\E", "shortCiteRegEx": "Capp\u00e9 et al\\.", "year": 2013}, {"title": "Finite time analysis of stratified sampling for Monte Carlo", "author": ["A. Carpentier", "R. Munos"], "venue": "In NIPS-24,", "citeRegEx": "Carpentier and Munos,? \\Q2011\\E", "shortCiteRegEx": "Carpentier and Munos", "year": 2011}, {"title": "Minimax number of strata for online stratified sampling given noisy samples", "author": ["A. Carpentier", "R. Munos"], "venue": "In Algorithmic Learning Theory, pp", "citeRegEx": "Carpentier and Munos,? \\Q2012\\E", "shortCiteRegEx": "Carpentier and Munos", "year": 2012}, {"title": "Adaptive stratified sampling for Monte-Carlo integration of differentiable functions", "author": ["A. Carpentier", "R. Munos"], "venue": "In NIPS, pp", "citeRegEx": "Carpentier and Munos,? \\Q2012\\E", "shortCiteRegEx": "Carpentier and Munos", "year": 2012}, {"title": "Prediction, Learning, and Games", "author": ["N. Cesa-Bianchi", "G. Lugosi"], "venue": null, "citeRegEx": "Cesa.Bianchi and Lugosi,? \\Q2006\\E", "shortCiteRegEx": "Cesa.Bianchi and Lugosi", "year": 2006}, {"title": "An empirical evaluation of Thompson sampling", "author": ["O. Chapelle", "L. Li"], "venue": "In NIPS-24,", "citeRegEx": "Chapelle and Li,? \\Q2011\\E", "shortCiteRegEx": "Chapelle and Li", "year": 2011}, {"title": "A theory of the term structure of interest rates", "author": ["J. Cox", "J. Ingersoll Jr.", "S. Ross"], "venue": "Econometrica: Journal of the Econometric Society,", "citeRegEx": "Cox et al\\.,? \\Q1985\\E", "shortCiteRegEx": "Cox et al\\.", "year": 1985}, {"title": "Sequential Monte Carlo samplers", "author": ["P. Del Moral", "A. Doucet", "A. Jasra"], "venue": "Journal of the Royal Statistical Society: Series B (Statistical Methodology),", "citeRegEx": "Moral et al\\.,? \\Q2006\\E", "shortCiteRegEx": "Moral et al\\.", "year": 2006}, {"title": "Minimum variance importance sampling via population Monte Carlo", "author": ["R. Douc", "A. Guillin", "J. Marin", "C. Robert"], "venue": "ESAIM: Probability and Statistics,", "citeRegEx": "Douc et al\\.,? \\Q2007\\E", "shortCiteRegEx": "Douc et al\\.", "year": 2007}, {"title": "Informational confidence bounds for self-normalized averages and applications", "author": ["A. Garivier"], "venue": "IEEE Information Theory Workshop", "citeRegEx": "Garivier,? \\Q2013\\E", "shortCiteRegEx": "Garivier", "year": 2013}, {"title": "Probability: a graduate course", "author": ["A. Gut"], "venue": null, "citeRegEx": "Gut,? \\Q2005\\E", "shortCiteRegEx": "Gut", "year": 2005}, {"title": "Thompson sampling: An asymptotically optimal finite time analysis", "author": ["E. Kaufmann", "N. Korda", "R. Munos"], "venue": "In Algorithmic Learning Theory, pp", "citeRegEx": "Kaufmann et al\\.,? \\Q2012\\E", "shortCiteRegEx": "Kaufmann et al\\.", "year": 2012}, {"title": "Assessing approximate inference for binary gaussian process classification", "author": ["M. Kuss", "C. Rasmussen"], "venue": "The Journal of Machine Learning Research,", "citeRegEx": "Kuss and Rasmussen,? \\Q2005\\E", "shortCiteRegEx": "Kuss and Rasmussen", "year": 2005}, {"title": "Asymptotically efficient adaptive allocation rules", "author": ["T. Lai", "H. Robbins"], "venue": "Advances in Applied Mathematics,", "citeRegEx": "Lai and Robbins,? \\Q1985\\E", "shortCiteRegEx": "Lai and Robbins", "year": 1985}, {"title": "From bandits to experts: On the value of side-observations", "author": ["S. Mannor", "O. Shamir"], "venue": "In NIPS, pp", "citeRegEx": "Mannor and Shamir,? \\Q2011\\E", "shortCiteRegEx": "Mannor and Shamir", "year": 2011}, {"title": "Simulation studies in optimistic Bayesian sampling in contextual-bandit problems", "author": ["B. May", "D. Leslie"], "venue": "Technical report,", "citeRegEx": "May and Leslie,? \\Q2011\\E", "shortCiteRegEx": "May and Leslie", "year": 2011}, {"title": "Annealed importance sampling", "author": ["R. Neal"], "venue": "Technical report, University of Toronto,", "citeRegEx": "Neal,? \\Q2001\\E", "shortCiteRegEx": "Neal", "year": 2001}, {"title": "Estimating ratios of normalizing constants using linked importance sampling", "author": ["R. Neal"], "venue": "Technical report, University of Toronto,", "citeRegEx": "Neal,? \\Q2005\\E", "shortCiteRegEx": "Neal", "year": 2005}, {"title": "Handbook of Markov Chain Monte Carlo, chapter MCMC using Hamiltonian dynamics, pp. 113\u2013162", "author": ["R. Neal"], "venue": null, "citeRegEx": "Neal,? \\Q2011\\E", "shortCiteRegEx": "Neal", "year": 2011}, {"title": "Some aspects of the sequential design of experiments", "author": ["H. Robbins"], "venue": "Bulletin of the American Mathematical Society,", "citeRegEx": "Robbins,? \\Q1952\\E", "shortCiteRegEx": "Robbins", "year": 1952}, {"title": "Bayesian computational methods", "author": ["C. Robert"], "venue": null, "citeRegEx": "Robert,? \\Q2012\\E", "shortCiteRegEx": "Robert", "year": 2012}, {"title": "On the likelihood that one unknown probability exceeds another in view of the evidence of two samples", "author": ["W. Thompson"], "venue": null, "citeRegEx": "Thompson,? \\Q1933\\E", "shortCiteRegEx": "Thompson", "year": 1933}], "referenceMentions": [{"referenceID": 30, "context": "In the stochastic MAB problem (Robbins, 1952) the payoff for each action k \u2208 {1, 2, .", "startOffset": 30, "endOffset": 45}, {"referenceID": 30, "context": "The analysis of the stochastic MAB problem was pioneered by Lai & Robbins (1985) who showed that, when the payoff distributions are defined by a single parameter, the asymptotic regret of any sub-polynomially consistent policy (i.", "startOffset": 66, "endOffset": 81}, {"referenceID": 30, "context": "Lai & Robbins (1985) also presented an algorithm based on upper confidence bounds (UCB), which achieves a regret asymptotically matching the lower bound (for certain parametric distributions).", "startOffset": 6, "endOffset": 21}, {"referenceID": 5, "context": "Later, Auer et al. (2002a) proposed UCB1 (Algorithm 1), which broadens the practical use of UCB by dropping the Algorithm 1 UCB1 (Auer et al.", "startOffset": 7, "endOffset": 27}, {"referenceID": 5, "context": "Auer et al. (2002a) proved that, for any finite number of actions n, UCB1\u2019s regret is bounded by", "startOffset": 0, "endOffset": 20}, {"referenceID": 11, "context": "A more recent algorithm is KL-UCB (Capp\u00e9 et al., 2013), where the confidence bound for arm k is based on solving", "startOffset": 34, "endOffset": 54}, {"referenceID": 32, "context": "Another approach that has received significant recent interest is Thompson sampling (TS) (Thompson, 1933): a Bayesian method where actions are chosen randomly in proportion to the posterior probability that their mean payoff is optimal.", "startOffset": 89, "endOffset": 105}, {"referenceID": 22, "context": "Indeed, the finite time regret of TS under Bernoulli payoff distributions closely matches the lower bound (3) (Kaufmann et al., 2012):", "startOffset": 110, "endOffset": 133}, {"referenceID": 4, "context": "For example, Audibert et al. (2009) show that with default parameters, UCB1 and UCB-V will select suboptimal arms with probability \u03a9(1/n), making tP(N < E[N ]\u2212 c \u221a E[N ]) = \u03a9(t).", "startOffset": 13, "endOffset": 36}, {"referenceID": 19, "context": "In particular, following (Douc et al., 2007; Arouna, 2004), we consider the problem of pricing European call options under the assumption that the interest rate evolves in time according to the Cox-Ingersoll-Ross (CIR) model (Cox et al.", "startOffset": 25, "endOffset": 58}, {"referenceID": 2, "context": "In particular, following (Douc et al., 2007; Arouna, 2004), we consider the problem of pricing European call options under the assumption that the interest rate evolves in time according to the Cox-Ingersoll-Ross (CIR) model (Cox et al.", "startOffset": 25, "endOffset": 58}, {"referenceID": 17, "context": ", 2007; Arouna, 2004), we consider the problem of pricing European call options under the assumption that the interest rate evolves in time according to the Cox-Ingersoll-Ross (CIR) model (Cox et al., 1985), a popular model in mathematical finance (details provided in Appendix F).", "startOffset": 188, "endOffset": 206}, {"referenceID": 19, "context": "Importantly, the task of adaptively allocating trials between different importance sampling estimators has been previously studied on this problem, using an unrelated technique known as d-kernel Population Monte Carlo (PMC) (Douc et al., 2007).", "startOffset": 224, "endOffset": 243}, {"referenceID": 19, "context": "We approximated the option prices under the same parameter settings as (Douc et al., 2007), namely, \u03bd = 0.", "startOffset": 71, "endOffset": 90}, {"referenceID": 31, "context": "Evaluating such quantities is useful for a variety of purposes, such as Bayesian model comparison and testing/training set evaluation (Robert, 2012).", "startOffset": 134, "endOffset": 148}, {"referenceID": 28, "context": "However, the desired quantities are notoriously difficult to estimate in many important settings, due in no small part to the fact that popular high-dimensional Monte Carlo strategies, such as Markov Chain Monte Carlo (MCMC) methods, cannot be directly applied (Neal, 2005).", "startOffset": 261, "endOffset": 273}, {"referenceID": 27, "context": "Nevertheless, a popular approach for approximating such values is annealed importance sampling (AIS) (Neal, 2001) (or more generally sequential Monte Carlo samplers (Del Moral et al.", "startOffset": 101, "endOffset": 113}, {"referenceID": 1, "context": "This is the case for example when the samplers use importance sampling, leading to the (new) stochastic variant of the problem known as \u201cbandits with side-observations\u201d (Mannor & Shamir, 2011; Alon et al., 2013).", "startOffset": 169, "endOffset": 211}], "year": 2014, "abstractText": "We consider the problem of sequentially choosing between a set of unbiased Monte Carlo estimators to minimize the mean-squared-error (MSE) of a final combined estimate. By reducing this task to a stochastic multi-armed bandit problem, we show that well developed allocation strategies can be used to achieve an MSE that approaches that of the best estimator chosen in retrospect. We then extend these developments to a scenario where alternative estimators have different, possibly stochastic costs. The outcome is a new set of adaptive Monte Carlo strategies that provide stronger guarantees than previous approaches while offering practical advantages.", "creator": "LaTeX with hyperref package"}}}