{"id": "1501.00358", "review": {"conference": "arxiv", "VERSION": "v1", "DATE_OF_SUBMISSION": "2-Jan-2015", "title": "Comprehend DeepWalk as Matrix Factorization", "abstract": "Word2vec, as an efficient tool for learning vector representation of words has shown its effectiveness in many natural language processing tasks. Mikolov et al. issued Skip-Gram and Negative Sampling model for developing this toolbox. Perozzi et al. introduced the Skip-Gram model into the study of social network for the first time, and designed an algorithm named DeepWalk for learning node embedding on a graph. We prove that the DeepWalk algorithm is actually factoring a matrix M where each entry M_{ij} is logarithm of the average probability that node i randomly walks to node j in fix steps.", "histories": [["v1", "Fri, 2 Jan 2015 07:57:14 GMT  (4kb)", "http://arxiv.org/abs/1501.00358v1", "4 pages"]], "COMMENTS": "4 pages", "reviews": [], "SUBJECTS": "cs.LG", "authors": ["cheng yang", "zhiyuan liu"], "accepted": false, "id": "1501.00358"}, "pdf": {"name": "1501.00358.pdf", "metadata": {"source": "CRF", "title": "Comprehend DeepWalk as Matrix Factorization", "authors": ["Cheng Yang", "Zhiyuan Liu"], "emails": ["cheng-ya14@mails.tsinghua.edu.cn", "liuzy@tsinghua.edu.cn"], "sections": [{"heading": null, "text": "ar X\niv :1\n50 1.\n00 35\n8v 1\n[ cs\n.L G\n] 2\nJ an\n2 01"}, {"heading": "1 Notation", "text": "Network G = (V,E). Node-context set D is generated from random walk, where each piece of D is a node-context pair (v, c). V is the set of nodes and VC is the set of context nodes. In most cases, V = VC .\nConsider a node-context pair (v, c): #(v, c) denotes the number of times (v, c) appears inD. #(v) = \u2211 c\u2032\u2208VC\n#(v, c\u2032) and #(c) = \u2211 v\u2032\u2208V #(v\n\u2032, c) denotes the number of times v and c appears in D. Note that |D| = \u2211 v\u2032\u2208V \u2211 c\u2032\u2208VC #(v\u2032, c\u2032).\nDeepWalk algorithm embeds a node v into a d-dimension vector \u2212\u2192v \u2208 Rd. Also, a context node c \u2208 VC is represented by a d-dimension vector\n\u2212\u2192c \u2208 Rd. Let W be a |V | \u00d7 d matrix where row i is vector \u2212\u2192vi and H be a |VC | \u00d7 d matrix where row j is vector \u2212\u2192cj . Our goal is to figure out a matrix M = WH T ."}, {"heading": "2 Proof", "text": "Perozzi et al. implemented DeepWalk algorithm with Skip-Gram and Hierarchical Softmax model. Note that Hierarchical Softmax [5] [4] is a variant of softmax for speeding the training time. In this section, we give proofs for both Negative Sampling and softmax with Skip-Gram model."}, {"heading": "2.1 Negative Sampling", "text": "Negative Sampling approximately maximizes the probability of softmax function by randomly choosing k negative samples from context set. Levy and\nGoldberg showed that Skip-Gram with Negative Sampling model(SGNS) is implicitly factorizing a word-context matrix [1] by assuming that dimensionality d is sufficiently large. In other words, we can assign each product \u2212\u2192v \u00b7 \u2212\u2192c a value independently of the others.\nIn SGNS model, we have\nP ((v, c) \u2208 D) = \u03c3(\u2212\u2192v \u00b7 \u2212\u2192c ) = 1\n1 + e\u2212 \u2212\u2192v \u00b7\u2212\u2192c\nSuppose we choose k negative samples for each node-context pair (v, c) according to the distribution PD(cN ) = #(cN) |D| . Then the objective function for SGNS can be written as\nl = \u2211\nv\u2208V\n\u2211\nc\u2208VC\n#(v, c)(log \u03c3(\u2212\u2192v \u00b7 \u2212\u2192c ) + k \u00b7 EcN\u223cPD [log \u03c3(\u2212 \u2212\u2192v \u00b7 \u2212\u2192c )])\n= \u2211\nv\u2208V\n\u2211\nc\u2208VC\n#(v, c)(log \u03c3(\u2212\u2192v \u00b7 \u2212\u2192c ) + k \u00b7 \u2211\nv\u2208V\n#(v) \u2211\ncN\u2208VC\n#(cN )\n|D| log \u03c3(\u2212\u2212\u2192v \u00b7 \u2212\u2192c )\n= \u2211\nv\u2208V\n\u2211\nc\u2208VC\n(#(v, c)(log \u03c3(\u2212\u2192v \u00b7 \u2212\u2192c ) + k \u00b7#(v) \u00b7 #(c)\n|D| log \u03c3(\u2212\u2212\u2192v \u00b7 \u2212\u2192c )\nDenote x = \u2212\u2192v \u00b7 \u2212\u2192c . By solving \u2202l\u2202x = 0, we have\n\u2212\u2192v \u00b7 \u2212\u2192c = x = log #(v, c) \u00b7 |D|\n#(v) \u00b7#(c) \u2212 log k\nThus we have Mij = log #(vi,cj) |D|\n#(vi) |D| \u00b7 #(cj) |D|\n\u2212 log k. Mij can be interpreted as Point-\nwise Mutual Information(PMI) of node-context pair (vi, cj) shifted by log k."}, {"heading": "2.2 Softmax", "text": "Since both Negative Sampling and Hierarchical Softmax are variants of softmax, we pay more attention to softmax model and give a further discussion in next section. We also assume that the values of \u2212\u2192v \u00b7 \u2212\u2192c are independent.\nIn softmax model,\nP ((v, c) \u2208 D) = e \u2212\u2192v \u00b7\u2212\u2192c\n\u2211 c\u2032\u2208VC e \u2212\u2192v \u00b7 \u2212\u2192 c\u2032\nAnd the objective function is\nl = \u2211\nv\u2208V\n\u2211\nc\u2208VC\n#(v, c) \u00b7 log e \u2212\u2192v \u00b7\u2212\u2192c\n\u2211 c\u2032\u2208VC e \u2212\u2192v \u00b7 \u2212\u2192 c\u2032\nAfter extracting all terms associated to \u2212\u2192v \u00b7 \u2212\u2192c as l(v, c), we have\nl(v, c) = #(v, c) log e \u2212\u2192v \u00b7\u2212\u2192c\n\u2211 c\u2032\u2208VC ,c\u2032 6=c e \u2212\u2192v \u00b7 \u2212\u2192 c\u2032 + e \u2212\u2192v \u00b7\u2212\u2192c +\n\u2211\nc\u0303\u2208VC ,c\u03036=c\n#(v, c\u0303) log e \u2212\u2192v \u00b7\n\u2212\u2192 c\u0303\n\u2211 c\u2032\u2208VC ,c\u2032 6=c e \u2212\u2192v \u00b7 \u2212\u2192 c\u2032 + e \u2212\u2192v \u00b7\u2212\u2192c\nNote that l = 1|VC | \u2211 v\u2208V \u2211 c\u2208VC l(v, c). Denote x = \u2212\u2192v \u00b7 \u2212\u2192c . By solving \u2202l\u2202x = 0 for all such x, we have\n\u2212\u2192v \u00b7 \u2212\u2192c = x = log #(v, c)\n#(v) + bv\nwhere bv can be any real constant since it will be canceled when we compute P ((v, c) \u2208 D). Thus we have Mij = log #(vi,cj) #(vi)\n+ bvi . We will discuss what Mij represents in next section."}, {"heading": "3 Discussion", "text": "It is clear that the method of sampling node-context pairs will affect matrix\nM . In this section, we will discuss #(v)|D| , #(c) |D| and #(v,c) #(v) based on an ideal sampling method for DeepWalk algorithm. Assume the graph is connected and undirected and window size is t. We can easily generalize this sampling method to directed graph by only adding (RWi, RWj) into D.\nAlgorithm 1 Ideal node-context pair sampling algorithm\nGenerate an infinite long random walk RW . Denote RWi as the node on position i of RW , where i = 0, 1, 2, . . . for i = 0, 1, 2, . . . do for j \u2208 [i+ 1, i+ t] do add (RWi, RWj) into D add (RWj , RWi) into D\nend for\nend for\nEach appearance of node i will be recorded 2t times in D for undirected graph and t times for directed graph. Thus we can figure out that #(vi)|D| is the frequency of vi appears in the random walk, which is exactly the PageRank value of vi. Also note that #(vi,vj) #(vi)/2t is the expectation times that vj is observed in left/right t neighbors of vi. Denote the transition matrix in PageRank algorithm be A. More formally, let di be the degree of node i. Aij = 1 di\nif (i, j) \u2208 E and Aij = 0 otherwise. We use ei to denote a |V |-dimension row vector where all entries are zero except the i-th entry is 1.\nSuppose that we start a random walk from node i and use ei to denote the initial state. Then eiA is the distribution over all the nodes where j-th entry is the probability that node i walks to node j. Hence j-th entry of eiA\nt is the probability that node i walks to node j at exactly t steps. Thus [ei(A + A\n2 + \u00b7 \u00b7 \u00b7+At)]j is the expectation times that vj appears in right t neighbors of vi.\nHence\n#(vi, vj) #(vi)/2t = 2[ei(A+A 2 + \u00b7 \u00b7 \u00b7+At)]j\n#(vi, vj)\n#(vi) = [ei(A+A 2 + \u00b7 \u00b7 \u00b7+At)]j t\nThis equality also holds for directed graph. By setting bvi = log 2t for all i, Mij = log #(vi,vj) #(vi)/2t is logarithm of the expec-\ntation times that vj appears in left/right t neighbors of vi.\nBy setting bvi = 0 for all i, Mij = log #(vi,vj) #(vi) = log [ei(A+A 2+\u00b7\u00b7\u00b7+At)]j t is logarithm of the average probability that node i randomly walks to node j in t steps."}], "references": [{"title": "Neural word embedding as implicit matrix factorization", "author": ["O. Levy", "Y. Goldberg"], "venue": "In Advances in Neural Information Processing Systems,", "citeRegEx": "1", "shortCiteRegEx": "1", "year": 2014}, {"title": "Efficient estimation of word representations in vector space", "author": ["T. Mikolov", "K. Chen", "G. Corrado", "J. Dean"], "venue": "arXiv preprint arXiv:1301.3781,", "citeRegEx": "2", "shortCiteRegEx": "2", "year": 2013}, {"title": "Distributed representations of words and phrases and their compositionality", "author": ["T. Mikolov", "I. Sutskever", "K. Chen", "G.S. Corrado", "J. Dean"], "venue": "In Advances in Neural Information Processing Systems,", "citeRegEx": "3", "shortCiteRegEx": "3", "year": 2013}, {"title": "A scalable hierarchical distributed language model", "author": ["A. Mnih", "G.E. Hinton"], "venue": "In Advances in neural information processing systems,", "citeRegEx": "4", "shortCiteRegEx": "4", "year": 2009}, {"title": "Hierarchical probabilistic neural network language model", "author": ["F. Morin", "Y. Bengio"], "venue": "In AISTATS,", "citeRegEx": "5", "shortCiteRegEx": "5", "year": 2005}, {"title": "Deepwalk: Online learning of social representations", "author": ["B. Perozzi", "R. Al-Rfou", "S. Skiena"], "venue": "arXiv preprint arXiv:1403.6652,", "citeRegEx": "6", "shortCiteRegEx": "6", "year": 2014}], "referenceMentions": [{"referenceID": 1, "context": "Abstract Word2vec [2], as an efficient tool for learning vector representation of words has shown its effectiveness in many natural language processing tasks.", "startOffset": 18, "endOffset": 21}, {"referenceID": 2, "context": "issued Skip-Gram and Negative Sampling model [3] for developing this toolbox.", "startOffset": 45, "endOffset": 48}, {"referenceID": 5, "context": "introduced the Skip-Gram model into the study of social network for the first time, and designed an algorithm named DeepWalk [6] for learning node embedding on a graph.", "startOffset": 125, "endOffset": 128}, {"referenceID": 4, "context": "Note that Hierarchical Softmax [5] [4] is a variant of softmax for speeding the training time.", "startOffset": 31, "endOffset": 34}, {"referenceID": 3, "context": "Note that Hierarchical Softmax [5] [4] is a variant of softmax for speeding the training time.", "startOffset": 35, "endOffset": 38}, {"referenceID": 0, "context": "Goldberg showed that Skip-Gram with Negative Sampling model(SGNS) is implicitly factorizing a word-context matrix [1] by assuming that dimensionality d is sufficiently large.", "startOffset": 114, "endOffset": 117}], "year": 2015, "abstractText": "Word2vec [2], as an efficient tool for learning vector representation of words has shown its effectiveness in many natural language processing tasks. Mikolov et al. issued Skip-Gram and Negative Sampling model [3] for developing this toolbox. Perozzi et al. introduced the Skip-Gram model into the study of social network for the first time, and designed an algorithm named DeepWalk [6] for learning node embedding on a graph. We prove that the DeepWalk algorithm is actually factoring a matrix M where each entry Mij is logarithm of the average probability that node i randomly walks to node j in fix steps. We will explain it in section 3. 1 Notation Network G = (V,E). Node-context set D is generated from random walk, where each piece of D is a node-context pair (v, c). V is the set of nodes and VC is the set of context nodes. In most cases, V = VC . Consider a node-context pair (v, c): #(v, c) denotes the number of times (v, c) appears inD. #(v) = \u2211 c\u2208VC #(v, c) and #(c) = \u2211 v\u2032\u2208V #(v , c) denotes the number of times v and c appears in D. Note that |D| = \u2211 v\u2032\u2208V \u2211 c\u2208VC #(v, c). DeepWalk algorithm embeds a node v into a d-dimension vector \u2212\u2192v \u2208 R. Also, a context node c \u2208 VC is represented by a d-dimension vector \u2212\u2192c \u2208 R. Let W be a |V | \u00d7 d matrix where row i is vector vi and H be a |VC | \u00d7 d matrix where row j is vector cj . Our goal is to figure out a matrix M = WH T . 2 Proof Perozzi et al. implemented DeepWalk algorithm with Skip-Gram and Hierarchical Softmax model. Note that Hierarchical Softmax [5] [4] is a variant of softmax for speeding the training time. In this section, we give proofs for both Negative Sampling and softmax with Skip-Gram model. 2.1 Negative Sampling Negative Sampling approximately maximizes the probability of softmax function by randomly choosing k negative samples from context set. Levy and", "creator": "LaTeX with hyperref package"}}}