{"id": "1505.03036", "review": {"conference": "ICML", "VERSION": "v1", "DATE_OF_SUBMISSION": "12-May-2015", "title": "Removing systematic errors for exoplanet search via latent causes", "abstract": "We describe a method for removing the effect of confounders in order to reconstruct a latent quantity of interest. The method, referred to as half-sibling regression, is inspired by recent work in causal inference using additive noise models. We provide a theoretical justification and illustrate the potential of the method in a challenging astronomy application.", "histories": [["v1", "Tue, 12 May 2015 14:49:08 GMT  (2838kb,D)", "http://arxiv.org/abs/1505.03036v1", "Extended version of a paper appearing in the Proceedings of the 32nd International Conference on Machine Learning, Lille, France, 2015"]], "COMMENTS": "Extended version of a paper appearing in the Proceedings of the 32nd International Conference on Machine Learning, Lille, France, 2015", "reviews": [], "SUBJECTS": "stat.ML astro-ph.EP astro-ph.IM cs.LG", "authors": ["bernhard sch\u00f6lkopf", "david w hogg", "dun wang", "daniel foreman-mackey", "dominik janzing", "carl-johann simon-gabriel", "jonas peters"], "accepted": true, "id": "1505.03036"}, "pdf": {"name": "1505.03036.pdf", "metadata": {"source": "META", "title": "Removing systematic errors for exoplanet search via latent causes", "authors": ["Bernhard Sch\u00f6lkopf", "David W. Hogg", "Dun Wang", "Daniel Foreman-Mackey", "Dominik Janzing", "Jonas Peters"], "emails": ["BS@TUEBINGEN.MPG.DE", "DAVID.HOGG@NYU.EDU", "DW1519@NYU.EDU", "FOREMAN.MACKEY@GMAIL.COM", "DOMINIK.JANZING@TUEBINGEN.MPG.DE", "CARL-JOHANN.SIMON-GABRIEL@TUEBINGEN.MPG.DE", "JONAS.PETERS@TUEBINGEN.MPG.DE"], "sections": [{"heading": "1. Introduction", "text": "The present paper proposes and analyzes a method for removing the effect of confounding noise. The analysis is based on a hypothetical underlying causal structure. The method does not infer causal structures; rather, it is influenced by a recent thrust to try to understand how causal structures facilitate machine learning tasks (Scho\u0308lkopf et al., 2012).\nCausal graphical models as pioneered by Pearl (2000); Spirtes et al. (1993) are joint probability distributions over a set of variables X1, . . . , Xn, along with directed graphs (usually, acyclicity is assumed) with vertices Xi, and arrows indicating direct causal influences. By the causal Markov assumption, each vertex Xi is independent of its non-descendants, given its parents.\nThere is an alternative view of causal models, which does\nExtended version of a paper appearing in the Proceedings of the 32nd International Conference on Machine Learning, Lille, France, 2015. JMLR: W&CP volume 37. Copyright 2015 by the author(s).\nnot start from a joint distribution. Instead, it assumes a set of jointly independent noise variables, one for each vertex, and a \u201cstructural equation\u201d for each variable that describes how the latter is computed by evaluating a deterministic function of its noise variable and its parents. This view, referred to as a functional causal model (or nonlinear structural equation model), leads to the same class of joint distributions over all variables (Pearl, 2000; Peters et al., 2014), and we may thus choose either representation.\nThe functional point of view is useful in that it often makes it easier to come up with assumptions on the causal mechanisms that are at work, i.e., on the functions associated with the variables. For instance, it was recently shown (Hoyer et al., 2009) that assuming nonlinear functions with additive noise renders the two\u2013variable case identifiable \u2014 i.e., a case where conditional independence tests do not provide any information, and it was thus previously believed that it is impossible to infer the structure of the graph based on observational data.\nIn this work we start from the functional point of view and assume the underlying causal graph shown in Fig. 1. Here, N,Q,X, Y are jointly random variables (RVs) (i.e., RVs defined on the same underlying probability space), taking values denoted by n, q, x, y. We do not require the ranges of the random variables to be R, in particular, they may be vectorial. All equalities regarding random variables should be interpreted to hold with probability one. We further (implicitly) assume the existence of conditional expectations.\nNote that while the causal motivation was helpful for our work, one can also view Fig. 1 as a DAG (directed acyclic graph) without causal interpretation, i.e., as a directed a graphical model. We need Q and X (and in some cases\nar X\niv :1\n50 5.\n03 03\n6v 1\n[ st\nat .M\nL ]\nalso N ) to be independent, which follows from the given structure no matter whether one views this as a causal graph or as a graphical model.\nIn the next section, we present the method. Section 3 describes the application and provides experimental results, and Section 4 summarizes our conclusions."}, {"heading": "2. Half-Sibling Regression", "text": "Suppose we are interested in the quantity Q, but unfortunately we cannot observe it directly. Instead, we observe Y , which we think of as a degraded version of Q that is affected by noise N . Clearly, without knowledge of N , there is no way to recover Q. However, we assume that N also affects another observable quantity (or a collection of quantities) X . By the graph structure, conditional on Y , the variables Q and X are dependent (in the generic case), thus X contains information about Q. This situation is quite common if X and Y are measurements performed with the same apparatus, introducing the noise N . In the physical sciences, this is often referred to as systematics, to convey the intuition that these errors are not simply due to random fluctuations, but caused by systematic influences of the measuring device. In our application below, both types of errors occur, but we will not try to tease them apart. Our method addresses errors that affect both X and Y , for instance by acting on N , no matter whether we call them random or systematic.\nHow can we use this information in practice? Unfortunately, without further restrictions, this problem is still too hard. Suppose that N randomly switches between {1, . . . , v}, where v \u2208 N (Scho\u0308lkopf et al., 2012). Define the structural equation fY for the variable Y as follows: y = fY (n, q) := fn(q), where f1, . . . , fv are v distinct functions that compute Y from Q \u2014 in other words, we randomly switch between v different mechanisms. Clearly, no matter how many pairs (x, y) we observe, we can choose a sufficiently large v along with functions f1, . . . , fv such\nthat there is no way of gleaning any reliable information on Q from the fi(Q) \u2014 e.g., there may be more fi than there were data points. Things could get even worse: for instance, N could be real valued, and switch between an uncountable number of functions. To prevent this kind of behavior, we need to simplify the way in which Y is allowed to depend on N .\nBefore we do so, we need to point out a fundamental limitation. The above example shows that it can be arbitrarily hard to get information about Q from finite data. However, even from infinite data, only partial information is available and certain \u201cgauge\u201d degrees of freedom remain.1 In particular, given a reconstructed Q, we can always construct another one by applying an invertible transformation to it, and incorporating its inverse into the function computing Y from Q and N . This includes the possibility of adding an offset, which we will see below.\nWe next propose an assumption which allows for a practical method to solve the problem of reconstructing Q up to the above gauge freedom. The method is surprisingly simple, and while we have not seen it in the same form elsewhere, we do not want to claim originality for it. Related tricks are occasionally applied in practice, often employing factor analysis to account for confounding effects (Price et al., 2006; Yu et al., 2006; Johnson & Li, 2007; Kang et al., 2008; Stegle et al., 2008; Gagnon-Bartsch & Speed, 2011). We will also present a theoretical analysis that provides insight into why and when these methods work."}, {"heading": "2.1. Complete Information", "text": "Inspired by recent work in causal inference, we use nonlinear additive noise models (Hoyer et al., 2009). Specifically, we assume that there exists a function f such that\nY = Q+ f(N). (1)\nNote that we could equally well assume the more general form Y = g(Q) + f(N), and the following analysis would look the same. However, in view of the above remark about the gauge freedom, this is not necessary sinceQ can at most be identified up to a (nonlinear) reparametrization anyway. Note, moreover, that while for Hoyer et al. (2009), the input of f is observed and we want to decide if it is a cause of Y , in the present setting the input of f is unobserved (Janzing et al., 2009), and the goal is to recover Q, which for Hoyer et al. (2009) played the role of the noise.\nThe intuition behind our approach is as follows. Since X \u22a5 Q, X cannot predict Q, and thus neither Q\u2019s influence on Y . It may contain information, however, about the\n1This means that there are some degrees of freedom in the parametrization of the model which do not affect the observable model.\ninfluence ofN on Y , sinceX is also influenced byN . Now suppose we try to predict Y from X . As argued above, whatever comes from Q cannot be predicted, hence only the component coming from N will be picked up. Trying to predict Y from X is thus a vehicle to selectively capture N \u2019s influence on Y , with the goal of subsequently removing it, to obtain an estimate of Q referred to as Q\u0302:\nDefinition 1 Q\u0302 := Y \u2212 E[Y |X] (2)\nFor an additive model (1), our intuition can be formalized: in this case, we can predict the additive component in Y coming from N \u2014 which is exactly what we want to remove to cancel the confounding effect of N and thus reconstruct Q (up to an offset):\nProposition 1 Suppose N,X are jointly random variables, and f is a measurable function. If there exists a function \u03c8 such that\nf(N) = \u03c8(X), (3)\ni.e., f(N) can in principle be predicted from X perfectly, then we have\nf(N) = E[f(N)|X]. (4)\nIf, moreover, the additive model assumption (1) holds, with Q,Y RVs on the same underlying probability space, and Q \u22a5 X , then\nQ\u0302 = Q\u2212 E[Q]. (5)\nIn our main application below, N will be systematic errors from an astronomical spacecraft and telescope, Y will be a star under analysis, and X will be a large set of other stars. In this case, the assumption that f(N) = \u03c8(X) has a concrete interpretation: it means that the device can be self-calibrated based on measured science data only (Padmanabhan et al., 2008).\nProof. Due to (3), we have\nE[f(N)|X] = E[\u03c8(X)|X] = \u03c8(X) = f(N). (6)\nTo show the second statement, consider the conditional expectation\nE[Y |X] = E[Q+ f(N)|X] (7)\nUsing Q \u22a5 X and (4), we get\nE[Y |X] = E[Q] + f(N) = E[Q] + Y \u2212Q. (8)\nRecalling Definition 1 completes the proof.\nProposition 1 provides us with a principled recommendation how to remove the effect of the noise and reconstruct the unobserved Q up to its mean E[Q]: we need to subtract the conditional expectation (i.e., the regression) E[Y |X] from the observed Y (Definition 1). The regression E[Y |X] can be estimated from observations (xi, yi) using (linear or nonlinear) off-the-shelf methods. We refer to this procedure as half-sibling regression to reflect the fact that we are trying to explain aspects of the child Y by regression on its half-sibling(s) X in order to reconstruct properties of its unobserved parent Q.\nNote that m(x) := E[f(N)|X = x] is a function of x, and E[f(N)|X] is the random variable m(X). Correspondingly, (4) is an equality of RVs. By assumption, all RVs live on the same underlying probability space. If we perform the associated random experiment, we obtain values for X andN , and (4) tells us that if we substitute them intom and f , respectively, we get the same value with probability 1. Eq. (5) is also an equality of RVs, and the above procedure therefore not only reconstructs some properties of the unobservable RV Q \u2014 it reconstructs, up to the mean E[Q], and with probability 1, the RV itself. This may sound too good to be true \u2014 in practice, of course its accuracy will depend on how well the assumptions of Proposition 1 hold.\nIf the following conditions are met, we may expect that the procedure should work well in practice:\n(i) X should be (almost) independent of Q \u2014 otherwise, our method could possibly remove parts of Q itself, and thus throw out the baby with the bathtub. A sufficient condition for this to be the case is that N be (almost) independent of Q, which often makes sense in practice, e.g., if N is introduced by a measuring device in a way independent of the underlying object being measured. Clearly, we can only hope to remove noise that is independent of the signal, otherwise it would be unclear what is noise and what is signal. A sufficient condition for N \u22a5 Q, finally, is that the causal DAG in Fig. 1 correctly describes the underlying causal structure. Note, however, that Proposition 1 and thus our method also applies if N 6\u22a5 Q, as long as X \u22a5 Q.\n(ii) The observable X is chosen such that Y can be predicted as well as possible from it; i.e., X contains enough information about f(N) and, ideally,N acts on bothX and Y in similar ways such that a \u201csimple\u201d function class suffices for solving the regression problem in practice. This may sound like a rather strong requirement, but we will see that in our astronomy application, it is not unrealistic: X will be a large vector of pixels of other stars, and we will use them to predict a pixel Y of a star of interest. In this kind of problem, the main variability of Y will often be due to the systematic effects due to the instrument N also affecting other stars, and thus a large set of other stars will\nindeed allow a good prediction of the measured Y .\nNote that it is not required that the underlying structural equation model be linear \u2014 N can act on X and Y in nonlinear ways, as an additive term f(N).\nIn practice, we never observe N directly, and thus it is hard to tell whether the assumption of perfect predictability of f(N) from X holds true. We now relax this assumption."}, {"heading": "2.2. Incomplete Information", "text": "First we observe that E[f(N)|X] is a good approximation for f(N) whenever f(N) is almost determined by X:\nLemma 2 For any two jointly random variables Z,X , we have\nE[(Z \u2212 E[Z|X])2] = E[Var[Z|X]]. (9)\nHere, E[Z|X] is the random variable g(X) with g(x) = E[Z|X = x], and Var[Z|X] is the random variable h(X) with h(x) = Var[Z|X = x]. Then (9) turns into\nE[(Z \u2212 g(X))2] = E[h(X)] . (10)\nProof. Note that for any random variable Z we have\nVar[Z|X = x] = E[(Z \u2212 E[Z|X = x])2|X = x] ,\nby the definition of variance, applied to the variableZ|X=x. Hence\nVar[Z|X] = E[(Z \u2212 E[Z|X])2|X] ,\nwhere both sides are functions of X . Taking the expectation w.r.t. X on both sides yields\nE[Var[Z|X]] = E[(Z \u2212 E[Z|X])2] ,\nwhere we have used the law of total expectation E[E[W |X]] = E[W ] on the right hand side.\nThis leads to a stronger result for our estimator Q\u0302 (2):\nProposition 3 Let f be measurable, N,Q,X, Y jointly random variables with Q \u22a5 X , and Y = Q + f(N). The expected squared deviation between Q\u0302 and Q \u2212 E[Q] satisfies\nE[(Q\u0302\u2212 (Q\u2212 E[Q]))2] = E[Var[f(N)|X]] . (11)\nProof. We rewrite the argument of the square in (11) as\nQ\u0302\u2212 (Q\u2212 E[Q]) = Y \u2212 E[Y |X]\u2212Q+ E[Q] = f(N) +Q\u2212 E[f(N)|X]\u2212 E[Q|X]\u2212Q+ E[Q] = f(N)\u2212 E[f(N)|X].\nHere, the last step uses E[Q|X] = E[Q], which follows from Q \u22a5 X .\nThe result follows using Lemma 2 with Z := f(N).\nNote that Proposition 1 is a special case of Proposition 3: if there exists a function \u03c8 such that \u03c8(X) = f(N), then the r.h.s. of (11) vanishes. Proposition 3 drops this assumption, which is more realistic: consider the case where X = g(N) + R, where R is another random variable. In this case, we cannot expect to reconstruct the variable f(N) from X exactly.\nThere are, however, two settings where we would still expect good approximate recovery of Q:\n(i) If the standard deviation of R goes to zero, the signal of N inX becomes strong and we can approximately estimate f(N) from X , see Proposition 4.\n(ii) Alternatively, we observe many different effects of N . In the astronomy application below, Q and R are stars, from which we get noisy observations Y and X . Proposition 5 below shows that observing many different Xi helps reconstructing Q, even if all Xi depend on N through different functions gi and their underlying (independent) signals Ri do not follow the same distribution. The intuition is that with increasing number of variables the independent Ri \u201caverage\u201d out, and thus it becomes easier to reconstruct the effect of N .\nProposition 4 Assume that Y = Q+ f(N) and let\nXs := g(N) + s \u00b7R ,\nwhere R, N and Q are jointly independent, f \u2208 C1b (R), g \u2208 C1(R), s \u2208 R, and g is invertible. Then\nQ\u0302s L2\u2192 Q\u2212 E[Q] as s\u2192 0 ,\nwhere Q\u0302s := Y \u2212 E[Y |Xs].\nProof. We have for s\u2192 0 that\ns \u00b7R P\u2192 0 \u21d2 g(N) + s \u00b7R\u2212 g(N) P\u2192 0 \u2217\u21d2 g\u22121 (g(N) + s \u00b7R)\u2212N P\u2192 0 \u2217\u21d2 f ( g\u22121 (g(N) + s \u00b7R) ) \u2212 f(N) P\u2192 0\n\u21d2 \u03c8s(Xs)\u2212 f(N) P\u2192 0\nfor some \u03c8s that is bounded in s (the implications \u2217 follow from the continuous mapping theorem).2 This implies\nE[f(N)|Xs]\u2212 f(N) L 2 \u2192 0\n2The notation P\u2192 denotes convergence in probability with respect to the measure P of the underlying probability space.\nbecause\nE[(f(N)\u2212 E[f(N)|Xs])2] \u2264 E[(f(N)\u2212 \u03c8s(Xs))2]\u21920\n(L2 convergence follows because f is bounded). But then\nQ\u2212 E[Q]\u2212 Q\u0302s = \u2212f(N)\u2212 E[Q] + E[f(N) +Q|Xs]\n= E[f(N)|Xs]\u2212 f(N) L 2 \u2192 0\nProposition 5 Assume that Y = Q+f(N) and that Xd := (X1, . . . , Xd) satisfies\nXi := gi(N) +Ri, i = 1, . . . , d,\nwhere all Ri, N and Q are jointly independent,\u2211\u221e i=1 1 i2 var(Ri) < \u221e, f \u2208 C 1 b (R), gi \u2208 C1(R) for all i, and\ng\u0303d := 1\nd d\u2211 j=1 gj\nis invertible with (g\u0303\u22121d )d uniformly equicontinuous. Then\nQ\u0302d L2\u2192 Q\u2212 E[Q] as d\u2192\u221e ,\nwhere we define Q\u0302d := Y \u2212 E[Y |Xd].\nProof. By Kolmogorov\u2019s strong law, we have for\n\u00b5\u0304d := 1\nd d\u2211 i=1 E[Ri]\nthat\n1 d \u2211d i=1Ri \u2212 \u00b5\u0304d\nP\u2192 0\n\u21d2 1d \u2211d i=1(gi(N) +Ri)\u2212 \u00b5\u0304d \u2212 g\u0303d(N) P\u2192 0\n\u2217\u21d2 g\u0303\u22121d ( 1 d \u2211d i=1(gi(N) +Ri)\u2212 \u00b5\u0304d ) \u2212 g\u0303\u22121d (g\u0303d(N)) P\u2192 0\n\u21d2 g\u0303\u22121d ( 1 d \u2211d i=1Xi \u2212 \u00b5\u0304d ) \u2212N P\u2192 0\n\u2217\u2217\u21d2 f ( g\u0303\u22121d ( 1 d \u2211d i=1Xi \u2212 \u00b5\u0304d )) \u2212 f(N) P\u2192 0\n\u21d2 \u03c8d(Xd)\u2212 f(N) P\u2192 0\nfor some \u03c8d that are uniformly bounded in d (the implication \u2217 follows from uniform equicontinuity, implication \u2217\u2217 by the continuous mapping theorem). This implies\nE[f(N)|Xd]\u2212 f(N) L2\u2192 0\nbecause\nE[(f(N)\u2212 E[f(N)|Xd])2] \u2264 E[(f(N)\u2212 \u03c8d(Xd))2]\u21920\n(The convergence of the right hand side follows from \u03c8d(Xd)\u2212f(N)\nP\u2192 0 and boundedness of\u03c8d(Xd)\u2212f(N)). But then\nQ\u2212 E[Q]\u2212 Q\u0302d = \u2212f(N)\u2212 E[Q] + E[f(N) +Q|Xd]\n= E[f(N)|Xd]\u2212 f(N) L2\u2192 0\nThe next two subsections discuss optional extensions of our approach. Readers who are mainly interested in the application may prefer to move to Section 3 directly."}, {"heading": "2.3. Time Series", "text": "Above, we have worked with random variables and assumed that the regression is performed on i.i.d. data drawn from those random variables. However, in practice we also encounter problems where the data are drawn from random processes depending on time.\nConsider a causal graph with an additional confounder T representing time, see Figure 2, and assume that the signals R and Q have a time series structure. This representation becomes necessary if R and Q share a strong periodicity, for example. If we want to retain this periodicity, we should not simply regress Y on X .\nIn many applications the signals may have a time structure but we expect R and Q as well as Q and N to be independent. We further assume that the signals R and Q will normally not share any strong frequencies. In those situations the representation shown in Figure 3 may be more appropriate. Because of the independence between Q and R, we can proceed as before and estimate Qt as the residuals after regressing Yt from Xt (we could even allow N to have a time structure, too). The graph structure shows that after including Xt as a predictor for Yt, all other Xt+h, h 6= 0 may contain further information about Yt. Note however, that this dependence decreases quickly\nwith increasing |h|, especially when the contribution of Rt to Xt is small compared to the contribution of Nt to Xt. Still, in some simulation settings, including different time lags Xt+h, h \u2208 {. . . ,\u22121, 0, 1, . . .} into the model for Yt improves the performance of the method (in terms of reconstructing Q) compared to predicting Yt only from Xt (results not shown). We expect that identifiability statements similar to the i.i.d. case may hold (see sections 2.1 and 2.2)."}, {"heading": "2.4. Prediction from Non-Effects of the Noise Variable", "text": "While Fig. 1 shows the causal structure motivating our work, our method does not require a directed arrow from N to X \u2014 it only requires that N 6\u22a5 X , to ensure that X contains information about N . We can represent this by an undirected connection between the two (Fig. 4), and note that such a dependence may arise from an arrow directed in either direction, and/or another confounder that influences both N and X . This confounder need not act deterministically on N , hence effectively removing our earlier requirement of a deterministic effect, cf. (1)."}, {"heading": "3. Applications", "text": ""}, {"heading": "3.1. Synthetic Data", "text": "We analyze two simulated data sets that illustrate the identifiability statements from Sections 2.1 and 2.2.\nIncreasing relative strength of N in a single X . We consider 20 instances (each time we sample 200 i.i.d. data\npoints) of the model Y = f(N) +Q and X = g(N) +R, where f and g are randomly chosen sigmoid functions and the variables N , Q and R are normally distributed. The standard deviation for R is chosen uniformly between 0.05 and 1, the standard deviation for N is between 0.5 and 1. Because Q can be recovered only up to a shift in the mean, we set its sample mean to zero. The distribution for R, however, has a mean that is chosen uniformly between \u22121 and 1 and its standard deviation is chosen from the vector (1, 0.5, 0.25, 0.125, 0.0625, 0.03125, 0). Proposition 4 shows that with decreasing standard deviation of R we can recover the signal Q. Standard deviation zero corresponds to the case of complete information (Section 2.1). For regressing Y on X , we use the function gam (penalized regression splines) from the R-package mgcv; Figure 5 shows that this asymptotic behavior can be seen on finite data sets.\nIncreasing number of observedXi variables. Here, we consider the same simulation setting as before, this time simulating Xi = gi(N) + Ri for i = 1, . . . , p. We have shown in Proposition 5 that if the number of variables Xi tends to infinity, we are able to reconstruct the signal Q. In this experiment, the standard deviation for Ri and Q is chosen uniformly between 0.05 and 1; The distribution of N is the same as above. It is interesting to note that even additive models (in the predictor variables) work as a regression method (we use the function gam from the R-package mgcv on all variables X1, . . . , Xp and its sum X1 + . . .+Xp). Figure 5 shows that with increasing p the reconstruction of Q improves."}, {"heading": "3.2. Exoplanet Light Curves", "text": "The field of exoplanet search has recently become one of the most popular areas of astronomy research. This is largely due to the Kepler space observatory launched in 2009. Kepler observed a tiny fraction of the Milky Way in search of exoplanets. The telescope was pointed at same patch of sky for more than four years (Fig. 6 and 7). In that patch, it monitored the brightness of 150000 stars (selected from among 3.5 million stars in the search field), taking a stream of half-hour exposures using a set of CCD (ChargeCoupled Device) imaging chips arranged in its focal plane using the layout visible in Fig. 7.\nKepler detects exoplanets using the transit method. Whenever a planet passes in front of their host star(s), we observe a tiny dip in the light curve (Fig. 8). This signal is rather faint, and for our own planet as seen from space, it would amount to a brightness change smaller than 10\u22124, lasting less than half a day, taking place once a year, and visible\nfrom about half a percent of all directions. The level of required photometric precision to detect such transits is one of the main motivations for performing these observations in space, where they are not disturbed by atmospheric effects, and it is possible to observe the same patch almost continuously using the same instrument.\nFor planets orbiting stars in the habitable zone (allowing for liquid water) of stars similar to the sun, we would expect the signal to be observable at most every few months. We thus have very few observations of each transit. However, it has become clear that there is a number of confounders introduced by spacecraft and telescope that lead to systematic changes in the light curves which are of the same magnitude or larger than the required accuracy. The dominant error is pointing jitter: if the camera field moves by a tiny fraction of a pixel (for Kepler, the order of magnitude is 0.01 pixels), then the light distribution on the pixels will change. Each star affects a set of pixels (Fig. 9), and we integrate their measurements to get an estimate of the star\u2019s overall brightness. Unfortunately, the pixel sensitivities are not precisely identical, and even though one can try to correct for this, we are left with significant systematic errors. Overall, although Kepler is highly optimized for stable photometric measurements, its accuracy falls short of what is required for reliably detecting earth-like planets in habitable zones of sun-like stars.\nWe obtained the data from the Mikulski Archive for Space Telescopes (MAST) (see http://archive.stsci. edu/index.html). Our system, which we abbreviate as CPM (Causal Pixel Model), is based on the assumption that stars on the same CCD share systematic errors. If we pick two stars on the same CCD that are far away from each other, they will be light years apart in space and no physical interaction between them can take place. As Fig. 9 shows, the light curves nevertheless have similar trends, which is caused by systematics. In CPM, we use linear regression to predict the light curve of each pixel belonging to the target star as a linear combination of a set of predictor pixels. Specifically, we use 4000 predictor pixels from about 150\nstars, which are selected to be closest in magnitude to the target star.3 This is done since the systematic effects of the instruments depend somewhat on the star brightness; e.g., when a star saturates a pixel, blooming takes place and the signal leaks to neighboring pixels. To rule out any direct optical cross-talk by stray light, we require that the predictor pixels are from stars sufficiently far away from the target star (at least 20 pixels distance on the CCD), but we always take them from the same CCD (note that Kepler has a number of CCDs, and we expect that systematic errors depend on the CCD). We train the model separately for each month, which contains about 1300 data points.4 Standard L2 regularization is employed to avoid overfitting, and parameters (regularization strength and number of input pixels) were optimized using cross-validation. Nonlinear kernel regression was also evaluated, but did not lead to better results. This may be due to the fact that the set of predictor pixels is relatively large (compared to the training set size); and among this large set, it seems that there are sufficiently many pixels who are affected by the systematics in a rather similar way as the target.\nWe have observed in our results that the method removes some of the intrinsic variability of the target star. This is due to the fact that the signals are not i.i.d. and time acts as a confounder. If among the predictor stars, there exists one whose intrinsic variability is very similar to the target star, then the regression can attenuate variability in the latter. This is unlikely to work exactly, but given the limited observation window, an approximate match (e.g., stars varying at slightly different frequencies) will already lead to some amount of attenuation. Since exoplanet transits are very rare, it is extremely unlikely (but not impossible) that the same mechanism will remove some transits.\nNote that for the purpose of exoplanet search, the stellar variability can be considered a confounder as well, independent of the planet positions which are causal for transits. In order to remove this, we use as additional regression inputs also past and future of the target star. This adds an autoregressive (AR) component to our model, removing more of the stellar variability and thus increasing the sensitivity for transits. In this case, we select an exclusion window around the point of time being corrected, to ensure that we do not remove the transit itself. Below, we report results where the AR component uses as inputs the three closest future and the three closest past time points, subject to the constraint that a window of \u00b19 hours around the considered time point is excluded. Choosing this window corresponds to the assumption that time points earlier\n3The exact number of stars varies with brightness, as brighter stars have larger images on the CCD and thus more pixels.\n4The data come in batches which are separated by larger errors, since the spacecraft needs to periodically re-direct its antenna to send the data back to earth.\nthan -9 hours or later than +9 hours are not informative for the transit itself. Smaller windows allow more accurate prediction, at the risk of damaging slow transit signals. Our code is available at https://github.com/ jvc2688/KeplerPixelModel.\nTo give a view on how our method performs, CPM is applied on several stars with known transit signals. After that, we compare them with the Kepler Pre-search Data Conditioning (PDC) method (see http://keplergo. arc.nasa.gov/PipelinePDC.shtml). PDC builds on the idea that systematic errors have a temporal structure that can be extracted from ancillary quantities. The first version of PDC removed systematic errors based on correlations with a set of ancillary engineering data, including temperatures at the detector electronics below the CCD array, and polynomials describing centroid motions of stars. The current PDC (Stumpe et al., 2012; Smith et al., 2012) performs PCA on filtered light curves of stars, projects the light curve of the target star on a PCA subspace, and subsequently removes this projection. The PCA is performed on a set of relatively quiet stars close in position and magnitude. For non-i.i.d. data, this procedure could remove temporal structure of interest. To prevent this, the PCA subspace is restricted to eight dimensions, strongly limiting the capacity of the model (cf. Foreman-Mackey et al., 2015).\nIn Fig. 10, we present corrected light curves for three typical stars of different magnitudes, using both CPM and PDC. Note that in our theoretical analysis, we dealt with additive noise, and could deal with multiplicative noise, e.g., by log transforming. In practice, none of the two models is correct for our application. If we are interested in the transit (and not the stellar variability), then the variability is a multiplicative confounder. At the same time, other noises may better be modeled as additive (e.g., CCD noise). In practice, we calibrate the data by dividing by the regression estimate and then subtracting 1, i.e.,\nY E[Y |x] \u2212 1 = Y E[Y |x] \u2212 E[Y |x] E[Y |x] = Y \u2212 E[Y |x] E[Y |x] .\nEffectively, we thus perform a subtractive normalization, followed by a divisive one. This worked well, taking care of both types of contaminations.\nThe results illustrate that our approach removes a major part of the variability present in the PDC light curves, while preserving the transit signals. To provide a quantitative comparison, we ran CPM on 1000 stars from the whole Kepler input catalog (500 chosen randomly from the whole list, and 500 random G-type sun-like stars), and estimate the Combined Differential Photometric Precision (CDPP) for CPM and PDC. CDPP is an estimate of the relative precision in a time window, indicating the noise level seen by\na transit signal with a given duration. The duration is typically chosen to be 3, 6, or 12 hours (Christiansen et al., 2012). Shorter durations are appropriate for planets close to their host stars, which are the ones that are easier to detect. We use the 12-hours CDPP metric, since the transit duration of an earth-like planet is roughly 10 hours. Fig. 11 presents our CDPP comparison of CPM and PDC, showing that our method outperforms PDC. This is no small feat, since PDC is highly optimized for the task at hand, incorporating substantial astronomical knowledge (e.g., it attempts to remove stellar variability as well as systematic trends)."}, {"heading": "4. Conclusion", "text": "We have assayed half-sibling regression, a simple yet effective method for removing the effect of systematic noise from observations. It utilizes the information contained in a set of other observations affected by the same noise source. The main motivation for the method was its application to exoplanet data processing, which we discussed in some detail, with rather promising results. However, we expect that it will have a large range of applications in other domains as well.\nWe expect that our method may enable astronomical discoveries at higher sensitivity on the existing Kepler satellite data. Moreover, we anticipate that methods to remove systematic errors will further increase in importance: by May 2013, two of the four reaction wheels used to control the Kepler spacecraft were disfunctional, and in May 2014, NASA announced the K2 mission, using the remaining two wheels in combination with thrusters to control the spacecraft and continue the search for exoplanets in other star fields. Systematic errors in K2 data are significantly larger\nsince the spacecraft has become harder to control. In addition, NASA is planning the launch of another space telescope for 2017. TESS (Transiting Exoplanet Survey Satellite)5 will perform an all-sky survey for small (earth-like) planets of nearby stars. To date, no earth-like planets orbiting sun-like stars in the habitable zone have been found. This is likely to change in the years to come, which would be a major scientific discovery.6 In particular, while the proposed method treats the problem of removing systematic errors as a preprocessing step, we are also exploring the possibility of jointly modeling systematics and transit events. This incorporates additional knowledge about the events that are looking for in our specific application, and it has already led to promising results (Foreman-Mackey et al., 2015)."}, {"heading": "Acknowledgments", "text": "We thank Stefan Harmeling, James McMurray, Oliver Stegle and Kun Zhang for helpful discussion, and the anonymous reviewers for helpful suggestions and references. C-J S-G was supported by a Google Europe Doctoral Fellowship in Causal Inference.\n5http://tess.gsfc.nasa.gov/ 6\u201cDecades, or even centuries after the TESS survey is completed, the new planetary systems it discovers will continue to be studied because they are both nearby and bright. In fact, when starships transporting colonists first depart the solar system, they may well be headed toward a TESS-discovered planet as their new home.\u201d (Haswell, 2010)"}], "references": [{"title": "A systematic search for transiting planets in the K2 data", "author": ["D. Foreman-Mackey", "B.T. Montet", "D.W. Hogg", "T.D. Morton", "D. Wang", "B. Sch\u00f6lkopf"], "venue": null, "citeRegEx": "Foreman.Mackey et al\\.,? \\Q2015\\E", "shortCiteRegEx": "Foreman.Mackey et al\\.", "year": 2015}, {"title": "Transiting Exoplanets", "author": ["Haswell", "Carole A"], "venue": null, "citeRegEx": "Haswell and A.,? \\Q2010\\E", "shortCiteRegEx": "Haswell and A.", "year": 2010}, {"title": "Nonlinear causal discovery with additive noise models", "author": ["P.O. Hoyer", "D. Janzing", "J.M. Mooij", "J. Peters", "B. Sch\u00f6lkopf"], "venue": "Advances in Neural Information Processing Systems,", "citeRegEx": "Hoyer et al\\.,? \\Q2009\\E", "shortCiteRegEx": "Hoyer et al\\.", "year": 2009}, {"title": "Identifying confounders using additive noise models", "author": ["D. Janzing", "J. Peters", "J. Mooij", "B. Sch\u00f6lkopf"], "venue": "25th Conference on Uncertainty in Artificial Intelligence,", "citeRegEx": "Janzing et al\\.,? \\Q2009\\E", "shortCiteRegEx": "Janzing et al\\.", "year": 2009}, {"title": "Adjusting batch effects in microarray expression data using empirical Bayes methods", "author": ["W.E. Johnson", "C. Li"], "venue": null, "citeRegEx": "Johnson and Li,? \\Q2007\\E", "shortCiteRegEx": "Johnson and Li", "year": 2007}, {"title": "An Improved Photometric Calibration of the Sloan Digital Sky Survey Imaging Data", "author": ["R.H. Lupton", "S. Roweis", "S.A. Snedden", "M.A. Strauss", "D.L. Tucker"], "venue": "The Astrophysical Journal,", "citeRegEx": "C. et al\\.,? \\Q2008\\E", "shortCiteRegEx": "C. et al\\.", "year": 2008}, {"title": "Causal discovery with continuous additive noise models", "author": ["J. Peters", "J.M. Mooij", "D. Janzing", "B. Sch\u00f6lkopf"], "venue": "Journal of Machine Learning Research,", "citeRegEx": "Peters et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Peters et al\\.", "year": 2014}, {"title": "On causal and anticausal learning", "author": ["B. Sch\u00f6lkopf", "D. Janzing", "J. Peters", "E. Sgouritsa", "K. Zhang", "J.M. Mooij"], "venue": "Proceedings of the 29th International Conference on Machine Learning (ICML),", "citeRegEx": "Sch\u00f6lkopf et al\\.,? \\Q2012\\E", "shortCiteRegEx": "Sch\u00f6lkopf et al\\.", "year": 2012}, {"title": "Causation, prediction, and search", "author": ["P. Spirtes", "C. Glymour", "R. Scheines"], "venue": null, "citeRegEx": "Spirtes et al\\.,? \\Q2000\\E", "shortCiteRegEx": "Spirtes et al\\.", "year": 2000}, {"title": "Accounting for non-genetic factors improves the power of eQTL studies", "author": ["Stegle", "Oliver", "Kannan", "Anitha", "Durbin", "Richard", "Winn", "John M"], "venue": "In Proc. Research in Computational Molecular Biology, 12th Annual International Conference,", "citeRegEx": "Stegle et al\\.,? \\Q2008\\E", "shortCiteRegEx": "Stegle et al\\.", "year": 2008}], "referenceMentions": [{"referenceID": 7, "context": "The method does not infer causal structures; rather, it is influenced by a recent thrust to try to understand how causal structures facilitate machine learning tasks (Sch\u00f6lkopf et al., 2012).", "startOffset": 166, "endOffset": 190}, {"referenceID": 8, "context": "Causal graphical models as pioneered by Pearl (2000); Spirtes et al. (1993) are joint probability distributions over a set of variables X1, .", "startOffset": 54, "endOffset": 76}, {"referenceID": 6, "context": "This view, referred to as a functional causal model (or nonlinear structural equation model), leads to the same class of joint distributions over all variables (Pearl, 2000; Peters et al., 2014), and we may thus choose either representation.", "startOffset": 160, "endOffset": 194}, {"referenceID": 2, "context": "For instance, it was recently shown (Hoyer et al., 2009) that assuming nonlinear functions with additive noise renders the two\u2013variable case identifiable \u2014 i.", "startOffset": 36, "endOffset": 56}, {"referenceID": 7, "context": ", v}, where v \u2208 N (Sch\u00f6lkopf et al., 2012).", "startOffset": 18, "endOffset": 42}, {"referenceID": 9, "context": "Related tricks are occasionally applied in practice, often employing factor analysis to account for confounding effects (Price et al., 2006; Yu et al., 2006; Johnson & Li, 2007; Kang et al., 2008; Stegle et al., 2008; Gagnon-Bartsch & Speed, 2011).", "startOffset": 120, "endOffset": 247}, {"referenceID": 2, "context": "Inspired by recent work in causal inference, we use nonlinear additive noise models (Hoyer et al., 2009).", "startOffset": 84, "endOffset": 104}, {"referenceID": 3, "context": "(2009), the input of f is observed and we want to decide if it is a cause of Y , in the present setting the input of f is unobserved (Janzing et al., 2009), and the goal is to recover Q, which for Hoyer et al.", "startOffset": 133, "endOffset": 155}, {"referenceID": 2, "context": "Note, moreover, that while for Hoyer et al. (2009), the input of f is observed and we want to decide if it is a cause of Y , in the present setting the input of f is unobserved (Janzing et al.", "startOffset": 31, "endOffset": 51}, {"referenceID": 2, "context": "Note, moreover, that while for Hoyer et al. (2009), the input of f is observed and we want to decide if it is a cause of Y , in the present setting the input of f is unobserved (Janzing et al., 2009), and the goal is to recover Q, which for Hoyer et al. (2009) played the role of the noise.", "startOffset": 31, "endOffset": 261}, {"referenceID": 0, "context": "This incorporates additional knowledge about the events that are looking for in our specific application, and it has already led to promising results (Foreman-Mackey et al., 2015).", "startOffset": 150, "endOffset": 179}], "year": 2015, "abstractText": "We describe a method for removing the effect of confounders in order to reconstruct a latent quantity of interest. The method, referred to as halfsibling regression, is inspired by recent work in causal inference using additive noise models. We provide a theoretical justification and illustrate the potential of the method in a challenging astronomy application.", "creator": "LaTeX with hyperref package"}}}