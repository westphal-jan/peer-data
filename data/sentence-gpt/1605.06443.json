{"id": "1605.06443", "review": {"conference": "NIPS", "VERSION": "v1", "DATE_OF_SUBMISSION": "20-May-2016", "title": "Structured Prediction Theory Based on Factor Graph Complexity", "abstract": "We present a general theoretical analysis of structured prediction. By introducing a new complexity measure that explicitly factors in the structure of the output space and the loss function, we are able to derive new data-dependent learning guarantees for a broad family of losses and for hypothesis sets with an arbitrary factor graph decomposition. We extend this theory by leveraging the principle of Voted Risk Minimization (VRM) and showing that learning is possible with complex factor graphs, for instance, by a simplified linear algebra algorithm. In addition, we can demonstrate that a simplified linear algebra algorithm is capable of solving the prediction system without a dependence on the complexity of the input space. This results in a new approach to prediction that provides an alternative alternative model for the problem. We hope that in the near future, we will be able to expand this model to include more models of a new problem and provide further proof of its applicability to prediction models.\n\n\n\n\n\nReferences [ edit ]", "histories": [["v1", "Fri, 20 May 2016 17:21:17 GMT  (1461kb,D)", "http://arxiv.org/abs/1605.06443v1", null], ["v2", "Thu, 1 Dec 2016 17:02:48 GMT  (1485kb,D)", "http://arxiv.org/abs/1605.06443v2", null]], "reviews": [], "SUBJECTS": "stat.ML cs.LG", "authors": ["corinna cortes", "vitaly kuznetsov", "mehryar mohri", "scott yang"], "accepted": true, "id": "1605.06443"}, "pdf": {"name": "1605.06443.pdf", "metadata": {"source": "CRF", "title": "Structured Prediction Theory Based on Factor Graph Complexity", "authors": ["Corinna Cortes", "Vitaly Kuznetsov"], "emails": ["corinna@google.com", "vitaly@cims.nyu.edu", "mohri@cims.nyu.edu", "yangs@cims.nyu.edu"], "sections": [{"heading": "1 Introduction", "text": "Structured prediction encompasses a broad family of important learning problems. These include key tasks in natural language processing such as part-of-speech processing, parsing, machine translation, and named-entity recognition, along with important areas in computer vision such as image processing and object recognition, and also crucial areas in speech processing such as pronunciation modeling and speech recognition.\nIn all these problems, the output space admits some structure. This may be a sequence of tags as in part-of-speech tagging, a parse tree as in context-free parsing, an acyclic graph as in dependency parsing, or labels of image segments as in object detection. Another unifying theme is that the natural loss function for each of these tasks admits a decomposition along the output substructures. For instance, the loss function can be the Hamming loss as in part-of-speech tagging, or it may be the edit-distance which is widely used in natural language and speech processing.\nThe output structure and the corresponding loss function make these problems significantly different from the (unstructured) binary classification problems extensively studied in learning theory. In recent years, a number of different algorithms have been designed for structured prediction, including conditional random field (CRF) [Lafferty et al., 2001], StructSVM [Tsochantaridis et al., 2005], Maximum-Margin Markov Network [Taskar et al., 2003], and search-based approaches such as [Daum\u00e9 III et al., 2009, Doppa et al., 2014, Lam et al., 2015, Chang et al., 2015, Ross et al., 2011]. More recently, deep learning techniques have also been developed for a variety of tasks such as part-of-speech tagging [Jurafsky and Martin, 2009, Vinyals et al., 2015a], named-entity recognition\n29th Conference on Neural Information Processing Systems (NIPS 2016), Barcelona, Spain.\nar X\niv :1\n60 5.\n06 44\n3v 1\n[ st\nat .M\nL ]\n[Nadeau and Sekine, 2007], machine translation [Zhang et al., 2008], image segmentation [Lucchi et al., 2013], and image annotation [Vinyals et al., 2015b].\nHowever, in contrast to the plethora of algorithms, there have been relatively few studies devoted to the theoretical understanding of structured prediction problems [Bakir et al., 2007]. Existing structured prediction learning guarantees hold only for specific decomposable losses such as the Hamming loss [Taskar et al., 2003, Cortes et al., 2014, London et al., 2013, Collins, 2001] and do not cover many other natural loss functions, such as the edit-distance. They also typically apply only to specific factor graph models. The sole exception is the work of McAllester [2007], which provides PAC-Bayesian guarantees for arbitrary losses, although it is only in the special case of randomized algorithms using linear (count-based) hypotheses.\nThis paper presents a general theoretical analysis of structured prediction with a series of new results. We give new data-dependent learning guarantees for structured prediction for a broad family of loss functions and hypothesis sets with an arbitrary factor graph decomposition. Our guarantees are based on a new complexity measure, which we show can be estimated in terms of familiar quantities for several commonly used hypothesis sets. Our bounds also match or improve upon the best-known bounds in several special cases.\nWe further introduce a new framework for structured prediction based on the principle of Voted Risk Minimization (VRM), which discriminates between the complexity of different subfamilies within the full set of features. We present new learning bounds for this scenario and design two new families of algorithms, Voted Conditional Random Fields (VCRF) and Voted Structured Boosting (StructBoost) that directly benefit from these guarantees. These algorithms can make use of features selected out of a union of very complex sub-families, while still preserving the ability to generalize well. As proof of concept validating our theory, we report experimental results for the VCRF algorithm on multiple datasets.\nThe paper is organized as follows. In Section 2 we introduce the notation and definitions relevant to our discussion of structure prediction. In Section 3, we derive a series of new learning guarantees for structured prediction, which are then used to prove the VRM principle in Section 4. Section 5 develops the algorithmic framework which is directly based on our theory. In Section 6, we provide some preliminary experimental results that serve as a proof of concept for our theory."}, {"heading": "2 Preliminaries", "text": "Let X denote the input space and Y the output space. In structured prediction, the output space may be a set of sequences, images, graphs, parse trees, lists, or some other (typically discrete) objects admitting some structure. By this, we mean that the output structure can be decomposed into l substructures. For example, this may be l positions along a sequence, so that the output space Y is decomposable along these substructures: Y = Y1 \u00d7 \u00b7 \u00b7 \u00b7 \u00d7 Yl. Here, Yk is the set of possible labels (or classes) that can assigned to substructure k.\nLoss functions. We denote by L : Y \u00d7 Y \u2192 R+ a loss function measuring the dissimilarity of two elements of the output space Y . We will assume that the loss function L is definite, that is L(y, y\u2032) = 0 iff y = y\u2032. This assumption holds for all loss functions commonly used in structured prediction. A key aspect of structured prediction is that the loss function can be decomposed along the substructures Yk. As an example, L may be the Hamming loss defined by L(y, y\u2032) = 1l \u2211l k=1 1yk 6=y\u2032k for all y = (y1, . . . , yl) and y\u2032 = (y\u20321, . . . , y \u2032 l), with yk, y \u2032 k \u2208 Yk. In the common case where Y is a set of sequences defined over a finite alphabet, L may be the edit-distance, which is widely used in natural language and speech processing applications, with possibly different costs associated to insertions, deletions and substitutions. L may also be a loss based on the negative inner product of the vectors of n-gram counts of two sequences, or its negative logarithm. Such losses have been used to approximate the BLEU score loss in machine translation. There are other losses defined in computational biology based on various string-similarity measures. Our theoretical analysis is general and applies to arbitrary bounded and definite loss functions.\nScoring functions and factor graphs. We will adopt the common approach in structured prediction where predictions are based on a scoring function mapping X \u00d7 Y to R. Let H be a family of scoring functions. For any h \u2208 H, we denote by h the predictor defined by h: for any x \u2208 X , h(x) = argmaxy\u2208Y h(x, y).\nFurthermore, we will assume, as is standard in structured prediction, that each function h \u2208 H can be decomposed as a sum. We will consider the most general case for such decompositions, which can be made explicit using the notion of factor graphs.1 A factor graph G is a tuple G = (V, F,E), where V are variable nodes, F factor nodes, and E a set of undirected edges between a variable node and a factor node. In our context, V can be identified with the set of substructure indices, that is V = {1, . . . , l}. For any factor node f , denote by N(f) \u2286 V the set of variable nodes connected to f via an edge and define Yf as the substructure set cross-product Yf = \u220f k\u2208N(f) Yk. Then, h admits the following decomposition as a sum of functions hf , each taking as argument an element of the input space x \u2208 X and an element of Yf , yf \u2208 Yf :\nh(x, y) = \u2211\nf\u2208F hf (x, yf ). (1)\nFigure 1 illustrates this definition with two different decompositions.\nMore generally, we will consider the setting in which a factor graph may depend on a particular example xi: G(xi, yi) = Gi = ([li], Fi, Ei). A special case of this setting is for example when the size li (or length) of each example is allowed to vary and where the number of possible labels |Y| is even infinite.\nWe present other examples of such hypothesis sets and their decomposition in Section 3, where we discuss our learning guarantees. Note that such hypothesis setsH with an additive decomposition are those commonly used in most structured prediction algorithms [Tsochantaridis et al., 2005, Taskar et al., 2003, Lafferty et al., 2001]. This is largely motivated by the computational requirement for efficient training and inference. Our results, while very general, further provide a statistical learning motivation for such decompositions.\nLearning scenario. We consider the familiar supervised learning scenario where the training and test points are drawn i.i.d. according to some distribution D over X \u00d7 Y . We will further adopt the standard definitions of margin, generalization error and empirical error. The margin \u03c1h(x, y) of a hypothesis h for a labeled example (x, y) \u2208 X \u00d7 Y is defined by\n\u03c1h(x, y) = h(x, y)\u2212max y\u2032 6=y h(x, y\u2032). (2)\nLet S = ((x1, y1), . . . , (xm, ym)) be a training sample of size m drawn from Dm. We denote by R(h) the generalization error and by R\u0302S(h) the empirical error of h over S:\nR(h) = E (x,y)\u223cD [L(h(x), y)] and R\u0302S(h) = E (x,y)\u223cS [L(h(x), y)], (3)\nwhere the notation (x, y)\u223cS indicates that (x, y) is drawn according to the empirical distribution defined by S. The learning problem consists of using the sample S to select a hypothesis h \u2208 H with small expected loss R(h).\nObserve that the definiteness of the loss function implies, for all x \u2208 X , the following: L(h(x), y) = L(h(x), y) 1\u03c1h(x,y)\u22640. (4)\nWe will later use this identity in the derivation of surrogate loss functions. 1Factor graphs are typically used to indicate the factorization of a probabilistic model. We are not assuming probabilistic models, but they would be also captured by our general framework: h would then be \u2212 log of a probability."}, {"heading": "3 General learning bounds for structured prediction", "text": "In this section, we present new learning guarantees for structured prediction. Our analysis is general and applies to the broad family of definite and bounded loss functions introduced in the previous section. It is also general in the sense that it applies to general hypothesis sets and not just sub-families of linear functions. For linear hypotheses, we will give a more refined analysis that holds for arbitrary norm-p regularized hypothesis sets.\nOur learning guarantees are based on a new notion of Rademacher complexity, and they are somewhat finer than the previously best-known bounds of Taskar et al. [2003], which were given for the special case of the Hamming loss with norm-2 regularization using covering numbers. Our bounds are data-dependent, admit a favorable dependency in terms of sparsity and the effective factor graph, and hold for general loss functions and regularizations. For the same norm-2 regularization, they also admit a logarithmic term improvement. We will present below a more detailed comparison with previous work.\nThe theoretical analysis of structured prediction is more complex than for classification since, by definition, it depends on the properties of the loss function and the factor graph. These attributes capture the combinatorial properties of the problem, which must be exploited since the total number of labels is often exponential in the size of that graph. To tackle this problem, we first introduce a new complexity tool."}, {"heading": "3.1 Complexity measure", "text": "A key ingredient of our analysis is a new data-dependent notion of complexity that extends the classical Rademacher complexity. We define the empirical factor graph Rademacher complexity R\u0302GS (H) of a hypothesis setH for a sample S = (x1, . . . , xm) and factor graph G as follows:\nR\u0302GS (H) = 1\nm E [ sup h\u2208H m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y hf (xi, y) ] ,\nwhere = ( i,f,y)i\u2208[m],f\u2208Fi,y\u2208Yf with i,f,ys independent Rademacher random variables uniformly distributed over {\u00b11}. The factor graph Rademacher complexity ofH for a factor graph G is defined as the expectation: RGm(H) = ES\u223cDm [ R\u0302GS (H) ] . As with the standard Rademacher complexity, the factor graph Rademacher complexity of a hypothesis set can be estimated from data in many cases. In some important cases, it also admits explicit upper bounds similar to those for the standard Rademacher complexity but with an additional dependence on the factor graph quantities. We will prove this for several families of regularized linear functions which are commonly used in structured prediction (Theorem 2)."}, {"heading": "3.2 Generalization bounds", "text": "In this section, we present new margin bounds for structured prediction based on the factor graph Rademacher complexity ofH. Our results hold both for the additive and the multiplicative empirical margin losses defined below\nR\u0302add\u03c1 (h) = E (x,y)\u223cS\n[ \u03a6\u2217 (\nmax y\u2032 6=y\nL(y\u2032, y)\u2212 1\u03c1 [ h(x, y)\u2212 h(x, y\u2032) ])] (5)\nR\u0302mult\u03c1 (h) = E (x,y)\u223cS\n[ \u03a6\u2217 (\nmax y\u2032 6=y\nL(y\u2032, y) ( 1\u2212 1\u03c1 [h(x, y)\u2212 h(x, y\u2032)] ))] . (6)\nHere, \u03a6\u2217(r) = min(M,max(0, r)) for all r, with M = maxy,y\u2032 L(y, y\u2032). The following is our general data-dependent margin bound for structured prediction.\nTheorem 1. Fix \u03c1 > 0. For any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, the following holds for all h \u2208 H,\nR(h) \u2264 Radd\u03c1 (h) \u2264 R\u0302addS,\u03c1(h) + 4 \u221a 2\n\u03c1 RGm(H) + \u221a log 1\u03b4 2m ,\nR(h) \u2264 Rmult\u03c1 (h) \u2264 R\u0302multS,\u03c1 (h) + 4 \u221a 2M\n\u03c1 RGm(H) + \u221a log 1\u03b4 2m .\nThe proof of Theorem 1 is based on new contraction lemmas (Lemma 5 and Lemma 6) that can be of independent interest. The full proofs of Theorem 1 and Lemma 5 are given in Appendix A. As for standard Rademacher complexity, the empirical factor graph Rademacher complexity R\u0302GS (H) is sharply concentrated around its mean RGm(H). This can be used to derive similar bounds to those of Theorem 1 with RGm(H) replaced by R\u0302GS (H) and slight changes to the constant in the last terms of each inequality. All of these margin bounds can be extended to hold uniformly over \u03c1 \u2208 (0, 1] at the price of an additional term of the form \u221a (log log2 2 \u03c1 )/m in the bound, using known techniques (see for example [Mohri et al., 2012]).\nTheorem 1 is the first data-dependent generalization guarantee for structured prediction with general loss functions, general hypothesis sets and arbitrary factor graphs for both multiplicative and additive margins. We will compare it to known special cases below.\nIndeed, the hypothesis set used by structured prediction convex algorithms such as StructSVM [Tsochantaridis et al., 2005], Max-Margin Markov Networks [Taskar et al., 2003] or Conditional Random Field (CRF) [Lafferty et al., 2001] is that of linear functions. More precisely, let \u03a8 be a feature mapping from (X \u00d7 Y) to RN such that \u03a8(x, y) = \u2211f\u2208F \u03a8f (x, yf ), and let\nHp = {x 7\u2192 w \u00b7\u03a8(x, y) : \u2016w\u2016p \u2264 \u039bp}.\nIn this case R\u0302Gm(Hp) can be efficiently estimated using random sampling and solving LP programs. Moreover, one can obtain explicit upper bounds on R\u0302Gm(Hp). To simplify our presentation, we will consider the case p = 1, 2, but our results can be extended to an arbitrary p \u2265 1 and, more generally, to arbitrary group norms.\nTheorem 2. For any sample S = (x1, . . . , xm), the following upper bounds hold for the empirical factor graph complexity ofH1 andH2:\nR\u0302GS (H1) \u2264 \u039b1r\u221e m\n\u221a s log(2N), R\u0302GS (H2) \u2264\n\u039b2r2 m\n\u221a\u2211m i=1 \u2211 f\u2208Fi \u2211 y\u2208Yf |Fi|,\nwhere r\u221e = maxi,f,y \u2016\u03a8f (xi, y)\u2016\u221e, r2 = maxi,f,y \u2016\u03a8f (xi, y)\u20162 and where s is a sparsity factor defined by s = maxj\u2208[1,N ] \u2211m i=1 \u2211 f\u2208Fi \u2211 y\u2208Yf |Fi|1\u03a8j(xi,y)6=0.\nPlugging in these factor graph complexity upper bounds into Theorem 1 immediately yields explicit data-dependent structured prediction learning guarantees for linear hypotheses with general loss functions and arbitrary factor graphs (see Corollary 8). Observe that in the worst case the sparsity factor can be bounded as follows:\ns \u2264 m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf |Fi| \u2264\nm\u2211\ni=1\n|Fi|2di \u2264 mmax i |Fi|2di,\nwhere di = maxf\u2208Fi |Yf |. Thus, the factor graph Rademacher complexities of linear hypothesis in H1 scale as O( \u221a log(N) maxi |Fi|2di/m). This shows that the expected size of the factor graph is crucial for learning in this scenario and should be contrasted with other existing structured prediction guarantees that we discuss below, which assume a fixed upper bound on the size of the factor graph. Note that our result shows that learning is possible even with an infinite set Y . To the best of our knowledge, this is the first learning guarantee for learning with infinitely many classes.\nOur learning guarantee forH1 can additionally benefit from the sparsity of the feature mapping and observed data. In particular, in many applications \u03a8f,j is a binary indicator function that is non-zero for a single (x, y) \u2208 X \u00d7 Yf . For instance, in NLP, \u03a8f,j may indicate an occurrence of a certain\nn-gram in the input xi and output y. Observe that in this case, s = \u2211m i=1 |Fi|2 \u2264 mmaxi |Fi|2\nand the complexity term is only in O(maxi |Fi| \u221a\nlog(N)/m), where N may depend linearly on di."}, {"heading": "3.3 Special cases and comparisons", "text": "Here, we discuss some special cases of interest for which we compare our learning guarantees with those given by previous work.\nMarkov networks. For the pairwise Markov networks with a fixed number of substructures l studied by Taskar et al. [2003], our equivalent factor admits l nodes, |Fi| = l, and the maximum size of Yf is di = k\n2 if each substructure of a pair can be assigned one of k classes. Thus, if we apply Corollary 8 with Hamming distance as our loss function and and divide the bound through by l, to normalize the loss to interval [0, 1] as in [Taskar et al., 2003], we obtain the following explicit form of our guarantee for an additive empirical margin loss, for all h \u2208 H2:\nR(h) \u2264 R\u0302addS,\u03c1(h) + 4\u039b2r2 \u03c1\n\u221a 2k2\nm + \u221a log 1\u03b4 2m .\nThis bound can be further improved by eliminating the dependency on k using an extension of our contraction Lemma 5 to \u2016 \u00b7 \u2016\u221e,2 (see Lemma 6). The complexity term of Taskar et al. [2003] bounds depends on the following O\u0303( \u221a \u039b22q\n2r22/m). Our bound has the same dependence on these key quantities, with no logarithmic term in our case. Note that, unlike the result of Taskar et al. [2003], our bound also holds for general loss functions and different p-norm regularizers. Moreover, our result for a multiplicative empirical margin loss is new, even in this special case.\nMulti-class classification. For standard (unstructured) multi-class classification, we have |Fi| = 1 and di = c, where c is the number of classes. In that case, for linear hypotheses, the complexity term of our bound varies as O(\u039b2r2 \u221a c/\u03c12m) for example for norm-2 regularization (Corollary 9), which improves upon the best known general margin bounds of Kuznetsov et al. [2014], who provide a guarantee that scales linearly with the number of classes instead. Moreover, in the special case where an individual wy is learned for each class y \u2208 [c], we retrieve the recent favorable bounds given by Lei et al. [2015], albeit with a somewhat simpler formulation. In that case, for any (x, y), all components of the feature vector \u03a8(x, y) are zero, except (perhaps) for the N components corresponding to class y, where N is the dimension of wy. In view of that, for example for a group-norm \u2016 \u00b7 \u20162,1- regularization, the complexity term of our bound varies as O(\u039br \u221a (log c)/\u03c12m), which matches the results of Lei et al. [2015] with a logarithmic dependency on c (ignoring some complex exponents of log c in their case). Additionally, note that unlike existing multi-class learning guarantees, our results hold for arbitrary loss functions. See Corollary 10 for further details. Our sparsity-based bounds can also be used to give bounds with logarithmic dependence on the number of classes when the features only take values in {0, 1}. Finally, using Lemma 6 instead of Lemma 5, the dependency on the number of classes can be further improved.\nWe conclude this section by observing that, since our guarantees are expressed in terms of the average size of the factor graph over a given sample, this invites us to search for a hypothesis set H and predictor h \u2208 H such that the tradeoff between the empirical size of the factor graph and empirical error is optimal. In the next section, we will make use of a recently developed principle of Voted Risk Minimization (VRM) [Cortes et al., 2015] to reach this objective."}, {"heading": "4 Voted Risk Minimization", "text": "In many structured prediction applications such as natural language processing and computer vision, one may wish to exploit very rich features. However, the use of rich families of hypotheses could lead to overfitting. In this section, we show that it may be possible to use rich families in conjunction with simpler families, provided that fewer complex hypotheses are used (or that they are used with less mixture weight). We achieve this goal by deriving learning guarantees for ensembles of structure prediction rules that explicitly account for the differing complexities between families. This will motivate the algorithms that we present in Section 5.\nAssume that we are given p families H1, . . . ,Hp of functions mapping from X \u00d7 Y to R. Define the ensemble family F = conv(\u222apk=1Hk), that is the family of functions f of the form f = \u2211T t=1 \u03b1tht, where \u03b1 = (\u03b11, . . . , \u03b1T ) is in the simplex \u2206 and where, for each t \u2208 [1, T ], ht is in Hkt for some kt \u2208 [1, p]. We further assume that RGm(H1) \u2264 RGm(H2) . . . \u2264 RGm(Hp). As an example, Hks may be ordered by the size of the corresponding factor graphs.\nThe main result in this section is a generalization of the VRM theory to the structured prediction setting. The learning guarantees that we present are in terms of upper bounds on R\u0302addS,\u03c1(h) and R\u0302multS,\u03c1 (h), which are defined as follows for all \u03c4 \u2265 0:\nR\u0302addS,\u03c1,\u03c4 (h) = E (x,y)\u223cS\n[ \u03a6\u2217 (\nmax y\u2032 6=y\nL(y\u2032, y) + \u03c4 \u2212 1\u03c1 [ h(x, y)\u2212 h(x, y\u2032) ])] (7)\nR\u0302multS,\u03c1,\u03c4 (h) = E (x,y)\u223cS\n[ \u03a6\u2217 (\nmax y\u2032 6=y\nL(y\u2032, y) ( 1 + \u03c4 \u2212 1\u03c1 [h(x, y)\u2212 h(x, y\u2032)] ))] . (8)\nFor simplicity, we assume in this section that |Y| = c < +\u221e.\nTheorem 3. Fix \u03c1 > 0. For any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, each of the following inequalities holds for all f \u2208 F:\nR(f)\u2212 R\u0302addS,\u03c1,1(f) \u2264 4 \u221a 2\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) + C(\u03c1,M, c,m, p),\nR(f)\u2212 R\u0302multS,\u03c1,1(f) \u2264 4 \u221a 2M\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) + C(\u03c1,M, c,m, p).\nwhere C(\u03c1,M, c,m, p) = 2c\u03c1M \u221a log p m + 3M \u221a\u2308 4 \u03c12 log ( c2M2\u03c12m 4 log p )\u2309 log p m + log 2\u03b4 2m .\nThe proof of this theorem crucially depends on the theory we developed in Section 3 and is given in Appendix A. The explicit dependence of this bound on the parameter vector \u03b1 suggests that learning even with highly complex hypothesis sets could be possible so long as the complexity term, which is a weighted average of the factor graph complexities, is not too large. The theorem provides a quantitative way of determining the mixture weights that should be apportioned to each family. Furthermore, the dependency on the number of distinct feature map families Hk is very mild and therefore suggests that a large number of families can be used. These properties will be useful for motivating new algorithms for structured prediction."}, {"heading": "5 Algorithms", "text": "In this section, we derive several algorithms for structured prediction based on the VRM principle discussed in Section 4. We first give general convex upper bounds (Section 5.1) on the structured prediction loss which recover as special cases the loss functions used in StructSVM [Tsochantaridis et al., 2005], Max-Margin Markov Networks [Taskar et al., 2003], and Conditional Random Field (CRF) [Lafferty et al., 2001]. Next, we introduce a new algorithm, Voted Conditional Random Field (VCRF) Section 5.2, with accompanying experiments as proof of concept. We also present another algorithm, Voted StructBoost (VStructBoost), in Appendix C."}, {"heading": "5.1 General framework for convex surrogate losses", "text": "Given a labeled example (x, y) \u2208 X \u00d7 Y , the mapping h 7\u2192 L(h(x), y) is typically not a convex function of h, which leads to computationally hard optimization problems. This motivates the use of convex surrogate losses. We first introduce a general formulation of surrogate losses for structured prediction problems. Lemma 4. For any u \u2208 R+, let \u03a6u : R\u2192 R be a decreasing upper bound on v 7\u2192 u1v\u22640 such that u 7\u2192 \u03a6u(v) is increasing for a fixed v. Then, the following upper bound holds for any h \u2208 H and (x, y) \u2208 X \u00d7 Y ,\nL(h(x), y) \u2264 max y\u2032 6=y \u03a6L(y\u2032,y)(h(x, y)\u2212 h(x, y\u2032)). (9)\nThe proof is given in Appendix A. This result defines a general framework that enables us to straightforwardly recover many of the most common state-of-the-art structured prediction algorithms via suitable choices of \u03a6u(v): (a) for \u03a6u(v) = max(0, u(1\u2212v)), the right-hand side of (9) coincides with the surrogate loss defining StructSVM [Tsochantaridis et al., 2005]; (b) for \u03a6u(v) = max(0, u\u2212 v), it coincides with the surrogate loss defining Max-Margin Markov Networks [Taskar et al., 2003] when using for L the Hamming loss; and (c) for \u03a6u(v) = log(1 + eu\u2212v), it coincides with the surrogate loss defining Conditional Random Field (CRF) [Lafferty et al., 2001].\nMoreover, alternative choices of \u03a6u(v) can help define new algorithms. In particular, we will refer to the algorithm based on the surrogate loss defined by \u03a6u(v) = ue\u2212v as StructBoost, in reference to the exponential loss used in AdaBoost. Another related alternative is based on the choice \u03a6u(v) = eu\u2212v . See Appendix C, for further details on this algorithm. In fact, for each of \u03a6u(v) described above, the corresponding convex surrogate is an upper bound on either the multiplicative or additive margin loss introduced in Section 3. Therefore, each of these algorithms seeks a hypothesis that minimizes the generalization bounds presented in Section 3. To the best of our knowledge, this interpretation of these well-known structured prediction algorithms is also new. In what follows, we derive new structured prediction algorithms that minimize finer generalization bounds presented in Section 4."}, {"heading": "5.2 Voted Conditional Random Field (VCRF)", "text": "We first consider the convex surrogate loss based on \u03a6u(v) = log(1 + eu\u2212v), which corresponds to the loss defining CRF models. Using the monotonicity of the logarithm and upper bounding the maximum by a sum gives the following upper bound on the surrogate loss holds:\nmax y\u2032 6=y\nlog(1 + eL(y,y \u2032)\u2212w\u00b7\u03b4\u03a8(x,y,y\u2032)) = log\n( \u2211\ny\u2032\u2208Y eL(y,y\n\u2032)\u2212w\u00b7\u03b4\u03a8(x,y,y\u2032) ) ,\nwhich, combined with the VRM principle, leads to the following optimization problem:\nmin w\n1\nm\nm\u2211\ni=1\nlog\n(\u2211\ny\u2208Y eL(y,yi)\u2212w\u00b7\u03b4\u03a8(xi,yi,y)\n) + p\u2211\nk=1\n(\u03bbrk + \u03b2)\u2016wk\u20161, (10)\nwhere rk = r\u221e|F (k)| \u221a\nlogN . We refer to the learning algorithm based on the optimization problem (10) as VCRF. Note that for \u03bb = 0, (10) coincides with the objective function of L1regularized CRF. Observe that we can also directly use maxy\u2032 6=y log(1 + eL(y,y\n\u2032)\u2212w\u00b7\u03b4\u03a8(x,y,y\u2032)) or its upper bound \u2211 y\u2032 6=y log(1 + e\nL(y,y\u2032)\u2212w\u00b7\u03b4\u03a8(x,y,y\u2032)) as a convex surrogate. We can similarly derive an L2-regularization formulation of the VCRF algorithm.\nIn Appendix D, we describe efficient algorithms for solving the VCRF and VStructBoost optimization problems. Our algorithms can be further used with a large family of structured prediction losses that include the edit-distance and the n-gram loss function. To the best of our knowledge these results are also new."}, {"heading": "6 Experiments", "text": "In Appendix B, we corroborate our theory by reporting experimental results suggesting that the VCRF algorithm can outperform the CRF algorithm on a number of part-of-speech (POS) datasets."}, {"heading": "7 Conclusion", "text": "We presented a general theoretical analysis of structured prediction. The data-dependent margin guarantees for structured prediction can be used to guide the design of algorithms or to determine the generalization guarantees of existing algorithms. Its explicit dependency on the properties of the factor graph used to define model decomposition and on feature sparsity can help shed new light on the role played by the graph and features in generalization. Our extension of the VRM theory to structured prediction provides a new analysis of generalization when using a very rich set of features, which is common in many applications such as natural language processing and leads to new algorithms, VCRF and VStructBoost. Our preliminary experimental results for VCRF serve as a proof of concept and motivate a more extensive empirical and algorithmic studies of these two families of algorithms."}, {"heading": "A Proofs", "text": "This appendix section gathers detailed proofs of all of our main results. In Appendix A.1, we prove a contraction lemma used as a tool in the proof of our general factor graph Rademacher complexity bounds (Appendix A.3). In Appendix A.7, we further extend our bounds to the Voted Risk Minimization setting. Appendix A.4 gives explicit upper bounds on the factor graph Rademacher complexity of several commonly used hypothesis sets. In Appendix A.8, we prove a general upper bound on a loss function used in structured prediction in terms of a convex surrogate.\nA.1 Contraction lemma\nThe following contraction lemma will be a key tool used in the proofs of our generalization bounds for structured prediction.\nLemma 5. LetH be a hypothesis set of functions mappingX to Rc. Assume that for all i = 1, . . . ,m, \u03a8i is \u00b5i-Lipschitz for Rc equipped with the norm-2 functions for some \u00b5i > 0. That is\n|\u03a8i(x\u2032)\u2212\u03a8i(x)| \u2264 \u00b5i\u2016x\u2032 \u2212 x\u20162, for all (x,x\u2032) \u2208 (Rc)2. Then, for any sample S ofm points x1, . . . , xm \u2208 X , the following inequality holds\n1 m E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i\u03a8i(h(xi))\n] \u2264 \u221a 2\nm E\n sup\nh\u2208H\nm\u2211\ni=1\nc\u2211\nj=1\nij \u00b5ihj(xi)\n  , (11)\nwhere = ( ij)i,j and ijs are independent Rademacher variables uniformly distributed over {\u00b11}.\nProof. Fix a sample S = (x1, . . . , xm). Then, we can rewrite the left-hand side of (12) as follows:\n1 m E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i\u03a8i(h(xi))\n] = 1\nm E \u03c31,...,\u03c3m\u22121 [ E \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m\u03a8m(h(xm)) ]] ,\nwhere Um\u22121(h) = \u2211m\u22121 i=1 \u03c3i\u03a8i(h(xi)). Assume that the suprema can be attained and let h1,h2 \u2208 H be the hypotheses satisfying Um\u22121(h1) + \u03a8m(h1(xm)) = sup\nh\u2208H Um\u22121(h) + \u03a8m(h(xm))\nUm\u22121(h2)\u2212\u03a8m(h2(xm)) = sup h\u2208H Um\u22121(h)\u2212\u03a8m(h(xm)).\nWhen the suprema are not reached, a similar argument to what follows can be given by considering instead hypotheses that are -close to the suprema for any > 0. By definition of expectation, since \u03c3m is uniformly distributed over {\u00b11}, we can write\nE \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m\u03a8m(h(xm)) ]\n= 1\n2 sup h\u2208H\nUm\u22121(h) + \u03a8m(h(xm)) + 1\n2 sup h\u2208H\nUm\u22121(h)\u2212\u03a8m(h(xm))\n= 1\n2 [Um\u22121(h1) + \u03a8m(h1(xm))] +\n1 2 [Um\u22121(h2)\u2212\u03a8m(h2(xm))].\nNext, using the \u00b5m-Lipschitzness of \u03a8m and the Khintchine-Kahane inequality, we can write\nE \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m\u03a8m(h(xm)) ]\n\u2264 1 2 [Um\u22121(h1) + Um\u22121(h2) + \u00b5m\u2016h1(xm)\u2212 h2(xm)\u20162]\n\u2264 1 2\n[ Um\u22121(h1) + Um\u22121(h2) + \u00b5m\n\u221a 2 E m1,..., mc\n[\u2223\u2223\u2223 c\u2211\nj=1\nmj ( h1j(xm)\u2212 h2j(xm) )\u2223\u2223\u2223 ]] .\nNow, let m denote ( m1, . . . , mc) and let s( m) \u2208 {\u00b11} denote the sign of \u2211c j=1 mj ( h1j(xm)\u2212\nh2j(xm) ) . Then, the following holds:\nE \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m(\u03a8m \u25e6 h)(xm) ]\n\u2264 1 2 E m\n[ Um\u22121(h1) + Um\u22121(h2) + \u00b5m \u221a 2 \u2223\u2223\u2223 c\u2211\nj=1\nmj ( h1j(xm)\u2212 h2j(xm) )\u2223\u2223\u2223 ]\n= 1\n2 E m\n[ Um\u22121(h1) + \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjh1j(xm)\n+ Um\u22121(h2)\u2212 \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjh2j(xm)\n]\n\u2264 1 2 E m [ sup h\u2208H ( Um\u22121(h) + \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjhj(xm) )\n+ sup h\u2208H\n( Um\u22121(h)\u2212 \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjhj(xm) )]\n= E m [ E \u03c3m [ sup h\u2208H Um\u22121(h) + \u00b5m \u221a 2\u03c3m c\u2211\nj=1\nmjhj(xm) ]]\n= E m [ sup h\u2208H Um\u22121(h) + \u00b5m \u221a 2 c\u2211\nj=1\nmjhj(xm) ]] ,\nProceeding in the same way for all other \u03c3is (i < m) completes the proof.\nA.2 Contraction lemma for \u2016 \u00b7 \u2016\u221e,2-norm\nIn this section, we present an extension of the contraction Lemma 5, that can be used to remove the dependency on the alphabet size in all of our bounds. Lemma 6. Let H be a hypothesis set of functions mapping X \u00d7 [d] to Rc. Assume that for all i = 1, . . . ,m, \u03a8i is \u00b5i-Lipschitz for Rc\u00d7d equipped with the norm-(\u221e, 2) for some \u00b5i > 0. That is |\u03a8i(x\u2032)\u2212\u03a8i(x)| \u2264 \u00b5i\u2016x\u2032 \u2212 x\u2016\u221e,2, for all (x,x\u2032) \u2208 (Rc\u00d7d)2. Then, for any sample S of m points x1, . . . , xm \u2208 X , there exists a distribution U over [d]c\u00d7m such that the following inequality holds:\n1 m E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i\u03a8i(h(xi))\n] \u2264 \u221a 2\nm E \u03c5\u223cU,\n sup\nh\u2208H\nm\u2211\ni=1\nc\u2211\nj=1\nij \u00b5ihj(xi, \u03c5mj)\n  , (12)\nwhere = ( ij)i,j and ijs are independent Rademacher variables uniformly distributed over {\u00b11} and \u03c5 = (\u03c5i,j)i,j is a sequence of random variables distributed according to U . Note that \u03c5i,js themselves do not need to be independent.\nProof. Fix a sample S = (x1, . . . , xm). Then, we can rewrite the left-hand side of (12) as follows:\n1 m E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i\u03a8i(h(xi))\n] = 1\nm E \u03c31,...,\u03c3m\u22121 [ E \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m\u03a8m(h(xm)) ]] ,\nwhere Um\u22121(h) = \u2211m\u22121 i=1 \u03c3i\u03a8i(h(xi)). Assume that the suprema can be attained and let h1,h2 \u2208 H be the hypotheses satisfying Um\u22121(h1) + \u03a8m(h1(xm)) = sup\nh\u2208H Um\u22121(h) + \u03a8m(h(xm))\nUm\u22121(h2)\u2212\u03a8m(h2(xm)) = sup h\u2208H Um\u22121(h)\u2212\u03a8m(h(xm)).\nWhen the suprema are not reached, a similar argument to what follows can be given by considering instead hypotheses that are -close to the suprema for any > 0. By definition of expectation, since \u03c3m is uniformly distributed over {\u00b11}, we can write\nE \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m\u03a8m(h1(xm)) ]\n= 1\n2 sup h\u2208H\nUm\u22121(h) + \u03a8m(h1(xm)) + 1\n2 sup h\u2208H\nUm\u22121(h)\u2212\u03a8m(h(xm))\n= 1\n2 [Um\u22121(h1) + \u03a8m(h1(xm))] +\n1 2 [Um\u22121(h2)\u2212\u03a8m(h2(xm))].\nNext, using the \u00b5m-Lipschitzness of \u03a8m and the Khintchine-Kahane inequality, we can write\nE \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m(\u03a8m \u25e6 h)(xm) ]\n\u2264 1 2 [Um\u22121(h1) + Um\u22121(h2) + \u00b5m\u2016h1(xm)\u2212 h2(xm)\u2016\u221e,2]\n\u2264 1 2\n[ Um\u22121(h1) + Um\u22121(h2) + \u00b5m\n\u221a 2 E m1,..., mc\n[\u2223\u2223\u2223 c\u2211\nj=1\nmj\u2016h1,j(xm, \u00b7)\u2212 h2,j(xm, \u00b7)\u2016\u221e \u2223\u2223\u2223 ]] .\nDefine the random variables \u03c5mj = \u03c5mj(\u03c3) = argmaxk\u2208[d] |h1,j(xm, k)\u2212 h2,j(xm, k)|.\nNow, let m denote ( m1, . . . , mc) and let s( m) \u2208 {\u00b11} denote the sign of\u2211c j=1 mj\u2016h1,j(xm, \u00b7)\u2212 h2,j(xm, \u00b7)\u2016\u221e. Then, the following holds:\nE \u03c3m [ sup h\u2208H Um\u22121(h) + \u03c3m(\u03a8m \u25e6 h)(xm) ]\n\u2264 1 2 E m\n[ Um\u22121(h1) + Um\u22121(h2) + \u00b5m \u221a 2 \u2223\u2223\u2223 c\u2211\nj=1\nmj\u2016h1,j(xm, \u00b7)\u2212 h2,j(xm, \u00b7)\u2016\u221e \u2223\u2223\u2223 ]\n= 1\n2 E m\n[ Um\u22121(h1) + Um\u22121(h2)\n+ \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmj |h1,j(xm, \u03c5mj)\u2212 h2,j(xm, \u03c5mj)| ]\n= 1\n2 E m\n[ Um\u22121(h1) + Um\u22121(h2)\n+ \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmj(h1,j(xm, \u03c5mj)\u2212 h2,j(xm, \u03c5mj)) ]\n= 1\n2 E m\n[ Um\u22121(h1) + \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjh1,j(xm, \u03c5mj)\n+ Um\u22121(h2)\u2212 \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjh2,j(xm, \u03c5mj)\n] .\nAfter taking expectation over \u03c5, the rest of the proof proceeds the same way as the argument in Lemma 5:\n1 2 E \u03c5\u223cU, m\n[ Um\u22121(h1) + \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjh1,j(xm, \u03c5mj)\n+ Um\u22121(h2)\u2212 \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjh2,j(xm, \u03c5mj)\n]\n\u2264 1 2 E \u03c5\u223cU, m [ sup h\u2208H ( Um\u22121(h) + \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjhj(xm, \u03c5mj) )\n+ sup h\u2208H\n( Um\u22121(h)\u2212 \u00b5m \u221a 2 s( m) c\u2211\nj=1\nmjhj(xm, \u03c5mj) )]\n= E \u03c5\u223cU, m [ E \u03c3m [ sup h\u2208H Um\u22121(h) + \u00b5m \u221a 2\u03c3m c\u2211\nj=1\nmjhj(xm, \u03c5mj) ]]\n= E \u03c5\u223cU, m [ sup h\u2208H Um\u22121(h) + \u00b5m \u221a 2 c\u2211\nj=1\nmjhj(xm, \u03c5mj) ]] ,\nProceeding in the same way for all other \u03c3is (i < m) completes the proof.\nA.3 General structured prediction learning bounds\nIn this section, we give the proof of several general structured prediction bounds in terms of the notion of factor graph Rademacher complexity. We will use the additive and multiplicative margin losses of a hypothesis h, which are the population versions of the empirical quantities margin losses we introduced in (5) and (6) defined as follows:\nRadd\u03c1 (h) = E (x,y)\u223cD\n[ \u03a6\u2217 (\nmax y\u2032 6=y\nL(y\u2032, y)\u2212 1\u03c1 [ h(x, y)\u2212 h(x, y\u2032)\n])]\nRmult\u03c1 (h) = E (x,y)\u223cD\n[ \u03a6\u2217 (\nmax y\u2032 6=y\nL(y\u2032, y) ( 1\u2212 1\u03c1 [h(x, y)\u2212 h(x, y\u2032)] ))] .\nThe following is our general margin bound structured prediction.\nTheorem 1. Fix \u03c1 > 0. For any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, the following holds for all h \u2208 H,\nR(h) \u2264 Radd\u03c1 (h) \u2264 R\u0302addS,\u03c1(h) + 4 \u221a 2\n\u03c1 RGm(H) + \u221a log 1\u03b4 2m ,\nR(h) \u2264 Rmult\u03c1 (h) \u2264 R\u0302multS,\u03c1 (h) + 4 \u221a 2M\n\u03c1 RGm(H) + \u221a log 1\u03b4 2m .\nProof. Let \u03a6u(v) = \u03a6\u2217(u \u2212 v\u03c1 ), where \u03a6\u2217(r) = min(M,max(0, r)). Observe that for any u \u2208 [0,M ], u1v\u22640 \u2264 \u03a6u(v) for all v. Furthermore, \u03a6u(v) is an increasing function of u for any given v. Therefore, by Lemma 4 and monotonicity of \u03a6\u2217,\nR(h) \u2264 E (x,y)\u223cD [max y\u2032 6=y \u03a6L(y\u2032,y)(h(x, y)\u2212 h(x, y\u2032))]\n= E (x,y)\u223cD\n[ \u03a6\u2217 (\nmax y\u2032 6=y\n( L(y\u2032, y)\u2212 h(x, y)\u2212 h(x, y \u2032) \u03c1\n))]\n= Radd\u03c1 (h).\nDefine\nH0 = { (x, y) 7\u2192 \u03a6\u2217 (\nmax y\u2032 6=y\n( L(y\u2032, y)\u2212 h(x, y)\u2212 h(x, y \u2032) \u03c1 )) : h \u2208 H\n} ,\nH1 = {\n(x, y) 7\u2192 max y\u2032 6=y\n( L(y\u2032, y)\u2212 h(x, y)\u2212 h(x, y \u2032) \u03c1 ) : h \u2208 H\n} .\nBy standard Rademacher complexity bounds (Koltchinskii and Panchenko [2002]), for any \u03b4 > 0, with probability at least 1\u2212 \u03b4, the following inequality holds for all h \u2208 H:\nRadd\u03c1 (h) \u2264 R\u0302addS,\u03c1(h) + 2Rm(H0) + \u221a log 1\u03b4 2m ,\nwhere Rm(H0) is the Rademacher complexity of the familyH0:\nRm(H0) = 1\nm E S\u223cDm E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i\u03a6 \u2217 (\nmax y\u2032 6=yi\n( L(y\u2032, yi)\u2212 h(xi, yi)\u2212 h(xi, y\u2032) \u03c1\n))]\nand where \u03c3 = (\u03c31, . . . , \u03c3m) with \u03c3is independent Rademacher random variables uniformly distributed over {\u00b11}. Since \u03a6\u2217 is 1-Lipschitz, by Talagrand\u2019s contraction lemma (Ledoux and Talagrand [1991], Mohri et al. [2012]), we have Rm(H0) \u2264 Rm(H1). Now, observe that, by the sub-additivity of the supremum, the following inequality holds:\nRm(H1) \u2264 1\nm E S\u223cDm E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i max y\u2032 6=yi\n( L(y\u2032, yi) + h(xi, y \u2032)\n\u03c1\n)]\n+ 1\nm E S\u223cDm E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i h(xi, yi)\n\u03c1\n] ,\nwhere we also used for the last term the fact that \u2212\u03c3i and \u03c3i admit the same distribution. We use Lemma 5 to bound each of the two terms appearing on the right-hand side separately. To do so, we we first show the Lipschitzness of h 7\u2192 maxy\u2032 6=yi ( L(y\u2032, yi) + h(xi,y \u2032)\n\u03c1\n) . Observe that the following\nchain of inequalities holds for any h, h\u0303 \u2208 H:\u2223\u2223\u2223\u2223\u2223maxy 6=yi ( L(y, yi) + h(xi, y) \u03c1 ) \u2212max y 6=yi ( L(y, yi) + h\u0303(xi, y) \u03c1 )\u2223\u2223\u2223\u2223\u2223\n\u2264 1 \u03c1 max y 6=yi\n\u2223\u2223\u2223h(xi, y)\u2212 h\u0303(xi, y) \u2223\u2223\u2223\n\u2264 1 \u03c1 max y\u2208Y\n\u2223\u2223\u2223h(xi, y)\u2212 h\u0303(xi, y) \u2223\u2223\u2223\n= 1\n\u03c1 max y\u2208Y\n\u2223\u2223\u2223 \u2211\nf\u2208Fi (hf (xi, yf )\u2212 h\u0303f (xi, yf ))\n\u2223\u2223\u2223\n\u2264 1 \u03c1\n\u2211 f\u2208Fi max y\u2208Y \u2223\u2223\u2223(hf (xi, yf )\u2212 h\u0303f (xi, yf )) \u2223\u2223\u2223\n= 1\n\u03c1\n\u2211 f\u2208Fi max y\u2208Yf \u2223\u2223\u2223(hf (xi, y)\u2212 h\u0303f (xi, y)) \u2223\u2223\u2223\n\u2264 \u221a |Fi| \u03c1 \u221a\u2211\nf\u2208Fi\n[ max y\u2208Y |(hf (xi, y)\u2212 h\u0303f (xi, y))| ]2\n= \u221a |Fi| \u03c1 \u221a\u2211\nf\u2208Fi max y\u2208Y |(hf (xi, y)\u2212 h\u0303f (xi, y))|2\n\u2264 \u221a |Fi| \u03c1 \u221a\u2211\nf\u2208Fi\n\u2211 y\u2208Y |(hf (xi, y)\u2212 h\u0303f (xi, y))|2.\nWe can therefore apply Lemma 5, which yields\n1 m E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i max y\u2032 6=yi\n( L(y\u2032, yi) + h(xi, y \u2032)\n\u03c1\n)]\n\u2264 \u221a 2\nm E [ sup h\u2208H m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf i,f,y\n\u221a |Fi| \u03c1 hf (xi, y) ] = \u221a 2 \u03c1 R\u0302GS (H).\nSimilarly, for the second term, observe that the following Lipschitz property holds:\n\u2223\u2223\u2223h(xi, yi) \u03c1 \u2212 h\u0303(xi, yi) \u03c1 \u2223\u2223\u2223 \u2264 1 \u03c1 max y 6=yi \u2223\u2223\u2223h(xi, y)\u2212 h\u0303(xi, y) \u2223\u2223\u2223\n\u2264 \u221a |Fi| \u03c1 \u221a\u2211\nf\u2208Fi\n\u2211 y\u2208Y |(hf (xi, y)\u2212 h\u0303f (xi, y))|2.\nWe can therefore apply Lemma 5 and obtain the following:\n1 m E \u03c3 [ sup h\u2208H m\u2211\ni=1\n\u03c3i h(xi, yi)\n\u03c1\n)] \u2264 \u221a 2\nm E [ sup h\u2208H m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf i,f,y\n\u221a |Fi| \u03c1 hf (xi, y) ] = \u221a 2 \u03c1 R\u0302GS (H).\nTaking the expectation over S of the two inequalities shows that Rm(H1) \u2264 2 \u221a 2 \u03c1 R\u0302 G S (H), which completes the proof of the first statement.\nThe second statement can be proven in a similar way with \u03a6u(v) = \u03a6\u2217(u(1\u2212 v\u03c1 )). In particular, by standard Rademacher complexity bounds and Talagrand\u2019s contraction lemma, we can write\nRmult\u03c1 (h) \u2264 R\u0302multS,\u03c1 (h) + 2Rm(H\u03031) + \u221a log 1\u03b4 2m ,\nwhere\nH\u03031 = {\n(x, y) 7\u2192 max y\u2032 6=y\nL(y\u2032, y) ( 1\u2212 h(x, y)\u2212 h(x, y \u2032)\n\u03c1\n) : h \u2208 H } .\nWe observe that the following inequality holds: \u2223\u2223\u2223\u2223\u2223maxy 6=yi L(y, yi) ( 1\u2212 h(xi, yi)\u2212 h(xi, y) \u03c1 ) \u2212max y 6=yi L(y, yi) ( 1\u2212 h\u0303(xi, yi)\u2212 h\u0303(xi, y) \u03c1 )\u2223\u2223\u2223\u2223\u2223\n\u2264 2M \u03c1 max y\u2208Y\n\u2223\u2223\u2223h(xi, y)\u2212 h\u0303(xi, y) \u2223\u2223\u2223.\nThen, the rest of the proof follows from Lemma 5 as in the previous argument.\nA.4 Bounds on factor graph Rademacher complexity\nThe following lemma is a standard bound on the expectation of the maximum of n zero-mean bounded random variables, which will be used in the proof of our bounds on factor graph Rademacher complexity.\nLemma 7. Let X1 . . . Xn be n \u2265 1 real-valued random variables such that for all j \u2208 [1, n], Xj = \u2211mj i=1 Yij where, for each fixed j \u2208 [1, n], Yij are independent zero mean random variables with |Yij | \u2264 tij . Then, the following inequality holds:\nE [\nmax j\u2208[1,n] Xj\n] \u2264 t \u221a 2 log n,\nwith t = \u221a maxj\u2208[1,n] \u2211mj i=1 t 2 ij .\nThe following are upper bounds on the factor graph Rademacher complexity forH1 andH2. Similar guarantees can be given for other hypothesis setsHp with p > 1.\nTheorem 2. For any sample S = (x1, . . . , xm), the following upper bounds hold for the empirical factor graph complexity ofH1 andH2:\nR\u0302GS (H1) \u2264 \u039b1r\u221e m\n\u221a s log(2N), R\u0302GS (H2) \u2264\n\u039b2r2 m\n\u221a\u2211m i=1 \u2211 f\u2208Fi \u2211 y\u2208Yf |Fi|,\nwhere r\u221e = maxi,f,y \u2016\u03a8f (xi, y)\u2016\u221e, r2 = maxi,f,y \u2016\u03a8f (xi, y)\u20162 and where s is a sparsity factor defined by s = maxj\u2208[1,N ] \u2211m i=1 \u2211 f\u2208Fi \u2211 y\u2208Yf |Fi|1\u03a8j(xi,y)6=0.\nProof. By definition of the dual norm and Lemma 7 (or Massart\u2019s lemma), the following holds:\nmR\u0302GS (H1) = E\n[ sup\n\u2016w\u20161\u2264\u039b1 w \u00b7\nm\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y\u03a8f (xi, y)\n]\n= \u039b1 E [\u2225\u2225\u2225\u2225 m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y\u03a8f (xi, y) \u2225\u2225\u2225\u2225 \u221e ]\n= \u039b1 E   max j\u2208[1,N ],\u03c3\u2208{\u22121,+1} \u03c3 m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y\u03a8f,j(xi, y)  \n= \u039b1 E   max j\u2208[1,N ],\u03c3\u2208{\u22121,+1} \u03c3 m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y\u03a8f,j(xi, y)1\u03a8f,j(xi,y) 6=0\n \n\u2264 \u039b1 \u221a\u221a\u221a\u221a2 (\nmax j\u2208[1,N ]\nm\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf |Fi|1\u03a8j(xi,y)6=0\n) r2\u221e log(2N)\n= \u039b1r\u221e \u221a 2s log(2N),\nwhich completes the proof of the first statement. The second statement can be proven in a similar way using the the definition of the dual norm and Jensen\u2019s inequality:\nmR\u0302GS (H2) = E\n[ sup\n\u2016w\u20162\u2264\u039b2 w \u00b7\nm\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y\u03a8f (xi, y)\n]\n= \u039b2 E [\u2225\u2225\u2225\u2225 m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y\u03a8f (xi, y) \u2225\u2225\u2225\u2225 2 ]\n= \u039b2\n( E [\u2225\u2225\u2225\u2225 m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf\n\u221a |Fi| i,f,y\u03a8f (xi, y) \u2225\u2225\u2225\u2225 2\n2\n]) 12\n= \u039b2\n( m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf |Fi|\u2016\u03a8f (xi, y)\u201622\n) 1 2\n\u2264 \u039b2r2\n\u221a\u221a\u221a\u221a m\u2211\ni=1\n\u2211\nf\u2208Fi\n\u2211\ny\u2208Yf |Fi|,\nwhich concludes the proof.\nA.5 Learning guarantees for structured prediction with linear hypotheses\nThe following result is a direct consequence of Theorem 1 and Theorem 2.\nCorollary 8. Fix \u03c1 > 0. For any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, the following holds for all h \u2208 H1,\nR(h) \u2264 R\u0302addS,\u03c1(h) + 4 \u221a 2\n\u03c1m \u039b1r\u221e\n\u221a s log(2N) + 3 \u221a log 2\u03b4 2m ,\nR(h) \u2264 R\u0302multS,\u03c1 (h) + 4 \u221a 2M\n\u03c1m \u039b1r\u221e\n\u221a s log(2N) + 3 \u221a log 2\u03b4 2m .\nSimilarly, for any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, the following holds for all h \u2208 H2,\nR(h) \u2264 R\u0302addS,\u03c1(h) + 4 \u221a 2\n\u03c1m \u039b2r2\n\u221a\u2211m i=1 \u2211 f\u2208Fi \u2211 y\u2208Yf |Fi|+ 3 \u221a log 2\u03b4 2m ,\nR(h) \u2264 R\u0302multS,\u03c1 (h) + 4 \u221a 2M\n\u03c1m \u039b2r2\n\u221a\u2211m i=1 \u2211 f\u2208Fi \u2211 y\u2208Yf |Fi|+ 3 \u221a log 2\u03b4 2m .\nA.6 Learning guarantees for multi-class classification with linear hypotheses\nThe following result is a direct consequence of Corollary 8 and the observation that for multi-class classification |Fi| = 1 and di = maxf\u2208Fi |Yf | = c.\nCorollary 9. Fix \u03c1 > 0. For any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, the following holds for all h \u2208 H1,\nR(h) \u2264 R\u0302addS,\u03c1(h) + 4 \u221a\n2\u039b1r\u221e \u03c1\n\u221a c log(2N)\nm + 3 \u221a log 2\u03b4 2m ,\nR(h) \u2264 R\u0302multS,\u03c1 (h) + 4 \u221a\n2M\u039b1r\u221e \u03c1\n\u221a c log(2N)\nm + 3 \u221a log 2\u03b4 2m .\nSimilarly, for any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, the following holds for all h \u2208 H2,\nR(h) \u2264 R\u0302addS,\u03c1(h) + 4 \u221a\n2\u039b2r2 \u03c1\n\u221a c\nm + 3 \u221a log 2\u03b4 2m ,\nR(h) \u2264 R\u0302multS,\u03c1 (h) + 4 \u221a\n2M\u039b2r2 \u03c1\n\u221a c\nm + 3 \u221a log 2\u03b4 2m .\nConsider the following set of linear hypothesis:\nH2,1 = {x 7\u2192 w \u00b7\u03a8(x, y) : \u2016w\u20162,1 \u2264 \u039b2,1, y \u2208 [c]}, where \u03a8(x, y) = (0, . . . 0,\u03a8y(x), 0, . . . , 0)T \u2208 RN1\u00d7...,Nc and w = (w1, . . . ,wc) with \u2016w\u20162,1 = \u2211c y=1 \u2016wy\u20162. In this case, w \u00b7 \u03a8(x, y) = wy \u00b7 \u03a8y(x). The standard scenario in multi-class classification is when \u03a8y(x) = \u03a8(x) is the same for all y.\nCorollary 10. Fix \u03c1 > 0. For any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, the following holds for all h \u2208 H2,1,\nR(h) \u2264 R\u0302addS,\u03c1(h) + 16\u039b2,1r2,\u221e(log(c))1/4\n\u03c1 \u221a m\n+ 3 \u221a log 2\u03b4 2m ,\nR(h) \u2264 R\u0302multS,\u03c1 (h) + 16\u039b2,1r2,\u221e(log(c))1/4\n\u03c1 \u221a m\n+ 3 \u221a log 2\u03b4 2m ,\nwhere r2,\u221e = maxx,y \u2016\u03a8y(xi)\u20162.\nProof. By definition of the dual norm andH2,1, the following holds:\nmR\u0302GS (H2,1) = E\n[ sup\n\u2016w\u20162,1\u2264\u039b w \u00b7\nm\u2211\ni=1\n\u2211 y\u2208[c] i,y\u03a8(xi, y)\n]\n= \u039bE [\u2225\u2225\u2225\u2225 m\u2211\ni=1\n\u2211 y\u2208[c] i,y\u03a8(xi, y) \u2225\u2225\u2225\u2225 2,\u221e ]\n= \u039bE [ max y \u2225\u2225\u2225\u2225 m\u2211\ni=1\ni,y\u03a8y(xi) \u2225\u2225\u2225\u2225 2\n]\n\u2264 \u039b ( E [ max y \u2225\u2225\u2225\u2225 m\u2211\ni=1\ni,y\u03a8y(xi) \u2225\u2225\u2225\u2225 2\n2\n])1/2\n= \u039b ( E [ max y m\u2211\ni=1\n\u2225\u2225\u2225\u2225\u03a8y(xi) \u2225\u2225\u2225\u2225 2\n2\n+ \u2211\ni 6=j i,y j,y\u03a8y(xi) \u00b7\u03a8y(xj)\n])1/2\n\u2264 \u039b (\nmax y\nm\u2211\ni=1\n\u2225\u2225\u2225\u2225\u03a8y(xi) \u2225\u2225\u2225\u2225 2\n2\n+ E [ max y \u2211\ni 6=j i,y j,y\u03a8y(xi) \u00b7\u03a8y(xj)\n])1/2\nBy Lemma 7 (or Massart\u2019s lemma), the following bound holds:\nE [ max y \u2211\ni 6=j i,y j,y\u03a8y(xi) \u00b7\u03a8y(xj)\n] \u2264 mr2,\u221e \u221a log(c).\nSince, maxy \u2211m i=1 \u2016\u03a8y(xi)\u201622 \u2264 mr22,\u221e, we obtain that the following result holds:\nR\u0302GS (H2,1) \u2264 \u221a\n2\u039br2,\u221e(log(c))1/4\u221a m ,\nand applying Theorem 1 completes the proof.\nA.7 VRM structured prediction learning bounds\nHere, we give the proof of our structured prediction learning guarantees in the setting of Voted Risk Minimization. We will use the following lemma.\nLemma 11. The function \u03a6\u2217 is sub-additive: \u03a6\u2217(x+ y) \u2264 \u03a6\u2217(x) + \u03a6\u2217(y), for all x, y \u2208 R.\nProof. By the sub-additivity of the maximum function, for any x, y \u2208 R, the following upper bound holds for \u03a6\u2217(x+ y):\n\u03a6\u2217(x+ y) = min(M,max(0, x+ y)) \u2264 min(M,max(0, x) + max(0, y)) \u2264 min(M,max(0, x)) + min(M,max(0, y)) = \u03a6\u2217(x) + \u03a6\u2217(y),\nwhich completes the proof.\nFor the following proof, for any \u03c4 \u2265 0, the margin losses Radd\u03c1,\u03c4 (h) and Rmult\u03c1,\u03c4 (h) are defined as the population counterparts of the empirical losses define by (7) and (8).\nTheorem 3. Fix \u03c1 > 0. For any \u03b4 > 0, with probability at least 1\u2212 \u03b4 over the draw of a sample S of size m, each of the following inequalities holds for all f \u2208 F:\nR(f)\u2212 R\u0302addS,\u03c1,1(f) \u2264 4 \u221a 2\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) + C(\u03c1,M, c,m, p),\nR(f)\u2212 R\u0302multS,\u03c1,1(f) \u2264 4 \u221a 2M\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) + C(\u03c1,M, c,m, p).\nwhere\nC(\u03c1,M, c,m, p) = 2\nc\u03c1M\n\u221a log p\nm + 3M\n\u221a \u2308\n4 \u03c12 log\n( c2M2\u03c12m\n4 log p )\u2309 log p m + log 2\u03b4 2m .\nProof. The proof makes use of Theorem 1 and the proof techniques of Kuznetsov et al. [2014][Theorem 1] but requires a finer analysis both because of the general loss functions used here and because of the more complex structure of the hypothesis set.\nFor a fixed h = (h1, . . . , hT ), any \u03b1 in the probability simplex \u2206 defines a distribution over {h1, . . . , hT }. Sampling from {h1, . . . , hT } according to \u03b1 and averaging leads to functions g of the form g = 1n \u2211T i=1 ntht for some n = (n1, . . . , nT ), with \u2211T t=1 nt = n, and ht \u2208 Hkt . For any N = (N1, . . . , Np) with |N| = n, we consider the family of functions\nGF,N =\n{ 1\nn\np\u2211\nk=1\nNk\u2211\nj=1\nhk,j | \u2200(k, j) \u2208 [p]\u00d7 [Nk], hk,j \u2208 Hk } ,\nand the union of all such families GF,n = \u22c3 |N|=nGF,N. Fix \u03c1 > 0. For a fixed N, the factor graph Rademacher complexity of GF,N can be bounded as follows for any m \u2265 1:\nRGm(GF,N) \u2264 1\nn\np\u2211\nk=1\nNkR G m(Hk).\nThus, by Theorem 1, the following learning bound holds: for any \u03b4 > 0, with probability at least 1\u2212 \u03b4, for all g \u2208 GF,N,\nRadd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g) \u2264\n1\nn\n4 \u221a 2\n\u03c1\np\u2211\nk=1\nNkR G m(Hk) + \u221a log 1\u03b4 2m .\nSince there are at most pn possible p-tuples N with |N| = n,2 by the union bound, for any \u03b4 > 0, with probability at least 1\u2212 \u03b4, for all g \u2208 GF,n, we can write\nRadd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g) \u2264\n1\nn\n4 \u221a 2\n\u03c1\np\u2211\nk=1\nNkR G m(Hk) +\n\u221a log p n\n\u03b4\n2m .\nThus, with probability at least 1\u2212 \u03b4, for all functions g = 1n \u2211T i=1 ntht with ht \u2208 Hkt , the following inequality holds\nRadd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g) \u2264\n1\nn\n4 \u221a 2\n\u03c1\np\u2211\nk=1\n\u2211\nt:kt=k\nntR G m(Hkt) +\n\u221a log p n\n\u03b4\n2m .\nTaking the expectation with respect to \u03b1 and using E\u03b1[nt/n] = \u03b1t, we obtain that for any \u03b4 > 0, with probability at least 1\u2212 \u03b4, for all g, we can write\nE \u03b1 [Radd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g)] \u2264\n4 \u221a 2\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) +\n\u221a log p n\n\u03b4\n2m .\nFix n \u2265 1. Then, for any \u03b4n > 0, with probability at least 1\u2212 \u03b4n,\nE \u03b1 [Radd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g)] \u2264\n4 \u221a 2\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) +\n\u221a log p n\n\u03b4n\n2m .\nChoose \u03b4n = \u03b42pn\u22121 for some \u03b4 > 0, then for p \u2265 2, \u2211 n\u22651 \u03b4n = \u03b4 2(1\u22121/p) \u2264 \u03b4. Thus, for any \u03b4 > 0 and any n \u2265 1, with probability at least 1\u2212 \u03b4, the following holds for all g:\nE \u03b1 [Radd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g)] \u2264\n4 \u221a 2\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) +\n\u221a log 2p 2n\u22121\n\u03b4\n2m . (13)\n2 The number S(p, n) of p-tuples N with |N| = n is known to be precisely ( p+n\u22121 p\u22121 ) .\nNow, for any f = \u2211T t=1 \u03b1tht \u2208 F and any g = 1n \u2211T i=1 ntht, using (4), we can upper-bound R(f), the generalization error of f , as follows:\nR(f) = E [ L(f(x), y)1\u03c1f (x,y)\u22640 ] (14)\n\u2264 E [ L(f(x), y)1\u03c1f (x,y)\u2212(g(x,y)\u2212g(x,yf ))<\u2212\u03c1/2 ] + E [ L(f(x), y)1g(x,y)\u2212g(x,yf )\u2264\u03c1/2 ] \u2264M Pr [ \u03c1f (x, y)\u2212 (g(x, y)\u2212 g(x, yf )) < \u2212\u03c1/2 ] + E [ L(f(x), y)1g(x,y)\u2212g(x,yf )\u2264\u03c1/2 ] ,\nwhere for any function \u03d5 : X \u00d7 Y \u2192 [0, 1], we define y\u2032\u03d5 as follows: y\u2032\u03d5 = argmaxy\u2032 6=y \u03d5(x, y). Using the same arguments as in the proof of Lemma 4, one can show that\nE [ L(f(x), y))1g(x,y)\u2212g(x,yf )<\u03c1/2 ] \u2264 Radd\u03c1/2(g).\nWe now give a lower-bound on R\u0302addS,\u03c1,1(f) in terms ofR add S,\u03c1, 12 (g). To do so, we start with the expression of Radd S,\u03c1, 12 (g):\nR\u0302addS,\u03c1, 12 (g) = E (x,y)\u223cS\n[ \u03a6\u2217 (\nmax y\u2032 6=y\nL(y\u2032, y) + 12\u2212 1\u03c1 [g(x, y)\u2212g(x, y\u2032)] )]\nBy the sub-additivity of max, we can write\nmax y\u2032 6=y\nL(y\u2032, y) + 12\u2212 1\u03c1 [g(x, y)\u2212g(x, y\u2032)]\n\u2264 max y\u2032 6=y\n{ L(y, y\u2032) + 1\u2212 f(x, y)\u2212 f(x, y\n\u2032) \u03c1\n}\n+ max y\u2032 6=y\n{ \u2212 1\n2 + f(x, y)\u2212 f(x, y\u2032) \u03c1 \u2212 g(x, y)\u2212 g(x, y \u2032) \u03c1\n} = X + Y,\nwhere X and Y are defined by\nX = max y\u2032 6=y\n( L(y, y\u2032) + 1\u2212 f(x, y)\u2212 f(x, y\n\u2032) \u03c1\n) ,\nY = \u22121 2 + max y\u2032 6=y\n( f(x, y)\u2212 f(x, y\u2032)\n\u03c1 \u2212 g(x, y)\u2212 g(x, y \u2032) \u03c1\n) .\nIn view of that, since \u03a6\u2217 is non-decreasing and sub-additive (Lemma 11), we can write\nR\u0302addS,\u03c1, 12 (g) \u2264 E (x,y)\u223cS [\u03a6\u2217(X + Y )] (15)\n\u2264 E (x,y)\u223cS [\u03a6\u2217(X) + \u03a6\u2217(Y )] = E (x,y)\u223cS [\u03a6\u2217(X)] + E (x,y)\u223cS [\u03a6\u2217(Y )]\n= R\u0302addS,\u03c1,1(f) + E (x,y)\u223cS [\u03a6\u2217(Y )]\n\u2264 R\u0302addS,\u03c1,1(f) +M E (x,y)\u223cS [1Y >0]\n= R\u0302addS,\u03c1,1(f) +M Pr (x,y)\u223cS [ max y\u2032 6=y { f(x, y)\u2212 g(x, y) + (g(x, y\u2032)\u2212 f(x, y\u2032)) } > \u03c1/2 ] .\nCombining (14) and (15) shows that R(f)\u2212 R\u0302addS,\u03c1,1(f) is bounded by\nRadd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g) +M Pr\n[ \u03c1f (x, y)\u2212 (g(x, y)\u2212 g(x, yf )) < \u2212\u03c1/2 ]\n+M Pr (x,y)\u223cS [ max y\u2032 6=y {f(x, y)\u2212 g(x, y) + (g(x, y\u2032)\u2212 f(x, y\u2032))} > \u03c1/2 ] .\nTaking the expectation with respect to \u03b1 shows that R(f)\u2212 R\u0302addS,\u03c1,1(f) is bounded by\nE \u03b1 [ Radd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g) ] +M E (x,y)\u223cD,\u03b1 [ 1\u03c1f (x,y)\u2212(g(x,y)\u2212g(x,yf ))<\u2212\u03c1/2 ]\n+M E (x,y)\u223cS,\u03b1\n[ 1maxy\u2032 6=y{f(x,y)\u2212g(x,y)+(g(x,y\u2032)\u2212f(x,y\u2032))}>\u03c1/2 ] . (16)\nBy Hoeffding\u2019s bound, the following holds:\nE \u03b1\n[ 1\u03c1f (x,y)\u2212(g(x,y)\u2212g(x,yf ))<\u2212\u03c1/2 ] = Pr\n\u03b1\n[ (f(x, y)\u2212 f(x, yf ))\u2212 (g(x, y)\u2212 g(x, yf )) < \u2212\u03c1/2 ]\n\u2264 e\u2212n\u03c12/8. Similarly, using the union bound and Hoeffding\u2019s bound, the third expectation term appearing in (16) can be bounded as follows:\nE \u03b1 [ 1maxy\u2032 6=y{f(x,y)\u2212g(x,y)+(g(x,y\u2032)\u2212f(x,y\u2032))}>\u03c1/2 ]\n= Pr \u03b1 [ max y\u2032 6=y {f(x, y)\u2212 g(x, y) + (g(x, y\u2032)\u2212 f(x, y\u2032))} > \u03c1/2 ] \u2264 \u2211\ny\u2032 6=y Pr \u03b1\n[ f(x, y)\u2212 g(x, y) + (g(x, y\u2032)\u2212 f(x, y\u2032)) > \u03c1/2 ]\n\u2264 (c\u2212 1)e\u2212n\u03c12/8. Thus, for any fixed f , we can write\nR(f)\u2212 R\u0302addS,\u03c1,1(f) \u2264 cMe\u2212n\u03c1 2/8 + E\n\u03b1 [ Radd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g) ] .\nTherefore, the following quantity upper bounds supf R(f)\u2212 R\u0302addS,\u03c1,1(f):\ncMe\u2212n\u03c1 2/8 + sup\ng E \u03b1 [ Radd\u03c1, 12 (g)\u2212 R\u0302addS,\u03c1, 12 (g) ] ,\nand, in view of (13), for any \u03b4 > 0 and any n \u2265 1, with probability at least 1\u2212 \u03b4, the following holds for all f :\nR(f)\u2212 R\u0302addS,\u03c1,1(f) \u2264 cMe\u2212n\u03c1 2/8 +\n4 \u221a 2\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) +\n\u221a log 2p 2n\u22121\n\u03b4\n2m .\nChoosing n = \u2308\n4 \u03c12 log\n( M2c2\u03c12m\n4 log p\n)\u2309 yields the following inequality:3\nR(f)\u2212 R\u0302addS,\u03c1,1(f) \u2264 4 \u221a 2\n\u03c1\nT\u2211\nt=1\n\u03b1tR G m(Hkt) +\n2\nc\u03c1M\n\u221a log p\nm\n+ 3M\n\u221a \u2308\n4 \u03c12 log\n( c2M2\u03c12m\n4 log p )\u2309 log p m + log 2\u03b4 2m ,\nand concludes the proof.\nA.8 General upper bound on the loss based on convex surrogates\nHere, we present the proof of a general upper bound on a loss function in terms of convex surrogates.\n3To select n we consider f(n) = ce\u2212nu + \u221a nv, where u = \u03c12/8 and v = log p/m. Taking the derivative of f , setting it to zero and solving for n, we obtain n = \u2212 1 2u W\u22121(\u2212 v2c2u ) where W\u22121 is the second branch of the Lambert function (inverse of x 7\u2192 xex). Using the bound \u2212 log x \u2264 \u2212W\u22121(\u2212x) \u2264 2 log x leads to the following choice of n: n = \u2308 \u2212 1\n2u log( v 2c2u ) \u2309 .\nLemma 4. For any u \u2208 R+, let \u03a6u : R\u2192 R be a decreasing upper bound on v 7\u2192 u1v\u22640 such that u 7\u2192 \u03a6u(v) is increasing for a fixed v. Then, the following upper bound holds for any h \u2208 H and (x, y) \u2208 X \u00d7 Y ,\nL(h(x), y) \u2264 max y\u2032 6=y \u03a6L(y\u2032,y)(h(x, y)\u2212 h(x, y\u2032)). (17)\nProof. By (4) and the property of \u03a6u as an upper bound, for any (x, y) \u2208 X \u00d7 Y , we can write L(h(x), y) = L(h(x), y)1\u03c1h(x,y)\u22640\n\u2264 \u03a6L(h(x),y)(\u03c1h(x, y)) = \u03a6L(h(x),y)(h(x, y)\u2212max\ny\u2032 6=y h(x, y\u2032)).\nIf h(x) 6= y, then, since maxy\u2032 6=y h(x, y\u2032) = h(x, h(x)), the following holds: L(h(x), y) \u2264 \u03a6L(h(x),y)(h(x, y)\u2212 h(x, h(x))\n\u2264 max y\u2032 6=y \u03a6L(y\u2032,y)(h(x, y)\u2212 h(x, y\u2032)).\nOtherwise, if h(x) = y, then L(h(x), y)) = 0 \u2264 L(y\u2032, y) for all y\u2032 6= y. Since u 7\u2192 \u03a6u(h(x, y) \u2212 h(x, y\u2032)) is increasing, this implies\n\u03a6L(h(x),y)(h(x, y)\u2212 h(x, y\u2032)) \u2264 \u03a6L(y\u2032,y)(h(x, y)\u2212 h(x, y\u2032)),\nfor all y\u2032 6= y. Using the fact that \u03a6L(h(x),y) is decreasing and the inequality just shown yields\nL(h(x), y) = \u03a6L(h(x),y)(h(x, y)\u2212max y\u2032 6=y h(x, y\u2032))\n= max y\u2032 6=y\n\u03a6L(h(x),y)(h(x, y)\u2212 h(x, y\u2032))\n\u2264 max y\u2032 6=y \u03a6L(y\u2032,y)(h(x, y)\u2212 h(x, y\u2032)),\nand completes the proof."}, {"heading": "B Experiments", "text": "This section reports the results of preliminary experiments with the VCRF algorithm. The experiments in this section are meant to serve as a proof of concept of the benefits of VRM-type regularization as suggested by the theory developed in this paper. We leave an extensive experimental study of other aspects of our theory, including general loss functions, convex surrogates and p-norms, to future work.\nFor our experiments, we chose the part-of-speech task (POS) that consists of labeling each word of a sentence with its correct part-of-speech tag. We used 10 POS datasets: Basque, Chinese, Dutch, English, Finnish, Finnish-FTB, Hindi, Tamil, Turkish and Twitter. The detailed description of these datasets is in Appendix B.1. Our VCRF algorithm can be applied with a variety of different families of feature functions Hk mapping X \u00d7 Y to R. Details concerning features and complexity penalties rks are provided in Appendix B.2, while an outline of our hyperparameter selection and cross-validation procedure is given in Appendix B.3.\nThe average error and the standard deviation of the errors are reported in Table 1 for each data set. Our results show that VCRF provides a statistically significant improvement over L1-CRF on every dataset, with the exception of English and Dutch. One-sided paired t-test at 5% level was used to assess the significance of the results. It should be noted that for all of the significant results, VCRF outperformed L1-CRF on every fold. Furthermore, our results indicate that VCRF tends to produce models that are sparser than those of L1-CRF. This is highlighted in Table 2 of Appendix B.2. In a separate set of experiments, we have also tested the robustness of our algorithm to erroneous annotations and noise. The details and the results of these experiments are given in Appendix B.4.\nTable 2 illustrates the impact on sparsity of VCRF versus L1-regularized CRF. As can be seen, VCRF tends to produce models that are much more sparse, due to its heavy penalization on the large number of higher-order features.\nFurther details on the datasets and the specific features as well as more experimental results are provided below.\nB.1 Datasets\nTable 3 provides some statistics for each of the datasets that we use. These datasets span a variety of sizes, in terms of sentence count, token count, and unique token count. Most are annotated under the Universal Dependencies (UD) annotation system, with the exception of the Chinese (Palmer et al. [2007]), Turkish (Oflazer et al. [2003], Atalay et al. [2003]), and Twitter (Gimpel et al. [2011], Owoputi et al. [2013]) datasets.\nB.2 Features and Complexities\nThe standard features that are used in POS tagging are usually binary indicators that signal the occurrence of certain words, tags or other linguistic constructs such as suffixes, prefixes, punctuation, capitalization or numbers in a window around a given position in the sequence. In our experiments, we use the union of a broad family of products of such indicator functions. Let V denote the input vocabulary over alphabet \u03a3. For x \u2208 V and t \u2265 0, let suff(x, t) be the suffix of length t for the word x and pref(x, t) the prefix. Then for k1, k2, k3 \u2265 0, we can define the following three families of base features:\nHwk1(s) = { x 7\u2192 1xs+rs\u2212t+1=x\u2032 : t, r \u2208 N, r + t = k1, x \u2032 \u2208 V k1 } , H tagk2 (s) = {y 7\u2192 1yss\u2212k2+1=y\u2032 : y \u2208 \u2206 k2}, Hspk3(s) = { x 7\u2192 1suff(xs,t)=S1pref(xs,r)=P : t, r \u2208 N, t+ r = k3, S \u2208 \u03a3t, P \u2208 \u03a3r } .\nWe can then define a family of features Hk1,k2,k3 that consists of functions of the form\n\u03a8(x, y) =\nl\u2211\ns=1\n\u03c8(x, yss\u2212k2+1, s),\nwhere \u03c8(x, yss\u2212k2+1, s) = h1(x)h2(y s s\u2212k2+1)h3(x), for some h1 \u2208 Hwk1(s), h2 \u2208 H tag k2 (s), h3 \u2208 Hspk3(s). As an example, consider the following sentence:\nDET NN VBD RB JJ The cat was surprisingly agile\nThen, at position s = 3, the following features h1 \u2208 Hw3 (3), h2 \u2208 Htag2 (3), h3 \u2208 Hsp1 (3) would activate:\nh1(x) = 1x2=\u2018was\u2019, x3=\u2018surprisingly\u2019, x4=\u2018agile\u2019(x)\nh2(y) = 1y2=\u2019VBD\u2019, y3=\u2018RB\u2019(y)\nh3(x) = 1suff(x3,2)=\u2018ly\u2019(x).\nSee Figure 2 for an illustration.\nNow, recall that the VCRF algorithm requires knowledge of complexities r(Hk1,k2,k3). By definition of the hypothesis set and rks\nr(Hk1,k2,k3) \u2264 \u221a\n2(k1 log |V |+ k2 log |\u2206|+ k3 log |\u03a3| m , (18)\nwhich is precisely the complexity penalty used in our experiments.\nThe impact of this added penalization can be seen in Table 2, where it is seen that the number of non-zero features for VCRF can be dramatically smaller than the number for L1-regularized CRF.\nB.3 Hyperparameter Tuning and Cross-Validation\nRecall that the VCRF algorithm admits two hyperparameters \u03bb and \u03b2. In our experiments, we optimized over \u03bb, \u03b2 \u2208 {1, 0.5, 10\u22121, . . . , 10\u22125, 0}. We compared VCRF against L1-regularized CRF, which is the special case of VCRF with \u03bb = 0. For gradient computation, we used the procedure in Section D.2.1, which is agnostic to the choice of the underlying loss function. While our algorithms can be used with very general families of loss functions this choice allows an easy direct comparison with the CRF algorithm. We ran each algorithm for 50 full passes over the entire training set or until convergence.\nIn each of the experiments, we used 5-fold cross-validation for model selection and performance evaluation. Each dataset was randomly partitioned into 5 folds, and each algorithm was run 5 times, with a different assignment of folds to the training set, validation set and test set for each run. For each run i \u2208 {0, . . . , 4}, fold i was used for validation, fold i+ 1( mod 5) was used for testing, and the remaining folds were used for training. In each run, we selected the parameters that had the lowest token error on the validation set and then measured the token error of those parameters on the test set. The average error and the standard deviation of the errors are reported in Table 1 for each data set.\nB.4 More Experiments\nIn this section, we present our results for a POS tagging task when noise is artificially injected into the labels. Specifically, for tokens corresponding to features that commonly appear in the dataset (at least five times in our experiments), we flip their associated POS label to some other arbitrary label with a specified probability.\nThe results of these experiments are given in Table 4. They demonstrate that VCRF outperforms L1CRF in the majority of cases. Moreover, these differences can be magnified from the original scenario, as can be seen on the examples of English and Twitter datasets at the 30% noise level.\nC Voted Structured Boosting (VStructBoost)\nIn this section, we consider algorithms based on the StructBoost surrogate loss, where we choose \u03a6u(v) = ue\n\u2212v . Let \u03b4\u03a8(x, y, y\u2032) = \u03a8(x, y)\u2212\u03a8(x, y\u2032). This then leads to the following optimization problem:\nmin w\n1\nm\nm\u2211\ni=1\nmax y 6=yi\nL(y, yi)e \u2212w\u00b7\u03b4\u03a8(xi,yi,y) +\np\u2211\nk=1\n(\u03bbrk + \u03b2)\u2016wk\u20161. (19)\nOne disadvantage of this formulation is that the first term of the objective is not differentiable. Upper bounding the maximum by a sum leads to the following optimization problem:\nmin w\n1\nm\nm\u2211\ni=1\n\u2211 y 6=yi L(y, yi)e \u2212w\u00b7\u03b4\u03a8(xi,yi,y) + p\u2211 k=1 (\u03bbrk + \u03b2)\u2016wk\u20161. (20)\nWe refer to the learning algorithm based on the optimization problem (20) as VStructBoost. To the best of our knowledge, the formulations (19) and (20) are new, even with the standard L1- or L2-regularization."}, {"heading": "D Optimization solutions", "text": "Here, we show how the optimization problems in (10) and (20) can be solved efficiently when the feature vectors admit a particular factor graph decomposition that we refer to as Markov property.\nD.1 Markovian features\nWe will consider in what follows the common case where Y is a set of sequences of length l over a finite alphabet \u2206 of size r. Other structured problems can be treated in similar ways. We will denote by \u03b5 the empty string and for any sequence y = (y1, . . . , yl) \u2208 Y , we will denote by ys \u2032\ns = (ys, . . . , ys\u2032) the substring of y starting at index s and ending at s \u2032. For convenience, for s \u2264 0,\nwe define ys by ys = \u03b5.\nOne common assumption that we shall adopt here is that the feature vector \u03a8 admits a Markovian property of order q. By this, we mean that it can be decomposed as follows for any (x, y) \u2208 X \u00d7 Y:\n\u03a8(x, y) =\nl\u2211\ns=1\n\u03c8(x, yss\u2212q+1, s). (21)\nfor some position-dependent feature vector function \u03c8 defined over X \u00d7\u2206q \u00d7 [l]. This also suggests a natural decomposition of the family of feature vectors \u03a8 = (\u03a81, . . . ,\u03a8p) for the application of VRM principle where \u03a8k is a Markovian feature vector of order k. Thus, Fk then consists of the family of Markovian feature functions of order k. We note that we can write \u03a8 = \u2211p k=1 \u03a8\u0303k with \u03a8\u0303k = (0, . . . ,\u03a8k, . . . , 0). In the following, abusing the notation, we will simply write \u03a8k instead of \u03a8\u0303k. Thus, for any x \u2208 X and y \u2208 Y ,4\n\u03a8(x, y) =\np\u2211\nk=1\n\u03a8k(x, y). (22)\nFor any k \u2208 [1, p], let \u03c8k denote the position-dependent feature vector function corresponding to \u03a8k. Also, for any x \u2208 X and y \u2208 \u2206l, define \u03c8\u0303 by \u03c8\u0303(x, yss\u2212p+1, s) = \u2211p k=1\u03c8k(x, y s s\u2212k+1, s). Observe then that we can write\n\u03a8(x, y) =\np\u2211\nk=1\n\u03a8k(x, y) =\np\u2211\nk=1\nl\u2211\ns=1\n\u03c8k(x, y s s\u2212k+1, s)\n=\nl\u2211\ns=1\np\u2211\nk=1\n\u03c8k(x, y s s\u2212k+1, s)\n=\nl\u2211\ns=1\n\u03c8\u0303(xi, y s s\u2212p+1, s). (23)\nIn Sections D.2 and D.3, we describe algorithms for efficiently computing the gradient by leveraging the underlying graph structure of the problem.\nD.2 Efficient gradient computation for VCRF\nIn this section, we show how Gradient Descent (GD) and Stochastic Gradient Descent (SGD) can be used to solve the optimization problem of VCRF. To do so, we will show how the subgradient of the contribution to the objective function of a given point xi can be computed efficiently. Since the computation of the subgradient of the regularization term presents no difficulty, it suffices to show that the gradient of Fi, the contribution of point xi to the empirical loss term for an arbitrary i \u2208 [m], can be computed efficiently. In the special case of the Hamming loss or when loss is omitted from the objective altogether, this coincides with the standard CRF training procedure. We extend this to more general families of loss function.\nFix i \u2208 [m]. For the VCRF objective, Fi can be rewritten as follows:\nFi(w) = 1\nm log\n(\u2211\ny\u2208Y eL(y,yi)\u2212w\u00b7\u03b4\u03a8(xi,yi,y)\n) = 1\nm log\n(\u2211\ny\u2208Y eL(y,yi)+w\u00b7\u03a8(xi,y)\n) \u2212w \u00b7\u03a8(xi, yi)\nm .\nThe following lemma gives the expression of the gradient of Fi and helps identify the key computationally challenging terms qw. Lemma 12. The gradient of Fi at any w can be expressed as follows:\n\u2207Fi(w) = 1\nm\nl\u2211\ns=1\n\u2211\nz\u2208\u2206p\n[ \u2211\ny : yss\u2212p+1=z\nqw(y) ] \u03c8\u0303(xi, z, s)\u2212 \u03a8(xi, yi)\nm ,\nwhere, for all y \u2208 Y ,\nqw(y) = eL(y,yi)+w\u00b7\u03a8(xi,y)\nZw ,\nZw = \u2211\ny\u2208Y eL(y,yi)+w\u00b7\u03a8(xi,y).\n4Our results can be straightforwardly generalized to more complex decompositions of the form \u03a8(x, y) =\u2211Q q=1 \u2211p k=1 \u03a8q,k(x, y).\nProof. In view of the expression of Fi given above, the gradient of Fi at any w is given by\n\u2207Fi(w) = 1\nm\n\u2211\ny\u2208Y\neL(y,yi)+w\u00b7\u03a8(xi,y)\u2211 y\u0303\u2208Y e L(y\u0303,yi)+w\u00b7\u03a8(xi,y\u0303) \u03a8(xi, y)\u2212 \u03a8(xi, yi) m\n= 1\nm E y\u223cqw [\u03a8(xi, y)]\u2212\n\u03a8(xi, yi)\nm .\nBy (23), we can write\nE y\u223cqw\n[\u03a8(xi, y)] = \u2211\ny\u2208\u2206l qw(y)\nl\u2211\ns=1\n\u03c8\u0303(xi, y s s\u2212p+1, s) =\nl\u2211\ns=1\n\u2211\nz\u2208\u2206p\n[ \u2211\ny : yss\u2212p+1=z\nqw(y) ] \u03c8\u0303(xi, z, s),\nwhich completes the proof.\nThe lemma implies that the key computation in the gradient is\nQw(z, s) = \u2211\ny : yss\u2212p+1=z\nqw(y) = \u2211\ny : yss\u2212p+1=z\neL(y,yi) \u220fl t=1 e w\u00b7\u03c8\u0303(xi,ytt\u2212p+1,t)\nZw , (24)\nfor all s \u2208 [l] and z \u2208 \u2206p. The sum defining these terms is over a number of sequences y that is exponential in |\u2206|. However, we will show in the following sections how to efficiently compute Qw(z, s) for any s \u2208 [l] and z \u2208 \u2206p in several important cases: (0) in the absence of a loss; (1) when L is Markovian; (2) when L is a rational loss; and (3) when L is the edit-distance or any other tropical loss.\nD.2.1 Gradient computation in the absence of a loss In that case, it suffices to show how to compute Z \u2032w = \u2211 y\u2208Y e\nw\u00b7\u03a8(xi,y) and the following term, ignoring the loss factors:\nQ\u2032w(z, s) = \u2211\ny : yss\u2212p+1=z\nl\u220f\nt=1\new\u00b7\u03c8\u0303(xi,y t t\u2212p+1,t), (25)\nfor all s \u2208 [l] and z \u2208 \u2206p. We will show that Q\u2032w(z, s) coincides with the flow through an edge of a weighted graph we will define, which leads to an efficient computation. We will use for any y \u2208 \u2206l, the convention ys = \u03b5 if s \u2264 0. Now, let A be the weighted finite automaton (WFA) with the following set of states:\nQA = { (ytt\u2212p+1, t) : y \u2208 \u2206l, t = 0, . . . , l } ,\nwith IA = (\u03b5, 0) its single initial state, FA = {(yll\u2212p+1, l) : y \u2208 \u2206l} its set of final states, and a transition from state (yt\u22121t\u2212p+1, t\u2212 1) to state (yt\u22121t\u2212p+2 b, t) with label b and weight \u03c9(yt\u22121t\u2212p+1 b, t) = ew\u00b7\u03c8\u0303(xi,y t\u22121 t\u2212p+1b,t), that is the following set of transitions:\nEA = {( (yt\u22121t\u2212p+1, t\u2212 1), b, \u03c9(yt\u22121t\u2212p+1 b, t), (yt\u22121t\u2212p+2 b, t) ) : y \u2208 \u2206l, b \u2208 \u2206, t \u2208 [l] } .\nFigure 3 illustrates this construction in the case p = 2. The WFA A is deterministic by construction. The weight of a path in A is obtained by multiplying the weights of its constituent transitions. In view of that, Q\u2032w(z, s) can be seen as the sum of the weights of all paths in A going through the transition from state (zp\u221211 , s\u2212 1) to (zp2, s) with label zp. For any state (ytt\u2212p+1, t) \u2208 QA, let \u03b1((ytt\u2212p+1, t)) denote the sum of the weights of all paths in A from IA to (ytt\u2212p+1, t) and \u03b2((y t t\u2212p+1, t)) the sum of the weights of all paths from (y t t\u2212p+1, t) to a final state. Then, Q\u2032w(z, s) is given by\nQ\u2032w(z, s) = \u03b1 ( (zp\u221211 , s\u2212 1) ) \u00d7 \u03c9(z, s)\u00d7 \u03b2 ( (zp2, s) ) .\nNote also that Z \u2032w is simply the sum of the weights of all paths in A, that is Z \u2032 w = \u03b2((\u03b5, 0)).\nSince A is acyclic, \u03b1 and \u03b2 can be computed for all states in linear time in the size of A using a single-source shortest-distance algorithm over the (+,\u00d7) semiring or the so-called forward-backward algorithm. Thus, since A admits O(l|\u2206|p) transitions, we can compute all of the quantities Q\u2032w(z, s), s \u2208 [l] and z \u2208 \u2206p and Z \u2032w, in time O(l|\u2206|p).\nD.2.2 Gradient computation with a Markovian loss\nWe will say that a loss function L is Markovian if it admits a decomposition similar to the features, that is for all y, y\u2032 \u2208 Y ,\nL(y, y\u2032) = l\u2211\nt=1\nLt(y t t\u2212p+1, y \u2032t t\u2212p+1).\nIn that case, we can absorb the losses in the transition weights and define new transition weights \u03c9\u2032 as follows:\n\u03c9\u2032(t, yt\u22121t\u2212p+1 b) = e Lt(y t\u22121 t\u2212p+1 b,(yi) t\u22121 t\u2212p+1 b)\u03c9(yt\u22121t\u2212p+1 b, t).\nUsing the resulting WFA A\u2032 and precisely the same techniques as those described in the previous section, we can compute all Qw(z, s) in time O(l|\u2206|p). In particular, we can compute efficiently these quantities in the case of the Hamming loss which is a Markovian loss for p = 1.\nD.3 Efficient gradient computation for VStructBoost\nIn this section, we briefly describe the gradient computation for VStructBoost, which follows along similar lines as the discussion for VCRF.\nFix i \u2208 [m] and let Fi denote the contribution of point xi to the empirical loss in VStructBoost. Using the equality L(yi, yi) = 0, Fi can be rewritten as\nFi(w) = 1\nm\n\u2211 y 6=yi L(y, yi)e \u2212w\u00b7\u03b4\u03a8(xi,yi,y) = 1 m e\u2212w\u00b7\u03a8(xi,yi) \u2211 y\u2208\u2206l L(y, yi)e w\u00b7\u03a8(xi,y).\nThe gradient of Fi can therefore be expressed as follows:\n\u2207Fi(w) = 1 m e\u2212w\u00b7\u03a8(xi,yi)\n\u2211\ny\u2208\u2206l L(y, yi)e\nw\u00b7\u03a8(xi,y)\u03a8(xi, y) (26)\n\u2212 1 m e\u2212w\u00b7\u03a8(xi,yi)\u03a8(xi, yi)\n\u2211\ny\u2208\u2206l L(y, yi)e\nw\u00b7\u03a8(xi,y).\nEfficient computation of these terms is not straightforward, since the sums run over exponentially many sequences y. However, by leveraging the Markovian property of the features, we can reduce the calculation to flow computations over a weighted directed graph, in a manner analogous to what we demonstrated for VCRF.\nD.4 Inference\nIn this section, we describe an efficient algorithm for inference when using Markovian features. The algorithm consists of a standard single-source shortest-path algorithm applied to a WFA A\u2032 differs from the WFA A only by the weight of each transition, defined as follows:\nEA\u2032 = {( (y\u0304t\u22121t\u2212p+1, t\u2212 1), b,w \u00b7 \u03c8\u0303(x, yt\u22121t\u2212p+1b, t), (y\u0304t\u22121t\u2212p+2 b, t) ) : y \u2208 \u2206l, b \u2208 \u2206, t \u2208 [l] } .\nFurthermore, here, the weight of a path is obtained by adding the weights of its constituent transitions. Figure 4 shows A\u2032 in the special case of p = 2. By construction, the weight of the unique accepting path in A\u2032 labeled with y \u2208 \u2206l is\u2211lt=1 w \u00b7 \u03c8\u0303(x, yt\u22121t\u2212p+1b, t) = w \u00b7\u03a8(x, y). Thus, the label of the single-source shortest path, argminy\u2208\u2206l w \u00b7\u03a8(x, y), is the desired predicted label. Since A\u2032 is acyclic, the running-time complexity of the algorithm is linear in the size of A\u2032, that is O(l|\u2206|l)."}, {"heading": "Appendix References", "text": "N. B. Atalay, K. Oflazer, and B. Say. The annotation process in the turkish treebank. In LINC, 2003.\nK. Gimpel, N. Schneider, B. O\u2019Connor, D. Das, D. Mills, J. Eisenstein, M. Heilman, D. Yogatama, J. Flanigan, and N. A. Smith. Part-of-speech tagging for twitter: annotation, features, and experiments. In ACL, 2011.\nV. Koltchinskii and D. Panchenko. Empirical margin distributions and bounding the generalization error of combined classifiers. Annals of Statistics, 30, 2002.\nV. Kuznetsov, M. Mohri, and U. Syed. Multi-class deep boosting. In Proceedings of NIPS, 2014.\nM. Ledoux and M. Talagrand. Probability in Banach Spaces: Isoperimetry and Processes. Springer, 1991.\nM. Mohri, A. Rostamizadeh, and A. Talwalkar. Foundations of Machine Learning. The MIT Press, 2012.\nK. Oflazer, B. Say, D. Z. Hakkani-T\u00fcr, and G. T\u00fcr. Building a turkish treebank. In Text, Speech and Language Technology, volume 20, pages 261\u2013277. Springer Netherlands, 2003.\nO. Owoputi, B. O\u2019Connor, C. Dyer, K. Gimpel, N. Schneider, and N. A. Smith. Improved part-of-speech tagging for online conversational text with word clusters. In Proceedings of NAACL-HLT, pages 380\u2013390, 2013.\nM. Palmer, N. Xue, F. Xia, F.-D. Chiou, Z. Jiang, and M. Chang. Chinese treebank 6.0 LDC2007T36. Web Download, 2007."}], "references": [{"title": "The annotation process in the turkish treebank", "author": ["N.B. Atalay", "K. Oflazer", "B. Say"], "venue": "In LINC,", "citeRegEx": "Atalay et al\\.,? \\Q2003\\E", "shortCiteRegEx": "Atalay et al\\.", "year": 2003}, {"title": "Part-of-speech tagging for twitter: annotation, features, and experiments", "author": ["K. Gimpel", "N. Schneider", "B. O\u2019Connor", "D. Das", "D. Mills", "J. Eisenstein", "M. Heilman", "D. Yogatama", "J. Flanigan", "N.A. Smith"], "venue": "In ACL,", "citeRegEx": "Gimpel et al\\.,? \\Q2011\\E", "shortCiteRegEx": "Gimpel et al\\.", "year": 2011}, {"title": "Empirical margin distributions and bounding the generalization error of combined classifiers", "author": ["V. Koltchinskii", "D. Panchenko"], "venue": "Annals of Statistics,", "citeRegEx": "Koltchinskii and Panchenko.,? \\Q2002\\E", "shortCiteRegEx": "Koltchinskii and Panchenko.", "year": 2002}, {"title": "Multi-class deep boosting", "author": ["V. Kuznetsov", "M. Mohri", "U. Syed"], "venue": "In Proceedings of NIPS,", "citeRegEx": "Kuznetsov et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Kuznetsov et al\\.", "year": 2014}, {"title": "Probability in Banach Spaces: Isoperimetry and Processes", "author": ["M. Ledoux", "M. Talagrand"], "venue": null, "citeRegEx": "Ledoux and Talagrand.,? \\Q1991\\E", "shortCiteRegEx": "Ledoux and Talagrand.", "year": 1991}, {"title": "Foundations of Machine Learning", "author": ["M. Mohri", "A. Rostamizadeh", "A. Talwalkar"], "venue": null, "citeRegEx": "Mohri et al\\.,? \\Q2012\\E", "shortCiteRegEx": "Mohri et al\\.", "year": 2012}, {"title": "Building a turkish treebank", "author": ["K. Oflazer", "B. Say", "D.Z. Hakkani-T\u00fcr", "G. T\u00fcr"], "venue": "In Text, Speech and Language Technology,", "citeRegEx": "Oflazer et al\\.,? \\Q2003\\E", "shortCiteRegEx": "Oflazer et al\\.", "year": 2003}, {"title": "Improved part-of-speech tagging for online conversational text with word clusters", "author": ["O. Owoputi", "B. O\u2019Connor", "C. Dyer", "K. Gimpel", "N. Schneider", "N.A. Smith"], "venue": "In Proceedings of NAACL-HLT,", "citeRegEx": "Owoputi et al\\.,? \\Q2013\\E", "shortCiteRegEx": "Owoputi et al\\.", "year": 2013}, {"title": "Chinese treebank 6.0 LDC2007T36", "author": ["M. Palmer", "N. Xue", "F. Xia", "F.-D. Chiou", "Z. Jiang", "M. Chang"], "venue": "Web Download,", "citeRegEx": "Palmer et al\\.,? \\Q2007\\E", "shortCiteRegEx": "Palmer et al\\.", "year": 2007}], "referenceMentions": [{"referenceID": 5, "context": "All of these margin bounds can be extended to hold uniformly over \u03c1 \u2208 (0, 1] at the price of an additional term of the form \u221a (log log2 2 \u03c1 )/m in the bound, using known techniques (see for example [Mohri et al., 2012]).", "startOffset": 198, "endOffset": 218}, {"referenceID": 3, "context": "In that case, for linear hypotheses, the complexity term of our bound varies as O(\u039b2r2 \u221a c/\u03c12m) for example for norm-2 regularization (Corollary 9), which improves upon the best known general margin bounds of Kuznetsov et al. [2014], who provide a guarantee that scales linearly with the number of classes instead.", "startOffset": 209, "endOffset": 233}, {"referenceID": 3, "context": "In that case, for linear hypotheses, the complexity term of our bound varies as O(\u039b2r2 \u221a c/\u03c12m) for example for norm-2 regularization (Corollary 9), which improves upon the best known general margin bounds of Kuznetsov et al. [2014], who provide a guarantee that scales linearly with the number of classes instead. Moreover, in the special case where an individual wy is learned for each class y \u2208 [c], we retrieve the recent favorable bounds given by Lei et al. [2015], albeit with a somewhat simpler formulation.", "startOffset": 209, "endOffset": 470}, {"referenceID": 3, "context": "In that case, for linear hypotheses, the complexity term of our bound varies as O(\u039b2r2 \u221a c/\u03c12m) for example for norm-2 regularization (Corollary 9), which improves upon the best known general margin bounds of Kuznetsov et al. [2014], who provide a guarantee that scales linearly with the number of classes instead. Moreover, in the special case where an individual wy is learned for each class y \u2208 [c], we retrieve the recent favorable bounds given by Lei et al. [2015], albeit with a somewhat simpler formulation. In that case, for any (x, y), all components of the feature vector \u03a8(x, y) are zero, except (perhaps) for the N components corresponding to class y, where N is the dimension of wy. In view of that, for example for a group-norm \u2016 \u00b7 \u20162,1regularization, the complexity term of our bound varies as O(\u039br \u221a (log c)/\u03c12m), which matches the results of Lei et al. [2015] with a logarithmic dependency on c (ignoring some complex exponents of log c in their case).", "startOffset": 209, "endOffset": 877}, {"referenceID": 2, "context": "By standard Rademacher complexity bounds (Koltchinskii and Panchenko [2002]), for any \u03b4 > 0, with probability at least 1\u2212 \u03b4, the following inequality holds for all h \u2208 H: Radd \u03c1 (h) \u2264 R\u0302add S,\u03c1(h) + 2Rm(H0) + \u221a log 1\u03b4 2m ,", "startOffset": 42, "endOffset": 76}, {"referenceID": 4, "context": "Since \u03a6\u2217 is 1-Lipschitz, by Talagrand\u2019s contraction lemma (Ledoux and Talagrand [1991], Mohri et al.", "startOffset": 59, "endOffset": 87}, {"referenceID": 4, "context": "Since \u03a6\u2217 is 1-Lipschitz, by Talagrand\u2019s contraction lemma (Ledoux and Talagrand [1991], Mohri et al. [2012]), we have Rm(H0) \u2264 Rm(H1).", "startOffset": 59, "endOffset": 108}, {"referenceID": 3, "context": "The proof makes use of Theorem 1 and the proof techniques of Kuznetsov et al. [2014][Theorem 1] but requires a finer analysis both because of the general loss functions used here and because of the more complex structure of the hypothesis set.", "startOffset": 61, "endOffset": 85}, {"referenceID": 4, "context": "Most are annotated under the Universal Dependencies (UD) annotation system, with the exception of the Chinese (Palmer et al. [2007]), Turkish (Oflazer et al.", "startOffset": 111, "endOffset": 132}, {"referenceID": 4, "context": "[2007]), Turkish (Oflazer et al. [2003], Atalay et al.", "startOffset": 18, "endOffset": 40}, {"referenceID": 0, "context": "[2003], Atalay et al. [2003]), and Twitter (Gimpel et al.", "startOffset": 8, "endOffset": 29}, {"referenceID": 0, "context": "[2003], Atalay et al. [2003]), and Twitter (Gimpel et al. [2011], Owoputi et al.", "startOffset": 8, "endOffset": 65}, {"referenceID": 0, "context": "[2003], Atalay et al. [2003]), and Twitter (Gimpel et al. [2011], Owoputi et al. [2013]) datasets.", "startOffset": 8, "endOffset": 88}], "year": 2016, "abstractText": "We present a general theoretical analysis of structured prediction. By introducing a new complexity measure that explicitly factors in the structure of the output space and the loss function, we are able to derive new data-dependent learning guarantees for a broad family of losses and for hypothesis sets with an arbitrary factor graph decomposition. We extend this theory by leveraging the principle of Voted Risk Minimization (VRM) and showing that learning is possible with complex factor graphs. We both present new learning bounds in this advanced setting as well as derive two new families of algorithms, Voted Conditional Random Fields and Voted Structured Boosting, which can make use of very complex features and factor graphs without overfitting. Finally, we also validate our theory through experiments on several datasets.", "creator": "LaTeX with hyperref package"}}}