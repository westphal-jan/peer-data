{"id": "1611.03451", "review": {"conference": "AAAI", "VERSION": "v1", "DATE_OF_SUBMISSION": "10-Nov-2016", "title": "Importance Sampling with Unequal Support", "abstract": "importance sampling is often used in machine learning when training and testing data come from overlapping distributions. in presentation paper we propose a new variant of importance sampling that severely reduce the variance of reference sampling - based estimates by orders of magnitude when the supports of the training and testing protocol differ. after motivating when presenting our new importance sampling estimator, we provide a detailed theoretical setup that characterizes both its bias and variance relative - the ordinary context sampling behavior ( in various settings, which include jurisdictions where ordinary emphasis sampling is biased, while our previous estimator would not, and vice versa ). we conclude with an example of because our new importance sampling estimator can be studied to improve estimates of how well a new treatment policy for diabetes will work for an individual, using only data from when the individual used a previous treatment policy.", "histories": [["v1", "Thu, 10 Nov 2016 19:11:09 GMT  (1654kb,D)", "http://arxiv.org/abs/1611.03451v1", null]], "reviews": [], "SUBJECTS": "cs.LG cs.AI stat.ML", "authors": ["philip s thomas", "emma brunskill"], "accepted": true, "id": "1611.03451"}, "pdf": {"name": "1611.03451.pdf", "metadata": {"source": "CRF", "title": "Importance Sampling with Unequal Support", "authors": ["Philip S. Thomas", "Emma Brunskill"], "emails": [], "sections": [{"heading": "Introduction", "text": "A key challenge in artificial intelligence is to estimate the expectation of a random variable. Instances of this problem arise in areas ranging from planning and decision making (e.g., estimating the expected sum of rewards produced by a policy for decision making under uncertainty) to probabilistic inference. Although the estimation of an expected value is straightforward if we can generate many independent and identically distributed (i.i.d.) samples from the relevant probability distribution (which we refer to as the target distribution), we may not have generative access to the target distribution. Instead, we might only have data from a different distribution that we call the sampling distribution.\nFor example, in off-policy evaluation for reinforcement learning, the goal is to estimate the expected sum of rewards that a decision policy will produce, given only data gathered using some other policy. Similarly, in supervised learning, we may wish to predict the performance of a regressor or classifier if it were to be applied to data that comes from a distribution that differs from the distribution of the available data (e.g., we might predict the accuracy of a classifier for hand-written letters given that observed letter frequencies come from English, using a corpus of labeled letters collected from German documents).\nMore precisely, we consider the problem of estimating \u03b8 := E[h(X)], where h is a real-valued function and the\nexpectation is over the random variable X , which is a sample from the target distribution. As input we assume access to n i.i.d. samples from a sampling distribution that is different from the target distribution. A classical approach to this problem is to use importance sampling (IS), which reweighs the observed samples to account for the difference between the target and sampling distributions (Kahn, 1955). Importance sampling produces an unbiased but often highvariance estimate of \u03b8.\nWe introduce importance sampling with unequal support (US)\u2014a simple new importance sampling estimator that can drastically reduce the variance of importance sampling when the supports of the sampling and target distributions differ. This setting with unequal support can occur, for example, in our earlier example where German documents might include symbols like \u00df, that the classifier will not encounter. US essentially performs importance sampling only on the data that falls within the support of the target distribution, and then scales this estimate by a constant that reflects the relative support of the target and sampling distributions.\nUS typically has lower variance than ordinary importance sampling (sometimes by orders of magnitude), and is unbiased in the important setting where at least one sample falls within the support of the target distribution. If no samples do, then none of the available data could have been generated by the target distribution, and so it is unclear what would make for a reasonable estimate. Furthermore, the conditionally unbiased nature of US is sufficient to allow for its use with concentration inequalities like Hoeffding\u2019s inequality to construct confidence bounds on \u03b8. By contrast, weighted importance sampling (Rubinstein, 1981) is another variant of importance sampling that can reduce variance, but which introduces bias that makes it incompatible with Hoeffding\u2019s inequality."}, {"heading": "Problem Setting and Importance Sampling", "text": "Let f and g be probability density functions (PDFs) for two distributions that we call the target distribution and sampling distribution, respectively. Let h : R \u2192 R be called the evaluation function. Let \u03b8 := Ef [h(X)], where Ef denotes the expected value given that f is the PDF of the random variable(s) in the expectation (in this case, just X). Let F := {x \u2208 R : f(x) 6= 0}, G := {x \u2208 R : g(x) 6= 0}, and H := {x \u2208 R : h(x) 6= 0} be the supports of the target and\nar X\niv :1\n61 1.\n03 45\n1v 1\n[ cs\n.L G\n] 1\n0 N\nov 2\n01 6\nsampling distributions, and the evaluation function, respectively. In this paper we will discuss techniques for estimating \u03b8 given n \u2208 N>0 i.i.d. samples, Xn := {X1, . . . , Xn}, from the sampling distribution, and we focus on the setting where F \u2229H \u2282 G\u2014where the joint support of F and H is a strict subset of the support of G.\nThe importance sampling estimator,\nIS(Xn) := t+ 1\nn\nn\u2211\ni=1\nf(Xi) g(Xi) (h(Xi)\u2212 t), (1)\nis a widely used estimator of \u03b8, where t = 0 (we consider non-zero values of t later). If F \u2229 H \u2286 G, then IS(Xn) is a consistent and unbiased estimator of \u03b8. That is, IS(Xn)\na.s.\u2212\u2192 \u03b8 and Eg[IS(Xn)] = \u03b8 (we review this latter result in Property 1 in the supplemental document).\nA control variate is a constant, t \u2208 R, that is subtracted from each h(Xi) and then added back to the final estimate, as in (1) (Hammersley, 1960; Hammersley and Handscomb, 1964). Although control variates, t(Xi), that depend on the sample, Xi, can be beneficial, for our later purposes we only consider constant control variates. Intuitively, including a constant control variate equates to estimating \u03b8\u2032 := Ef [h\u2032(X)] using importance sampling without a control variate, where h\u2032(x) = h(x) \u2212 t, and then adding t to the resulting estimate to get an estimate of \u03b8.\nLater we show that the variance of importance sampling increases with \u03b82, and so applying importance sampling to h results in higher variance than applying importance sampling to h\u2032 with t \u2248 \u03b8, since then \u03b8\u2032 \u2248 0. That is, by inducing a kind of normalization, a control variate can reduce the variance of estimates without introducing bias\u2014a property that has made the inclusion of control variates a popular topic in some recent works using importance sampling (Dud\u0131\u0301k et al., 2011; Jiang and Li, 2016; Thomas and Brunskill, 2016). Although later we discuss control variates more, for simplicity our derivations focus on importance sampling estimators without control variates. There are also other extensions of the importance sampling estimator that can reduce variance\u2014notably the weighted importance sampling estimator, which we compare to later, and which can provide large reductions of variance and mean squared error, but which introduces bias.\nAn Illustrative Example In this section we present an example that highlights the peculiar behavior of the IS estimator when F \u2229 H 6= G. Let g(x) = 0.5 if x \u2208 [0, 2] and g(x) = 0 otherwise, and let f(x) = 1 if x \u2208 [0, 1] and f(x) = 0 otherwise. So, F = [0, 1] and G = [0, 2]. Let h(x) = 1 if x \u2208 [0, 1] and h(x) = 0 otherwise, so that H = [0, 1]. Notice that \u03b8 = 1.\nSince the sampling and target distributions are both uniform, an obvious estimator of \u03b8 (if f and g are known but h is not) would be the average of the points that fall within F . Let (#Xi \u2208 F ) denote the number of samples in Xn that are in F . Formally, the obvious estimator is\n\u03b8\u0302 := 1 (#Xi \u2208 F ) n\u2211\ni=1\n1F (Xi)h(Xi),\nwhere 1A(x) = 1 if x \u2208 A and 1A(x) = 0 otherwise. Given our knowledge of h, it is straightforward to show that this estimator is equal to 1 if (#Xi \u2208 F ) > 0 and is undefined otherwise\u2014it is exactly correct (has zero bias and variance) as long as at least one sample falls within F . If no samples fall within F , then we have only observed data that will never occur under the target distribution, and so we have no useful information about \u03b8. In this case, we might define our obvious estimator to return an arbitrary value, e.g., zero.\nPerhaps surprisingly, the importance sampling estimator does not degenerate to this obvious estimator:\nIS(Xn) = 1\nn\nn\u2211\ni=1\n1F (Xi)2h(Xi) = 2(#Xi \u2208 F )\nn .\nSince Eg[(#Xi \u2208 F )/n] = 1/2, this estimate is correct in expectation, but does not have zero variance given that at least one sample falls within F . If more than 1/2 of the samples fall within F , this estimate will be an over-estimate of \u03b8, and if fewer than 1/2 of the samples fall within F , this estimate will be an under-estimate. Although correct on average, the importance sampling estimator has unnecessary additional variance relative to the obvious estimator."}, {"heading": "Importance Sampling with Unequal Support", "text": "We propose a new importance sampling estimator, importance sampling with unequal support (ISUS, or US for brevity), that does degenerate to the obvious estimator for our illustrative example. Intuitively, US prunes from Xn the samples that are outside F (or more generally, outside some set C, that we define later) to construct a new data set, X\u2032n, that has fewer samples. This new data set can be viewed as (#Xi \u2208 F ) i.i.d. samples from a different sampling distribution\u2014a distribution with PDF g\u2032, which is simply g, but truncated to only have support on F and re-normalized to integrate to one. US then applies ordinary importance sampling to this new data set.\nFor generality, we allow US to prune from Xn all of the points that are not in a set, C, which can be defined many different ways, including C := F (as in our previous example). Our only requirement is that F \u2229H \u2286 C \u2286 G. In order to compute US, we must compute a value,\nc :=\n\u222b\nC\ng(x) dx,\nwhich is the probability that a sample from the sampling distribution will be in C. In general, C should be chosen to be as small as possible while still ensuring that both 1) F \u2229H \u2286 C \u2286 G (so that informative samples are not discarded) and 2) c can be computed. Ideally, we would select C = F \u2229H , however in some cases c cannot be computed for this value of C. For example, in our later experiments we consider a problem where h and H are not known, but F is, and so we can compute c using C = F , but not C = F \u2229H .\nLet k(Xn) := \u2211n i=1 1C(Xi) be the number of Xi that\nare in C. The US estimator is then defined as:\nUS(Xn) := c\nk(Xn)\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi), (2)\nif k(Xn) > 0, and US(Xn) := 0 if k(Xn) = 0. This is equivalent to applying importance sampling to the pruned data set, X\u2032n, since then g\n\u2032(x) = g(x)/c for x \u2208 C. Also, in (2) we sum over all n samples rather than just the k(Xn) samples in C because f(Xi)h(Xi) = 0 for all Xi not in C."}, {"heading": "Theoretical Analysis of US", "text": "We begin with two simple theorems that elucidate the relationship between IS and US. The proofs of both theorems are straightforward, but deferred to the supplemental document. First, Theorem 1 shows that, when C = G, US degenerates to IS. One case where C = G is when the support of the target distribution and evaluation function are both equal to the support of the sampling distribution, i.e., when F = H = G, and so C = G necessarily. Theorem 1. If C = G, then US(Xn) = IS(Xn).\nTheorem 2 shows that, if we replace c in the definition of US with an empirical estimate, c\u0302(Xn) := k(Xn)/n, then US and IS are equivalent. This provides some intuition for why US tends to outperform IS when C \u2282 G\u2014IS is US, but using an empirical estimate of c (the probability that a sample falls within C), in place of its known value. Theorem 2. If we replace c with an empirical estimate, c\u0302(Xn) := k(Xn)/n, then US(Xn) = IS(Xn).\nIn Table 1 we summarize more theoretical results that clarify the differences between IS and US in several settings. The first setting (denoted by a \u2020 in Table 1) is the standard setting where we consider the ordinary expected value and variance of the two estimators. The second setting (denoted by a \u2021 in Table 1) conditions on the event that at least one sample falls withinC, that is, the event that k(Xn) > 0. This is a reasonable setting to consider if one takes the view that no estimate should be returned if all of the samples are outside C. That is, if the pruned data set, X\u2032n, is empty, then no estimate should be produced or considered (just as IS does not produce an estimate when n = 0\u2014when there are no samples at all). Finally, the third setting (denoted by a ? in Table 1) conditions on the event that k(Xn) = \u03ba\u2014that a specific constant number of the n samples are in C.\nTable 1 and the theorems that it references use additional symbols that we review here. Let \u03c1 := Pr(k(Xn) > 0) = 1\u2212 (1\u2212 c)n be the probability that at least one of n samples is in C. Let Varg(\u00b7) denote the variance given that the random variables within the parenthesis are sampled from the distribution with PDF g. Let\nv := Varg\n( f(X)\ng(X) h(X)\n\u2223\u2223\u2223\u2223X \u2208 C )\nbe the conditional variance of the importance sampling estimate when using a single sample and given that the sample is inC. LetB(n, c) denote the binomial distribution with parameters n and c and let EB(n,c) denote the expected value given that \u03ba \u223c B(n, c).\nAlthough the proofs of the claims in Table 1 are some of the primary contributions of this work, we defer them to the supplemental document because they are straightforward (though lengthy) and do not provide further insights\ninto the results. The primary result of Table 1 is that US is unbiased and often has lower variance in the key setting of interest: when at least one sample is in the support of the target distribution\u2014when k(Xn) > 0. We find this setting compelling because, when no samples are in F , little can be inferred about Ef [h(X)].\nIn this setting (denoted by \u2021 in Table 1) US is an unbiased estimator, while IS is not (although the bias of IS does go to zero as n \u2192 \u221e).1 To understand the source of this bias, consider the bias of IS given that k(Xn) = \u03ba\u2014the ? setting in Table 1. In this case, Eg[IS(Xn)] = \u03bacn\u03b8. Recall that IS uses an empirical estimate of c, i.e., c\u0302 \u2248 \u03ban (as discussed in Theorem 2). When this estimate is correct, terms in \u03bacn\u03b8 cancel, making IS unbiased. Thus, the bias of IS when conditioning on the event that k(Xn) > 0 stems from IS\u2019s use of an estimate of c.\nNext we discuss the variance of the two estimators given that at least one sample falls within C, i.e., in the \u2021 setting. First consider how the variances of IS and US change as c \u2192 0\u2014that is, as the differences between the supports of the sampling and target distributions increases. Specifically, let ci := 1i for i \u2208 N>0. We then have that: Var(IS(Xn)|k(Xn) > 0, ci) \u2265 civn\u03c1 = vn\u03c1i \u2265 vni , since \u03c1 \u2208 (0, 1], and Var(US(Xn)|k(Xn) > 0, ci) = (v/i2)EB(n,c)[1/\u03ba|\u03ba > 0] \u2264 v/i2, since EB(n,c)[\u03ba\u22121|\u03ba > 0] \u2264 1. Thus, as i \u2192 \u221e (as c \u2192 0 logarithmically), and given some fixed n and v, the variance of US goes to zero much faster than the variance of IS. The variance of US (as a function of i) converges to zero linearly (or faster) with a rate of at most 1 while the variance of IS converges to zero sublinearly (at best, logarithmically).\nNext note that the variance of US in this setting is independent of \u03b82, but the variance of IS increases with \u03b82 (see Property 3 in the supplemental document, applied to Theorem 9). To ameliorate this issue, a control variate, t, can be used to center the data so that \u03b8 \u2248 0. However, since \u03b8 is not known a priori, selecting t = \u03b8 is not practical. The term that scales with \u03b82 in the variance of IS given that k(Xn) > 0 therefore means that the variance of IS depends on the quality of the control variate\u2014poor control variates can cause IS to have high variance. By contrast, the variance of US in this setting does not have a term that scales with \u03b82, and so the quality of the control variate is less important.2\nThere is a rare case when IS can have a lower variance than US. First, we assume that the control variate is perfect so that \u03b8 = 0 (which, as discussed before, is impractical) and consider the term that scales with v. From this term, it is clear that US will have lower variance that IS if:\nc2EB(n,c)[\u03ba \u22121|\u03ba > 0] \u2264 c\nn\u03c1 . (3)\n1If we do not condition on the event that k(Xn) > 0, then US is a biased estimator of \u03b8. This is because it is unclear how to define US(Xn) when k(Xn) = 0, and we chose (arbitrarily) to define it to be 0. However, the bias of IS(Xn) in this setting converges quickly to zero, since \u03c1 (the probability that no samples fall within C) converges quickly to one as n\u2192\u221e.\n2The quality of the control variate can still impact the variance of estimates though, since it can change v.\nNotice that this inequality depends only on n and c, which must both be known in order to implement US, and so we can test a priori whether US will have lower variance than IS. That is, if (3) holds, then US will have lower variance than IS, given that k(Xn) > 0. However, if (3) does not hold, it does not mean that IS will have lower variance than US unless the perfect (typically unknown) control variate is used so that \u03b8 = 0."}, {"heading": "Application to Illustrative Example", "text": "Because neither method is always superior, here we consider the application of IS and US to the illustrative example to see when each method works best, and by how much. We consider the setting where C = F , but modify the example slightly. First, although the target distribution is always uniform, we allow for its support to be scaled. Specifically, we define the support of f to be [0, Fmax], where Fmax \u2208 (0, 2]. When Fmax is small, it corresponds to significant differences in support, while large Fmax correspond to small differences (when Fmax = 2, C = F = G and so the two estimators are equivalent). We also modify h to allow for various values of \u03b8. Specifically, we define h(x) = \u22121 + \u03b8 if x < Fmax/2 and h(x) = 1 + \u03b8 if x \u2265 Fmax/2. Notice that, although we defined h in terms of \u03b8, \u03b8 remains Ef [h(X)], and also that using this definition of h and \u03b8 = 0 is an instance that is particularly favorable to IS.\nFor this example, it is straightforward to verify that v = 4/F 2max for any definition of \u03b8, and c = Fmax/2. Given these two values (and \u03b8), we can compute the bias and variance of each estimator. The biases and variances of the two estimators for various settings are depicted in Figure 1. Notice that US is always competitive with IS, although the reverse is not true. Particularly, when Fmax is small (so that c is small), or when \u03b8 is large, US can have orders of magnitude lower variance than IS. Also, as n increases, the two estimators become increasingly similar, since the empirical estimate of c used by IS becomes increasingly accurate, although US is still vastly superior to IS even when n is large if c is correspondingly small. This matches our theoretical analysis from the previous section: we expect US to perform better when c is small (by our convergence rate analysis) or when \u03b82 is large (due to US\u2019s lesser dependence on the quality of the control variate), and we expect the two estimators to becomes increasingly similar as n \u2192 \u221e (because c\u0302 becomes increasingly similar to c).\nNotice also that gains are not only obtained when c is\nso small relative to n that no samples are expected to fall within C (a relatively uninteresting setting). For example, the right-most plot in Figure 1 shows that with Fmax = 0.5, where Pr(k(Xn) > 0) = \u03c1 = 1 \u2212 1250 \u2248 1, the MSE of US is approximately 0.086, while the MSE of IS is approximately 6.08\u2014US is has roughly 1/70 the MSE of IS (1/8 the RMSE).\nPerhaps surprisingly, there are cases where IS has lower variance than US (even when both are unbiased, since \u03b8 = 0). For example, consider the plot with \u03b8 = 0 and n = 10, and the position on the horizontal axis that corresponds to Fmax = 1.0. This is one case where IS is marginally better than US (it has lower variance in both settings, and neither estimator is biased). Intuitively, the IS estimator includes the points outside the support of F , although they have associated values, h(Xi) = 0, which pulls the importance sampling estimate towards zero. In this case, when \u03b8 = 0, this extra pull towards zero happens to be beneficial. However, to remain unbiased given the pull towards zero, IS also increases the magnitudes of the weights associated with points in F , which incurs additional variance. When Fmax is small enough, this additional variance outweighs the variance reduction that results from the extra pull towards zero, and so US is again superior. This intuition is supported by the fact that in Figure 1 IS does not outperform US for small Fmax or \u03b8 \u2265 1, since then a pull towards zero is detrimental.\nFinally, we consider the use of IS and US to create highconfidence upper and lower bounds on \u03b8 using a concentration inequality (Massart, 2007) like Hoeffding\u2019s inequality (Hoeffding, 1963). If b denotes the range of the function f(x)h(x)/g(x), for x \u2208 G, then using Hoeffding\u2019s inequality, we have that IS(Xn)\u2212 b \u221a ln(1/\u03b4)/(2n) is a 1\u2212 \u03b4 confidence lower bound on \u03b8. Similarly, we can use US with Hoeffding\u2019s inequality to create a 1 \u2212 \u03b4 confidence lower bound: US(Xn) \u2212 cb \u221a ln(1/\u03b4)/(2k(Xn)), since the range of the k(Xn) i.i.d. random variables averaged by US(Xn) is cb. Notice that, if k(Xn) = 0, then this second estimator is undefined (one might define the lower bound to be a known lower bound on \u03b8 in this setting). Although we expect that k(Xn) \u2248 cn, the resulting c in the denominator of the US-based bound is within the square root, while the c in the numerator is not, and so the bound constructed using US should tend to be tighter when c is small."}, {"heading": "Application to Diabetes Treatment", "text": "We applied US and IS to the problem of predicting the effectiveness of altering the treatment policy for diabetes 1 for a particular individual. That is, we would like to use prior data from when the individual was treated with one treatment policy to estimate how well a related policy would work. The treatment policy is parameterized by two numbers, CR and CF, and dictates how much insulin a person should inject prior to eating a meal in order to keep his or her blood glucose close to optimum levels. CR and CF are typically specified by a diabetologist and tweaked during follow-up visits every 3\u20136 months. If follow-up visits are not an option, recent research has suggested using reinforcement learning algorithms to tune CR and CF (Bastani, 2014).\nHere we focus on a sub-problem of improving CR and CF\u2014using data collected from an initial range of admissible values of CR and CF to predict how well a new range of values for CR and CF would perform. When collecting data, CR and CF are drawn uniformly from an initial admissible range, and then used for one day (which we view as one episode of a Markov decision process). The performance during each day is measured using an objective function similar to the reward function proposed by Bastani (2014), which measures the deviation of blood glucose from optimum levels, with larger penalties for low blood glucose levels. We refer to the measure of how good the outcome was from one day as the return associated with that day, with larger values being better. Using approximately 30 days of data, our goal is to estimate the expected return if a different distribution of CR and CF were to be used.\nWe consider a specific in silico person\u2014a person sim-\nulated using a metabolic simulator. We used the subject \u201cAdult#003\u201d in the Type 1 Diabetes Metabolic Simulator (T1DMS) (Dalla Man et al., 2014)\u2014a simulator that has been approved by the US Food and Drug Administration as a substitute for animal trials in pre-clinical testing of treatment policies for type 1 diabetes. During each day, the subject is given three or four meals of randomized sizes at randomized times, similar to the experimental setup proposed by Bastani (2014). As a result of this randomness, and the stochastic nature of the T1DMS model, applying the same values of CR and CF can produce different returns if used for multiple days. After analyzing the performance of many CR and CF pairs, we selected an initial range that results in good performance: CR \u2208 [8.5, 11] and CF \u2208 [10, 15]. Using a large number of samples, we computed an estimate of the expected return if different CR and CF values are used for a single day\u2014this estimate is depicted in Figure 2.\nAs described by Bastani (2014), when the value of CR is set appropriately, performance is robust to changes in CF. We therefore focus on possible changes to CR. Specifically, we consider new treatment policies where CF remains sampled from the uniform distribution over [10, 15], but where CR is sampled from the truncated normal distribution over [CRmin, 11], with mean 11 and standard deviation 11 \u2212 CRmin. This distribution places the largest probability densities at the upper end of the range of CR, which favors better policies. As CRmin increases towards 11, the support of the sampling distribution and target distribution become increasingly different (c = (11 \u2212 CRmin)/2.5) and the expected return increases.\nFor each value of CRmin (each of which corresponds to\na value of c), we performed 2,433 trials, each of which involved sampling 30 days of data from the sampling distribution and then using IS, US, and weighted importance sampling (WIS) to estimate the expected return if CR and CF were sampled from the target distribution. Figure 2 displays the bias, variance and mean squared error (MSE) of these 2,433 estimates, using an estimate of ground truth computed using Monte Carlo sampling. Figure 2 also shows the impact of providing a constant control variate to all the estimators: the chosen control variate was the expected return under the sampling distribution.\nNotice that we see the same trend as in the illustrative example\u2014for small c (the best treatment policies, which have small ranges of CR), US significantly outperforms IS. Furthermore, when a decent control variate is not used, the benefits of US are increased, even when controlling for the resulting bias by measuring the mean squared error. We also computed the biases and variances given that k(Xn) > 0, and observed similar results (not shown), which favored US slightly more. Notice that WIS and US perform very similarly. Indeed, if the sampling and target distributions are both uniform, it is straightforward to verify that WIS and US are equivalent. In other experiments (not shown) we found that WIS yields lower variance than US when the target distribution is modified to be even less like the uniform distribution.\nHowever, it is often important to be able to produce confidence intervals around estimates (especially when data is limited), and since WIS is biased, it cannot be used with standard concentration inequalities. We used Hoeffding\u2019s inequality to compute a 90% confidence interval around the estimates produced by IS and US (without control variates and with CRmin = 10.375, so that c = 1/4) using various numbers of samples (days of data). The mean confidence intervals are depicted in Figure 3, which also shows a Monte Carlo estimate of \u03b8, as well as deterministic domain-specific upper and lower bounds on h(X) (denoted by \u201ch range\u201d in the legend). If k(Xn) = 0, then US is not defined, and so the confidence intervals shown for US are averaged only over the instances where k(Xn) > 0. To show how often US returns a solution, Figure 3 also shows \u03c1\u2014the probability that US will produce a confidence bound\u2014using the right verti-\ncal axis for scale. US produces a much tighter confidence interval than IS in all cases. Furthermore, the setting where US often does not return a bound corresponds to the setting where IS produces a confidence interval that is outside the deterministic bound on h(X)\u2014a trivial confidence interval. In additional experiments (not shown) we defined the bounds to be truncated to always be within the deterministic bounds on h(X) and define the bound produced using US to be conservative (equal to the deterministic bounds) when k(Xn) = 0. In this experiment we saw similar results\u2014the confidence intervals produced using US were much tighter than those using IS."}, {"heading": "Conclusion and Future Work", "text": "We have presented a simple new variant of importance sampling, US. Our analytical and empirical results suggest that US can significantly outperform ordinary importance sampling, and we provide an a priori calculation to check for the rare cases where it can perform slightly worse. Unlike some other IS estimators that have been developed to reduce variance (like WIS), US is unbiased given mild conditions that still permit the easy computation of confidence intervals."}, {"heading": "Supplemental Document", "text": "In this supplemental document we prove the various properties and theorems referenced earlier (particularly those in Table 1).\nProperty 1. If F \u2229H \u2286 G then Eg[IS(Xn)] = \u03b8."}, {"heading": "Proof.", "text": "Eg[IS(Xn)] (a) =Eg\n[ f(X)\ng(X) h(X)\n] = \u222b\nG\ng(x) f(x)\ng(x) h(x) dx\n(b) =\n\u222b\nF\u2229H f(x)h(x) dx = Ef [h(X)] = \u03b8,\nwhere (a) holds because IS(Xn) is the mean of n independent and identically distributed random variables, and (b) holds because \u2200x \u2208 G \\ (F \u2229H), f(x) = 0.\nWe now provide a proof of Theorem 1, which states that if C = G, then US(Xn) = IS(Xn).\nProof. In this setting, c = \u222b G g(x) dx = 1 and since every Xi must be within C, k(Xn) = n. So,\nUS(Xn) = c\nk(Xn)\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi)\n= 1\nn\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi).\nWe now provide a proof of Theorem 2, which states that if we replace c with an empirical estimate, c\u0302(Xn) := n\u22121k(Xn), then US(Xn) = IS(Xn).\nProof. Using the empirical estimate, c\u0302(Xn), in place of c within US we have:\nUS(Xn) = c\u0302(Xn)\nk(Xn)\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi)\n= k(Xn)\nnk(Xn)\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi)\n= 1\nn\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi)\n= IS(Xn).\nTheorem 3. If F \u2229H \u2286 G and \u03ba \u2208 N>0, then\nEg[US(Xn)|k(Xn) = \u03ba] = \u03b8.\nProof. Let Prg(X \u2208 C) denote the probability that a sample, X , from the sampling distribution is in C.\nEg[ US(Xn)|k(Xn) = \u03ba]\n=Eg\n[ c\n\u03ba\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi) \u2223\u2223\u2223\u2223\u2223k(Xn) = \u03ba ]\n(a) =Eg\n[ c\n\u03ba\n\u03ba\u2211\ni=1\nf(Xi) g(Xi) h(Xi) \u2223\u2223\u2223\u2223\u2223\u2200i \u2208 {1, . . . , \u03ba}, Xi \u2208 C ]\n(b) =Eg [ c f(X)\ng(X) h(X)\n\u2223\u2223\u2223\u2223X \u2208 C ]\n(c) =\n\u222b\nC\ng(x) Prg(X \u2208 C) c f(x) g(x) h(x) dx\n(d) =\n\u222b\nC\ng(x) c c f(x) g(x) h(x) dx\n=\n\u222b\nC\nf(x)h(x) dx\n(e) =Ef [h(X)],\nwhere (a) holds because f(Xi) = 0 for all but \u03ba of the terms in the summation, and so (by re-ordering the Xi so that these \u03ba terms have indices 1, . . . , \u03ba) we need only sum to \u03ba rather than n, (b) holds because the summation is over \u03ba independent and identically distributed random variables, (c) holds by the definition of conditional expectations, (d) holds because Prg(X \u2208 C) = c, and (e) holds because F \u2229H \u2286 C.\nTheorem 4. If F \u2229H \u2286 G then\nEg[US(Xn)|k(Xn) > 0] = \u03b8."}, {"heading": "Proof.", "text": "Eg[ US(Xn)|k(Xn) > 0]\n= n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba|k(Xn) > 0) Pr(k(Xn) > 0) Eg[US(Xn)|k(Xn) = \u03ba]\n(a) =\nn\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba|k(Xn) > 0) Pr(k(Xn) > 0) \u03b8\n=\u03b8 n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba|k(Xn) > 0) Pr(k(Xn) > 0)\n=\u03b8,\nwhere (a) holds because, by Theorem 3, E[US(Xn)|k(Xn) = \u03ba] = \u03b8.\nTheorem 5. If F \u2229H \u2286 G and \u03ba \u2208 N>0, then\nEg[IS(Xn)|k(Xn) = \u03ba]\u2212 \u03b8 = ( \u03ba cn \u2212 1 ) \u03b8. (4)\nProof. Following roughly the same steps as used to prove\nTheorem 3 we have that:\nEg[ IS(Xn)|k(Xn) = \u03ba]\n=Eg\n[ 1\nn\nn\u2211\ni=1\nf(Xi) g(Xi) h(Xi) \u2223\u2223\u2223\u2223\u2223k(Xn) = \u03ba ]\n=Eg\n[ 1\nn\n\u03ba\u2211\ni=1\nf(Xi) g(Xi) h(Xi) \u2223\u2223\u2223\u2223\u2223\u2200i \u2208 {1, . . . , \u03ba}, Xi \u2208 C ]\n=Eg\n[ \u03ba\nn\nf(X1) g(X1) h(X1)\n\u2223\u2223\u2223\u2223X1 \u2208 C ]\n=\n\u222b\nC\ng(x)\nc\n\u03ba\nn\nf(x) g(x) h(x) dx\n= \u03ba\ncn Ef [h(X)]\n= \u03ba\ncn \u03b8,\nand so (4) follows.\nTheorem 6. If F \u2229H \u2286 G then\nEg[IS(Xn)|k(Xn) > 0] = 1\n1\u2212 (1\u2212 c)n \u03b8.\nProof. Recall from Property 1 that Eg[IS(Xn)] = \u03b8. By marginalizing over whether or not k(Xn) > 0, we also have that:\nEg[IS(Xn)] =Pr(k(Xn) > 0)Eg[IS(Xn)|k(Xn) > 0] + Pr(k(Xn) = 0)Eg[IS(Xn)|k(Xn) = 0].\nSo,\nEg[ IS(Xn)|k(Xn) > 0]\n= \u03b8 \u2212 Pr(k(Xn) = 0)Eg[IS(Xn)|k(Xn) = 0]\nPr(k(Xn) > 0)\n(a) =\n\u03b8\n1\u2212 (1\u2212 c)n ,\nwhere (a) holds because Eg[IS(Xn)|k(Xn) = 0] = 0 and Pr(k(Xn) > 0) = 1\u2212Pr(k(Xn) = 0) = 1\u2212 (1\u2212 c)n.\nTheorem 7. If F \u2229H \u2286 G, then Eg[US(Xn)] = (1\u2212 (1\u2212 c)n)\u03b8."}, {"heading": "Proof.", "text": "Eg[ US(Xn)]\n=Pr(k(Xn) > 0)\ufe38 \ufe37\ufe37 \ufe38 =1\u2212(1\u2212c)n Eg[US(Xn)|k(Xn) > 0]\ufe38 \ufe37\ufe37 \ufe38 =\u03b8, by Theorem 4\n+ Pr(k(Xn) = 0)Eg[US(Xn)|k(Xn) = 0]\ufe38 \ufe37\ufe37 \ufe38 =0\n=(1\u2212 (1\u2212 c)n)\u03b8. Before continuing, recall the following property (which\nwe prove for completeness):\nProperty 2. Let X1, . . . , Xn be n independent and identically distributed random variables, each with finite mean and variance. Then,\nE\n  ( 1\nn\nn\u2211\ni=1\nXi\n)2  = 1\nn Var (X1) +E [X1]\n2 .\nProof. Recall that\nVar\n( 1\nn\nn\u2211\ni=1\nXi ) = E [( 1\nn\nn\u2211\ni=1\nXi )2] \u2212E [ 1\nn\nn\u2211\ni=1\nXi ]2 .\nSo, by rearranging terms:\nE\n[( 1\nn\nn\u2211\ni=1\nXi )2] = 1\nn2 Var\n( n\u2211\ni=1\nXi ) + 1\nn2 E\n[ n\u2211\ni=1\nXi ]2 .\nSince the Xi are independent and identically distributed, we therefore have that:\nE\n  ( 1\nn\nn\u2211\ni=1\nXi\n)2  = 1\nn2 nVar (X1) +\n1\nn2 n2E [X1]\n2\n= 1\nn Var (X1) +E [X1]\n2 .\nTheorem 8. If F \u2229H \u2286 G then\nVarg(US(Xn)|k(Xn > 0)) =c2vEB(n,c) [ 1\n\u03ba\n\u2223\u2223\u2223\u2223\u03ba > 0 ] ."}, {"heading": "Proof.", "text": "Varg(US(Xn)|k(Xn) > 0) =Eg[US(Xn) 2|k(Xn) > 0]\u2212Eg[US(Xn)|k(Xn) > 0]2\n=Eg[US(Xn) 2|k(Xn) > 0]\u2212 \u03b82\n=\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba) Pr(k(Xn) > 0) Eg[US(Xn)\n2|k(Xn) = \u03ba] ) \u2212 \u03b82.\n(5)\nWe will write y to denote a vector in Rn, the elements of which are y1, . . . , yn \u2208 R. We also write yi:j to denote the ith through jth entries of y, i.e., yi:j := [yi, yi+1, . . . , yj\u22121, yj ]. Let Gn\u03ba = {y \u2208 Gn : k(y) = \u03ba} be the set of all possible tuples of n samples where exactly \u03ba are in C. We also overload the definition of g by defining g(y) := \u220fn i=1 g(yi). Using this notation, we have that (where . . . are used to denote that a long line is split across multiple lines via scalar multiplication):\nEg[ US(Xn) 2|k(Xn) = \u03ba]\n=\n\u222b\nGn\u03ba\ng(y)\nPr(k(Xn) = \u03ba) US(y)2 dy\n(a) =\n( n \u03ba )\nPr(k(Xn) = \u03ba)\n\u222b\nC\u03ba\n\u222b\n(G\\C)n\u2212\u03ba g(y)US(y)2 dy1:\u03ba dy\u03ba+1:n\n(b) =\n( n \u03ba )\nPr(k(Xn) = \u03ba)\n\u222b\nC\u03ba\n\u222b\n(G\\C)n\u2212\u03ba g(y1:\u03ba)g(y\u03ba+1:n) . . .\nUS(y1:\u03ba) 2 dy1:\u03ba dy\u03ba+1:n\n=\n( n \u03ba ) ( n \u03ba ) c\u03ba(1\u2212 c)n\u2212\u03ba \u222b C\u03ba g(y1:\u03ba)US(y1:\u03ba) 2 dy1:\u03ba . . . \u222b\n(G\\C)n\u2212\u03ba g(y\u03ba+1:n) dy\u03ba+1:n \ufe38 \ufe37\ufe37 \ufe38 =(1\u2212c)n\u2212\u03ba\n=\n( n \u03ba ) (1\u2212 c)n\u2212k(\nn \u03ba\n) c\u03ba(1\u2212 c)n\u2212\u03ba\n\u222b\nC\u03ba g(y1:\u03ba)\n( c\n\u03ba\n\u03ba\u2211\ni=1\nf(yi) g(yi) h(yi)\n)2 dy1:\u03ba\n= c2\nc\u03ba\n\u222b\nC\u03ba g(y1:\u03ba)\n( 1\n\u03ba\n\u03ba\u2211\ni=1\nf(yi) g(yi) h(yi)\n)2 dy1:\u03ba\n(c) =c2\n\u222b\nC\u03ba\ng(y1:\u03ba)\nPr(k(X\u03ba) = \u03ba)\n( 1\n\u03ba\n\u03ba\u2211\ni=1\nf(yi) g(yi) h(yi)\n)2 dy1:\u03ba\n=c2Eg\n[( 1\n\u03ba\n\u03ba\u2211\ni=1\nf(Xi) g(Xi) h(Xi) )2\u2223\u2223\u2223\u2223\u2223X\u03ba \u2208 C \u03ba ]\n(d) =c2\n( 1\n\u03ba v +E\n[ f(X)\ng(X) h(X)\n\u2223\u2223\u2223\u2223X \u223c g,X \u2208 C ]2)\n=c2 ( 1\n\u03ba v +\n(\u222b\nC\ng(x)\nc\nf(x) g(x) h(x) dx\n)2) = c2\n\u03ba v + \u03b82, (6)\nwhere (a) comes from 1) the fact that there are ( n \u03ba ) ways of ordering n elements such that \u03ba are in C and n \u2212 \u03ba are in G \\ C, and 2) the fact that US does not depend on the order of its inputs, (b) comes from 1) the property that US(y) does not change if additional samples are appended to y that are not in C and 2) the fact that g(y) can be decomposed into g(y1:\u03ba)g(y\u03ba+1:n) since it represents the joint probability density function for n independent and identically distributed random variables, (c) comes from the fact that Pr(k(X\u03ba) = \u03ba) = c\u03ba, and (d) comes from Property 2.\nCombining (5) with (6) we have that\nVarg(US(Xn)|k(Xn) > 0)\n=\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\nPr(k(Xn) > 0)\n( c2\n\u03ba v + \u03b82\n)) \u2212 \u03b82\n=c2v\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\nPr(k(Xn) > 0)\n1\n\u03ba\n)\n+ \u03b82\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\nPr(k(Xn) > 0)\n)\n\ufe38 \ufe37\ufe37 \ufe38 =1\n\u2212\u03b82\n=c2v n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\nPr(k(Xn) > 0)\n1\n\u03ba\n=c2vEB(n,c)\n[ 1\n\u03ba\n\u2223\u2223\u2223\u2223\u03ba > 0 ] .\nTheorem 9. If F \u2229H \u2286 G then\nVarg(IS(Xn)|k(Xn > 0)) = v c n\u03c1 + \u03b82 c\u03c1(n\u2212 1) + \u03c1\u2212 cn cn\u03c12 .\nProof. At a high level, this proof is similar to the proof of Theorem 8, but uses the property that IS(Xn) = k(Xn) cn US(Xn).\nVarg(IS(Xn)|k(Xn) > 0) =Eg[IS(Xn) 2|k(Xn) > 0]\u2212Eg[IS(Xn)|k(Xn) > 0]2\n(a) =Eg[IS(Xn) 2|k(Xn) > 0]\u2212 (\n\u03b8 1\u2212 (1\u2212 c)n )2\n=\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba) Pr(k(Xn) > 0) Eg[IS(Xn)\n2|k(Xn) = \u03ba] )\n\u2212 (\n\u03b8 1\u2212 (1\u2212 c)n )2 , (7)\nwhere (a) comes from Theorem 6. Also,\nEg[ IS(Xn) 2|k(Xn) = \u03ba]\n(a) =Eg\n[( k(Xn)\ncn US(Xn) )2\u2223\u2223\u2223\u2223\u2223k(Xn) = \u03ba ]\n= \u03ba2\nc2n2 Eg[US(Xn)\n2|k(Xn) = \u03ba] (b)= \u03ba 2\nc2n2\n( c2\n\u03ba v + \u03b82\n) ,(8)\nwhere (a) holds because IS(Xn) = k(Xn)cn US(Xn) and (b) follows from (6). Using the shorthand, \u03c1 := Pr(k(Xn) > 0) = 1 \u2212 (1 \u2212 c)n and by combining (7) with (8) we have\nthat:\nVarg(IS(Xn)|k(Xn) > 0)\n=\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\nPr(k(Xn) > 0)\n\u03ba2\nc2n2\n( c2\n\u03ba v + \u03b82\n))\n\u2212 (\n\u03b8 1\u2212 (1\u2212 c)n )2\n= v\nn2\u03c1\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\u03ba\n)\n\ufe38 \ufe37\ufe37 \ufe38 =EB(n,c)[\u03ba]=nc\n+ \u03b82\nc2n2\u03c1\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\u03ba 2\n)\n\ufe38 \ufe37\ufe37 \ufe38 =EB(n,c)[\u03ba2]=nc((n\u22121)c+1)\n\u2212 ( \u03b8\n\u03c1\n)2\n=v c n\u03c1 + \u03b82((n\u2212 1)c+ 1) cn\u03c1 \u2212 \u03b8 2 \u03c12\n=v c\nn\u03c1 + \u03b82 c\u03c1(n\u2212 1) + \u03c1\u2212 cn cn\u03c12 .\nTheorem 10. If F \u2229H \u2286 G then\nVarg(US(Xn)) = \u03c1c 2vEB(n,c)\n[ 1\n\u03ba\n\u2223\u2223\u2223\u2223\u03ba > 0 ] +\u03b82\u03c1(1\u2212\u03c1)."}, {"heading": "Proof.", "text": "Varg(US(Xn)) = Eg[US(Xn) 2]\u2212Eg[US(Xn)]2\n(a) =Eg[US(Xn) 2]\u2212 \u03c12\u03b82\n=\n( n\u2211\n\u03ba=0\nPr(k(Xn) = \u03ba)Eg[US(Xn) 2|k(Xn) = \u03ba]\n)\n\u2212 \u03c12\u03b82\n=Pr(k(Xn) = 0)Eg[US(Xn) 2|k(Xn) = 0]\ufe38 \ufe37\ufe37 \ufe38 =0\n+\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)Eg[US(Xn) 2|k(Xn) = \u03ba]\n)\n\u2212 \u03c12\u03b82\n(b) =\u03c1\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\n\u03c1\n( c2\n\u03ba v + \u03b82\n)) \u2212 \u03c12\u03b82\n=\u03c1c2v\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\n\u03c1\n1\n\u03ba\n)\n+ \u03c1\u03b82\n( n\u2211\n\u03ba=1\nPr(k(Xn) = \u03ba)\n\u03c1\n)\n\ufe38 \ufe37\ufe37 \ufe38 =1\n\u2212\u03c12\u03b82\n=\u03c1c2vEB(n,c)\n[ 1\n\u03ba\n\u2223\u2223\u2223\u2223\u03ba > 0 ] + \u03b82\u03c1(1\u2212 \u03c1),\nwhere (a) comes from Theorem 7, (b) comes from (6) and from multiplying one term by \u03c1/\u03c1 = 1.\nTheorem 11. If F \u2229H \u2286 G then\nVarg(IS(Xn)) = 1\nn\n( cv + \u03b82 ( 1 c \u2212 1 )) ."}, {"heading": "Proof.", "text": "Varg(IS(Xn)) (a) =\n1 n Varg(IS(X))\n= 1\nn\n( Eg[IS(X) 2]\u2212Eg[IS(X)]2 )\n(b) = 1\nn\n( Eg[IS(X) 2]\u2212 \u03b82 )\n= 1\nn\n( Pr(X \u2208 C|X \u223c g)Eg[IS(X)2|X \u2208 C]\n+ Pr(X 6\u2208 C|X \u223c g)Eg[IS(X)2|X 6\u2208 C]\ufe38 \ufe37\ufe37 \ufe38 =0\n\u2212\u03b82 )\n= 1\nn\n( cEg[IS(X) 2|X \u2208 C]\u2212 \u03b82 )\n(c) = 1\nn\n( c ( v + \u03b82\nc2\n) \u2212 \u03b82\n)\n= 1\nn\n( cv + \u03b82 ( 1 c \u2212 1 )) ,\nwhere (a) holds because IS(Xn) is the sum of n independent and identically distributed random variables, (b) comes from Property 1, and (c) comes from applying (8) with n = 1 and \u03ba = 1. Property 3. c\u03c1(n\u2212 1) + \u03c1\u2212 cn \u2265 0, Proof. Recall that \u03c1 := 1\u2212 (1\u2212 c)n, so we have that: c\u03c1(n\u2212 1) + \u03c1\u2212 cn = c(1\u2212 (1\u2212 c)n)(n\u2212 1) + 1\u2212 (1\u2212 c)n \u2212 cn\n=(cn\u2212 c)(1\u2212 (1\u2212 c)n) + 1\u2212 (1\u2212 c)n \u2212 cn =cn\u2212 cn(1\u2212 c)n \u2212 c+ c(1\u2212 c)n + 1\u2212 (1\u2212 c)n \u2212 cn =(1\u2212 c)n(\u2212cn+ c\u2212 1)\u2212 c+ 1. (9) We will show by induction that (9) is non-negative for all n \u2265 1. First, notice that for the base case where n = 1, (9) is equal to zero. For the inductive step we will show that (9) is non-negative for n+1 given that it is non-negative for n.\n(1\u2212 c)n+1(\u2212c(n+ 1) + c\u2212 1)\u2212 c+ 1 =(1\u2212 c)(1\u2212 c)n(\u2212cn+ c\u2212 1)\u2212 (1\u2212 c)n+1c\n+ (\u2212c+ 1)(1\u2212 c+ c) =(1\u2212 c) ( (1\u2212 c)n(\u2212cn+ c\u2212 1)\u2212 c+ 1 )\n\ufe38 \ufe37\ufe37 \ufe38 (a)\n\u2212 (1\u2212 c)n+1c+ c(1\u2212 c), where (a) is positive by the inductive hypothesis, and so we need only show that \u2212(1\u2212 c)n+1c+ c(1\u2212 c) \u2265 0. Since \u2212(1\u2212 c)n+1c+ c(1\u2212 c) =c ( (1\u2212 c)\u2212 (1\u2212 c)n+1 ) ,\nand 1\u2212c \u2265 (1\u2212c)n+1 because c \u2208 (0, 1], we conclude."}], "references": [{"title": "Model-free intelligent diabetes management using machine learning", "author": ["M. Bastani"], "venue": "Master\u2019s thesis, Department of Computing Science, University of Alberta,", "citeRegEx": "Bastani.,? \\Q2014\\E", "shortCiteRegEx": "Bastani.", "year": 2014}, {"title": "The uva/padova type 1 diabetes simulator new features", "author": ["C. Dalla Man", "F. Micheletto", "D. Lv", "M. Breton", "B. Kovatchev", "C. Cobelli"], "venue": "Journal of diabetes science and technology,", "citeRegEx": "Man et al\\.,? \\Q2014\\E", "shortCiteRegEx": "Man et al\\.", "year": 2014}, {"title": "Doubly robust policy evaluation and learning", "author": ["M. Dud\u0131\u0301k", "J. Langford", "L. Li"], "venue": "In Proceedings of the TwentyEighth International Conference on Machine Learning,", "citeRegEx": "Dud\u0131\u0301k et al\\.,? \\Q2011\\E", "shortCiteRegEx": "Dud\u0131\u0301k et al\\.", "year": 2011}, {"title": "Monte carlo methods for solving multivariable problems", "author": ["J.M. Hammersley"], "venue": "Annals of the New York Academy of Sciences,", "citeRegEx": "Hammersley.,? \\Q1960\\E", "shortCiteRegEx": "Hammersley.", "year": 1960}, {"title": "Monte carlo methods, methuen & co", "author": ["J.M. Hammersley", "D.C. Handscomb"], "venue": null, "citeRegEx": "Hammersley and Handscomb.,? \\Q1964\\E", "shortCiteRegEx": "Hammersley and Handscomb.", "year": 1964}, {"title": "Probability inequalities for sums of bounded random variables", "author": ["W. Hoeffding"], "venue": "Journal of the American Statistical Association,", "citeRegEx": "Hoeffding.,? \\Q1963\\E", "shortCiteRegEx": "Hoeffding.", "year": 1963}, {"title": "Doubly robust off-policy value evaluation for reinforcement learning", "author": ["N. Jiang", "L. Li"], "venue": "In International Conference on Machine Learning,", "citeRegEx": "Jiang and Li.,? \\Q2016\\E", "shortCiteRegEx": "Jiang and Li.", "year": 2016}, {"title": "Use of different Monte Carlo sampling techniques", "author": ["H. Kahn"], "venue": "Technical Report P-766,", "citeRegEx": "Kahn.,? \\Q1955\\E", "shortCiteRegEx": "Kahn.", "year": 1955}, {"title": "Concentration Inequalities and Model Selection", "author": ["P. Massart"], "venue": null, "citeRegEx": "Massart.,? \\Q2007\\E", "shortCiteRegEx": "Massart.", "year": 2007}, {"title": "Simulation and the Monte Carlo method", "author": ["R. Rubinstein"], "venue": null, "citeRegEx": "Rubinstein.,? \\Q1981\\E", "shortCiteRegEx": "Rubinstein.", "year": 1981}, {"title": "Data-efficient off-policy policy evaluation for reinforcement learning", "author": ["P.S. Thomas", "E. Brunskill"], "venue": "In International Conference on Machine Learning,", "citeRegEx": "Thomas and Brunskill.,? \\Q2016\\E", "shortCiteRegEx": "Thomas and Brunskill.", "year": 2016}], "referenceMentions": [{"referenceID": 7, "context": "A classical approach to this problem is to use importance sampling (IS), which reweighs the observed samples to account for the difference between the target and sampling distributions (Kahn, 1955).", "startOffset": 185, "endOffset": 197}, {"referenceID": 9, "context": "By contrast, weighted importance sampling (Rubinstein, 1981) is another variant of importance sampling that can reduce variance, but which introduces bias that makes it incompatible with Hoeffding\u2019s inequality.", "startOffset": 42, "endOffset": 60}, {"referenceID": 3, "context": "A control variate is a constant, t \u2208 R, that is subtracted from each h(Xi) and then added back to the final estimate, as in (1) (Hammersley, 1960; Hammersley and Handscomb, 1964).", "startOffset": 128, "endOffset": 178}, {"referenceID": 4, "context": "A control variate is a constant, t \u2208 R, that is subtracted from each h(Xi) and then added back to the final estimate, as in (1) (Hammersley, 1960; Hammersley and Handscomb, 1964).", "startOffset": 128, "endOffset": 178}, {"referenceID": 2, "context": "That is, by inducing a kind of normalization, a control variate can reduce the variance of estimates without introducing bias\u2014a property that has made the inclusion of control variates a popular topic in some recent works using importance sampling (Dud\u0131\u0301k et al., 2011; Jiang and Li, 2016; Thomas and Brunskill, 2016).", "startOffset": 248, "endOffset": 317}, {"referenceID": 6, "context": "That is, by inducing a kind of normalization, a control variate can reduce the variance of estimates without introducing bias\u2014a property that has made the inclusion of control variates a popular topic in some recent works using importance sampling (Dud\u0131\u0301k et al., 2011; Jiang and Li, 2016; Thomas and Brunskill, 2016).", "startOffset": 248, "endOffset": 317}, {"referenceID": 10, "context": "That is, by inducing a kind of normalization, a control variate can reduce the variance of estimates without introducing bias\u2014a property that has made the inclusion of control variates a popular topic in some recent works using importance sampling (Dud\u0131\u0301k et al., 2011; Jiang and Li, 2016; Thomas and Brunskill, 2016).", "startOffset": 248, "endOffset": 317}, {"referenceID": 8, "context": "Finally, we consider the use of IS and US to create highconfidence upper and lower bounds on \u03b8 using a concentration inequality (Massart, 2007) like Hoeffding\u2019s inequality (Hoeffding, 1963).", "startOffset": 128, "endOffset": 143}, {"referenceID": 5, "context": "Finally, we consider the use of IS and US to create highconfidence upper and lower bounds on \u03b8 using a concentration inequality (Massart, 2007) like Hoeffding\u2019s inequality (Hoeffding, 1963).", "startOffset": 172, "endOffset": 189}, {"referenceID": 0, "context": "If follow-up visits are not an option, recent research has suggested using reinforcement learning algorithms to tune CR and CF (Bastani, 2014).", "startOffset": 127, "endOffset": 142}, {"referenceID": 0, "context": "If follow-up visits are not an option, recent research has suggested using reinforcement learning algorithms to tune CR and CF (Bastani, 2014). Here we focus on a sub-problem of improving CR and CF\u2014using data collected from an initial range of admissible values of CR and CF to predict how well a new range of values for CR and CF would perform. When collecting data, CR and CF are drawn uniformly from an initial admissible range, and then used for one day (which we view as one episode of a Markov decision process). The performance during each day is measured using an objective function similar to the reward function proposed by Bastani (2014), which measures the deviation of blood glucose from optimum levels, with larger penalties for low blood glucose levels.", "startOffset": 128, "endOffset": 649}, {"referenceID": 0, "context": "If follow-up visits are not an option, recent research has suggested using reinforcement learning algorithms to tune CR and CF (Bastani, 2014). Here we focus on a sub-problem of improving CR and CF\u2014using data collected from an initial range of admissible values of CR and CF to predict how well a new range of values for CR and CF would perform. When collecting data, CR and CF are drawn uniformly from an initial admissible range, and then used for one day (which we view as one episode of a Markov decision process). The performance during each day is measured using an objective function similar to the reward function proposed by Bastani (2014), which measures the deviation of blood glucose from optimum levels, with larger penalties for low blood glucose levels. We refer to the measure of how good the outcome was from one day as the return associated with that day, with larger values being better. Using approximately 30 days of data, our goal is to estimate the expected return if a different distribution of CR and CF were to be used. We consider a specific in silico person\u2014a person simulated using a metabolic simulator. We used the subject \u201cAdult#003\u201d in the Type 1 Diabetes Metabolic Simulator (T1DMS) (Dalla Man et al., 2014)\u2014a simulator that has been approved by the US Food and Drug Administration as a substitute for animal trials in pre-clinical testing of treatment policies for type 1 diabetes. During each day, the subject is given three or four meals of randomized sizes at randomized times, similar to the experimental setup proposed by Bastani (2014). As a result of this randomness, and the stochastic nature of the T1DMS model, applying the same values of CR and CF can produce different returns if used for multiple days.", "startOffset": 128, "endOffset": 1577}, {"referenceID": 0, "context": "If follow-up visits are not an option, recent research has suggested using reinforcement learning algorithms to tune CR and CF (Bastani, 2014). Here we focus on a sub-problem of improving CR and CF\u2014using data collected from an initial range of admissible values of CR and CF to predict how well a new range of values for CR and CF would perform. When collecting data, CR and CF are drawn uniformly from an initial admissible range, and then used for one day (which we view as one episode of a Markov decision process). The performance during each day is measured using an objective function similar to the reward function proposed by Bastani (2014), which measures the deviation of blood glucose from optimum levels, with larger penalties for low blood glucose levels. We refer to the measure of how good the outcome was from one day as the return associated with that day, with larger values being better. Using approximately 30 days of data, our goal is to estimate the expected return if a different distribution of CR and CF were to be used. We consider a specific in silico person\u2014a person simulated using a metabolic simulator. We used the subject \u201cAdult#003\u201d in the Type 1 Diabetes Metabolic Simulator (T1DMS) (Dalla Man et al., 2014)\u2014a simulator that has been approved by the US Food and Drug Administration as a substitute for animal trials in pre-clinical testing of treatment policies for type 1 diabetes. During each day, the subject is given three or four meals of randomized sizes at randomized times, similar to the experimental setup proposed by Bastani (2014). As a result of this randomness, and the stochastic nature of the T1DMS model, applying the same values of CR and CF can produce different returns if used for multiple days. After analyzing the performance of many CR and CF pairs, we selected an initial range that results in good performance: CR \u2208 [8.5, 11] and CF \u2208 [10, 15]. Using a large number of samples, we computed an estimate of the expected return if different CR and CF values are used for a single day\u2014this estimate is depicted in Figure 2. As described by Bastani (2014), when the value of CR is set appropriately, performance is robust to changes in CF.", "startOffset": 128, "endOffset": 2111}], "year": 2016, "abstractText": "Importance sampling is often used in machine learning when training and testing data come from different distributions. In this paper we propose a new variant of importance sampling that can reduce the variance of importance samplingbased estimates by orders of magnitude when the supports of the training and testing distributions differ. After motivating and presenting our new importance sampling estimator, we provide a detailed theoretical analysis that characterizes both its bias and variance relative to the ordinary importance sampling estimator (in various settings, which include cases where ordinary importance sampling is biased, while our new estimator is not, and vice versa). We conclude with an example of how our new importance sampling estimator can be used to improve estimates of how well a new treatment policy for diabetes will work for an individual, using only data from when the individual used a previous treatment policy. Introduction A key challenge in artificial intelligence is to estimate the expectation of a random variable. Instances of this problem arise in areas ranging from planning and decision making (e.g., estimating the expected sum of rewards produced by a policy for decision making under uncertainty) to probabilistic inference. Although the estimation of an expected value is straightforward if we can generate many independent and identically distributed (i.i.d.) samples from the relevant probability distribution (which we refer to as the target distribution), we may not have generative access to the target distribution. Instead, we might only have data from a different distribution that we call the sampling distribution. For example, in off-policy evaluation for reinforcement learning, the goal is to estimate the expected sum of rewards that a decision policy will produce, given only data gathered using some other policy. Similarly, in supervised learning, we may wish to predict the performance of a regressor or classifier if it were to be applied to data that comes from a distribution that differs from the distribution of the available data (e.g., we might predict the accuracy of a classifier for hand-written letters given that observed letter frequencies come from English, using a corpus of labeled letters collected from German documents). More precisely, we consider the problem of estimating \u03b8 := E[h(X)], where h is a real-valued function and the expectation is over the random variable X , which is a sample from the target distribution. As input we assume access to n i.i.d. samples from a sampling distribution that is different from the target distribution. A classical approach to this problem is to use importance sampling (IS), which reweighs the observed samples to account for the difference between the target and sampling distributions (Kahn, 1955). Importance sampling produces an unbiased but often highvariance estimate of \u03b8. We introduce importance sampling with unequal support (US)\u2014a simple new importance sampling estimator that can drastically reduce the variance of importance sampling when the supports of the sampling and target distributions differ. This setting with unequal support can occur, for example, in our earlier example where German documents might include symbols like \u00df, that the classifier will not encounter. US essentially performs importance sampling only on the data that falls within the support of the target distribution, and then scales this estimate by a constant that reflects the relative support of the target and sampling distributions. US typically has lower variance than ordinary importance sampling (sometimes by orders of magnitude), and is unbiased in the important setting where at least one sample falls within the support of the target distribution. If no samples do, then none of the available data could have been generated by the target distribution, and so it is unclear what would make for a reasonable estimate. Furthermore, the conditionally unbiased nature of US is sufficient to allow for its use with concentration inequalities like Hoeffding\u2019s inequality to construct confidence bounds on \u03b8. By contrast, weighted importance sampling (Rubinstein, 1981) is another variant of importance sampling that can reduce variance, but which introduces bias that makes it incompatible with Hoeffding\u2019s inequality. Problem Setting and Importance Sampling Let f and g be probability density functions (PDFs) for two distributions that we call the target distribution and sampling distribution, respectively. Let h : R \u2192 R be called the evaluation function. Let \u03b8 := Ef [h(X)], where Ef denotes the expected value given that f is the PDF of the random variable(s) in the expectation (in this case, just X). Let F := {x \u2208 R : f(x) 6= 0}, G := {x \u2208 R : g(x) 6= 0}, and H := {x \u2208 R : h(x) 6= 0} be the supports of the target and ar X iv :1 61 1. 03 45 1v 1 [ cs .L G ] 1 0 N ov 2 01 6 sampling distributions, and the evaluation function, respectively. In this paper we will discuss techniques for estimating \u03b8 given n \u2208 N>0 i.i.d. samples, Xn := {X1, . . . , Xn}, from the sampling distribution, and we focus on the setting where F \u2229H \u2282 G\u2014where the joint support of F and H is a strict subset of the support of G. The importance sampling estimator, IS(Xn) := t+ 1 n n \u2211 i=1 f(Xi) g(Xi) (h(Xi)\u2212 t), (1) is a widely used estimator of \u03b8, where t = 0 (we consider non-zero values of t later). If F \u2229 H \u2286 G, then IS(Xn) is a consistent and unbiased estimator of \u03b8. That is, IS(Xn) a.s. \u2212\u2192 \u03b8 and Eg[IS(Xn)] = \u03b8 (we review this latter result in Property 1 in the supplemental document). A control variate is a constant, t \u2208 R, that is subtracted from each h(Xi) and then added back to the final estimate, as in (1) (Hammersley, 1960; Hammersley and Handscomb, 1964). Although control variates, t(Xi), that depend on the sample, Xi, can be beneficial, for our later purposes we only consider constant control variates. Intuitively, including a constant control variate equates to estimating \u03b8\u2032 := Ef [h\u2032(X)] using importance sampling without a control variate, where h\u2032(x) = h(x) \u2212 t, and then adding t to the resulting estimate to get an estimate of \u03b8. Later we show that the variance of importance sampling increases with \u03b8, and so applying importance sampling to h results in higher variance than applying importance sampling to h\u2032 with t \u2248 \u03b8, since then \u03b8\u2032 \u2248 0. That is, by inducing a kind of normalization, a control variate can reduce the variance of estimates without introducing bias\u2014a property that has made the inclusion of control variates a popular topic in some recent works using importance sampling (Dud\u0131\u0301k et al., 2011; Jiang and Li, 2016; Thomas and Brunskill, 2016). Although later we discuss control variates more, for simplicity our derivations focus on importance sampling estimators without control variates. There are also other extensions of the importance sampling estimator that can reduce variance\u2014notably the weighted importance sampling estimator, which we compare to later, and which can provide large reductions of variance and mean squared error, but which introduces bias. An Illustrative Example In this section we present an example that highlights the peculiar behavior of the IS estimator when F \u2229 H 6= G. Let g(x) = 0.5 if x \u2208 [0, 2] and g(x) = 0 otherwise, and let f(x) = 1 if x \u2208 [0, 1] and f(x) = 0 otherwise. So, F = [0, 1] and G = [0, 2]. Let h(x) = 1 if x \u2208 [0, 1] and h(x) = 0 otherwise, so that H = [0, 1]. Notice that \u03b8 = 1. Since the sampling and target distributions are both uniform, an obvious estimator of \u03b8 (if f and g are known but h is not) would be the average of the points that fall within F . Let (#Xi \u2208 F ) denote the number of samples in Xn that are in F . Formally, the obvious estimator is \u03b8\u0302 := 1 (#Xi \u2208 F ) n \u2211 i=1 1F (Xi)h(Xi), where 1A(x) = 1 if x \u2208 A and 1A(x) = 0 otherwise. Given our knowledge of h, it is straightforward to show that this estimator is equal to 1 if (#Xi \u2208 F ) > 0 and is undefined otherwise\u2014it is exactly correct (has zero bias and variance) as long as at least one sample falls within F . If no samples fall within F , then we have only observed data that will never occur under the target distribution, and so we have no useful information about \u03b8. In this case, we might define our obvious estimator to return an arbitrary value, e.g., zero. Perhaps surprisingly, the importance sampling estimator does not degenerate to this obvious estimator:", "creator": "LaTeX with hyperref package"}}}